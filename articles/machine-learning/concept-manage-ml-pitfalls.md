---
title: 通过 AutoML 避免过度拟合和不均衡数据
titleSuffix: Azure Machine Learning
description: 通过 Azure 机器学习的自动化机器学习解决方案，识别和管理 ML 模型的常见错误。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.reviewer: nibaccam
author: nibaccam
ms.author: nibaccam
ms.date: 04/09/2020
ms.openlocfilehash: e1191c01ce3f62f34c351cefd29a5e40aa68bfd3
ms.sourcegitcommit: fdec8e8bdbddcce5b7a0c4ffc6842154220c8b90
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/19/2020
ms.locfileid: "83658397"
---
# <a name="prevent-overfitting-and-imbalanced-data-with-automated-machine-learning"></a>通过自动化机器学习防止过度拟合和不均衡数据

在生成机器学习模型时，过度拟合和不均衡数据是常见的错误。 默认情况下，Azure 机器学习的自动化机器学习提供图表和指标来帮助你识别这些风险，并实施最佳做法以帮助缓解这些风险。 

## <a name="identify-over-fitting"></a>识别过度拟合

如果模型非常适应定型数据，则在机器学习中会发生过度拟合，因此无法准确预测不可见的测试数据。 换句话说，模型只是简单地记住了定型数据中的特定模式和噪音，但并不太灵活，无法预测实时数据。

请考虑以下已定型的模型及其相应的定型和测试准确度。

| “模型” | 定型准确度 | 测试准确度 |
|-------|----------------|---------------|
| A | 99.9% | 95% |
| B | 87% | 87% |
| C | 99.9% | 45% |

就模型 A 而言，存在一种常见的误解 - 如果不可见数据的测试准确度低于定型准确度，则该模型过度拟合。 但是，测试准确度应始终小于定型准确度，并且过度拟合和适度拟合的区别在于准确度低多少。 

在比较模型 A 与 B 时，模型 A 更好，因为该模型具有更高的测试准确度，尽管 95% 的测试准确度略低，但差异并不显著，无法说明存在过度拟合  。 不要仅仅因为定型准确度和测试准确度更接近就选择模型 B。

模型 C 代表了一个明显的过度拟合情况；定型准确度非常高，但测试准确度却并没有那么高。 这种分辨方式虽然较主观，但却是从对问题和数据的了解以及可接受的误差大小中得出的。

## <a name="prevent-over-fitting"></a>防止过度拟合

在大多数严重情况下，过度拟合的模型将假定在定型过程中出现的功能值组合将始终生成与目标完全相同的输出。

防止过度拟合的最佳方式是遵循 ML 最佳做法，其中包括：

* 使用更多定型数据，消除统计偏差
* 防止目标泄露
* 使用更少功能
* **正则化和超参数优化**
* **模型复杂性限制**
* **交叉验证**

在自动化 ML 的上下文中，上述前三项是你实现的最佳做法。 加粗的后三项是自动化 ML 默认实现以防止过度拟合的最佳做法。 在除自动化 ML 以外的设置中，所有这六种最佳做法都可以避免模型过度拟合。

### <a name="best-practices-you-implement"></a>你实现的最佳做法

使用更多数据是防止过度拟合的最简单且最可行的方法，而且通常还能提高准确性，这是它的一个额外好处。 若你使用更多数据，模型要记住确切的模式就变得更加困难，并且它就不得不实现更灵活的解决方案以适应更多条件。 识别统计偏差也很重要，确保你的定型数据不包含实时预测数据中不存在的独立模式。 这种情况很难解决，因为定型集和测试集之间可能没有过度拟合，但与实时测试数据相比，可能会存在过度拟合。

目标泄露是一个类似问题；在此情况下，你可能不会在定型/测试集之间发现过度拟合，但它却会在预测时出现。 当你的模型在定型期间“作弊”，访问在预测时不应有的数据时，就会发生目标泄漏。 例如，如果你的问题是在星期一预测星期五的商品价格，但某个功能意外包含星期四的数据，这就是模型在预测时不会有的数据，因为它不能预知未来。 目标泄漏是一种容易遗漏的错误，但其特征通常是问题的准确度异常地高。 如果你正在尝试预测股票价格，并且定型模型的准确度为 95%，则功能中可能存在目标泄漏。

删除功能也有助于避免过度拟合，因为这样做可防止模型使用太多字段来记住特定模式，从而使模型更加灵活。 定量测量可能很难，但如果你可以删除功能并保持相同的准确度，则很可能使模型更灵活，并且降低过度拟合的风险。

### <a name="best-practices-automated-ml-implements"></a>自动化 ML 实现的最佳实践

正则化是最小化代价函数以惩罚复杂和过度拟合模型的过程。 正则化函数的类型各不相同，但通常它们都会对模型系数的大小、方差和复杂性进行惩罚。 自动化 ML 以不同的组合使用 L1（套索）、L2（岭）和 ElasticNet（同时使用 L1 和 L2），各个组合使用不同的模型超参数设置来控制过度拟合。 简单而言，自动化 ML 会改变模型的管控程度，并选择最佳结果。

自动化 ML 还实现了显式的“模型复杂性限制”来防止过度拟合。 在大多数情况下，此实现专用于决策树或林算法，其中每个树的最大深度受到限制，并且在林或组合学习方法中使用的树总数也受到限制。

交叉验证 (CV) 是从完整定型数据提取许多子集并针对每个子集定型一个模型的过程。 其思路是，针对某个子集时，模型可能会“幸运地”具有高准确度，但在使用多个子集时，模型不会每次都实现这种高准确度。 当执行 CV 时，你需要提供一个验证维持数据集并指定你的 CV 折叠数（子集数），自动化 ML 将定型你的模型并调整超参数以最大程度地减少验证集上的错误。 单个 CV 折叠可能会过度拟合，但使用多个折叠则可降低最终模型过度拟合的概率。 缺点是 CV 确实会导致定型时间变长，从而导致成本增加，因为你不是对一个模型进行一次定型，而是针对 n 个 CV 子集对它进行一次定型。 

> [!NOTE]
> 默认情况下不启用交叉验证；它必须在自动化 ML 设置中进行配置。 但是，在配置交叉验证并提供验证数据集后，此过程将自动执行。 请参阅 

<a name="imbalance"></a>

## <a name="identify-models-with-imbalanced-data"></a>标识具有不均衡数据的模型

不均衡数据通常存在于机器学习分类场景的数据中，它是指在每个类中包含比例不相称的观察值的数据。 这种不均衡可能会导致错误地感知模型准确度的正效应，因为输入数据偏向一个类，这会导致已定型的模型也出现该偏差。 

由于分类算法通常是按准确度计算的，因此检查模型的准确度分数是确定模型是否受不均衡数据影响的好方法。 对于某些类，它实际的准确度是很高还是很低？

此外，自动化 ML 运行自动生成以下图表，这有助于了解模型分类的正确性，并识别可能会受到不均衡数据影响的模型。

图表| 说明
---|---
[混淆矩阵](how-to-understand-automated-ml.md#confusion-matrix)| 针对数据的实际标签评估正确分类的标签。 
[精准率-召回率](how-to-understand-automated-ml.md#precision-recall-chart)| 针对找到的数据标签实例的比率，评估正确标签的比率 
[ROC 曲线](how-to-understand-automated-ml.md#roc)| 针对假正标签的比率评估正确标签的比率。

## <a name="handle-imbalanced-data"></a>处理不均衡数据 

作为简化机器学习工作流的目标的一部分，自动化 ML 具有内置功能，可帮助处理不均衡数据。例如： 

- 加权列：自动化 ML 支持加权列作为输入，从而使数据中行的权重增加或减少，这会使类的重要性上升或降低。

- 自动化 ML 使用的算法可正确处理高达 20:1 的不均衡，这意味着最常见的类在数据中的行数可以是最不常见的类的 20 倍。

除自动化 ML 之外，下面提供了一些可用于处理不均衡数据的其他方法。 

- 通过对较小的类进行上采样或对较大的类进行下采样，重新采样以均衡类的不均衡。 这些方法需要专业技能来处理和分析。

- 使用可更好地处理不均衡数据的性能指标。 例如，F1 分数是精准率和召回率的加权平均值。 精准率测量分类器的准确度，低精准率表示存在大量假正例；召回率测量分类器的完成度，低召回率表示存在大量假反例。 

## <a name="next-steps"></a>后续步骤

查看示例并了解如何使用自动化机器学习生成模型：

+ 按照[教程：使用 Azure 机器学习自动定型回归模型](tutorial-auto-train-models.md)进行操作

+ 为自动训练实验配置设置：
  + 在 Azure 机器学习工作室中，[使用这些步骤](how-to-use-automated-ml-for-ml-models.md)。
  + 通过 Python SDK，[使用这些步骤](how-to-configure-auto-train.md)。


