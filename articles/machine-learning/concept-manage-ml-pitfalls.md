---
title: 使用 AutoML 避免过度拟合&不平衡的数据
titleSuffix: Azure Machine Learning
description: 使用 Azure 机器学习的自动机器学习解决方案识别和管理 ML 模型的常见缺陷。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.reviewer: nibaccam
author: nibaccam
ms.author: nibaccam
ms.date: 04/09/2020
ms.openlocfilehash: 76f920ad6aae68defb567a7a6623d1ffd488af5f
ms.sourcegitcommit: 2d7910337e66bbf4bd8ad47390c625f13551510b
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/08/2020
ms.locfileid: "80874851"
---
# <a name="prevent-overfitting-and-imbalanced-data-with-automated-machine-learning"></a>通过自动机器学习防止数据过度拟合和不平衡

在构建机器学习模型时，过度拟合和不平衡的数据是常见的陷阱。 默认情况下，Azure 机器学习的自动机器学习提供图表和指标，以帮助您识别这些风险，并实现最佳实践来帮助缓解这些风险。 

## <a name="identify-over-fitting"></a>识别过度拟合

如果模型过于完美地拟合训练数据，因而无法准确预测不可见的测试数据，则机器学习中就会发生过度拟合。 换言之，模型只是记住训练数据中的特定模式和干扰，但无法足够灵活地基于实际数据做出预测。

考虑以下训练的模型及其相应的训练和测试准确度。

| “模型” | 训练准确度 | 测试准确度 |
|-------|----------------|---------------|
| A | 99.9% | 95% |
| B | 87% | 87% |
| C | 99.9% | 45% |

考虑模型 **A**：一个常见的误解是，如果针对不可见数据的测试准确度低于训练准确度，则模型就是过度拟合的。 但是，测试准确度应始终小于训练准确度，并且过度拟合与适当拟合的差别以较不准确的程度为准。** 

将模型 **A** 与 **B** 相比较时，模型 **A** 是更好的模型，因为它的测试准确度更高；尽管测试准确度略低于 95%，但这种差异并不明显，也并不意味着存在过度拟合。 不选择模型 **B** 的原因仅仅是训练和测试精度更为接近。

模型 **C** 明确反映了过度拟合的情况；训练准确度极高，但测试准确度远远达不到较高的水平。 这种区分是主观的，但来自于对您的问题和数据的了解，以及可接受的错误程度。

## <a name="prevent-over-fitting"></a>防止过度拟合

在最严重的情况下，过度拟合的模型会假设训练过程中出现的特征值组合始终为目标生成完全相同的输出。

防止过度拟合的最佳方式是遵循 ML 最佳做法，包括：

* 使用更多训练数据，并消除统计偏差
* 防止目标泄漏
* 使用较少的功能
* **正则化和超参数优化**
* **模型复杂性限制**
* **交叉验证**

在自动化 ML 的上下文中，上面所述的前三项是**你要实施的最佳做法**。 带粗体格式的后三项是**自动化 ML 为了防止过度拟合而默认实施的最佳做法**。 在除自动化 ML 以外的设置中，为了避免过度拟合模型，值得遵循所有六项最佳做法。

### <a name="best-practices-you-implement"></a>你要实施的最佳做法

使用**更多的数据**是防止过度拟合的最简单且最可行的方法，通常，这种做法带来的额外好处就是提高准确度。 使用更多数据时，模型将更难以记住确切的模式，因此它被迫达成可以更灵活地适应更多条件的解决方案。 此外，必须识别**统计偏差**，以确保训练数据不包含实时预测数据中不存在的隔离模式。 此问题可能很难解决，因为训练集和测试集之间可能不存在过度拟合，但与实时测试数据相比，可能又存在过度拟合。

目标泄漏是一个类似的问题，在这种情况下，可能在训练/测试集之间看不到过度拟合，但在预测时却会出现过度拟合。 如果模型在训练过程中“作弊”（访问预测时一般不会存在的数据），则会发生目标泄漏。 例如，如果你的问题是在星期一预测某件商品在星期五的价格，但某个特征意外地包含星期四的数据，则预测时模型不会包含此数据，因为模型无法看到未来。 目标泄漏是一个容易错过的错误，但通常的特点是异常高的准确性为您的问题。 如果您试图预测股票价格，并训练模型在 95% 的准确性，很可能有目标泄漏在您的功能某处。

删除特征也有助于避免过度拟合问题：防止在模型中包含过多的字段用于记住特定的模式，从而使其更灵活。 以量化方式进行度量可能有难度，但如果可以删除特征并保持相同的准确度，则有可能会使模型变得更灵活，并降低过度拟合的风险。

### <a name="best-practices-automated-ml-implements"></a>最佳实践自动化 ML 机具

正则化是最大程度地减小代价函数来惩罚复杂的过度拟合模型的过程。 有多种不同类型的正则化函数，但一般情况下，这些函数全都惩罚模型系数大小、差异和复杂性。 自动化 ML 结合用于控制过度拟合的不同模型超参数设置，使用 L1 (Lasso)、L2 (Ridge) 和 ElasticNet（同时包括 L1 和 L2）的不同组合。 简单而言，自动化 ML 会根据模型的调控程度而改变，并选择最佳结果。

自动化 ML 还实施明确的模型复杂性限制来防止过度拟合。 在大多数情况下，此实现专门用于决策树或林算法，其中单个树的最大深度是有限的，并且林或组合技术中使用的树总数是有限的。

交叉验证 (CV) 是提取整个训练数据的多个子集，并针对每个子集训练模型的过程。 其思路是，某个模型可能比较“幸运”，在预测一个子集时具有很高的准确度，但使用许多子集时，模型无法每次都实现这种高准确度。 执行 CV 时，需要提供一个验证维持数据集，指定 CV 折数（子集数），然后，自动化 ML 将训练模型并优化超参数，以尽量减少验证集的错误。 可能有一个 CV 折过度拟合，但如果使用许多的折，则可以减少最终模型过度拟合的可能性。 缺点是 CV 会导致训练时间变得更长，从而增大成本，因为模型不是训练一次，而是针对 *n* 个 CV 子集中的每个子集训练一次。 

> [!NOTE]
> 默认不会启用交叉验证；必须在自动化 ML 设置中进行配置。 但是，在配置交叉验证并提供验证数据集后，该过程将为您自动执行。 查看 

<a name="imbalance"></a>

## <a name="identify-models-with-imbalanced-data"></a>识别包含不平衡数据的模型

不平衡的数据往往出现在机器学习分类方案的数据中，指的是在每个类中包含不相称比例的观测值的数据。 这种不平衡可能会对模型准确度造成错误的认知效应，因为输入数据与一个类存在偏差，从而导致训练的模型模拟该偏差。 

由于分类算法通常是按准确度评估的，因此，检查模型的准确度评分可以很好地识别该模型是否受到不平衡数据的影响。 模型在预测某些类时的准确度是否确实很高或很低？

此外，自动化 ML 运行会自动生成以下图表，以帮助你了解模型分类的正确性，并识别可能受到不平衡数据影响的模型。

图表| 说明
---|---
[混淆矩阵](how-to-understand-automated-ml.md#confusion-matrix)| 根据数据的实际标签评估正确分类的标签。 
[精准率-召回率](how-to-understand-automated-ml.md#precision-recall-chart)| 根据发现的数据标签实例比评估正确的标签比 
[ROC 曲线](how-to-understand-automated-ml.md#roc)| 根据误报标签比评估正确的标签比。

## <a name="handle-imbalanced-data"></a>处理不平衡的数据 

自动化 ML 的目标之一是简化机器学习工作流，其中的内置功能可帮助处理不平衡的数据，例如， 

- **权重列**：自动 ML 支持加权列作为输入，导致数据中的行向上或向下加权，从而使类或多或少变得"重要"。

- 自动化 ML 使用的算法可以正确处理最高 20:1 的不平衡比，这意味着，最常用类的数据中包含的行数可以比最不常用类多 20 倍。

以下技术是用于处理自动化 ML 外部的不平衡数据的附加选项。 

- 通过向上采样较小的类或向下采样较大的类，重新采样来均衡类的不平衡性。 这些方法需要具备处理和分析方面的专业知识。

- 使用性能指标来更好地处理不平衡的数据。 例如，F1 评分是精准率和召回率的加权平均值。 精确测量分类器的精确性-低精度表示大量误报--,而召回测量分类器完整性时，低召回表示大量假阴性。 

## <a name="next-steps"></a>后续步骤

查看示例并了解如何使用自动化机器学习生成模型：

+ 遵循[教程：使用 Azure 机器学习自动训练回归模型](tutorial-auto-train-models.md)

+ 配置自动训练试验的设置：
  + 在 Azure 机器学习工作室中[使用这些步骤](how-to-use-automated-ml-for-ml-models.md)。
  + 在 Python SDK 中[使用这些步骤](how-to-configure-auto-train.md)。


