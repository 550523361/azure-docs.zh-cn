---
title: 交叉验证模型：模块引用
titleSuffix: Azure Machine Learning service
description: 了解如何在 Azure 机器学习服务中使用交叉验证模型模块，通过对数据进行分区来交叉验证分类或回归模型的参数估算。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 10/10/2019
ms.openlocfilehash: a5eea61ee8284010531e80e17bf1110ab470d04c
ms.sourcegitcommit: c22327552d62f88aeaa321189f9b9a631525027c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/04/2019
ms.locfileid: "73512842"
---
# <a name="cross-validate-model"></a>交叉验证模型

本文介绍如何使用 Azure 机器学习设计器（预览版）中的 "**交叉验证模型**" 模块。 *交叉验证*是一种重要的技术，通常在机器学习中用于评估数据集的可变性和使用该数据定型的任何模型的可靠性。  

"**交叉验证模型**" 模块将标记的数据集作为输入，并将其与未定型的分类或回归模型结合使用。 它将数据集分割成一定数量的子集（*折叠*），在每个折页上生成一个模型，然后为每个折页返回一组准确性统计信息。 通过比较所有折叠的准确性统计信息，您可以解释数据集的质量，并了解模型是否容易受到数据的变化。  

交叉验证还会返回数据集的预测结果和概率，以便您可以评估预测的可靠性。  

### <a name="how-cross-validation-works"></a>交叉验证的工作原理

1. 交叉验证会将定型数据随机划分为多个分区，也称为 "*折叠*"。 

    + 如果之前未对数据集进行分区，则该算法默认为10个折叠。 
    + 若要将数据集划分为不同数量的折叠，可以使用[分区和示例](partition-and-sample.md)模块，指示要使用的折叠数。  

2.  该模块将留出折叠1中用于验证的数据（有时称为*维持折叠*），并使用剩余的折叠来训练模型。 

    例如，如果创建了五个折叠，模块将在交叉验证过程中生成五个模型，每个模型都使用4/5 数据进行定型，并在剩余的1/5 上经过测试。  

3.  在测试每个折叠的模型期间，会评估多个准确性统计信息。 使用哪些统计信息取决于您要评估的模型的类型。 不同的统计信息用于评估分类模型和回归模型。  

4.  完成所有折叠的构建和评估过程后，**交叉验证模型**将生成一组性能指标，并为所有数据评分结果。 应查看这些度量值，以确定是否有任何单个折叠具有特别高或较低的准确性 

### <a name="advantages-of-cross-validation"></a>交叉验证的优点

评估模型的另一种常见方法是使用[拆分数据](split-data.md)将数据分成定型集和测试集，然后验证定型数据的模型。 但是，交叉验证具有一些优点：  

-   交叉验证使用的测试数据更多。

     交叉验证使用较大的数据空间中的指定参数来测量模型的性能。 也就是说，交叉验证将整个定型数据集用于定型和计算，而不是部分。 与此相反，如果您使用通过随机拆分生成的数据来验证模型，则通常只会在30% 或更少的可用数据上评估模型。  

     但是，因为交叉验证会在更大的数据集上定型和验证模型，所以，计算工作量要多得多，并且花费的时间比对随机拆分进行验证要长得多。  

-   交叉验证会计算数据集和模型的值。

     交叉验证并不只是衡量模型的准确性，还提供了一些有关数据集的代表方式以及模型对数据的变化程度的了解。  

## <a name="how-to-use-cross-validate-model"></a>如何使用交叉验证模型

如果数据集很大，则可能需要较长时间才能运行交叉验证。  因此，您可以在生成和测试模型的初始阶段使用 "**交叉验证模型**"，以评估模型参数的好坏（假定计算时间可以容忍），然后使用与[训练模型](train-model.md)和[评估模型](evaluate-model.md)模块一起建立参数。

在这种情况下，您可以使用**交叉验证模型**定型和测试模型。

1. 将**交叉验证模型**模块添加到管道。 在 Azure 机器学习设计器中，可以在**模型计分 & 计算**类别中找到它。 

2. 连接任何**分类**或**回归**模型的输出。 

    例如，如果使用**两个类 Bayes 点机**进行分类，请使用所需的参数配置模型，然后将连接器从分类器的 "未定型的**模型**" 端口拖到 "**交叉验证" 的匹配端口模型**。 

    > [!TIP] 
    > 模型无需定型，因为**交叉验证模型**会自动训练模型作为计算的一部分。  
3.  在**交叉验证模型**的**数据集**端口上，连接任何标记的定型数据集。  

4.  在 "**交叉验证模型**" 的 "**属性**" 窗格中，单击 "**启动列选择器**"，然后选择包含类标签的单个列或可预测值。 

5. 如果希望能够在同一数据的连续运行之间重复交叉验证的结果，请设置**随机种子**参数的值。  

6.  运行管道。

7. 有关报告的说明，请参阅 "[结果](#results)" 部分。

    若要获取模型副本以便以后重新使用，请右键单击包含该算法的模块的输出（例如，**两个类 Bayes 点机**），然后单击 "**另存为定型模型**"。

## <a name="results"></a>结果

所有迭代完成后，**交叉验证模型**将为整个数据集创建分数，以及可用于评估模型质量的性能度量值。

### <a name="scored-results"></a>评分结果

模块的第一个输出为每一行提供源数据以及一些预测值和相关的概率。 

若要查看这些结果，请在管道中，右键单击 "**交叉验证模型**" 模块，选择**评分结果**，然后单击 "**可视化**"。

| 新列名称      | 说明                              |
| -------------------- | ---------------------------------------- |
| 评分标签        | 此列将添加到数据集的末尾，并包含每行的预测值。 |
| 评分概率 | 此列将添加到数据集的末尾，并指示**评分标签**中的值的预计概率。 |
| 折叠编号          | 指示在交叉验证期间分配给每个数据行的折叠的从零开始的索引。 |

 ### <a name="evaluation-results"></a>评估结果

第二个报表按折叠分组。 请记住，在执行期间，**交叉验证模型**将定型数据随机拆分为*n*个折叠（默认为10）。 在数据集的每次循环中，**交叉验证模型**使用一折作为验证数据集，并使用剩余的*第1个*折叠来定型模型。 对于所有其他折叠中的数据，将对其中的每*个模型进行*测试。

在此报表中，按索引值以升序列出折叠。  若要对其他任何列进行排序，可以将结果保存为数据集。

若要查看这些结果，请在管道中右键单击 "**交叉验证模型**" 模块，选择 "**通过折叠计算结果**"，然后单击 "**可视化**"。


|列名称| 说明|
|----|----|
|折叠编号| 每个折叠的标识符。 如果创建了5个折叠，则会有5个数据子集，编号为0到4。
|折叠中的示例数|分配给每个折叠的行数。 它们应该大致相等。 |


此外，对于每个折页，都包含以下度量值，具体取决于您要评估的模型的类型。 

+ **分类模型**：精度、回调、F 评分、AUC、准确性  

+ **回归模型**：平均绝对错误、根本平均平方误差、相对绝对错误、相对平方误差和确定系数


## <a name="technical-notes"></a>技术说明  

+ 最佳做法是在将数据集用于交叉验证之前规范化数据集。 

+ 因为**交叉验证模型**会多次定型和验证模型，所以，计算工作量要多得多，并且完成时间比使用随机分割的数据集验证模型要长得多。 

+ 使用交叉验证衡量模型的准确性时，无需将数据集拆分为定型集和测试集。 


## <a name="next-steps"></a>后续步骤

查看可用于 Azure 机器学习服务[的模块集](module-reference.md)。 

