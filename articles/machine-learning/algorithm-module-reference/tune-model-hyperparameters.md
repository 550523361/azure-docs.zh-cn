---
title: 优化模型超参数
titleSuffix: Azure Machine Learning
description: 了解如何使用 Azure 机器学习中的优化模型超参数模块对模型执行参数扫描以确定最佳参数设置。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 10/16/2019
ms.openlocfilehash: 4dd2cd89e8edb4e636bf46d2a8125a0f1d00f2f3
ms.sourcegitcommit: a9b1f7d5111cb07e3462973eb607ff1e512bc407
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/22/2020
ms.locfileid: "76312237"
---
# <a name="tune-model-hyperparameters"></a>优化模型超参数

本文介绍如何在 Azure 机器学习设计器中使用优化模型超参数模块。 目标是确定机器学习模型的最佳超参数。 该模块通过使用不同的设置组合来生成和测试多个模型。 它对所有模型的度量值进行比较以获取设置的组合。 

术语*参数*和*超参数*可能令人困惑。 模型的参数是您在 "属性" 窗格中设置的*参数*。 基本上，此模块对指定的参数设置执行*参数扫描*。 它学习了_超参数_的最佳集，每个特定的决策树、数据集或回归方法可能会有所不同。 查找最佳配置的过程有时称为 "*优化*"。 

模块支持以下方法来查找模型的最佳设置：*集成训练和调整。* 在此方法中，您将配置要使用的一组参数。 然后，让模块循环访问多个组合。 模块测量准确性，直到找到 "最佳" 模型。 对于大多数学习器模块，您可以选择在训练过程中应更改哪些参数，哪些参数应保持固定。

根据你想要运行优化过程的时间，你可能会决定彻底测试所有组合。 或者，您可以通过建立参数组合的网格并测试参数网格的随机子集，缩短该过程。

此方法将生成一个训练的模型，您可以将其保存以供重复使用。  

> [!TIP] 
> 可以执行相关的任务。 开始优化之前，请应用功能选择来确定具有最大信息值的列或变量。

## <a name="how-to-configure-tune-model-hyperparameters"></a>如何配置优化模型超参数  

了解机器学习模型的最佳超参数需要大量使用管道。

### <a name="train-a-model-by-using-a-parameter-sweep"></a>使用参数扫描训练模型  

本部分介绍如何执行基本参数扫描，该参数扫描使用优化模型超参数模块训练模型。

1.  在设计器中，将 "微调模型超参数" 模块添加到管道。

2.  将未经训练的模型连接到最左侧的输入。 

3. 将 "**创建训练人员模式**" 选项设置为 "**参数范围**"。 使用**范围生成器**来指定要在参数扫描中使用的值的范围。  

    几乎所有分类和回归模块都支持集成参数扫描。 对于不支持配置参数范围的学习者，只能测试可用的参数值。

    您可以手动设置一个或多个参数的值，然后对其余参数进行扫描。 这可能节省一些时间。

4.  添加要用于定型的数据集，并将其连接到微调模型超参数的中间输入。  

    （可选）如果有标记的数据集，则可以将其连接到最右侧的输入端口（**可选验证数据集**）。 这使您可以在定型和优化时测量准确性。

5.  在 "优化模型超参数" 的 "**属性**" 窗格中，选择 "**参数扫描模式**" 的值。 此选项控制参数的选择方式。

    - **整个网格**：选择此选项时，模块将循环切换由系统预定义的网格，以尝试不同的组合并确定最佳学习器。 如果你不知道最佳的参数设置，并且想要尝试所有可能的值组合，则此选项很有用。

    - **随机扫描**：如果选择此选项，模块将在系统定义的范围内随机选择参数值。 你必须指定你希望模块执行的最大运行数。 如果要使用所选的度量值提高模型性能，但仍保留计算资源，则此选项很有用。    

6.  对于 "**标签列**"，打开列选择器以选择单个标签列。

7.  选择运行数：

    1. **随机扫描时的最大运行数**：如果选择随机扫描，则可以通过使用参数值的随机组合来指定该模型应定型多少次。

    2. **随机网格上的最大运行数**：此选项还控制随机采样参数值的迭代次数，但不会从指定范围中随机生成值。 相反，该模块会创建所有可能组合的参数值的矩阵。 然后，它对矩阵进行随机抽样。 此方法的效率更高，不容易出现区域过度抽样或 undersampling。

8.  对于 "**排名**"，请选择要用于对模型进行排名的单个度量值。

    运行参数扫描时，该模块将计算该模型类型的所有适用指标，并将其返回到**扫描结果**报告中。 模块对回归和分类模型使用不同的度量值。

    但是，所选的度量值决定了模型的排序方式。 只有最顶层的模型（按照所选的指标）将输出为要用于计分的定型模型。

9.  对于 "**随机种子**"，请输入用于开始参数扫描的数字。 

10. 运行管道。

## <a name="results-of-hyperparameter-tuning"></a>超参数优化的结果

培训完成后：

+ 若要查看最佳模型的一组准确性度量值，请右键单击该模块，然后选择 "**可视化**"。

    输出包括应用于模型类型的所有准确性指标，但为排名选择的指标决定了哪个模型被视为 "最佳"。

+ 若要保存训练模型的快照，请选择 "**定型模型**" 模块右侧面板中的 "**输出**" 选项卡。 选择 "**注册数据集**" 图标，将该模型保存为可重复使用的模块。


## <a name="technical-notes"></a>技术说明

本部分包含实现详细信息和提示。

### <a name="how-a-parameter-sweep-works"></a>参数扫描的工作方式

设置参数扫描时，可以定义搜索范围。 搜索可能会使用随机选择的有限数量的参数。 或者，它可能是你定义的参数空间的详尽搜索。

+ **随机扫描**：此选项使用一组迭代数训练模型。 

  您可以指定要循环访问的值的范围，并且该模块使用这些值的随机选择子集。 使用替换来选择值，这意味着以前随机选择的数字不会从可用编号池中删除。 因此选择任何值的可能性在所有阶段都保持不变。  

+ **整个网格**：使用整个网格的选项表示测试每个组合。 此选项最全面，但需要最多时间。 

### <a name="controlling-the-length-and-complexity-of-training"></a>控制定型的长度和复杂性

循环访问多个设置组合可能会很耗时，因此该模块提供多种方法来限制该过程：

+ 限制用于测试模型的迭代数。
+ 限制参数空间。
+ 同时限制迭代数和参数空间。

建议你使用设置管道来确定对特定数据集和模型定型最有效的方法。

### <a name="choosing-an-evaluation-metric"></a>选择评估指标

在测试结束时，该模型将显示一个报表，其中包含每个模型的准确性，以便您可以查看指标结果：

- 一组统一的指标用于所有二元分类模型。
- 准确性用于所有多类分类模型。
- 一组不同的度量值用于回归模型。 

但是，在训练过程中，您必须选择用于对优化过程中生成的模型进行排名的*单个*度量值。 您可能会发现，最佳指标有所不同，具体取决于您的业务问题和误报和漏报的代价。

#### <a name="metrics-used-for-binary-classification"></a>用于二元分类的指标

-   **准确性**是真实结果与事例总数的比例。  

-   **精度**是真实结果与正值结果的比例。  

-   **召回**是所有结果中所有正确结果的小数部分。  

-   **F 分数**是指平衡精度和召回的度量值。  

-   **AUC**是一个值，该值表示在 x 轴上绘制误报时曲线下的区域，并且在 y 轴上绘制真实的正值。  

-   **平均日志丢失**是两个概率分布之间的差异： true，后者是模型中的一种。  

#### <a name="metrics-used-for-regression"></a>用于回归的指标

-   **平均绝对误差**表示模型中的所有错误，其中*错误*表示预测值与真实值之间的距离。 它通常缩写为*MAE*。  

-   **平均方形错误的根**用于测量错误平方的平均值，然后获取该值的根。 它通常缩写为*RMSE*。  

-   **相对绝对错误**将错误表示为真正值的百分比。  

-   **相对平方误差**通过除以预测值的总平方误差来规范化总平方误差。  

-   **确定系数**是单个数字，用于指示数据与模型的匹配程度。 如果值为1，则表示模型与数据完全匹配。 如果值为零，则表示数据是随机的，否则不能适合模型。 通常称为*r<sup>2</sup>* 、 *r<sup>2</sup>* 或*r 平方*。  

### <a name="modules-that-dont-support-a-parameter-sweep"></a>不支持参数扫描的模块

几乎所有 Azure 机器学习的学员都支持交叉验证和集成参数扫描，这使你可以使用选择管道的参数。 如果学习器不支持设置一系列值，仍可以在交叉验证中使用它。 在这种情况下，将为扫描选择一系列允许值。 


## <a name="next-steps"></a>后续步骤

查看可用于 Azure 机器学习[的模块集](module-reference.md)。 

