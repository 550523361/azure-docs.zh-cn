---
title: 优化模型超参数
titleSuffix: Azure Machine Learning service
description: 了解如何使用 Azure 机器学习服务中的优化模型超参数模块对模型执行参数扫描以确定最佳参数设置。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 10/16/2019
ms.openlocfilehash: 06adfe66bfe894d7b3c95e3d416da866c7d103b3
ms.sourcegitcommit: c22327552d62f88aeaa321189f9b9a631525027c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/04/2019
ms.locfileid: "73515650"
---
# <a name="tune-model-hyperparameters"></a>优化模型超参数

本文介绍如何使用 Azure 机器学习设计器（预览版）中的[微调模型超参数](tune-model-hyperparameters.md)模块来确定给定机器学习模型的最佳超参数。 该模块使用不同的设置组合来构建和测试多个模型，并对所有模型的度量值进行比较以获取设置的组合。 

术语*参数*和*超参数*可能令人困惑。 模型的参数是您在 "属性" 窗格中设置的*参数*。 基本上，此模块对指定的参数设置执行*参数扫描*，并学习一组最佳的_超参数_，这对于每个特定的决策树、数据集或回归方法可能有所不同。 查找最佳配置的过程有时称为 "*优化*"。 

模块支持以下方法来查找模型的最佳设置 

**集成的定型和调整**：配置要使用的一组参数，然后让该模块循环访问多个组合，测量准确性，直到找到 "最佳" 模型。 对于大多数学习器模块，您可以选择在训练过程中应更改哪些参数，哪些参数应保持固定。

    Depending on how long you want the tuning process to run, you might decide to exhaustively test all combinations, or you could shorten the process by establishing a grid of parameter combinations and testing a randomized subset of the parameter grid.

 此方法将生成一个训练的模型，您可以将其保存以供重复使用。  

### <a name="related-tasks"></a>相关任务

+ 进行优化之前，请应用功能选择来确定具有最大信息值的列或变量。

## <a name="how-to-configure-tune-model-hyperparameters"></a>如何配置优化模型超参数  

通常，若要了解给定机器学习模型的最佳超参数，需要相当大的 pipelineation。

### <a name="train-a-model-using-a-parameter-sweep"></a>使用参数扫描训练模型  

本部分介绍如何执行基本参数扫描，该参数扫描使用[优化模型超参数](tune-model-hyperparameters.md)模块训练模型。

1.  在设计器中，将 "[微调模型超参数](tune-model-hyperparameters.md)" 模块添加到管道。

2.  将未经训练的模型连接到最左侧的输入。 

3. 将 "**创建训练器模式**" 选项设置为 "**参数范围**"，然后使用 "**范围生成器**" 来指定要在参数扫描中使用的值的范围。  

    几乎所有分类和回归模块都支持集成参数扫描。 对于不支持配置参数范围的学习人员，只能测试可用的参数值。

    您可以手动设置一个或多个参数的值，然后对其余参数进行扫描。 这可能节省一些时间。

4.  添加要用于定型的数据集，并将其连接到[微调模型超参数](tune-model-hyperparameters.md)的中间输入。  

    （可选）如果有标记的数据集，则可以将其连接到最右侧的输入端口（**可选验证数据集**）。 这使您可以在定型和优化时测量准确性。

5.  在 "[优化模型超参数](tune-model-hyperparameters.md)" 的 "**属性**" 窗格中，选择 "**参数扫描模式**" 的值。 此选项控制参数的选择方式。

    - **整个网格**：选择此选项时，模块将循环切换由系统预定义的网格，以尝试不同的组合并确定最佳学习器。 如果您不知道最佳的参数设置可能并想要尝试所有可能的值组合，则此选项很有用。

    - **随机扫描**：如果选择此选项，模块将在系统定义的范围内随机选择参数值。 你必须指定你希望模块执行的最大运行数。 如果要使用所选的度量值提高模型性能，但仍保留计算资源，则此选项很有用。

    如果选择随机扫描，则可以使用参数值的随机组合来指定**随机扫描上运行的最大运行数**，这意味着该模型应定型多少次。

6.  对于 "**标签列**"，请启动列选择器以选择单个标签列。

7.  **随机扫描时的最大运行数**：如果选择随机扫描，则可以使用参数值的随机组合来指定该模型应定型多少次。

    **随机网格上的最大运行数**：此选项还控制随机采样参数值的迭代次数，但不会从指定范围内随机生成值;而是会创建一个矩阵，该矩阵是参数值的所有可能组合，并对矩阵进行随机采样。 此方法的效率更高，不容易出现区域过度抽样或 undersampling。

8.  选择对模型进行**排序**时要使用的单个度量值。

    运行参数扫描时，将计算模型类型的所有适用指标，并在**扫描结果**报告中返回。 用于回归和分类模型的单独指标。

    但是，您选择的度量值决定了模型的排名。 只有最顶层的模型（按照所选的指标）将输出为要用于计分的定型模型。

9.  对于 "**随机种子**"，请键入初始化参数扫描时要使用的数字。 

10. 运行管道。

## <a name="results-of-hyperparameter-tuning"></a>超参数优化的结果

培训完成后：

+ 若要查看最佳模型的一组准确性度量值，请右键单击该模块，选择 "**扫描结果**"，然后选择 "**可视化**"。

    所有适用于模型类型的准确性指标都是输出，但您为排名选择的度量值决定哪个模型被视为 "最佳"。

+ 若要在其他管道中使用该模型进行评分，无需重复优化过程，请右键单击模型输出，并选择 "**另存为定型模型**"。 


## <a name="technical-notes"></a>技术说明

本部分包含实现详细信息、提示以及常见问题的解答。

### <a name="how-a-parameter-sweep-works"></a>参数扫描的工作方式

本部分介绍了参数扫描的常规工作方式，以及此模块中的选项如何进行交互。

设置参数扫描时，可以定义搜索范围，使用随机选择的有限数目的参数，或对定义的参数空间进行穷举搜索。

+ **随机扫描**：此选项使用一组迭代数训练模型。 

     您可以指定要循环访问的值的范围，并且该模块使用这些值的随机选择子集。  使用替换来选择值，这意味着以前随机选择的数字不会从可用编号池中删除。 因此，任何选定值的可能性在所有阶段都保持不变。  

+ **整个网格**：使用整个网格的选项只是指测试每个组合并对其进行测试。 此选项可被视为最彻底，但要求最多时间。 

### <a name="controlling-the-length-and-complexity-of-training"></a>控制定型的长度和复杂性

循环访问多个设置组合可能会很耗时，因此该模块提供多种方法来限制该过程：

+ 限制用于测试模型的迭代数
+ 限制参数空间
+ 同时限制迭代数和参数空间

建议你使用设置管道来确定对特定数据集和模型定型最有效的方法。

### <a name="choosing-an-evaluation-metric"></a>选择评估指标

其中包含每个模型的准确性的报表显示在末尾，以便您可以查看指标结果。 一组统一的指标适用于所有的二元分类模型，准确性适用于所有多类分类模型，另一组指标用于回归模型。 但是，在训练过程中，您必须选择用于对优化过程中生成的模型进行排名的**单个**度量值。 您可能会发现，最佳指标会根据您的业务问题和误报和漏报的成本而变化。

#### <a name="metrics-used-for-binary-classification"></a>用于二元分类的指标

-   **准确性**True 结果与事例总数的比例。  

-   **精度**True 结果的比例为正值。  

-   **召回**所有结果中所有正确结果的部分。  

-   **F 分数**一个度量值，该度量值用于平衡精度和回调。  

-   **AUC**一个值，该值表示在 x 轴上绘制误报时曲线下的区域，而实际的正值绘制在 y 轴上。  

-   **平均日志丢失**两个概率分布之间的差异： true 和模型中的一个。  

#### <a name="metrics-used-for-regression"></a>用于回归的指标

-   **平均绝对误差**表示模型中的所有错误，其中错误表示预测值与真实值之间的距离。 通常缩写为**MAE**。  

-   **平均方形错误的根**用于测量错误平方的平均值，然后获取该值的根。 通常缩写为**RMSE**  

-   **相对绝对错误**将错误表示为真正值的百分比。  

-   **相对平方误差**通过除以预测值的总平方误差来规范化总平方误差。  

-   **确定系数**一个数字，用于指示数据与模型的匹配程度。 如果值为1，则表示模型完全匹配数据;如果值为零，则表示数据是随机的，否则不能适合模型。 通常称为**r<sup>2</sup>** 、 **r<sup>2</sup>** 或**r 平方**。  

### <a name="modules-that-do-not-support-a-parameter-sweep"></a>不支持参数扫描的模块

几乎所有 Azure 机器学习的学员都支持交叉验证和集成参数扫描，这使你可以使用选择管道的参数。 如果学习器不支持设置一系列值，仍可以在交叉验证中使用它。 在这种情况下，会为扫描选择某些允许值范围。 


## <a name="next-steps"></a>后续步骤

查看可用于 Azure 机器学习服务[的模块集](module-reference.md)。 

