---
title: 分区和示例：模块参考
titleSuffix: Azure Machine Learning
description: 了解如何使用 Azure 机器学习中的“分区和采样”模块对数据集进行采样或由数据集创建分区。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 10/22/2019
ms.openlocfilehash: 0392a05df485b45b1244f4542ed55af1837dca3d
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/28/2020
ms.locfileid: "79477504"
---
# <a name="partition-and-sample-module"></a>“分区和采样”模块

本文介绍 Azure 机器学习设计器（预览版）中的一个模块。

使用分区和示例模块对数据集执行采样或从数据集创建分区。

采样是机器学习中的一个重要工具，因为通过采样可以减小数据集的大小，同时使值的比率保持相同。 本模块支持机器学习中重要的几个相关任务： 

- 将数据划分为多个大小相同的小节。 

  可以将分区用于交叉验证，或用于将事例分配给随机组。

- 将数据分成组，然后处理特定组中的数据。 

  随机将事例分配给不同的组后，可能需要修改仅与一个组关联的要素。

- 采样。 

  可以提取一定百分比的数据，应用随机采样，也可以选择一列用于均衡数据集并对其值进行分层采样。

- 创建更小的数据集用于测试。 

  如果存在大量数据，可以在设置管道时使用前 n 行，然后在构建模型时转为使用完整数据集**。 您还可以使用采样创建用于开发的小型数据集。

## <a name="configure-the-module"></a>配置模块

此模块支持以下将数据划分为分区或采样的方法。 首先选择该方法，然后设置该方法所需的其他选项。

- Head
- 采样
- 分配到折叠
- 选取折叠

### <a name="get-top-n-rows-from-a-dataset"></a>获取数据集中的前 N 行

使用此模式可仅获取前 *n* 行。 如果要在少量行上测试管道，并且不需要以任何方式平衡或采样数据，则此选项非常有用。

1. 在界面中将“分区和采样”模块添加到管道，并连接数据集****。  

1. **分区或采样模式**：将此选项设置为**头**。

1. **要选择的行数**：输入要返回的行数。

   行数必须为非负整数。 如果所选行数大于数据集中的行数，则返回整个数据集。

1. 提交管道。

模块输出仅包含指定行数的单个数据集。 始终从数据集的顶部开始读行。

### <a name="create-a-sample-of-data"></a>创建数据样本

此选项支持简单随机采样或分层随机采样。 如果要创建较小的代表性示例数据集以进行测试，则它很有用。

1. 将“分区和采样”模块添加到管道，并连接数据集****。

1. **分区或采样模式**：将此选项设置为**采样**。

1. **采样率**：输入介于 0 和 1 之间的值。 此值指定输出数据集应包含的行数占源数据集中行数的百分比。

   例如，如果只想要原始数据集的一半，请输入`0.5`以指示采样率应为 50%。

   根据指定的比率，对输入数据集的行进行随机排列并有选择地放置在输出数据集中。

1. **用于采样的随机种子**：可选，输入一个整数用作种子值。

   如果希望每次都按相同的方式划分多个行，则此选项非常重要。 默认值为**0，** 这意味着基于系统时钟生成起始种子。 每次运行管道时，此值都会导致略有不同的结果。

1. **用于采样的分层拆分**：如果数据集中的行在采样前均匀地除以某些键列，请选择此选项。

   对于用于采样的分层键列，请选择一个单独的分层列，以供划分数据集时使用******。 然后，将数据集中的行划分如下：

   1. 所有输入行均按指定分层列中的值分组（分层）。

   1. 对每个组中的行进行随机排列。

   1. 将每个组有选择地添加到输出数据集中以满足指定比例。


1. 提交管道。

   使用此选项时，模块输出包含代表性采样数据的单个数据集。 不会输出数据集的未采样部分。 

## <a name="split-data-into-partitions"></a>将数据拆分到多个分区

要将数据集划分为数据子集时，请使用此选项。 要创建自定义数量的折叠以用于交叉验证，或将行拆分为多个组，此选项也很有用。

1. 将“分区和采样”模块添加到管道，并连接数据集****。

1. 对于分“区或采样模式”，选择“分配到折叠”********。

1. **在分区中使用替换**：如果您希望将采样行放回行池以进行可能的重用，请选择此选项。 因此，可以将同一行分配到多个折叠。

   如果不使用替换（默认选项），则采样行不会放回行池以进行潜在重用。 因此，只能将每行分配到一个折叠。

1. **随机拆分**：如果您希望将行随机分配给折叠，请选择此选项。

   如果未选择此选项，则行将分配给通过循环方法折叠。

1. **随机种子**：可选，输入一个整数用作种子值。 如果希望每次都按相同的方式划分多个行，则此选项非常重要。 否则，默认值**0**表示将使用随机启动种子。

1. **指定分区器方法**：使用以下选项指示您希望将数据分摊到每个分区的方式：

   - **分区均匀：** 使用此选项在每个分区中放置相同数量的行。 要指定输出分区数，请在 **"指定折叠数"中输入整数，以均匀地拆分为**框。

   - **具有自定义比例的分区**：使用此选项将每个分区的大小指定为逗号分隔列表。

     例如，假设您要创建三个分区。 第一个分区将包含 50% 的数据。 其余两个分区将各包含 25% 的数据。 在 **"以逗号分隔的比例列表"** 框中，输入这些数字 **：.5、.25、.25**。

     所有分区大小的总和必须正好是 1。

     如果输入的数字加起来小于 1**，则将创建一个额外的分区来容纳剩余的行。 例如，如果输入值 **.2**和 **.3，** 则将创建第三个分区以保存所有行的剩余 50%。
     
     如果输入的数字加起来大于 1**，则在运行管道时会引发错误。

1. **分层拆分**：如果希望在拆分时将行分层，请选择此选项，然后选择 _"地层"列_。

1. 提交管道。

   使用此选项，模块将输出多个数据集。 数据集根据您指定的规则进行分区。

### <a name="use-data-from-a-predefined-partition"></a>使用预定义分区中的数据  

将数据集划分为多个分区，现在希望依次加载每个分区以进行进一步分析或处理时，请使用此选项。

1. 将“分区和采样”模块添加到管道****。

1. 将模块连接到分区**和示例**的上一个实例的输出。 此实例必须使用“分配到折叠”选项才能生成一定数量的分区****。

1. **分区或采样模式**：选择 **"选取折叠**"。

1. **指定要从**：选择分区以输入其索引来采样的折叠。 分区索引从 1 开始。 例如，如果将数据集划分为三个部分，则分区的索引分别为 1、2 和 3。

   如果输入无效的索引值，则引发设计时错误："错误 0018：数据集包含无效数据。

   除了将数据集按折叠分组，还可以将数据集分成两个组：目标折叠和其他所有内容。 为此，请输入单个折叠的索引，然后选择**所选折叠的"选取补补"** 选项，以获取指定折叠中除数据外的所有内容。

1. 如果使用多个分区，则必须添加更多**分区和示例**模块的实例来处理每个分区。

   例如，第二行中的**分区和示例**模块设置为 **"分配给折叠**"，第三行中的模块设置为 **"选取折叠**"。   

   ![分区和采样](./media/module/partition-and-sample.png)

1. 提交管道。

   使用此选项，模块将输出仅包含分配给该折叠的行的单个数据集。

> [!NOTE]
>  无法直接查看折叠名称。 它们仅存在于元数据中。

## <a name="next-steps"></a>后续步骤

参阅 Azure 机器学习[可用的模块集](module-reference.md)。 