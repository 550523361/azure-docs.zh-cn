---
title: Azure Cosmos DB 索引编制策略
description: 了解 Azure Cosmos DB 中索引的工作原理。 了解如何配置和更改索引策略，实现自动索引并提高性能。
author: rimman
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/08/2019
ms.author: rimman
ms.openlocfilehash: 6998db1679e67f8ac4bf7c81ea9373c66a9618ee
ms.sourcegitcommit: c174d408a5522b58160e17a87d2b6ef4482a6694
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/18/2019
ms.locfileid: "59278558"
---
# <a name="index-policy-in-azure-cosmos-db"></a>Azure Cosmos DB 中的索引策略

可以通过配置以下参数来替代 Azure Cosmos 容器上的默认索引策略：

* **在索引中包括或排除项和路径**：可以排除或当插入或替换容器中的项时在索引中，包含特定项。 还可以包含或排除要跨容器编制索引的特定路径/属性。 路径可能包括通配符模式，例如 *。

* **配置索引类型**：除了单元格区域建立索引的路径，你可以添加其他类型的索引，例如空间。

* **配置索引模式**：通过在容器上使用索引策略，可以配置不同的索引模式，例如“一致”或“无”。

## <a name="indexing-modes"></a>索引模式

Azure Cosmos DB 支持两种索引模式，您可以通过索引策略的 Azure Cosmos 容器上配置：

* **一致**：如果 Azure Cosmos 容器的策略设置为*一致*，特定容器上的查询将按照为点读取指定的一致性级别 (例如，强、 有限过时、 会话或最终)。 

  更新项时，会同步更新索引。 例如，对项执行插入、替换、更新和删除操作将导致更新索引。 一致索引支持一致的查询，但代价是影响写入吞吐量。 降低写入吞吐量取决于"路径包含在索引"和"一致性级别"。 一致索引模式旨在使索引保持最新实现所有更新并立即为查询提供服务。

* **无**：索引模式为“无”的容器没有与之关联的索引。 如果 Azure Cosmos 数据库用作键值存储，并且只通过项的 ID 属性访问项，则通常使用该模式。

  > [!NOTE]
  > 配置索引模式作为*None*具有副作用的删除任何现有索引。 如果访问模式仅需要 ID 或自助链接，则应使用此选项。

查询一致性级别的维护与常规读取操作的维护类似。 如果查询包含的容器的 azure Cosmos 数据库将返回错误*None*索引模式。 您可以查询作为扫描通过的显式**x-ms-documentdb-启用-扫描**REST API 中的标头或**EnableScanInQuery**使用.NET SDK 请求选项。 “EnableScanInQuery”当前不支持某些查询功能（如 ORDER BY），因为这些功能授权相应索引。

## <a name="modifying-the-indexing-policy"></a>修改索引策略

在 Azure Cosmos DB 中，可以随时更新容器的索引策略。 索引策略对 Azure Cosmos 容器中的更改可能会导致索引形状中的更改。 此更改会影响可编制索引的路径、其精度以及索引本身的一致性模型。 索引策略的更改实际上要求将旧索引转换为新索引。

### <a name="index-transformations"></a>索引转换

所有索引转换都是联机进行的。 不会影响的写入可用性或容器上预配的吞吐量可以按照新策略有效转换按照旧策略索引的项。 读取和编写通过使用 REST API、 Sdk，或使用执行的操作的存储过程和触发器在索引转换过程不受影响的一致性。

更改索引策略是一个异步操作，并完成该操作的时间取决于项数、 预配的吞吐量和的项的大小。 正在重新编制索引时，查询可能返回所有匹配的结果，如果使用的索引，它被修改，查询和查询不会返回任何错误/失败。 正在重新编制索引时，查询最终是一致而不考虑索引模式配置。 索引转换完成后，将继续看到一致的结果。 这适用于由 REST API、SDK 等接口或存储过程和触发器发出的查询。 以异步方式在后台，通过使用特定副本可用的备用资源在副本上执行索引转换。

所有索引转换都已到位。 Azure Cosmos DB 不维护索引的两个副本。 因此，在索引转换发生时，容器中不需要也不占用额外的磁盘空间。

更改索引策略时，更改应用的目的是从旧索引移动到新的索引和主要基于索引模式配置。 与其他属性（如包括/排除路径，索引种类和精度）相比，索引模式配置起主要作用。

如果新旧索引策略都使用“一致”索引，则 Azure Cosmos 数据库执行联机索引转换。 转换正在进行时，不能应用一致索引模式下的其他索引策略更改。 当切换到“无”索引模式时，会立即删除索引。 当想要取消正在进行的转换，并开始使用不同的索引策略时，切换到“无”模式非常有用。

## <a name="modifying-the-indexing-policy---examples"></a>修改索引策略 - 示例

以下是你想要更新的索引策略的最常见用例：

* 如果你想要正常操作期间，具有一致的结果，但若要故障回复到**None**在大容量数据导入期间的索引模式。

* 如果要在当前 Azure Cosmos 容器上开始使用索引功能。 例如，可使用地理空间查询，这需要空间索引种类；或使用 ORDER BY/字符串范围查询，这需要字符串范围索引种类。

* 如果要手动选择要编制索引的属性，并随时更改它们以适应工作负载。

* 如果要调整索引精度，以提高查询性能或减少占用的存储。

## <a name="next-steps"></a>后续步骤

阅读以下文章中有关索引的详细信息：

* [索引概览](index-overview.md)
* [索引类型](index-types.md)
* [索引路径](index-paths.md)
* [如何管理索引策略](how-to-manage-indexing-policy.md)
