---
title: Azure Cosmos DB 一致性、可用性和性能权衡
description: Azure Cosmos DB 中各种一致性级别的可用性和性能利弊。
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/06/2020
ms.reviewer: sngun
ms.openlocfilehash: 7cdaa9699b15000359c438bcc410e300415b759a
ms.sourcegitcommit: ea006cd8e62888271b2601d5ed4ec78fb40e8427
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/14/2020
ms.locfileid: "81379962"
---
# <a name="consistency-availability-and-performance-tradeoffs"></a>一致性、可用性和性能权衡

依赖复制以实现高可用性和/或低延迟的分布式数据库必须做出权衡。 在读取一致性与可用性、延迟和吞吐量之间做出权衡。

Azure Cosmos DB 通过某种选择范围来实现数据一致性。 此方法包含多个选项，而不会走非常一致性和最终一致性这两种极端。 您可以从一致性频谱上的五个定义良好的级别中进行选择。 从最强到最弱，级别为：

- *强*
- *有边界的陈旧性*
- *会话*
- *一致的前缀*
- *最终*

每个级别提供可用性和性能权衡，并由全面的 SL 支持。

## <a name="consistency-levels-and-latency"></a>一致性级别和延迟

所有一致性级别的读取延迟始终保证在第 99 百分位小于 10 毫秒。 此读取延迟由 SLA 提供保障。 平均读取延迟（第 50 百分位）通常为 4 毫秒或更少。

所有一致性级别的写入延迟始终保证在第 99 百分位小于 10 毫秒。 此写入延迟由 SLA 提供保障。 平均（在第 50 百分位）写入延迟通常不超过 5 毫秒。 跨多个区域且使用非常一致性配置的 Azure Cosmos 帐户不在此保障内。

### <a name="write-latency-and-strong-consistency"></a>写入延迟和强一致性

对于配置与多个区域强一致的 Azure Cosmos 帐户，写入延迟等于两个最远区域之间的两倍往返时间 （RTT），加上第 99 个百分位数的 10 毫秒。 区域之间的高网络 RTT 将转换为更高的 Cosmos DB 请求延迟，因为强一致性仅在确保已提交到帐户中的所有区域后才能完成操作。

确切的 RTT 延迟取决于光速距离和 Azure 网络拓扑。 Azure 网络不会针对任意两个 Azure 区域之间的 RTT 提供任何延迟 SLA。 对于你的 Azure Cosmos 帐户，将在 Azure 门户中显示复制延迟。 可以使用 Azure 门户（转到"指标"边栏选项卡，选择"一致性"选项卡）来监视与 Azure Cosmos 帐户关联的各个区域之间的复制延迟。

> [!IMPORTANT]
> 默认情况下，由于写入延迟较高，具有超过 5000 英里（8000 公里）的区域的帐户的强一致性将被阻止。 要启用此功能，请联系支持人员。

## <a name="consistency-levels-and-throughput"></a>一致性级别和吞吐量

- 对于强和边界过时，读取针对四个副本集中的两个副本（少数仲裁），以提供一致性保证。 会话、一致的前缀和最终执行单个副本读取。 结果是，对于相同数量的请求单位，强和边界陈旧的读取吞吐量是其他一致性级别的一半。

- 对于给定类型的写入操作（例如插入、替换、更新插入和删除），所有一致性级别为请求单元提供的写入吞吐量是相同的。

|**一致性级别**|**仲裁读取**|**仲裁写入**|
|--|--|--|
|**强**|当地少数民族|全球多数|
|**有限过期**|当地少数民族|本地多数|
|**会话**|单个副本（使用会话令牌）|本地多数|
|**一致前缀**|单个副本|本地多数|
|**最终**|单个副本|本地多数|

## <a name="consistency-levels-and-data-durability"></a><a id="rto"></a>一致性级别和数据持续性

在全球分布式数据库环境中，当发生区域范围的服务中断时，一致性级别与数据持续性之间存在直接关系。 制定业务连续性计划时，需了解应用程序在中断事件发生后完全恢复之前的最大可接受时间。 应用程序完全恢复所需的时间称为**恢复时间目标**（**RTO**）。 此外，还需要了解从中断事件恢复时，应用程序可忍受最近数据更新丢失的最长期限。 您可能承受损失的更新的时间段称为**恢复点目标**（**RPO**）。

下表定义了存在区域宽中断时一致性模型和数据持久性之间的关系。 请务必注意，在分布式系统中，由于 CAP 定理的存在，即使一致性较高，也不可能存在 RPO 和 RTO 为零的分布式数据库。 若要详细了解原因，请参阅 [Azure Cosmos DB 中的一致性级别](consistency-levels.md)。

|**地区**|**复制模式**|**一致性级别**|**RPO**|**RTO**|
|---------|---------|---------|---------|---------|
|1|单主或多主数据库|任何一致性级别|< 240 分钟|<1 周|
|>1|单主数据库|会话、一致的前缀或最终|< 15 分钟|< 15 分钟|
|>1|单主数据库|有限过期|*K* & *T*|< 15 分钟|
|>1|单主数据库|非常|0|< 15 分钟|
|>1|多主数据库|会话、一致的前缀或最终|< 15 分钟|0|
|>1|多主数据库|有限过期|*K* & *T*|0|

*K* = 某个项的“K”版本（即更新）的数目。**

*T* = 自上次更新以来的时间间隔“T”。**

## <a name="strong-consistency-and-multi-master"></a>强一致性和多主数据库

针对多主数据库配置的 Cosmos 帐户不能配置为实施强一致性，因为分布式系统不可能在提供为零的 RPO 的同时提供为零的 RTO。 另外，将强一致性与多主数据库配合使用时，没有写入延迟优势，因为对任何区域的任何写入必须在复制后提交到帐户中的所有已配置区域。 这导致写入延迟与单主数据库帐户相同。

## <a name="next-steps"></a>后续步骤

详细了解全局分布，以及分布式系统中的常规一致性利弊。 请参阅以下文章：

- [现代分布式数据库系统设计的一致性权衡](https://www.computer.org/csdl/magazine/co/2012/02/mco2012020037/13rRUxjyX7k)
- [高可用性](high-availability.md)
- [Azure Cosmos DB SLA](https://azure.microsoft.com/support/legal/sla/cosmos-db/v1_2/)
