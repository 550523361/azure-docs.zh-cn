---
title: 将 Windows 安全事件数据连接到 Azure 哨兵*微软文档
description: 了解如何将 Windows 安全事件数据连接到 Azure 哨兵。
services: sentinel
documentationcenter: na
author: yelevin
manager: rkarlin
editor: ''
ms.assetid: d51d2e09-a073-41c8-b396-91d60b057e6a
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/22/2020
ms.author: yelevin
ms.openlocfilehash: 30055ba1befc68d015e3e3162d8db11a2916f3d4
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/28/2020
ms.locfileid: "80124973"
---
# <a name="connect-windows-security-events"></a>连接 Windows 安全事件 

安全事件连接器允许您将所有安全事件（服务器和工作站、物理和虚拟）流式传输到 Azure Sentinel 工作区。 这使您能够在仪表板中查看 Windows 安全事件，在创建自定义警报时使用它们，并依靠这些事件改进调查，让您更深入地了解组织的网络并扩展安全操作能力。 您可以从以下集中选择要流式传输的事件：<a name="event-sets"></a>

- **所有事件**- 所有 Windows 安全和 AppLocker 事件。
- **通用**- 用于审核目的的标准事件集。 此集中包含完整的用户审核跟踪。 例如，它包含用户登录和用户注销事件（事件标识 4624、4634）。 还有审核操作，如安全组更改、密钥域控制器 Kerberos 操作以及符合已接受最佳做法的其他类型的事件。

    **公共**事件集可能包含某些类型的不太常见的事件。  这是因为**公共**集的要点是将事件量减少到更易于管理的水平，同时仍然保持完整的审核跟踪功能。

- **最小**- 一组可能指示潜在威胁的事件。 此集不包含完整的审核跟踪。 它只涵盖可能指示成功违规的事件，以及发生率非常低的其他重要事件。 例如，它包含成功和失败的用户登录（事件标识 4624， 4625），但它不包含注销信息 （4634），这些信息虽然对审核很重要，但对违规检测没有意义，并且具有相对较高的容量。 此集的大部分数据量由登录事件和进程创建事件（事件 ID 4688）组成。

- **无**- 无安全或 AppLocker 事件。 （此设置用于禁用连接器。

    以下列表提供了每个集的安全和应用程序锁存事件 ID 的完整细分：

    | 事件集 | 收集的事件指示 |
    | --- | --- |
    | **轻微** | 1102, 4624, 4625, 4657, 4663, 4688, 4700, 4702, 4719, 4720, 4722, 4723, 4724, 4727, 4728, 4732, 4735, 4737, 4739, 4740, 4754, 4755, 4756, 4767, 4799, 4825, 4946, 4948, 4956, 5024, 5033, 8001, 8002, 8003, 8004, 8005, 8006, 8007, 8222 |
    | **常见** | 1, 299, 300, 324, 340, 403, 404, 410, 411, 412, 413, 431, 500, 501, 1100, 1102, 1107, 1108, 4608, 4610, 4611, 4614, 4622, 4624, 4625, 4634, 4647, 4648, 4649, 4657, 4661, 4662, 4663, 4665, 4666, 4667, 4688, 4670, 4672, 4673, 4674, 4675, 4689, 4697, 4700, 4702, 4704, 4705, 4716, 4717, 4718, 4719, 4720, 4722, 4723, 4724, 4725, 4726, 4727, 4728, 4729, 4733, 4732, 4735, 4737, 4738, 4739, 4740, 4742, 4744, 4745, 4746, 4750, 4751, 4752, 4754, 4755, 4756, 4757, 4760, 4761, 4762, 4764, 4767, 4768, 4771, 4774, 4778, 4779, 4781, 4793, 4797, 4798, 4799, 4800, 4801, 4802, 4803, 4825, 4826, 4870, 4886, 4887, 4888, 4893, 4898, 4902, 4904, 4905, 4907, 4931, 4932, 4933, 4946, 4948, 4956, 4985, 5024, 5033, 5059, 5136, 5137, 5140, 5145, 5632, 6144, 6145, 6272, 6273, 6278, 6416, 6423, 6424, 8001, 8002, 8003, 8004, 8005, 8006, 8007, 8222, 26401, 30004 |

> [!NOTE]
> 可以从 Azure 安全中心或 Azure Sentinel 配置单个工作区上下文中的安全事件集合，但不能同时配置这两个集合。 如果在已在运行 Azure 安全中心的工作区中载入 Azure Sentinel，并且设置为收集安全事件，则有两个选项：
> - 将安全事件集合保留在 Azure 安全中心中。 您将能够在 Azure Sentinel 和 Azure 安全中心中查询和分析这些事件。 但是，您将无法监视连接器的连接状态或在 Azure Sentinel 中更改其配置。 如果这对您很重要，请考虑第二个选项。
>
> - 禁用 Azure[安全中心中的安全事件集合](../security-center/security-center-enable-data-collection.md)，然后仅在 Azure Sentinel 中添加安全事件连接器。 与第一个选项一样，您将能够在 Azure Sentinel 和 Azure 安全中心中查询和分析事件，但现在您将能够监视连接器的连接状态或更改其配置（并且仅在 Azure Sentinel 中）。

## <a name="set-up-the-windows-security-events-connector"></a>设置 Windows 安全事件连接器

要在 Azure 哨兵中收集 Windows 安全事件，请执行：

1. 在 Azure Sentinel 导航菜单中，选择 **"数据连接器**"。 从连接器列表中，单击**安全事件**，然后在右下角的 **"打开连接器"页面**按钮上单击。 然后按照 **"说明"** 选项卡下的屏幕上的说明进行操作，如本节其余部分所述。

1. 验证您是否具有"**先决条件**"所述的适当权限。

1. 在要将安全事件流式传输到 Azure Sentinel 的计算机上下载并安装[日志分析代理](../azure-monitor/platform/log-analytics-agent.md)（也称为 Microsoft 监视代理或 MMA）。

    对于 Azure 虚拟机：
    
    1. 单击**Azure Windows 虚拟机上的安装代理**，然后单击下面显示的链接。
    1. 对于要连接的每个虚拟机，单击右侧列表中的名称，然后单击"**连接**"。

    对于非 Azure Windows 计算机（物理、虚拟上部或另一个云中的虚拟）：

    1. 单击**非 Azure Windows 计算机上的安装代理**，然后单击下面显示的链接。
    1. 单击右侧显示在**Windows 计算机**下的相应下载链接。
    1. 使用下载的可执行文件，在您选择的 Windows 系统上安装代理，并使用上面显示的下载链接下方的**工作区 ID 和密钥**进行配置。

    > [!NOTE]
    >
    > 要允许没有必要互联网连接的 Windows 系统将事件仍流式传输到 Azure Sentinel，请使用右下角的链接在单独的计算机上下载并安装**OMS 网关**，以充当代理。  您仍然需要在每个要收集其事件的 Windows 系统上安装日志分析代理。
    >
    > 有关此方案的详细信息，请参阅[**日志分析网关**文档](../azure-monitor/platform/gateway.md)。

    有关其他安装选项和更多详细信息，请参阅[**日志分析代理**文档](../azure-monitor/platform/agent-windows.md)。

1. 选择要流式传输的事件集（[全部、通用或最小](#event-sets)）。

1. 单击“更新”****。

1. 要在日志分析中为 Windows 安全事件使用相关架构`SecurityEvent`，请键入查询窗口。

## <a name="validate-connectivity"></a>验证连接

可能需要大约 20 分钟，直到日志开始出现在日志分析中。 



## <a name="next-steps"></a>后续步骤
在本文档中，您学习了如何将 Windows 安全事件连接到 Azure Sentinel。 要详细了解 Azure Sentinel，请参阅以下文章：
- 了解如何[洞悉数据和潜在威胁](quickstart-get-visibility.md)。
- 使用[内置](tutorial-detect-threats-built-in.md)或[自定义](tutorial-detect-threats-custom.md)规则开始使用 Azure Sentinel 检测威胁。

