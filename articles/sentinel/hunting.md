---
title: Azure Sentinel 中的寻猎功能*微软文档
description: 本文介绍如何使用 Azure Sentinel 搜索功能。
services: sentinel
documentationcenter: na
author: yelevin
manager: rkarlin
editor: ''
ms.assetid: 6aa9dd27-6506-49c5-8e97-cc1aebecee87
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.devlang: na
ms.topic: conceptual
ms.custom: mvc
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/10/2019
ms.author: yelevin
ms.openlocfilehash: 52af688917aa531d125f83844df29a988ed7cb7e
ms.sourcegitcommit: acb82fc770128234f2e9222939826e3ade3a2a28
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/21/2020
ms.locfileid: "81686634"
---
# <a name="hunt-for-threats-with-azure-sentinel"></a>使用 Azure 哨兵搜索威胁

如果您是希望主动查找安全威胁的调查员，Azure Sentinel 会强大的搜索和查询工具，以查找组织数据源的安全威胁。 但是，您的系统和安全设备会生成大量数据，这些数据可能难以解析和筛选到有意义的事件。 为了帮助安全分析人员主动查找安全应用未检测到的新异常，Azure Sentinel 的内置搜索查询指导您提出正确的问题，以查找网络上已有的数据中的问题。 

例如，一个内置查询提供有关在基础结构上运行的最罕见进程的数据 - 您不希望每次运行这些进程时都发出警报，它们可能完全是无辜的，但您可能希望偶尔查看该查询，以查看是否有异常情况。 



通过 Azure Sentinel 搜索，您可以利用以下功能：

- 内置查询：为了入门，起始页提供预加载的查询示例，旨在帮助您入门并熟悉表和查询语言。 这些内置的狩猎查询由 Microsoft 安全研究人员持续开发，增加了新的查询，并微调现有查询，为您提供一个入口点来查找新检测，并找出从何处开始寻找新的攻击的开始。 

- 使用 IntelliSense 强大的查询语言：构建在查询语言之上，使您能够灵活地将狩猎带到一个新的水平。

- 创建自己的书签：在狩猎过程中，您可能会遇到看起来异常或可疑的匹配项或发现、仪表板或活动。 为了标记这些项目，以便将来可以返回这些项目，请使用书签功能。 书签允许您保存项目以供以后使用，用于创建事件以供调查。 有关书签的详细信息，请参阅[在狩猎中使用书签](hunting.md)。
- 使用笔记本自动调查：笔记本就像一步一步的剧本，您可以构建这些手册来完成调查和搜索的步骤。  笔记本将所有狩猎步骤封装在可重用的剧本中，这些步骤可以与组织中的其他人共享。 
- 查询存储的数据：数据可在表中访问，可供您查询。 例如，可以查询进程创建、DNS 事件和许多其他事件类型。

- 指向社区的链接：利用大社区的力量来查找其他查询和数据源。
 
## <a name="get-started-hunting"></a>开始打猎

1. 在 Azure Sentinel 门户中，单击 **"搜索**"。
  ![Azure 哨兵开始狩猎](media/tutorial-hunting/hunting-start.png)

2. 打开 **"搜索"** 页时，所有寻用查询都显示在单个表中。 该表列出了 Microsoft 安全分析团队编写的所有查询以及您创建或修改的任何其他查询。 每个查询都提供它搜索的内容及其运行的数据类型的说明。 这些模板按其各种策略分组 - 右侧的图标对威胁类型进行分类，例如初始访问、持久性和渗漏。 您可以使用任何字段筛选这些狩猎查询模板。 您可以将任何查询保存到收藏夹。 通过将查询保存到收藏夹，查询会在每次访问 **"搜索"** 页时自动运行。 您可以创建自己的狩猎查询或克隆并自定义现有的狩猎查询模板。 
 
2. 单击"狩猎查询详细信息"页中的 **"运行"查询**，以在不离开搜索页的情况下运行任何查询。  匹配项数显示在表中。 查看狩猎查询及其匹配项的列表。 查看匹配关联的终止链中的哪个阶段。

3. 在查询详细信息窗格中快速查看基础查询，或单击"**查看查询结果**"以在日志分析中打开查询。 在底部，查看查询的匹配项。

4.    单击该行并选择 **"添加书签**"以添加要调查的行 - 您可以对任何看起来可疑的行执行此操作。 

5. 然后，返回主要 **"搜索"** 页面，然后单击 **"书签"** 选项卡以查看所有可疑活动。 

6. 选择书签，然后单击 **"调查"** 以打开调查体验。 您可以筛选书签。 例如，如果您正在调查市场活动，则可以为市场活动创建一个标记，然后根据市场活动筛选所有书签。

1. 发现哪些狩猎查询提供了对可能攻击的高价值见解后，还可以基于查询创建自定义检测规则，并将这些见解呈现为对安全事件响应者的警报。

 

## <a name="query-language"></a>查询语言 

Azure Sentinel 中的搜索基于 Kusto 查询语言。 有关查询语言和受支持的运算符的详细信息，请参阅[查询语言参考](/azure/azure-monitor/log-query/get-started-queries)。

## <a name="public-hunting-query-github-repository"></a>公共狩猎查询 GitHub 存储库

查看[狩猎查询存储库](https://github.com/Azure/Orion)。 贡献和使用客户共享的示例查询。

 

## <a name="sample-query"></a>示例查询

典型查询以表名开头，后跟一系列由  分隔的\|运算符。

在上面的示例中，从表名称 SecurityEvent 开始，并根据需要添加管道元素。

1. 定义时间筛选器以仅查看过去七天的记录。

2. 在查询中添加筛选器以仅显示事件 ID 4688。

3. 在 CommandLine 上的查询中添加筛选器，以仅包含 cscript.exe 的实例。

4. 仅投影您感兴趣的列，并将结果限制为 1000，然后单击 **"运行"查询**。
5. 单击绿色三角形并运行查询。 您可以测试查询并运行它以查找异常行为。

## <a name="useful-operators"></a>有用的运算符

查询语言功能强大，具有许多可用的运算符，此处列出了一些有用的运算符：

**其中**- 将表筛选为满足谓词的行子集。

**摘要**- 生成聚合输入表内容的表。

**联接**- 通过匹配每个表中指定列的值，合并两个表的行以形成新表。

**计数**- 返回输入记录集中的记录数。

**顶部**- 返回按指定列排序的前 N 条记录。

**限制**- 返回最多指定数量的行。

**项目**- 选择要包含、重命名或删除的列，然后插入新的计算列。

**扩展**- 创建计算列并将其追加到结果集中。

**makeset** - 返回 Expr 在组中采用的一组不同值的动态 （JSON） 数组

**查找**- 查找与一组表的谓词匹配的行。

## <a name="save-a-query"></a>保存查询

您可以创建或修改查询并将其保存为您自己的查询，或与同一租户中的用户共享查询。

   ![保存查询](./media/tutorial-hunting/save-query.png)

创建新的狩猎查询：

1. 单击 **"新建"查询**并选择 **"保存**"。
2. 填写所有空白字段，然后选择 **"保存**"。

   ![新建查询](./media/tutorial-hunting/new-query.png)

克隆和修改现有的狩猎查询：

1. 选择要修改的表中的狩猎查询。
2. 选择要修改的查询行中的省略号 （...），然后选择 **"克隆"查询**。

   ![克隆查询](./media/tutorial-hunting/clone-query.png)
 

3. 修改查询并选择 **"创建**"。

   ![自定义查询](./media/tutorial-hunting/custom-query.png)

## <a name="next-steps"></a>后续步骤
在本文中，您学习了如何使用 Azure Sentinel 运行狩猎调查。 要详细了解 Azure Sentinel，请参阅以下文章：


- [使用笔记本运行自动狩猎活动](notebooks.md)
- [使用书签在狩猎时保存有趣的信息](bookmarks.md)
