---
title: 了解 Azure IoT 中心配额和限制 |Microsoft Docs
description: 开发人员指南-介绍适用于 IoT 中心的配额和预期限制行为。
author: robinsh
ms.author: robinsh
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 08/08/2019
ms.openlocfilehash: 64f285ea27bde4565d051a84a65c5b4d7b8e9e8c
ms.sourcegitcommit: 67e9f4cc16f2cc6d8de99239b56cb87f3e9bff41
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/31/2020
ms.locfileid: "76906981"
---
# <a name="reference---iot-hub-quotas-and-throttling"></a>参考-IoT 中心配额和限制

本文介绍 IoT 中心的配额，并提供相关信息，帮助你了解限制的工作原理。

## <a name="quotas-and-throttling"></a>配额和限制

每个 Azure 订阅最多可以有50个 IoT 中心，最多可以有1个免费中心。

每个 IoT 中心都预配了特定层中的特定数量的单位。 层和单位数决定了可以发送的消息的每日配额上限。 用于计算每日配额的消息大小为免费层中心 0.5 KB，适用于所有其他层的4KB。 有关详细信息，请参阅[Azure IoT 中心定价](https://azure.microsoft.com/pricing/details/iot-hub/)。

该层还决定了 IoT 中心对所有操作强制实施的限制。

### <a name="iot-plug-and-play"></a>IoT 即插即用

公共预览期间，IoT 即插即用设备将为每个接口发送单独的消息，这可能会增加计入消息配额的消息数。

## <a name="operation-throttles"></a>操作限制

操作限制是在分钟范围内应用的速率限制，旨在防止滥用。 它们也服从[流量](#traffic-shaping)调整。

下表显示了强制限制。 值引用单个中心。

| 作为 | Free、B1 和 S1 | B2 和 S2 | B3 和 S3 | 
| -------- | ------- | ------- | ------- |
| [标识注册表操作](#identity-registry-operations-throttle)（创建、检索、列出、更新、删除） | 1.67/秒/单位（100/分钟/单位） | 1.67/秒/单位（100/分钟/单位） | 83.33/秒/单位（5000/分钟/单位） |
| [新设备连接](#device-connections-throttle)（此限制适用于_新连接_的速率，而不是连接总数） | 高为 100/秒或 12/秒/单位 <br/> 例如，两个 S1 单位是 2\*12 = 24 个新连接数/秒，但你的单元上至少有100个新的连接数/秒。 对于9个 S1 单位，你的单元中有108个新连接/秒（9\*12）。 | 120新连接数/秒/单位 | 6000新连接数/秒/单位 |
| 从设备到云的发送 | 超过100个发送操作数/秒或12个发送操作数/秒/单位 <br/> 例如，两个 S1 单位是 2\*12 = 24/秒，但是在所有单位中至少有100个发送操作。 对于9个 S1 单位，每个单位都有108个发送操作数/sec （9\*12）。 | 120发送操作数/秒/单位 | 6000发送操作数/秒/单位 |
| 云到设备发送<sup>1</sup> | 1.67 发送操作数/秒/单位（100个消息/分钟/单位） | 1.67 发送操作数/秒/单位（100发送操作数/分钟/单位） | 83.33 发送操作数/秒/单位（5000发送操作数/分钟/单位） |
| 云到设备接收<sup>1</sup> <br/> （仅当设备使用 HTTPS 时）| 16.67 接收操作数/秒/单位（1000接收操作数/分钟/单位） | 16.67 接收操作数/秒/单位（1000接收操作数/分钟/单位） | 833.33 接收操作数/秒/单位（50000接收操作数/分钟/单位） |
| 文件上传 | 1.67 文件上传起始次数/秒/单位（100/分钟/单位） | 1.67 文件上传起始次数/秒/单位（100/分钟/单位） | 83.33 文件上传起始次数/秒/单位（5000/分钟/单位） |
| 直接方法<sup>1</sup> | 160KB/秒/单位<sup>2</sup> | 480KB/秒/单位<sup>2</sup> | 24MB/秒/单位<sup>2</sup> | 
| 请求 | 20/分钟/单位 | 20/分钟/单位 | 1000/分钟/单位 |
| 克隆（设备和模块）读取<sup>1</sup> | 100/秒 | 高为 100/秒或 10/秒/单位 | 500/秒/单位 |
| 克隆更新（设备和模块）<sup>1</sup> | 50/秒 | 高于 50/秒或 5/秒/单位 | 250/秒/单位 |
| 作业操作<sup>1</sup> <br/> （创建、更新、列出、删除） | 1.67/秒/单位（100/分钟/单位） | 1.67/秒/单位（100/分钟/单位） | 83.33/秒/单位（5000/分钟/单位） |
| 作业设备操作<sup>1</sup> <br/> （更新克隆，调用直接方法） | 10/秒 | 大于 10/秒或 1/秒/单位 | 50/秒/单位 |
| 配置和边缘部署<sup>1</sup> <br/> （创建、更新、列出、删除） | 0.33/秒/单位（20/分钟/单位） | 0.33/秒/单位（20/分钟/单位） | 0.33/秒/单位（20/分钟/单位） |
| 设备流初始速率<sup>1</sup> | 5个新流/秒 | 5个新流/秒 | 5个新流/秒 |
| 同时连接的设备流的最大数目<sup>1</sup> | 50 | 50 | 50 |
| 最大设备流数据传输<sup>1</sup> （每天聚合卷） | 300 MB | 300 MB | 300 MB |

<sup>1</sup>此功能在 IoT 中心的基本层中不可用。 有关详细信息，请参阅[如何选择正确的 IoT 中心](iot-hub-scaling.md)。 <br/><sup>2</sup>限制计量大小为 4 KB。

### <a name="throttling-details"></a>限制详细信息

* 计量大小确定使用限制的增量。 如果直接调用的负载介于0到 4 KB 之间，则会将其计为 4 KB。 在达到 160 KB/秒/单位的限制之前，每个单位最多可以执行40个调用。

   同样，如果有效负载介于 4 KB 到 8 KB 之间，则每个呼叫帐户 8 KB，在达到最大限制之前，每个单位每秒最多可以进行20个调用。

   最后，如果负载大小介于156KB 和 160 KB 之间，则在达到 160 KB/秒/单位的限制之前，每个单元每个单元只能进行1次调用。

*  对于层 S2 的*作业设备操作（更新克隆、调用直接方法）* ，仅当你使用作业调用方法时，50/秒/单位才适用于。 如果直接调用直接方法，则会应用 24 MB/秒/单位（适用于 S2）的原始阻止限制。

*  **配额**是你*每天*可以发送的消息的聚合数。 可以在[IoT 中心定价页](https://azure.microsoft.com/pricing/details/iot-hub/)上美元/天的 "**消息总数**" 列下找到中心的配额限制。

*  云到设备和设备到云的限制确定发送消息的最大*速率*-消息的数量，而不考虑 4 KB 的区块。 每条消息最大可以为 256 KB，这是[最大消息大小](iot-hub-devguide-quotas-throttling.md#other-limits)。

*  最佳做法是限制调用，以便不会达到/超过限制限制。 如果达到此限制，IoT 中心将响应并返回错误代码429，并且客户端应进行备份，然后重试。 这些限制是每个中心（或在某些情况下，每个集线器/单位）。 有关详细信息，请参阅[管理连接和可靠消息/重试模式](iot-hub-reliability-features-in-sdks.md#retry-patterns)。

### <a name="traffic-shaping"></a>流量调整

为了适应突发流量，IoT 中心会在有限时间中接受超出限制的请求。 其中的前几个请求将立即处理。 但是，如果请求数继续违反限制，IoT 中心会开始将请求放入队列中，并按限制进行处理。 这种效果称为*流量*调整。 而且，此队列的大小会受到限制。 如果违反限制，最终将填满队列，IoT 中心会开始拒绝带有 `429 ThrottlingException`的请求。

例如，使用模拟设备每秒向 S1 IoT 中心发送200的设备到云消息（限制为 100/秒 D2C）。 对于前一两分钟，消息将立即处理。 但是，由于设备会继续发送超过限制限制的消息，因此 IoT 中心开始时只会处理100消息/秒，并将其余的消息放入队列中。 您开始注意到增加了延迟。 最终，在队列填满时开始获取 `429 ThrottlingException`， [IoT 中心度量值](iot-hub-metrics.md)中的 "限制错误数" 也会开始增加。

### <a name="identity-registry-operations-throttle"></a>标识注册表操作限制

设备标识注册表操作用于设备管理和预配方案中的运行时使用。 通过[导入和导出作业](iot-hub-devguide-identity-registry.md#import-and-export-device-identities)，支持读取或更新大量的设备标识。

### <a name="device-connections-throttle"></a>设备连接限制

*设备连接*限制控制可与 IoT 中心建立新设备连接的速率。 "*设备连接*" 限制不控制同时连接的设备的最大数量。 *设备连接*速率限制取决于为 IoT 中心预配的单位数。

例如，如果购买了单个 S1 单位，每秒会获得100连接限制。 因此，若要连接100000设备，至少需要1000秒（大约16分钟）。 但是，你可以将任意数量的连接的设备与在标识注册表中注册的设备数量相同。

## <a name="other-limits"></a>其他限制

IoT 中心强制实施其他操作限制：

| 运算 | 限制 |
| --------- | ----- |
| 设备 | 可注册到单个 IoT 中心的设备和模块的总数上限为1000000。 增加此限制的唯一方法是联系[Microsoft 支持部门](https://azure.microsoft.com/support/options/)。|
| 文件上传 | 每个设备10个并发文件上传。 |
| 作业<sup>1</sup> | 最大并发作业数为1（适用于免费和 S1）、5（适用于 S2）和10（适用于 S3）。 但是，所有层的最大并发[设备导入/导出作业](iot-hub-bulk-identity-mgmt.md)数均为1。 <br/>作业历史记录最多保留30天。 |
| 其他终结点 | 付费 SKU 中心可能有10个额外终结点。 免费 SKU 中心可能有一个额外的终结点。 |
| 消息路由查询 | 付费 SKU 中心可能有100路由查询。 免费 SKU 中心可能有五个路由查询。 |
| 消息根据 | 付费 SKU 中心最多可以有10条消息根据。 免费 SKU 中心最多可以有2条消息根据。|
| 设备到云的消息传送 | 最大消息大小 256 KB |
| 云到设备的消息传递<sup>1</sup> | 最大消息大小 64 KB。 要传递的最大挂起消息数为每个设备50。 |
| 直接方法<sup>1</sup> | 最大直接方法负载大小为 128 KB。 |
| 自动设备和模块配置<sup>1</sup> | 100每个付费 SKU 中心的配置。 每个免费 SKU 中心20个配置。 |
| IoT Edge 自动部署<sup>1</sup> | 每个部署20个模块。 100每个付费 SKU 中心的部署（包括分层部署）。 每个免费 SKU 中心10个部署。 |
| 孪生<sup>1</sup> | 所需属性和报告属性部分的最大大小为 32 KB。 标记的最大大小部分为 8 KB。 |
| 共享访问策略 | 共享访问策略的最大数目为16 |

<sup>1</sup>此功能在 IoT 中心的基本层中不可用。 有关详细信息，请参阅[如何选择正确的 IoT 中心](iot-hub-scaling.md)。

## <a name="increasing-the-quota-or-throttle-limit"></a>增加配额或限制限制

在任意给定时间，你都可以通过[增加 IoT 中心的预配单位数](iot-hub-upgrade.md)来提高配额或限制限制。

## <a name="latency"></a>延迟

IoT 中心努力为所有操作提供低延迟。 然而，由于网络条件和其他不可预知的因素，它无法保证一定的延迟。 设计解决方案时，应执行以下操作：

* 避免对任何 IoT 中心操作的最大延迟做出任何假设。
* 在离设备最近的 Azure 区域预配 IoT 中心。
* 请考虑使用 Azure IoT Edge 在设备上或靠近设备的网关上执行对延迟敏感的操作。

如前文所述，多个 IoT 中心单位影响限制，但未提供任何附加延迟权益或保证。

如果操作延迟出现意外增长，请联系[Microsoft 支持部门](https://azure.microsoft.com/support/options/)。

## <a name="next-steps"></a>后续步骤

有关 IoT 中心限制行为的深入讨论，请参阅博客文章[Iot 中心限制和你](https://azure.microsoft.com/blog/iot-hub-throttling-and-you/)。

此 IoT 中心开发人员指南中的其他参考主题包括：

* [IoT 中心终结点](iot-hub-devguide-endpoints.md)
