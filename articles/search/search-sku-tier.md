---
title: 选择 Azure 搜索服务的定价层或 SKU | Microsoft Docs
description: Azure 搜索可在以下 SKU 上进行预配：“免费”、“基本”和“标准”，其中“标准”在各种资源配置和容量级别中均可用。
services: search
author: HeidiSteen
manager: cgronlun
tags: azure-portal
ms.service: search
ms.topic: conceptual
ms.date: 06/19/2018
ms.author: heidist
ms.openlocfilehash: 140daf4903c64d734182545cd4dc58db60274852
ms.sourcegitcommit: e2ea404126bdd990570b4417794d63367a417856
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/14/2018
ms.locfileid: "45576114"
---
# <a name="choose-a-pricing-tier-for-azure-search"></a>选择 Azure 搜索的定价层

在 Azure 搜索中，[服务已在特定的定价层或 SKU 上进行预配](search-create-service-portal.md)。 选项包括“免费”、“基本”或“标准”，其中“标准”在多个配置和容量中均可用。 

本文旨在帮助你选择层。 它用于补充[定价页](https://azure.microsoft.com/pricing/details/search/)和[服务限制](search-limits-quotas-capacity.md)页，包含与各层级相关的计费概念和消费模式的摘要。 它还建议采用迭代方法来了解哪个层能更好地满足你的需求。 

层级决定容量，而不是功能。 如果层级容量经证实过低，将需要在更高的层级上预配新服务，然后[重新加载索引](search-howto-reindex.md)。 相同的服务无法从一个 SKU 就地升级到另一个。

功能可用性不是主要的层级考虑因素。 所有层级（包括“免费”层）都提供功能奇偶一致性，除了 S3HD 的索引器支持。 但是，索引和资源约束可以有效地限制功能的使用范围。 例如，[认知搜索](cognitive-search-concept-intro.md)索引具有长期运行的特性，除非数据集很小，否则会在免费服务中超时。

> [!TIP]
> 大多数客户从“免费”层开始进行评估，然后升级到“标准”层进行开发。 选择层级并[预配搜索服务](search-create-service-portal.md)后，可以[增加副本和分区计数](search-capacity-planning.md)以进行性能调整。 有关何时以及为何调整容量的更多信息，请参阅[性能和优化注意事项](search-performance-optimization.md)。
>

## <a name="billing-concepts"></a>计费概念

选择层级时需要了解的概念包括容量定义、服务限制和服务单位。 

### <a name="capacity"></a>Capacity

容量的结构为副本和分区。 

+ 副本是搜索服务的实例，每个副本托管一个索引的一个负载均衡副本。 例如，包含 6 个副本的服务具有加载到服务中的每个索引的 6 个副本。 

+ 分区存储索引并自动拆分可搜索的数据：两个分区将索引分成两部分，三个分区分成三部分，以此类推。 在容量方面，分区大小是各层级的主要区别特征。

> [!NOTE]
> 所有“标准”层都支持[灵活组合副本和分区](search-capacity-planning.md#chart)，用户可通过改变均衡来[增加系统的速度或存储空间](search-performance-optimization.md)。 “基本”层最多可提供三个副本以实现高可用性，但只有一个分区。 “免费”层不提供专用资源：计算资源由多个免费服务共享。

### <a name="search-units"></a>搜索单位

要了解的重要计费概念是搜索单位 (SU)，即 Azure 搜索的计费单位。 由于 Azure 搜索依赖于副本和分区来运行，因此按其中一个或另一个来计费都是没有意义的。 相反，应基于两者的组合来计费。 如果用公式表示，SU 是服务使用的副本和分区的乘积：(R X P = SU)。 每个服务至少从 1 个 SU 开始（一个副本乘以一个分区），但更现实可行的模型可能是 3 个副本和 3 个分区的服务，按 9 个 SU 计费。 

尽管每个层级提供的容量越来越大，但你可以将总容量的一部分联机，其余部分储备待用。 在计费方面，实际支付的费用取决于联机的分区和副本数量（使用 SU 公式计算）。

每个 SU 的计费率是每小时一次，每个层级的计费率各不相同。 有关每层的费率，请参阅 [Pricing Details](https://azure.microsoft.com/pricing/details/search/)（定价详细信息）。

### <a name="limits"></a>限制

服务托管资源，如索引、索引器等。 每个层级都会对可以创建的资源数量施加[服务限制](search-limits-quotas-capacity.md)。 因此，索引数量（以及其他对象）的上限是各层级的第二个区别特征。 在门户中查看每个选项时，请注意索引数量的限制。 其他资源（如索引器、数据源和技能集）受索引限制约束。

## <a name="consumption-patterns"></a>消费模式

大多数客户从“免费”服务开始，并无限期保留，然后选择其中一个“标准”层用于重大开发或生产工作负载。 

![Azure 搜索层](./media/search-sku-tier/tiers.png "Azure 搜索定价层")

在任意一端，“基本”和“S3 HD”都存在重要但非典型的消费模式。 “基本”适用于小型生产工作负载：它提供 SLA、专用资源、高可用性以及适度的存储（总计 2 GB）。 此层级专为持续使用可用容量的客户设计。 在远端，“S3 HD”适用于 ISV、合作伙伴、[多租户解决方案](search-modeling-multitenant-saas-applications.md)或要求大量小型索引的任何配置的典型工作负载。 显然，“基本”或“S3 HD”层通常就很合适，但如果需要确认，可以发布到 [StackOverflow](https://stackoverflow.com/questions/tagged/azure-search) 或[联系 Azure 支持](https://azure.microsoft.com/support/options/)以获取更多指导。

将焦点转移到更常用的“标准”层上，“S1-S3”级别的容量不断增加，分区大小有转折点，并且索引、索引器和推论资源数量达到最大值：

|  | S1 | S2 | S3 |  |  |  |  |
|--|----|----|----|--|--|--|--|
| 分区大小|  25 GB | 100 GB | 250 GB |  |  |  |  |
| 索引和索引器限制| 50 | 200 | 200 |  |  |  |  |

当需要专用资源和多个分区时，通常选择“S1”。 假设共有 12 个分区，每个分区 25 GB，如果通过副本最大化分区，则“S1”上每项服务的限制总计为 300 GB（请参阅[分配分区和副本](search-capacity-planning.md#chart)以获得更多均衡组合）。

门户和定价页将重点放在分区大小和存储上，但对于每个层级，所有计算能力（磁盘容量、速度、CPU）随着价格呈线性增长。 “S2”副本快于“S1”，“S3”快于“S2”。 “S3”层以非常快的 I/O 速度打破了一般的线性计算定价模式。 如果预计 I/O 会成为瓶颈，那么“S3”会为你提供比更低层级更多的 IOPS。

“S3”和“S3 HD”受相同高容量基础结构支持，但各采用不同的方式达到其最大限制。 “S3”面向较小数目的非常大的索引。 在这种情况下，其最大限制是资源限制型（每个服务 2.4 TB）。 “S3 HD”面向较大数目的非常小的索引。 在 1,000 个索引的情况下，“S3 HD”达到其索引约束形式的限制。 如果“S3 HD”客户需要超过 1,000 个索引，请联系 Microsoft 支持部门，了解如何继续。

> [!NOTE]
> 以前，文档限制是一个考虑因素，但它将不再适用于 2018 年 1 月以后提供的大多数 Azure 搜索服务。 有关文档限制仍适用的条件的详细信息，请参阅[服务限制：文档限制](search-limits-quotas-capacity.md#document-limits)。
>

## <a name="evaluate-capacity"></a>评估容量

容量与运行服务的成本密切相关。 各层级在两个级别（存储和资源）施加限制，应同时考虑两个级别，因为无论先达到哪个级别的限制都是有效的限制。 

业务需求通常决定需要的索引数。 例如，针对大型文档存储库的全局索引，或者基于区域、应用程序或业务利基的多个索引。

若要确定索引大小，必须[生成一个索引](search-create-index-portal.md)。 Azure 搜索中的数据结构主要是[倒排索引](https://en.wikipedia.org/wiki/Inverted_index)，它具有与源数据不同的特征。 对于倒排索引，大小和复杂度由内容决定，不一定是输入的数据量。 具有大量冗余的大型数据源可能会导致比包含高度可变内容的较小数据集更小的索引。  在这种情况下，很难根据原始数据集的大小来推断索引大小。

### <a name="step-1-develop-rough-estimates-using-the-free-tier"></a>步骤 1：使用“免费”层进行粗略估计

估计容量的一种方法是从“免费”层开始。 回想一下，“免费”服务最多提供 3 个索引、50 MB 存储和 2 分钟索引时间。 使用这些约束来估计预计的索引大小可能具有挑战性，但以下示例介绍了一种方法：

+ [创建免费服务](search-create-service-portal.md)
+ 准备小型且具有代表性的数据集（假设五千个文档和百分之十的示例大小）
+ [生成初始索引](search-create-index-portal.md)并记下其在门户中的大小（假设为 30 MB）

假设示例既具有代表性，又占整个数据源的 10%，如果所有文档都编入索引，则 30 MB 索引将变为大约 300 MB。 有了此初始数量，你可以将此数额增加一倍到两个索引（开发和生产）的预算，总共 600MB 的存储需求。 “基本”层可以轻松满足此需求，因此你将从“基本”层开始。

### <a name="step-2-develop-refined-estimates-using-a-billable-tier"></a>步骤 2：使用可计费层进行改进的估计

有些客户更喜欢从可以适应更大采样和处理时间的专用资源开始，然后在开发期间对索引数量、大小和查询量进行现实估计。 最初，服务是根据最佳预计提供的，然后随着开发项目的成熟，团队通常会知道现有服务是否超出或低于预计的生产工作负载的容量。 

1. [检查每个层级的服务限制](https://docs.microsoft.com/azure/search/search-limits-quotas-capacity#index-limits)以确定较低层级是否可以支持需要的索引数量。 在“基本”-“S1”- “S2”层级中，索引限制分别为 15-50-200。

1. [在可计费层中创建服务](search-create-service-portal.md)：

    + 起点低，如果你处于学习曲线的开始位置，请从“基本”或“S1”开始。
    + 起点高，如果需要大规模索引和查询负载，请从“S2”甚至“S3”开始。

1. [生成初始索引](search-create-index-portal.md)以确定将源数据转换为索引的方式。 这是估计索引大小的唯一方法。

1. 在门户中[监视存储、服务限制、查询量和延迟](search-monitor-usage.md)。 门户向你显示每秒查询、受限查询和搜索延迟；所有这些内容都有助于决定你是否处于正确的层级。 除门户指标外，你还可以通过启用[搜索流量分析](search-traffic-analytics.md)来配置深层监视，例如点击链接分析。 

索引数目和大小与分析同等相关，因为通过充分利用存储（分区）或通过最大化对资源（索引、索引器等）的限制来达到最大限制（以先发生者为准）。 门户可帮助你跟踪两者，并在“概述”页面上并排显示当前使用情况和最大限制。

> [!NOTE]
> 如果文档包含无关数据，存储要求可能会过高。 理想情况下，文档仅包含搜索体验所需的数据。 二进制数据不可搜索，应该分开存储（或许存储在 Azure 表或 blob 存储中），并且在索引中要有一个字段用于保存外部数据的 URL 参考。 个别文档的最大大小是 16 MB（如果在一次请求中批量上传了多个文档，则小于 16 MB）。 [Azure 搜索中的服务限制](search-limits-quotas-capacity.md)提供详细信息。
>

**查询量注意事项**

每秒查询数 (QPS) 是在性能调整过程中突出显示的一个指标，但通常不是层级考虑因素，除非你期望在一开始就有很高的查询量。

所有标准层都可以实现副本与分区的均衡，通过额外的负载均衡副本和并行处理分区来支持更快的查询周转速度。 你可以在预配服务后调整新能。

期待从一开始就拥有强大的持续查询量的客户，应该考虑由更强大的硬件支持的更高层级。 如果无法实现这些查询量，你可以使分区和副本脱机，或者甚至切换到较低层级的服务。 有关如何计算查询吞吐量的详细信息，请参阅 [Azure 搜索性能和优化](search-performance-optimization.md)。


**服务级别协议**

“免费”层和预览功能不带[服务级别协议 (SLA)](https://azure.microsoft.com/support/legal/sla/search/v1_0/)。 对于所有可计费的层，SLA 将在用户为服务提供足够冗余时生效。 查询（读取）SLA 需要两个或多个副本。 查询和索引（读-写）SLA 需要不少于三个副本。 分区数不属于 SLA 相关考虑因素。 

## <a name="tips-for-tier-evaluation"></a>层级评估提示

+ 了解如何生成高效的索引，以及哪些刷新方法影响最小。 建议[搜索流量分析](search-traffic-analytics.md)以获取有关查询活动的见解。

+ 允许围绕查询构建指标并收集有关使用模式的数据（在营业时间进行查询，在非高峰时段进行索引），并使用这些数据来通知将来的服务预配决策。 虽然无法每小时或每天收集数据，但可以动态调整分区和资源，以适应计划的查询量更改，或者无计划的但持续更改（如果级别维持足够长以保证执行操作）。

+ 请记住，预配不足的唯一缺点是，如果实际需求超出预期，则可能必须关闭某项服务。 为避免服务中断，可以在更高层级的相同订阅中创建新服务，并将其并行运行，直到所有应用和请求都指向新的终结点。

## <a name="next-steps"></a>后续步骤

从“免费”层开始，使用数据子集生成初始索引以了解其特征。 Azure 搜索中的数据结构是倒排索引，其大小和复杂度由内容决定。 请记住，高度冗余的内容往往会导致比高度不规则的内容更小的索引。 在这种情况下，确定索引存储要求的是它的内容特征而不是数据集的大小。

一旦初步了解索引大小，就可以在本文中讨论的一个层级（“基本”层或“标准”层）[提供可计费服务](search-create-service-portal.md)。 放宽对数据子集的任何人为约束，并[重建索引](search-howto-reindex.md)以包含实际希望可搜索的所有数据。

根据需要[分配分区和副本](search-capacity-planning.md)以获取所需性能和规模。

如果性能和容量都合适，那么你已完成操作。 否则，请在与你的需求更接近的不同层级上重新创建搜索服务。

> [!NOTE]
> 有关你的问题的更多帮助，请发布到 [StackOverflow](https://stackoverflow.com/questions/tagged/azure-search) 或[联系 Azure 支持](https://azure.microsoft.com/support/options/)。