---
title: 选择 Azure 搜索服务的定价层或 SKU - Azure 搜索
description: 可在以下 SKU 中预配 Azure 搜索：“免费”、“基本”和“标准”，其中“标准”在各种资源配置和容量级别中均可用。
services: search
author: HeidiSteen
manager: cgronlun
tags: azure-portal
ms.service: search
ms.topic: conceptual
ms.date: 05/08/2019
ms.author: heidist
ms.custom: seodec2018
ms.openlocfilehash: 00422209302bbcc2139be4f6b490f0bb2816c051
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/13/2019
ms.locfileid: "65539293"
---
# <a name="choose-a-pricing-tier-for-azure-search"></a>选择 Azure 搜索的定价层

创建 Azure 搜索服务时，[资源是在某个定价层或 SKU 中创建的](search-create-service-portal.md)，该定价层或 SKU 在该服务的整个生存期内是固定的。 层包括“免费”、“基本”、“标准”和“存储优化”。 “标准”和“存储优化”提供多种配置和容量。

大多数客户从“免费”层着手，以便能够评估该服务。 然后升级到某个更高的层，以进行开发和生产部署。 可以使用“免费”层完成所有快速入门和教程，包括资源密集型认知搜索的教程。

> [!NOTE]
> Microsoft 目前以折扣价提供预览版“存储优化”服务层用于测试和试验，目的是收集反馈。 这些层推出正式版后，我们将公布最终定价。 不建议对生产应用程序使用这些层。

层反映托管服务（而不是功能）的硬件的特征，并按以下标准进行区分：

+ 可以创建的索引数。
+ 分区（物理存储）的大小和速度。

尽管所有层（包括“免费”层）通常会提供功能奇偶一致性，但较大的工作负荷可以要求使用较高的层。 例如，[使用认知服务的 AI 索引](cognitive-search-concept-intro.md)包含长时间运行的技能，除非数据集很小，否则这些技能会在免费服务中超时。

> [!NOTE] 
> 功能奇偶一致性的例外情况是[索引器](search-indexer-overview.md)，它们不可用于 S3 HD。
>

在某个层中，可以[调整副本和分区资源](search-capacity-planning.md)以增大或减小规模。 可以从一个或两个资源着手，然后暂时提高重度索引工作负荷的计算能力。 在层中优化资源级别的功能可以增大灵活性，但也会略微增大分析的复杂性。 可能需要进行试验，以确定资源/副本数更多的较低层所提供的性价比，是否高于资源数更少的较高层。 若要详细了解何时以及为何调整容量，请参阅[性能和优化注意事项](search-performance-optimization.md)。

## <a name="tiers-for-azure-search"></a>Azure 搜索的层

下表列出了可用的层。 预配服务时，可以在[定价页](https://azure.microsoft.com/pricing/details/search/)、[Azure 搜索中的服务限制](search-limits-quotas-capacity.md)以及门户页上找到有关各个层的详细信息。

|层 | 容量 |
|-----|-------------|
|免费 | 与其他订阅者共享。 不可缩放。 限制为 3 个索引和 50 MB 存储。 |
|基本 | 为小规模生产工作负荷提供专用计算资源。 一个 2 GB 的分区和最多 3 个副本。 |
|标准 1 (S1) | 适用于 S1 和更高大小的专用计算机，在每个级别提供更多的存储和处理容量。 适用于 S1 大小的计算机，分区大小为 25 GB/分区（为每个服务最多提供 300 GB）。 |
|标准 2 (S2) | 类似于 S1，但提供 100 GB 的分区（为每个服务最多提供 1.2 TB）。 |
|标准 3 (S3) | 200 GB 分区（为每个服务最多提供 2.4 TB）。 |
|标准 3 高密度 (S3 HD) | “高密度”是适用于 S3 的托管模式。  基础硬件针对大量的小型索引进行优化，适用于多租户方案。 S3 HD 的每单位费用与 S3 相同，但硬件经过优化，可基于大量的小型索引快速读取文件。|
|存储优化 1 (L1) | 1 TB 分区（为每个服务最多提供 12 TB）。 |
|存储优化 2 (L2) | 2 TB 分区（为每个服务最多提供 24 TB）。 |

> [!NOTE] 
> 与“标准”层相比，“存储优化”层以更低的每 TB 价格提供更大的存储容量。 主要弊端是查询延迟更高，应根据具体的应用程序要求确认这种延迟。  若要详细了解此层的性能注意事项，请参阅[性能和优化注意事项](search-performance-optimization.md)。
>

## <a name="how-billing-works"></a>计费原理

在 Azure 搜索中，有三个方面会产生费用，并且存在固定和可变的计费部分。 本部分介绍三个计费部分：核心服务费用、数据传出费用和 AI 扩充索引。

### <a name="core-service-costs-fixed-and-variable"></a>核心服务费用（固定和可变）

对于服务本身而言，最低费用是第一个搜索单位（1 个副本 x 1 分区）的费用。 在服务的整个生命周期内，此最低费用都是固定的，因为服务不能在低于此配置的组件上运行。

超出最低费用时，可以单独添加副本和分区。 例如，可以只添加副本，或只添加分区。 通过副本和分区递增容量构成了可变费用部分。

费用是根据某个[公式（副本数 x 分区数 x 费率）](#search-units)计算的。 付费费率取决于所选的定价层。

在以下屏幕截图中，“免费”、“基本”和 S1 层按单位定价。 （S2、S3、L1 和 L2 未显示。）如果创建“基本”服务，每月费用将是 *price-1* 显示的值的平均值。 如果创建“标准”服务，每月费用将是 *price-2* 显示的值的平均值。 每个层的单位费用将会增加，因为每个连续层的计算能力和存储容量会不断增大。 [Azure 搜索定价页](https://azure.microsoft.com/pricing/details/search/)上提供了Azure 搜索的费率。

![按单位定价](./media/search-sku-tier/per-unit-pricing.png "按单位定价")

在估算搜索解决方案的费用时，请记住，定价和容量不是线性的。 （容量翻倍不是支付两倍的费用，而是要支付更高的费用）有关该公式的工作方式示例，请参阅[如何分配副本和分区](search-capacity-planning.md#how-to-allocate-replicas-and-partitions)。

#### <a name="billing-based-on-search-units"></a>基于搜索单位计费

对于 Azure 搜索操作，要了解的最重要计费概念是搜索单位 (SU)。  由于 Azure 搜索必须同时使用副本和分区进行索引编制和查询，因此无法按其中的一个进行计费。 相反，应基于两者的组合来计费。

SU 是服务使用的副本数和分区数的乘积：   **(R x P = SU)** 。

每个服务至少从 1 个 SU（1 个分区乘以 1 个副本）开始。 任何服务的最大 SU 值为 36。 可通过多种方式来实现此最大值：例如，6 个分区 x 6 个副本，或 3 个分区 x 12 个副本。 通常使用小于总容量的值（例如，3 副本、3 分区的服务按 9 个 SU 计费）。 有关有效的组合，请参阅[分区和副本组合](search-capacity-planning.md#chart)图表。

费率按每个 SU、按小时计算。 每个层的费率渐进式提高。 层越高，分区越大且速度越快，因此，每小时的总费率更高。 可以在[定价详细信息](https://azure.microsoft.com/pricing/details/search/)页上查看每个层的费率。

大多数客户只是联机使用一部分总容量，将剩余的容器保持预留状态。 在计费方面，支付的每小时费用取决于联机的分区和副本数量（使用 SU 公式计算）。

### <a name="data-egress-charges-during-indexing"></a>索引期间的数据流出费用

使用 [Azure 搜索索引器](search-indexer-overview.md)可能会影响计费，具体取决于服务的位置。 如果在数据所在的同一区域中创建 Azure 搜索服务，则可以完全消除数据流出费用。 下面是一些信息从[带宽定价页](https://azure.microsoft.com/pricing/details/bandwidth/):

+ Microsoft 不会收取任何入站数据传输到 Azure 上的任何服务的任何出站数据; 二是从 Azure 搜索。

+ 在多业务解决方案中，是免费的跨网络传输时的所有服务都都在同一区域中的数据。

如果服务在不同的区域中，则会针对出站数据收费。 这些费用实际上不是 Azure 搜索帐单的一部分。 此处之所以提到这些费用，是因为如果你使用数据或 AI 扩充索引器从不同的区域提取数据，将会在总体帐单中看到这些费用。

### <a name="ai-enriched-indexing-with-cognitive-services"></a>使用认知服务的 AI 扩充索引

对于[使用认知服务的 AI 索引](cognitive-search-concept-intro.md)，应该计划在 S0 定价层上的 Azure 搜索所在的同一区域中附加一个可计费的 认知服务资源，用于即用即付处理。 附加认知服务不会产生固定的费用。 只需支付所需的处理费。

文档破解期间的图像提取属于 Azure 搜索费用。 该费用根据从文档中提取的图像数计收。 文本提取目前是免费的。

其他扩充功能（例如自然语言处理）基于[内置的认知技能](cognitive-search-predefined-skills.md)，根据认知服务资源计费。 这些功能的费率与直接使用认知服务执行任务的费率相同。 有关详细信息，请参阅[附加包含技能集的认知服务资源](cognitive-search-attach-cognitive-services.md)。

<a name="search-units"></a>

#### <a name="billing-for-image-extraction-in-cognitive-search"></a>认知搜索中图像提取的计费

如果从认知搜索索引管道中的文件提取图像，则 Azure 搜索帐单会收取该操作的费用。 在[索引器配置](https://docs.microsoft.com/rest/api/searchservice/create-indexer#indexer-parameters)中，**imageAction** 是触发图像提取的参数。 如果 **imageAction** 设置为“none”（默认值），则不收取图像提取费用。

定价随时可能变化。 Azure 搜索的[定价详细信息](https://azure.microsoft.com/pricing/details/search/)页上阐述了定价。

#### <a name="billing-for-built-in-skills-in-cognitive-search"></a>认知搜索中内置技能的计费

设置扩充管道时，该管道中使用的任何[内置技能](cognitive-search-predefined-skills.md)基于机器学习模型。 这些模型由认知服务提供。 如果在索引期间使用这些模型，则费率与直接请求资源的费率相同。

例如，假设某个管道使用用于处理已扫描的 JPEG 图像文件的光学字符识别 (OCR)，并且生成的文本将推送到 Azure 搜索索引，以进行自由形式的搜索查询。 索引管道将包含一个带有 [OCR 技能](cognitive-search-skill-ocr.md)的索引器，而该技能将[附加到认知服务资源](cognitive-search-attach-cognitive-services.md)。 运行该索引器时，认知资源帐单上会显示 OCR 执行费用。

## <a name="tips-for-reducing-costs"></a>有关降低成本的提示

无法通过关闭服务来减少费用。 专用资源始终运行，是在服务的生存期内专门分配给你使用的。 降低你的帐单的唯一方法是减少到仍提供了可接受的性能级别的副本和分区并[SLA 的遵从性](https://azure.microsoft.com/support/legal/sla/search/v1_0/)。

降低费用的唯一方法是选择每小时费率更低的层。 S1 的每小时费率低于 S2 或 S3 的费率。 假设你预配了一个面向低端负载预测的服务。若要扩充该服务，可以创建另一个具有较大层的服务，在该服务上重建索引，然后删除第一个服务。

如果针对本地服务器做了容量规划，则会知道，常见的做法是“超量购买”，以便可以应对预测的增长。 使用云服务时，可以采用更激进的方式来追求成本节省，因为你并不会受限于购买特定的产品。 如果当前服务能力不足，始终可以切换到更高层的服务。

### <a name="capacity"></a>容量

在 Azure 搜索中，容量的结构包括副本和分区   。

+ 副本是搜索服务的实例。 每个副本托管索引的一个负载均衡副本。 例如，包含 6 个副本的服务具有加载到服务中的每个索引的 6 个副本。

+ 分区存储索引，并自动拆分可搜索的数据。 两个分区可将索引拆分成两半，三个分区可将索引拆分为三个部分，依次类推。 在容量方面，分区大小是各层级的主要区别特征  。

> [!NOTE]
> 所有“标准”和“存储优化”层都支持[副本和分区的灵活组合](search-capacity-planning.md#chart)，因此你可以通过改变平衡方式来[优化系统以提高速度或存储](search-performance-optimization.md)。 “基本”层最多提供三个副本来实现高可用性，但只有一个分区。 “免费”层不提供专用资源：计算资源由多个订阅者共享。

### <a name="more-about-service-limits"></a>有关服务限制的详细信息

服务托管索引和索引器等资源。 每个层对可以创建的资源数量施加[服务限制](search-limits-quotas-capacity.md)。 因此，索引数量（以及其他对象）的上限是各层级的第二个区别特征。 在门户中查看每个选项时，请注意索引数量的限制。 其他资源（如索引器、数据源和技能集）受索引限制的约束。

## <a name="consumption-patterns"></a>消费模式

大多数客户从“免费”服务开始，并无限期保留，然后选择一个“标准”或“存储优化”层用于重大开发或生产工作负载。

![Azure 搜索定价层](./media/search-sku-tier/tiers.png "Azure 搜索定价层")

在低端和高端配置中，“基本”和“S3 HD”层适用于重要但非典型的消耗模式。 “基本”层适用于小型生产工作负荷。 它提供 SLA、专用资源和高可用性，但它提供的存储最适中，总量不超过 2 GB。 此层专为持续使用可用容量的客户设计。 在高端配置中，“S3 HD”层适用于 ISV、合作伙伴、[多租户解决方案](search-modeling-multitenant-saas-applications.md)或要求大量小型索引的任何配置的典型工作负荷。 如果“基本”或“S3 HD”是合适的层，客户可以明确地认识到这一点。 如需确认，可以在 [StackOverflow](https://stackoverflow.com/questions/tagged/azure-search) 上发贴或[联系 Azure 支持人员](https://azure.microsoft.com/support/options/)，以获取指导。

更常用的标准层 S1 到 S3 所提供的容量逐级提升。 分区大小存在拐点，索引、索引器和定理资源的数量存在限制：

|  | S1 | S2 | S3 |  |  |  |  |
|--|----|----|----|--|--|--|--|
| 分区大小|  25 GB | 100 GB | 200 GB |  |  |  |  |
| 索引和索引器限制| 50 | 200 | 200 |  |  |  |  |

需要专用资源和多个分区的客户通常会选择 S1。 S1 提供 25 GB 的分区（最多 12 个），如果使用最大的分区数而不是副本数据，则 S1 的每服务限制为 300 GB。 （有关更平衡的分配，请参阅[分配分区和副本](search-capacity-planning.md#chart)。）

门户和定价页将重点放在分区大小和存储上，但对于每个层级，所有计算能力（磁盘容量、速度、CPU）一般随着价格呈线性增长。 S2 副本快于 S1，S3 快于 S2。 “S3”层以非常快的 I/O 速度打破了线性计算定价模式。 如果你预期 I/O 会成为瓶颈，请注意，S3 提供的 IOPS 要远远高于更低的层。

S3 和 S3 HD 受相同高容量基础结构支持，但采用不同的方式达到其最大限制。 S3 面向更少数量的极大型索引，因此其最大限制与资源密切相关（每个服务 2.4 TB）。 S3 HD 面向较大数目的非常小的索引。 在 1,000 个索引的情况下，S3 HD 达到其索引约束形式的限制。 如果 S3 HD 客户需要超过 1,000 个索引，请联系 Microsoft 支持部门，了解如何继续。

> [!NOTE]
> 以前，文档限制是一个考虑因素，但不再适用于新服务。 有关在哪些情况下仍适用文档限制的信息，请参阅[文档限制](search-limits-quotas-capacity.md#document-limits)。
>

“存储优化”层 L1 和 L2 非常适合用于以下类似的应用程序：大数据要求较高，但最小化查询延迟不是最高优先事务时，最终用户数量相对较小。  

|  | L1 | L2 |  |  |  |  |  |
|--|----|----|--|--|--|--|--|
| 分区大小|  1 TB | 2 TB |  |  |  |  |  |
| 索引和索引器限制| 10 | 10 |  |  |  |  |  |

L2 提供的总存储容量是 L1 的两倍。  请根据索引所需的最大数据量来选择层。 “L1”层的分区以 1 TB 增量纵向扩展，最大可扩展到 12 TB。 L2 分区按每个分区 2 TB 的增量增大，最大可扩展到 24 TB。

## <a name="evaluating-capacity"></a>评估容量

容量与服务运行费用直接相关。 层在两个级别施加限制：存储和资源。 应该同时考虑到此两者，因为首先达到的限制就是实施的限制。

业务需求通常决定了所需的索引数。 例如，你可能需要对一个较大的文档存储库使用全局索引。 或者，你可能需要多个基于区域、应用或商业利基的索引。

若要确定索引大小，必须[生成一个索引](search-create-index-portal.md)。 Azure 搜索中的数据结构主要是[倒排索引](https://en.wikipedia.org/wiki/Inverted_index)结构，它具有与源数据不同的特征。 对于倒排索引，大小和复杂度由内容决定，不一定是输入的数据量。 具有高度冗余的大型数据源可能会导致比包含高度可变内容的较小数据集更小的索引。 因此，很难根据原始数据集的大小来推断索引大小。

> [!NOTE] 
> 即使估算将来的索引和存储需求类似于猜测，但也值得一试。 如果层级容量经证实过低，将需要在更高的层级上预配新服务，然后[重新加载索引](search-howto-reindex.md)。 服务无法从一个 SKU 就地升级到另一个。
>

### <a name="step-1-develop-rough-estimates-by-using-the-free-tier"></a>步骤 1：使用“免费”层进行粗略估算

估算容量的一种方法是从“免费”层开始。 回想一下，“免费”服务最多提供 3 个索引、50 MB 存储和 2 分钟索引时间。 根据这些约束估算预计索引大小可能很有难度。 下面是可以采用的一种方法：

+ [创建免费服务](search-create-service-portal.md)。
+ 准备一个较小的有代表性的数据集（例如，5,000 个文档，10% 的样本大小）。
+ [生成初始索引](search-create-index-portal.md)并记下其在门户中的大小（例如 30 MB）。

如果样本既有代表性，又占整个数据源的 10%，如果所有文档都编入索引，则 30 MB 索引将变为大约 300 MB。 有了此初始数量，即可将此数额增加一倍到两个索引（开发和生产）的预算。 这样可以满足总共 600 MB 的存储要求。 “基本”层可以轻松满足此要求，因此你将从“基本”层开始。

### <a name="step-2-develop-refined-estimates-by-using-a-billable-tier"></a>步骤 2：使用可计费层进行改进的估算

有些客户更喜欢从可以适应更大采样和处理时间的专用资源开始，然后在开发期间对索引数量、大小和查询量进行现实估算。 最初，服务是根据最佳猜测估算结果预配的。 然后，随着开发项目的不断成熟，团队通常知道现有的服务对于预计生产工作负荷而言是容量超量还是不足。

1. [检查每个层级的服务限制](https://docs.microsoft.com/azure/search/search-limits-quotas-capacity#index-limits)以确定较低层级是否可以支持需要的索引数量。 在“基本”、“S1”和“S2”层中，索引数限制分别为 15、50 和 200。 “存储优化”层的索引数限制为 10 个，因为它旨在支持少量的极大型索引。

1. [在可计费层中创建服务](search-create-service-portal.md)：

    + 如果你处于学习曲线的开始位置，请从较低的“基本”或“S1”层着手。
    + 如果你知道会出现较大的索引和查询负载，请从较高的“S2”甚至“S3”层着手。
    + 如果你要为大量的数据编制索引并且查询负载相对较低（例如，使用与内部商务应用程序时），请从“优化存储”层 L1 或 L2 着手。

1. [生成初始索引](search-create-index-portal.md)以确定将源数据转换为索引的方式。 这是估计索引大小的唯一方法。

1. 在门户中[监视存储、服务限制、查询量和延迟](search-monitor-usage.md)。 门户会显示每秒查询数、限制的查询数和搜索延迟。 所有这些值可帮助你确定是否选择了合适的层。 此外可以通过启用[搜索流量分析](search-traffic-analytics.md)，要配置对点击率分析等值的深度监视。

索引数量和大小对于分析而言同等重要。 这是因为，需要通过充分利用存储（分区）或通过最大化对资源（索引、索引器等）的限制来达到最大限制（以先发生者为准）。 门户可帮助你跟踪两者，并在“概述”页面上并排显示当前使用情况和最大限制。

> [!NOTE]
> 如果文档包含无关数据，存储要求可能会过高。 理想情况下，文档仅包含搜索体验所需的数据。 二进制数据不可搜索，因此应单独存储（也许可以存储在 Azure 表或 Blob 存储中）。 然后在索引中添加一个字段，用于保存对外部数据的 URL 引用。 单个文档的最大大小是 16 MB（如果在一次请求中批量上传了多个文档，则小于 16 MB）。 有关详细信息，请参阅 [Azure 搜索中的服务限制](search-limits-quotas-capacity.md)。
>

**查询量注意事项**

每秒查询数 (QPS) 在性能优化期间是一个重要的指标，但如果你预期查询量一开始就很高，则通常只需考虑到层。

“标准”层可以提供平衡的副本数和分区数。 可以添加副本来实现负载均衡，或添加分区进行并行处理，以此增大查询周转时间。 然后，可以在预配服务后优化性能。

如果你预期持续查询量一开始就很高，应考虑更高的由更强大硬件支持的“标准”层。 如果不会这些这种查询量，可以使分区和副本脱机，甚至切换到更低层的服务。 有关如何计算查询吞吐量的详细信息，请参阅 [Azure 搜索性能和优化](search-performance-optimization.md)。

“存储优化”层可用于大数据工作负荷，当查询延迟要求不太重要时，可以支持更大的总体可用索引存储。 仍应使用更多的副本进行负载均衡，并使用更多的分区进行并行处理。 然后，可以在预配服务后优化性能。

**服务级别协议**

未提供免费层和预览功能[服务级别协议 (Sla)](https://azure.microsoft.com/support/legal/sla/search/v1_0/)。 对于所有可计费的层，SLA 将在用户为服务提供足够冗余时生效。 您需要的查询 （读取） Sla 有两个或多个副本。 需要具有三个或多个副本用于查询和索引 （读-写） Sla。 分区数不会影响服务级别协议。

## <a name="tips-for-tier-evaluation"></a>层级评估提示

+ 了解如何生成高效的索引，并了解哪些刷新方法的影响最小。 使用[搜索流量分析](search-traffic-analytics.md)获取有关查询活动的见解。

+ 允许围绕查询生成指标，并围绕使用模式收集数据（在营业期间执行查询，在非高峰期执行索引编制）。 使用此数据做出明智的服务预配决策。 尽管这种做法不是在每小时或每日都可行，但可以动态调整分区和资源，以应对查询量的计划内变化。 此外，还可以应对计划外的但持续性的变化，前提是变化程度持续足够长的时间，以致有必要采取措施。

+ 请记住，预配不足的唯一缺点是，如果实际要求超出预测，则可能必须关闭某项服务。 为避免服务中断，可以在更高层级的相同订阅中创建新服务，并将其并行运行，直到所有应用和请求都指向新的终结点。

## <a name="next-steps"></a>后续步骤

从“免费”层开始，使用数据子集生成初始索引以了解其特征。 Azure 搜索中的数据结构是一种倒排索引结构。 倒排索引的大小和复杂性由内容决定。 请记住，高度冗余的内容往往会导致比高度不规则的内容更小的索引。 因此，确定索引存储要求的是它的内容特征而不是数据集的大小。

初始估算索引大小后，根据本文中所述的某个层[预配可计费的服务](search-create-service-portal.md)：“基本”、“标准”或“存储优化”。 放宽对数据大小的任何人为约束，并[重建索引](search-howto-reindex.md)以包含可搜索的所有数据。

根据需要[分配分区和副本](search-capacity-planning.md)以获取所需性能和规模。

如果性能和容量都合适，那么你已完成操作。 否则，请在与你的需求更接近的不同层级上重新创建搜索服务。

> [!NOTE]
> 如果有疑问，请将发布到[堆栈溢出](https://stackoverflow.com/questions/tagged/azure-search)或[联系 Azure 支持人员](https://azure.microsoft.com/support/options/)。
