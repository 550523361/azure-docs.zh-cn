---
title: "StorSimple 故障转移和灾难恢复 | Microsoft 文档"
description: "了解如何将 StorSimple 设备故障转移到其本身、另一个物理设备或虚拟设备。"
services: storsimple
documentationcenter: 
author: alkohli
manager: carmonm
editor: 
ms.assetid: 5751598e-49c8-42b3-8121-fea5857a7d83
ms.service: storsimple
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/16/2016
ms.author: alkohli
ms.translationtype: Human Translation
ms.sourcegitcommit: 2ea002938d69ad34aff421fa0eb753e449724a8f
ms.openlocfilehash: bf92ffdb16b86c4033cc96ae2abb060d90f9505e
ms.contentlocale: zh-cn
ms.lasthandoff: 11/17/2016

---
# <a name="failover-and-disaster-recovery-for-your-storsimple-device"></a>StorSimple 设备的故障转移和灾难恢复
## <a name="overview"></a>概述
本教程介绍发生灾难时故障转移 StorSimple 设备所要执行的步骤。 使用故障转移可将数据中心的源设备中的数据迁移到位于相同或不同地理位置的另一个物理设备甚至虚拟设备。 

灾难恢复 (DR) 通过设备故障转移功能进行协调，从“设备”页启动。 此页以表格形式列出与 StorSimple Manager 服务连接的所有 StorSimple 设备。 其中显示了每个设备的友好名称、状态、预配容量和最大容量、类型以及型号。

![“设备”页](./media/storsimple-device-failover-disaster-recovery/IC740972.png)

本教程中的指导适用于跨所有软件版本的 StorSimple 物理设备和虚拟设备。

## <a name="disaster-recovery-dr-and-device-failover"></a>灾难恢复 (DR) 与设备故障转移
在灾难恢复 (DR) 方案中，主设备将停止工作。 在此情况下，可以使用主设备作为*源*，指定另一个设备作为*目标*，将与出现故障的设备关联的云数据移到另一个设备。 可以选择将一个或多个卷容器迁移到目标设备。 此过程称为*故障转移*。 

在故障转移期间，源设备中的卷容器将改变所有权并被传输到目标设备。 在卷容器改变所有权后，系统会将这些容器从源设备中删除。 完成删除后，目标设备可以故障回复。

在灾难恢复之后，通常使用最新的备份将数据还原到目标设备。 但是，如果同一个卷存在多个备份策略，则选择卷数最多的备份策略，该策略的最新备份可用于还原目标设备上的数据。

例如，如果有两个备份策略（一个是默认策略，另一个是自定义策略）：*defaultPol* 和 *customPol*，其详细信息如下：

* *defaultPol*：每天 10:30 PM 开始运行一个卷 (*vol1*)。
* *customPol*：每天 10:00 PM 开始运行四个卷（*vol1*、*vol2*、*vol3*、*vol4*）。

在此情况下，将使用 *customPol*，因为它包含更多的卷，而我们为崩溃一致性指定了优先级。 此策略中的最新备份将用于还原数据。

## <a name="considerations-for-device-failover"></a>设备故障转移注意事项
发生灾难时，可以选择将 StorSimple 设备故障转移到：

* 物理设备 
* 其本身
* 虚拟设备

对于任何设备故障转移，请记住以下事项：

* 灾难恢复的先决条件是卷容器中的所有卷都已脱机，并且卷容器有关联的云快照。 
* 灾难恢复的可用目标设备是有足够空间容纳所选卷容器的设备。 
* 虽然已连接到你的服务，但没有足够空间的设备不能用作目标设备。
* 灾难恢复之后，在一段有限的时间内，数据访问性能可能会受到明显影响，因为设备需要从云访问数据，然后将数据存储在本地。

#### <a name="device-failover-across-software-versions"></a>跨软件版本的设备故障转移
部署中的 StorSimple Manager 服务可能有多个运行不同软件版本的物理设备和虚拟设备。 根据具体的软件版本，设备上的卷类型也可能不同。 例如，运行 Update 2 或更高版本的设备有本地固定卷和分层卷（以及包含为分层子集的存档）。 另一方面，运行 Update 2 以前版本的设备可能有分层卷和存档卷。 

可以使用下表来确定是否可以在灾难恢复期间故障转移到运行不同软件版本的另一个设备，以及卷类型的行为。

| 故障转移来源 | 允许物理设备 | 允许虚拟设备 |
| --- | --- | --- |
| Update 2 到 Update 1 以前的版本（版本 0.1、0.2、0.3） |否 |否 |
| Update 2 到 Update 1（1、1.1、1.2） |是 <br></br>如果使用本地固定卷或分层卷，或者混用两者，卷始终作为分层卷故障转移。 |是<br></br>如果使用本地固定卷，这些卷作为分层卷故障转移。 |
| Update 2 到 Update 2 或更高版本 |是<br></br>如果使用本地固定卷或分层卷，或者混用两者，卷始终作为起始卷类型故障转移；分层卷作为分层卷故障转移，本地固定卷作为本地固定卷故障转移。 |是<br></br>如果使用本地固定卷，这些卷作为分层卷故障转移。 |

#### <a name="partial-failover-across-software-versions"></a>跨软件版本的部分故障转移
如果要将运行 Update 1 以前版本的 StorSimple 源设备部分故障转移到运行 Update 1 或更高版本的目标，请遵循以下指导原则。 

| 部分故障转移来源 | 允许物理设备 | 允许虚拟设备 |
| --- | --- | --- |
| Update 1 以前的版本（版本 0.1、0.2、0.3）到 Update 1 或更高版本 |是，请参阅以下最佳实践提示。 |是，请参阅以下最佳实践提示。 |

> [!TIP]
> Update 1 和更高版本中的云元数据与数据格式会发生变化。 因此，不建议从 Update 1 以前的版本部分故障转移到 Update 1 或更高版本。 如果需要执行部分故障转移，建议先在两个设备（源和目标）上应用 Update 1 或更高版本，然后继续故障转移。 
> 
> 

## <a name="fail-over-to-another-physical-device"></a>故障转移到另一个物理设备
执行以下步骤可将设备还原到目标物理设备。

1. 验证要故障转移的卷容器是否有关联的云快照。
2. 在“设备”页上，单击“卷容器”选项卡。
3. 选择要故障转移到另一个设备的卷容器。 单击该卷容器显示其中的卷列表。 选择一个卷，然后单击“脱机”使该卷脱机。 针对卷容器中的所有卷重复此过程。
4. 针对要故障转移到另一个设备的所有卷容器重复上一步骤。
5. 在“设备”页中，单击“故障转移”。
6. 在打开的向导中的“选择要故障转移的卷容器”下面：
   
   1. 在卷容器列表中，选择要故障转移的卷容器。
      **列表中只显示与云快照和脱机卷关联的卷容器。**
   2. 在“为所选容器中的卷选择目标设备”中，从可用设备的下拉列表中选择目标设备。 下拉列表中只显示具有可用容量的设备。
   3. 最后，查看“确认故障转移”下面的所有故障转移设置。 单击勾选图标![勾选图标](./media/storsimple-device-failover-disaster-recovery/IC740895.png)。
7. 随后将创建一个可通过“作业”页监视的故障转移作业。 如果故障转移的卷容器包含本地卷，则会显示容器中每个本地卷（分层卷除外）的还原作业。 这些还原作业可能需要较长时间才能完成。 故障转移作业可能会更快完成。 请注意，只有完成还原作业之后，这些卷才获得本地保证。 完成故障转移后，转到“设备”页。                                            
   
   1. 为故障转移过程选择用作目标设备的设备。
   2. 转到“卷容器”页。 此时应列出所有卷容器以及旧设备中的卷。

## <a name="failover-using-a-single-device"></a>使用单个设备故障转移
如果只有一个设备且需要执行故障转移，请执行以下步骤。

1. 为设备中的所有卷创建云快照。
2. 将设备重置为出厂默认设置。 请遵循 [how to reset a StorSimple device to factory default settings](storsimple-manage-device-controller.md#reset-the-device-to-factory-default-settings)（如何将 StorSimple 设备重置为出厂默认设置）中的详细说明。
3. 配置设备，然后再次将它注册到 StorSimple Manager 服务。
4. 在“设备”页上，旧设备应显示为“脱机”。 新注册的设备应显示为“联机”。
5. 对于新设备，请先为设备完成最起码的配置。 
   
   > [!IMPORTANT]
   > **如果不先完成最起码的配置，灾难恢复会因当前实现中的 bug 而失败。将来的版本将修复此行为。**
   > 
   > 
6. 选择旧设备（脱机状态），然后单击“故障转移”。 在出现的向导中，故障转移此设备，并将新注册的设备指定为目标设备。 有关详细说明，请参阅[故障转移到另一个物理设备](#fail-over-to-another-physical-device)。
7. 可以通过“作业”页监视创建的设备还原作业。
8. 成功完成作业后，请访问新设备，并导航到“卷容器”页。 旧设备中的所有卷容器现在应已迁移到新设备。

## <a name="fail-over-to-a-storsimple-virtual-device"></a>故障转移到 StorSimple 虚拟设备
运行此过程之前，必须事先创建并配置一个 StorSimple 虚拟设备。 如果运行的是 Update 2，请考虑针对灾难恢复使用具有 64 TB 容量且使用高级存储的 8020 虚拟设备。 

执行以下步骤可将设备还原到目标 StorSimple 虚拟设备。

1. 验证要故障转移的卷容器是否有关联的云快照。
2. 在“设备”页上，单击“卷容器”选项卡。
3. 选择要故障转移到另一个设备的卷容器。 单击该卷容器显示其中的卷列表。 选择一个卷，然后单击“脱机”使该卷脱机。 针对卷容器中的所有卷重复此过程。
4. 针对要故障转移到另一个设备的所有卷容器重复上一步骤。
5. 在“设备”页中，单击“故障转移”。
6. 在打开的向导中的“选择要故障转移的卷容器”下面完成以下操作：
   
    a. 在卷容器列表中，选择要故障转移的卷容器。
   
    **列表中只显示与云快照和脱机卷关联的卷容器。**
   
    b. 在“为所选容器中的卷选择目标设备”中，从可用设备的下拉列表中选择 StorSimple 虚拟设备。 **下拉列表中只显示具有足够容量的设备。**  
7. 最后，查看“确认故障转移”下面的所有故障转移设置。 单击勾选图标![勾选图标](./media/storsimple-device-failover-disaster-recovery/IC740895.png)。
8. 完成故障转移后，转到“设备”页。
   
    a. 为故障转移过程选择用作目标设备的 StorSimple 虚拟设备。
   
    b. 转到“卷容器”页。 此时应列出所有卷容器以及旧设备中的卷。

![可用视频](./media/storsimple-device-failover-disaster-recovery/Video_icon.png) **可用视频**

若要观看演示如何将有故障物理设备还原到云中虚拟设备的视频，请单击[此处](https://azure.microsoft.com/documentation/videos/storsimple-and-disaster-recovery/)。

## <a name="failback"></a>故障回复
对于 Update 3 和更高版本，StorSimple 还支持故障回复。 完成故障转移后，将执行以下操作：

* 从源设备中清除已故障转移的卷容器。
* 在源设备上针对每个卷容器启动一个后台作业（故障转移）。 如果在作业进行时尝试故障回复，将会收到一条通知，告知这样做会造成何种影响。 需要等到该作业完成后才能开始故障回复。 
  
    完成卷容器删除的时间取决于多种因素，例如数据量、数据期限、备份数目以及操作可用的网络带宽。 如果你正在规划测试故障转移/故障回复，我们建议对数据较少（Gb 量级）的卷容器进行测试。 在大多数情况下，可以在故障转移完成后的 24 小时内开始故障回复。 

## <a name="frequently-asked-questions"></a>常见问题
问： **如果灾难恢复失败或部分成功，会发生什么情况？**

答： 如果灾难恢复失败，我们建议再试一次。 从第二次开始，灾难恢复大致知道哪些工作已完成，以及首次灾难恢复过程停顿在哪个步骤。 灾难恢复过程将从此步骤继续。 

问： **正在进行设备故障转移时，是否可以删除设备？**

答： 灾难恢复正在进行时无法删除设备。 只能在灾难恢复完成后删除设备。

问：    **源设备上的垃圾收集何时开始，以便能够删除源设备上的本地数据？**

答： 只有在完全清理设备之后，才在源设备上启用垃圾收集。 清理过程包括清理已从源设备故障转移的对象，例如卷、备份对象（不是数据）、卷容器和策略。

问： **如果与源设备中卷容器关联的删除作业失败，会发生什么情况？**

答：  如果删除作业失败，需要手动触发卷容器删除。 请在“设备”页上选择源设备，然后单击“卷容器”。 选择已故障转移的卷容器，然后在页面底部单击“删除”。 删除源设备上所有已故障转移的卷容器后，便可以开始故障回复。

## <a name="business-continuity-disaster-recovery-bcdr"></a>业务连续性灾难恢复 (BCDR)
当整个 Azure 数据中心停止运行时，将会启动业务连续性灾难恢复 (BCDR) 方案。 这可能会影响 StorSimple Manager 服务和关联的 StorSimple 设备。

如果 StorSimple 设备在发生灾难的前一刻才注册，这些 StorSimple 设备可能需要出厂重置。 发生灾难后，StorSimple 设备将显示为脱机。 必须从门户中删除 StorSimple 设备，进行出厂重置，然后重新注册。

## <a name="next-steps"></a>后续步骤
* 执行故障转移后，可能需要[停用或删除 StorSimple 设备](storsimple-deactivate-and-delete-device.md)。
* 有关如何使用 StorSimple Manager 服务的信息，请转到[使用 StorSimple Manager 服务管理 StorSimple 设备](storsimple-manager-service-administration.md)。


