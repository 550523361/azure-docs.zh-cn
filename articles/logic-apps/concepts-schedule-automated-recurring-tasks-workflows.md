---
title: 在 Azure 逻辑应用中计划定期任务和工作流
description: 有关使用 Azure 逻辑应用计划定期自动化任务、进程和工作流的概述
services: logic-apps
ms.suite: integration
ms.reviewer: deli, klam, logicappspm
ms.topic: conceptual
ms.date: 05/25/2019
ms.openlocfilehash: 0f6ec158cf6ab855191e6796be3abec7d37439a0
ms.sourcegitcommit: f4f626d6e92174086c530ed9bf3ccbe058639081
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/25/2019
ms.locfileid: "75456662"
---
# <a name="schedule-and-run-recurring-automated-tasks-processes-and-workflows-with-azure-logic-apps"></a>通过 Azure 逻辑应用计划和运行定期自动化任务、进程和工作流

逻辑应用可帮助你按计划创建和运行自动重复执行的任务和流程。 通过创建逻辑应用工作流，该工作流以内置定期触发器或滑动窗口触发器（即 "计划类型" 触发器）开头，你可以在以后的某个时间或按重复间隔运行任务。 可以调用 Azure 内部和外部的服务，例如 HTTP 或 HTTPS 终结点、将消息发送到 azure 服务（例如 Azure 存储和 Azure 服务总线），或将文件上传到文件共享。 利用定期触发器，还可以设置复杂的计划和高级重复执行的任务。 若要了解有关内置计划触发器和操作的详细信息，请参阅[计划触发器](#schedule-triggers)和[计划操作](#schedule-actions)。 

> [!TIP]
> 你可以计划和运行重复工作负载，而无需为每个计划的作业创建单独的逻辑应用，并在[每个区域和订阅的工作流限制](../logic-apps/logic-apps-limits-and-config.md#definition-limits)下运行。 相反，你可以使用 Azure 快速入门模板创建的逻辑应用模式[：逻辑应用作业计划程序](https://github.com/Azure/azure-quickstart-templates/tree/master/301-logicapps-jobscheduler/)。
>
> 逻辑应用作业计划程序模板创建调用 TimerJob 逻辑应用的 CreateTimerJob 逻辑应用。 然后，可以通过发出 HTTP 请求并为请求传递计划作为输入，将 CreateTimerJob 逻辑应用作为 API 进行调用。 每次调用 CreateTimerJob 逻辑应用时，都将调用 TimerJob 逻辑应用，该应用会创建一个新的 TimerJob 实例，该实例根据指定的计划持续运行，或在达到指定的限制之前运行。 这样，就可以根据需要运行任意多个 TimerJob 实例，而无需担心工作流限制，因为实例不是单独的逻辑应用工作流定义或资源。

此列表显示了可通过计划内置触发器运行的一些示例任务：

* 获取内部数据，如每天运行 SQL 存储过程。

* 获取外部数据，例如每隔15分钟从 NOAA 提取天气报告。

* 发送报表数据，如在过去一周内的所有订单的摘要电子邮件。

* 处理数据，例如在非高峰时间，在每个工作日压缩当前的已上传图像。

* 清除数据，如删除三个月之前的所有推文。

* 在未来9个月每天凌晨1:00 将数据存档（例如，将发票推送到备份服务）。

你还可以使用计划内置操作来暂停工作流，然后再运行下一个操作，例如：

* 等到工作日通过电子邮件发送状态更新。

* 在恢复和检索结果前，延迟工作流直到 HTTP 调用有时间完成。

本文介绍计划内置触发器和操作的功能。

<a name="schedule-triggers"></a>

## <a name="schedule-triggers"></a>计划触发器

你可以使用 "定期触发器" 或 "滑动窗口" 触发器（不与任何特定服务或系统相关联）启动逻辑应用工作流，例如 Office 365 Outlook 或 SQL Server。 这些触发器根据指定的重复周期启动并运行工作流，你可以在其中选择时间间隔和频率，例如两个触发器的秒数、分钟数和小时数，或者用于定期触发器的天数、周数或月数。 还可以设置开始日期和时间以及时区。 每当触发器触发时，逻辑应用就会为逻辑应用创建并运行一个新的工作流实例。

下面是这些触发器之间的差异：

* **定期**：按照指定的计划定期运行工作流。 如果错过了重复，则重复执行触发器不会处理丢失的重复，但会在下一个计划间隔后重启。 你可以指定开始日期和时间以及时区。 如果选择 "Day"，则可以指定一天中的小时和分钟的时间，例如，每日的2:30。 如果选择 "周"，则还可以选择周中的日期，如星期三和星期六。 有关详细信息，请参阅[创建、计划和运行定期触发器的重复执行任务和工作流](../connectors/connectors-native-recurrence.md)。

* **滑动窗口**：按固定的时间间隔运行工作流，以连续块区处理数据。 如果错过了重复出现，则滑动窗口触发器返回并处理丢失的重复。 你可以指定开始日期和时间、时区和持续时间，以延迟工作流中的每个重复。 此触发器没有用于指定日、周、月、一天中的小时、一小时的分钟数和一周中各天的选项。 有关详细信息，请参阅[通过滑动窗口触发器创建、计划和运行重复执行的任务和工作流](../connectors/connectors-native-sliding-window.md)。

<a name="schedule-actions"></a>

## <a name="schedule-actions"></a>计划操作

在逻辑应用工作流中执行任何操作后，你可以使用延迟和延迟到操作，使工作流等待下一个操作运行。

* **延迟**：等待为指定的时间单位（例如秒、分钟、小时、天、周或月）运行下一个操作。 有关详细信息，请参阅[延迟工作流中的下一步操作](../connectors/connectors-native-delay.md)。

* **延迟**至：等到指定的日期和时间运行下一个操作。 有关详细信息，请参阅[延迟工作流中的下一步操作](../connectors/connectors-native-delay.md)。

## <a name="patterns-for-start-date-and-time"></a>开始日期和时间的模式

<a name="start-time"></a>

下面是一些模式，演示如何在开始日期和时间控制重复周期，以及逻辑应用服务如何运行这些重复项：

| 开始时间 | 不按计划循环 | 定期计划（仅限定期触发器） |
|------------|-----------------------------|----------------------------------------------------|
| {无} | 即时运行第一个工作负荷。 <p>基于上次运行时间运行将来的工作负荷。 | 即时运行第一个工作负荷。 <p>基于指定的计划运行将来的工作负荷。 |
| 开始时间在过去 | **定期**触发器：基于指定的开始时间计算运行时间，并放弃过去的运行时间。 在下一个将来运行时间运行第一个工作负荷。 <p>基于上次运行时间的计算结果运行将来的工作负荷。 <p><p>**滑动窗口**触发器：根据指定的开始时间计算运行时间，并遵循过去的运行时间。 <p>根据指定的开始时间计算，运行未来的工作负荷。 <p><p>有关详细说明，请参阅此表格后面的示例。 | 基于从开始时间计算的计划，在不早于开始时间的时间运行第一个工作负荷。 <p>基于指定的计划运行将来的工作负荷。 <p>**注意：** 如果为计划指定了重复周期，但没有为计划指定小时或分钟，则会分别使用首次运行时间的小时或分钟计算将来的运行时间。 |
| 开始时间在当前或将来 | 在指定的开始时间运行第一个工作负荷。 <p>基于上次运行时间的计算结果运行将来的工作负荷。 | 基于从开始时间计算的计划，在不早于开始时间的时间运行第一个工作负荷。 <p>基于指定的计划运行将来的工作负荷。 <p>**注意：** 如果为计划指定了重复周期，但没有为计划指定小时或分钟，则会分别使用首次运行时间的小时或分钟计算将来的运行时间。 |
||||

> [!IMPORTANT]
> 当重复执行不指定高级计划选项时，将来的重复将基于上次运行时间。
> 这些重复周期的开始时间可能会由于诸如存储调用期间的延迟等因素而发生偏差。 若要确保逻辑应用不会错过循环，尤其是频率为天或更长时，请使用以下选项之一：
> 
> * 提供定期的开始时间。
> 
> * 使用 "**此时** **" 和 "时间"** 属性指定运行定期的时间和时间。
> 
> * 使用[滑动窗口触发器](../connectors/connectors-native-sliding-window.md)，而不是重复触发器。

*过去开始时间和重复周期的示例，但无计划*

假设当前日期和时间为2017年9月8日，1:00 PM。 指定开始日期和时间，该日期和时间为 2:00 2017 年9月7日（过去），每两天运行一次。

| 开始时间 | 当前时间 | 定期 | 计划 |
|------------|--------------|------------|----------|
| 2017-09-**07**T14:00:00Z <br>（2017-09-**07** ，晚上2:00） | 2017-09-**08**T13:00:00Z <br>（2017-09-**08** 1:00： 8 PM） | 每两天 | {无} |
|||||

对于定期触发器，逻辑应用引擎将根据开始时间计算运行时间，放弃过去的运行时间，使用下一个将来的开始时间进行首次运行，并基于上次运行时间计算将来的运行时间。

下面是此重复周期的大致形式：

| 开始时间 | 首次运行时间 | 将来的运行时间 |
|------------|----------------|------------------|
| 2017-09-**07** 的 2:00 PM | 2017-09-**09** 的 2:00 PM | 2017-09-**11** 的 2:00 PM </br>2017-09-**13** 的 2:00 PM </br>2017-09-**15** 的 2:00 PM </br>依此类推... |
||||

因此，无论在过去多久指定开始时间（例如，2017-09-**05** ，2:00 pm，或 2:00 pm 的 2017-09-**01** ），首次运行都将始终使用下一个将来的开始时间。

对于滑动窗口触发器，逻辑应用引擎会根据开始时间计算运行时间，并使用首次运行的开始时间，并根据开始时间计算将来的运行时间。

下面是此重复周期的大致形式：

| 开始时间 | 首次运行时间 | 将来的运行时间 |
|------------|----------------|------------------|
| 2017-09-**07** 的 2:00 PM | 2017-09-**07** 的 2:00 PM | 2017-09-**09** 的 2:00 PM </br>2017-09-**11** 的 2:00 PM </br>2017-09-**13** 的 2:00 PM </br>2017-09-**15** 的 2:00 PM </br>依此类推... |
||||

因此，无论在过去多久指定开始时间（例如，2017-09-**05** ，2:00 pm，或 2:00 pm 的 2017-09-**01** ），首次运行都将始终使用指定的开始时间。

<a name="example-recurrences"></a>

## <a name="example-recurrences"></a>示例重复

下面是可以为支持选项的触发器设置的各种示例重复：

| 触发器 | 定期 | 时间间隔 | 频率 | 开始时间 | 在这些日期 | 在这些小时 | 在这些分钟 | 说明 |
|---------|------------|----------|-----------|------------|---------------|----------------|------------------|------|
| 循环 <br>滑动窗口 | 每隔 15 分钟运行（没有开始日期和时间） | 15 | Minute | {无} | {不可用} | {无} | {无} | 此计划立即启动，然后根据上次运行时间计算将来的重复周期。 |
| 循环 <br>滑动窗口 | 每隔 15 分钟运行（有开始日期和时间） | 15 | Minute | *startDate*T*startTime*Z | {不可用} | {无} | {无} | 此计划不会在指定的开始日期和时间之前启动，将根据上次运行时间计算将来的重复周期。 |
| 循环 <br>滑动窗口 | 每隔一小时整点运行（有开始日期和时间） | 第 | 小时 | *startDate*Thh:00:00Z | {不可用} | {无} | {无} | 此计划不会在指定的开始日期和时间之前启动。 将来的每小时在 "00" 分钟标记下运行，这是从开始时间计算得出的。 <p>如果频率为“周”或“月”，则此计划只会分别在每周的一个星期日期或每月的一个日期运行。 |
| 循环 <br>滑动窗口 | 每天每隔一小时运行（没有开始日期和时间） | 第 | 小时 | {无} | {不可用} | {无} | {无} | 此计划立即启动，并根据上次运行时间计算将来的重复周期。 <p>如果频率为“周”或“月”，则此计划只会分别在每周的一个星期日期或每月的一个日期运行。 |
| 循环 <br>滑动窗口 | 每天每隔一小时运行（有开始日期和时间） | 第 | 小时 | *startDate*T*startTime*Z | {不可用} | {无} | {无} | 此计划不会在指定的开始日期和时间之前启动，将根据上次运行时间计算将来的重复周期。 <p>如果频率为“周”或“月”，则此计划只会分别在每周的一个星期日期或每月的一个日期运行。 |
| 循环 <br>滑动窗口 | 每隔一小时在整点过后的第 15 分钟运行（有开始日期和时间） | 第 | 小时 | *startDate*T00:15:00Z | {不可用} | {无} | {无} | 此计划不会在指定的开始日期和时间之前启动。 将来的重复运行时间为 "15" 分钟标记，它是从开始时间计算的，因此在凌晨00:15、1:15 AM、2:15 AM 等。 |
| 定期 | 每隔一小时在整点过后的第 15 分钟运行（没有开始日期和时间） | 第 | 天 | {无} | {不可用} | 0、1、2、3、4、5、6、7、8、9、10、11、12、13、14、15、16、17、18、19、20、21、22、23 | 15 | 此计划在 00:15 AM、1:15 AM、2:15 AM 等有规律的时间运行。 此外，此计划相当于频率为“小时”且开始时间为“15”分钟。 |
| 定期 | 每隔15分钟运行一次指定的分钟数（无开始日期和时间）。 | 第 | 天 | {无} | {不可用} | 0、1、2、3、4、5、6、7、8、9、10、11、12、13、14、15、16、17、18、19、20、21、22、23 | 0、15、30、45 | 此计划在下一个指定的 15 分钟标记之前不会启动。 |
| 定期 | 每日上午8点运行，*并*保存逻辑应用时的分钟标记 | 第 | 天 | {无} | {不可用} | 8 | {无} | 如果没有开始日期和时间，此计划将根据你保存逻辑应用的时间（PUT 操作）运行。 |
| 定期 | 每日上午8:00 运行（有开始日期和时间） | 第 | 天 | *startDate*T08:00:00Z | {不可用} | {无} | {无} | 此计划不会在指定的开始日期和时间之前启动。 将来每日在凌晨8:00 运行。 | 
| 定期 | 每日上午8:30 运行（无开始日期和时间） | 第 | 天 | {无} | {不可用} | 8 | 30 | 此计划每天上午8:30 运行。 |
| 定期 | 每日上午8:30 到 4:30 PM 运行 | 第 | 天 | {无} | {不可用} | 8, 16 | 30 | |
| 定期 | 每日上午8:30、8:45 AM、4:30 PM 和 4:45 PM 运行 | 第 | 天 | {无} | {不可用} | 8, 16 | 30, 45 | |
| 定期 | 在每个星期六的 5:00 PM 运行（没有开始日期和时间） | 第 | 周 | {无} | “星期六” | 17 | 00 | 此计划在每个星期六的 5:00 PM 运行。 |
| 定期 | 在每个星期六的 5:00 PM 运行（有开始日期和时间） | 第 | 周 | *startDate*T17:00:00Z | “星期六” | {无} | {无} | 此计划不会在指定的开始日期和时间（在本例中为 2017 年 9 月 9 日 5:00 PM）之前启动。 将来的定期计划在每个星期六的 5:00 PM 运行。 |
| 定期 | 每星期二、星期四下午5点运行，*以及*保存逻辑应用时的分钟标记| 第 | 周 | {无} | “星期二”、“星期四” | 17 | {无} | |
| 定期 | 在工作时间每隔一小时运行 | 第 | 周 | {无} | 选择除星期六和星期日以外的所有星期日期。 | 选择所需的日期小时。 | 选择所需的任何小时分钟。 | 例如，如果工作时间为 8:00 AM 到 5:00 PM，则选择“8、9、10、11、12、13、14、15、16、17”作为日期小时。 <p>如果工作时间为 8:30 AM 到 5:30 PM，则选择前面的日期小时加上“30”作为小时分钟。 |
| 定期 | 在周末每隔一个星期日期运行一次 | 第 | 周 | {无} | “星期六”、“星期日” | 选择所需的日期小时。 | 选择适当的任何小时分钟。 | 此计划根据指定的计划在每个星期六和星期日运行。 |
| 定期 | 仅每两周在星期一每隔 15 分钟运行 | 2 | 周 | {无} | “星期一” | 0、1、2、3、4、5、6、7、8、9、10、11、12、13、14、15、16、17、18、19、20、21、22、23 | 0、15、30、45 | 此计划按每个 15 分钟标记每隔两周在星期一运行。 |
| 定期 | 每月运行 | 第 | 月 | *startDate*T*startTime*Z | {不可用} | {不可用} | {不可用} | 此计划不会在指定*的开始日期和时间之前开始*，并在开始日期和时间计算将来的重复周期。 如果未指定开始日期和时间，则此计划使用创建日期和时间。 |
| 定期 | 在每个月每隔一小时运行一天 | 第 | 月 | {参阅备注} | {不可用} | 0、1、2、3、4、5、6、7、8、9、10、11、12、13、14、15、16、17、18、19、20、21、22、23 | {参阅备注} | 如果未指定开始日期和时间，则此计划使用创建日期和时间。 若要控制定期计划的分钟，请指定小时分钟和开始时间，或使用创建时间。 例如，如果开始时间或创建时间为 8:25 AM，则此计划在 8:25 AM、9:25 AM、10:25 AM 等有规律的时间运行。 |
|||||||||

<a name="run-once"></a>

## <a name="run-one-time-only"></a>仅运行一次

如果只想在将来一次运行逻辑应用，则可以使用**计划程序： "运行一次作业**" 模板。 创建新的逻辑应用后，在打开逻辑应用设计器之前，请在 "**模板**" 部分下的 "**类别**" 列表中，选择 "**计划**"，然后选择此模板：

![选择 "计划程序：运行一次作业" 模板](./media/concepts-schedule-automated-recurring-tasks-workflows/choose-run-once-template.png)

或者，如果可以在**收到 HTTP 请求时**使用启动逻辑应用-请求触发器，并将开始时间传递为触发器的参数。 对于第一个操作，请使用**延迟截止时间安排**操作，并提供下次操作开始运行的时间。

## <a name="next-steps"></a>后续步骤

* [通过定期触发器创建、计划和运行重复执行的任务和工作流](../connectors/connectors-native-recurrence.md)
* [通过滑动窗口触发器创建、计划和运行重复执行的任务和工作流](../connectors/connectors-native-sliding-window.md)
* [暂停带有延迟操作的工作流](../connectors/connectors-native-delay.md)
