---
title: 使用市场计量服务计量计费 |Azure 应用商店
description: 本文档是发布 SaaS 提供的具有灵活计费模型的 ISV 指南。
author: dsindona
ms.author: dsindona
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
ms.date: 07/10/2019
ms.openlocfilehash: 8e5a4813301cbab16d1cffabaaa60688f6e826ae
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/28/2020
ms.locfileid: "80281317"
---
# <a name="metered-billing-using-the-marketplace-metering-service"></a>使用市场计量服务计量计费

使用应用商店计量服务，您可以在商业市场程序中创建软件即服务 （SaaS） 产品，这些产品根据非标准单位收费。  在发布此产品/服务之前，您可以定义已处理的帐单维度，如带宽、票证或电子邮件。  然后，客户根据这些维度的使用情况付费，您的系统通过应用商店计量服务 API 通知 Microsoft 在发生计费事件时。  

## <a name="prerequisites-for-metered-billing"></a>计量计费的先决条件

为了使 SaaS 产品使用按流量计费，它必须：

* 满足创建[SaaS 产品/服务](https://docs.microsoft.com/azure/marketplace/partner-center-portal/create-new-saas-offer)中所述[通过 Microsoft 产品/服务销售](https://docs.microsoft.com/azure/marketplace/partner-center-portal/create-new-saas-offer#sell-through-microsoft)的所有要约要求。
* 与[SaaS 履行 API](https://docs.microsoft.com/azure/marketplace/partner-center-portal/pc-saas-fulfillment-api-v2)集成，供客户预配和连接到您的产品/服务。  
* 为**统一费率**定价模型配置，用于向客户收取服务费用。  维度是统一费率定价模型的可选扩展。 
* 与[应用商店计量服务 API](./marketplace-metering-service-apis.md)集成，向 Microsoft 通报计费事件。

>[!Note]
>应用商店计量服务仅适用于统一费率计费模型，不适用于每个用户计费模型。

## <a name="how-metered-billing-fits-in-with-pricing"></a>计量计费如何与定价相符

在定义产品/服务及其定价模型时，了解产品/服务层次结构非常重要。

* 每个 SaaS 产品配置为通过 Microsoft 销售或不销售。  发布产品/服务后，无法更改此设置。
* 每个 SaaS 产品（配置为通过 Microsoft 销售）都可以有一个或多个计划。 用户订阅 SaaS 产品/服务，但是在计划上下文中通过 Microsoft 购买的。
* 每个计划都有一个与之关联的定价模型：**统一费率**或**每个用户**。 要约中的所有计划都必须与相同的定价模型相关联。 例如，不能有一个产品/服务，其中一个计划是统一费率定价模型，另一个是每个用户定价模型。
* 在为统一费率计费模型配置的每个计划中，至少包括一个经常性费用（可以是 $0）：
    * 定期**月**费：当用户购买计划时每月重复预付的固定月费。
    * 经常性**年**费：在用户购买计划时每年重复预付的固定年费。
* 除了经常性费用外，该计划还可以包括用于向客户收取统一费率未包括的使用量的可选维度。   每个维度表示一个计费单元，您的服务将使用[应用商店计量服务 API](./marketplace-metering-service-apis.md)与 Microsoft 通信。

## <a name="sample-offer"></a>样品报价

例如，Contoso 是具有称为 Contoso 通知服务 （CNS） 的 SaaS 服务的发布者。 CNS 允许客户通过电子邮件或文本发送通知。 Contoso 在商业市场计划的合作伙伴中心注册为发布者，以向 Azure 客户发布产品/服务。  有两个与 CNS 相关的计划，概述如下：

* 基本计划
    * 发送 10000 封电子邮件和 1000 条短信，费用为 $0/月
    * 除了 10000 封电子邮件之外，每 100 封电子邮件支付 1 美元
    * 除了 1000 个文本之外，每文本支付 0.02 美元
* 高级计划
    * 发送 50000 封电子邮件和 10000 条短信，费用为 $350/月
    * 除了 50000 封电子邮件之外，每 100 封电子邮件支付 0.5 美元
    * 除了 10000 文本之外，每文本支付 0.01 美元

订阅 CNS 服务的 Azure 客户将能够根据所选计划每月发送包含的文本和电子邮件数量。  Contoso 测量使用量，最多包含数量，而不向 Microsoft 发送任何使用事件。  当客户消耗的数量超过包含的数量时，他们不必更改计划或执行任何不同操作。  Contoso 将使用[应用商店计量服务 API](./marketplace-metering-service-apis.md)测量超出包含数量的范围，并开始向 Microsoft 发出使用事件以进行其他使用。  Microsoft 将向客户收取发布者指定的附加使用量。

## <a name="billing-dimensions"></a>计费维度

计费维度用于向客户传达如何使用该软件计费的方式，以及向 Microsoft 传达使用事件。 它们的定义如下：

* **维度标识符**：在发出使用事件时引用的不可变标识符。
* **维度名称**：与维度关联的显示名称，例如"发送的短信"。
* **计量单位**：计费单位的描述，例如"每条短信"或"每100封电子邮件"。
* **单位价格**：维度一个单位的价格。  
* **包含的每月期限数量**：每月支付定期月费的客户每月包含的维度数量，必须为整数。
* **包括年期限的数量**：每月支付定期年费的客户包括维度的数量，必须是整数。

计费维度在产品/服务的所有计划中共享。  某些属性应用于所有计划的维度，而其他属性特定于计划。

定义维度本身的属性在产品/服务的所有计划中共享。  在发布产品/服务之前，从任何计划的上下文中对这些属性所做的更改将影响所有计划的维度定义。  发布产品/服务后，这些属性将不再可编辑。  这些属性包括：

* 标识符
* “属性”
* 度量单位

维度的其他属性特定于每个计划，并且可以具有不同的计划值。  在发布计划之前，您可以编辑这些值，只有此计划才会受到影响。  发布计划后，这些属性将不再可编辑。  这些属性包括：

* 单位价格
* 每月客户的包含数量 
* 年度客户的包含数量 

维度还有两个特殊概念，"启用"和"无限"：

* **已启用**表示此计划参与此维度。  如果要创建不基于此维度发送使用事件的新计划，则可能需要保留此未选中功能。  此外，在首次发布计划后添加的任何新维度都将在已发布的计划中显示为"未启用"。  禁用的维度不会显示在客户看到的计划的任何维度列表中。
* **无限**，由无穷大符号"*"表示此计划参与此维度，但不针对此维度计量用量。  如果要向客户指示此维度表示的功能包含在计划中，但使用没有限制。  具有无限用法的维度将显示在客户看到的计划的维度列表中，并指示它永远不会为此计划产生费用。

>[!Note] 
>明确支持以下方案： <br> - 您可以将新维度添加到新计划。  不会为已发布的任何计划启用新维度。 <br> - 您可以发布不带任何维度**的平面速率**计划，然后添加新计划并为该计划配置新维度。 对于已发布的计划，将不会启用新维度。

## <a name="constraints"></a>约束

### <a name="trial-behavior"></a>试用行为

使用市场计量服务的计量计费服务与提供免费试用版不兼容。  无法将计划配置为同时使用按流量计费和免费试用版。

### <a name="locking-behavior"></a>锁定行为

由于与应用商店计量服务一起使用的维度表示了解客户如何为服务付费，因此一旦发布维度，维度的所有详细信息将不再可编辑。  在发布之前，必须为计划完全定义维度，这一点很重要。
  
使用维度发布产品/服务后，无法再更改该维度的优惠级别详细信息：

* 标识符
* “属性”
* 度量单位

发布计划后，无法再更改计划级别的详细信息：

* 单位价格
* 每月学期的包含数量
* 年度学期的包含数量
* 是否为计划启用维度

### <a name="upper-limits"></a>上限

可为单个产品/服务配置的最大维度数为 18 个唯一维度。

## <a name="get-support"></a>获取支持

如果您有以下一项，则可以打开支持票证。

* 市场计量服务 API 的技术问题。
* 因右侧的错误或错误而需要升级的问题（例如。 错误的使用事件）。
* 与按流量计费相关的任何其他问题。 

按照以下步骤提交支持票证：

1. 转到[支持页](https://support.microsoft.com/supportforbusiness/productselection?sapId=48734891-ee9a-5d77-bf29-82bf8d8111ff)。 前几个下拉菜单会自动为您填写。 对于市场支持，将产品系列标识为**云和在线服务**，该产品为**市场发布者**。  不要更改预填充的下拉菜单选择。
2. 在"选择产品版本"下，选择**实时产品/服务管理**。
3. 在"选择最能描述问题的类别"下，选择**SaaS 应用**。
4. 在"选择最能描述问题的问题"下，选择**按流量计费**。
5. 通过选择"**下一步**"按钮，您将被定向到"**问题详细信息**"页面，您可以在该页面输入有关您的问题的更多详细信息。

有关更多发布者支持选项[，请参阅合作伙伴中心中对商业市场计划的支持](https://docs.microsoft.com/azure/marketplace/partner-center-portal/support)。

## <a name="next-steps"></a>后续步骤

- 有关详细信息[，请参阅应用商店计量服务 API。](./marketplace-metering-service-apis.md)
