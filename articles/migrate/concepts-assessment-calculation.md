---
title: Azure 迁移服务器评估中的评估
description: 了解 Azure 迁移服务器评估中的评估
ms.topic: conceptual
ms.date: 02/17/2020
ms.openlocfilehash: ae55686f0152d9c2b170ae1b34d7493ed7ac8d94
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/28/2020
ms.locfileid: "80127779"
---
# <a name="assessments-in-azure-migrateserver-assessment"></a>Azure 迁移中的评估：服务器评估

本文在[Azure 迁移：服务器评估](migrate-services-overview.md#azure-migrate-server-assessment-tool)工具中概述了评估。 服务器评估工具可以评估本地 VMware VM、超 VM 和物理服务器，以便迁移到 Azure。

## <a name="whats-an-assessment"></a>什么是评估？

使用"服务器评估"工具进行评估可测量将本地服务器迁移到 Azure 的就绪情况并估计影响。

## <a name="types-of-assessments"></a>评估类型

使用服务器评估创建的评估是数据的时间点快照。 服务器评估提供两种类型的评估。

**评估类型** | **详细信息** | **数据**
--- | --- | ---
**基于性能** | 根据收集的绩效数据提出建议的评估 | VM 大小建议基于 CPU 和内存利用率数据。<br/><br/> 磁盘类型建议（标准 HDD/SSD 或高级管理磁盘）基于 IOPS 和本地磁盘的吞吐量。
**本地** | 不使用性能数据提出建议的评估。 | VM 大小建议基于本地 VM 大小<br/><br> 建议的磁盘类型基于评估的选定存储类型。

## <a name="how-do-i-run-an-assessment"></a>如何运行评估？

运行评估的方法有几种：

- 使用轻量级 Azure 迁移设备收集的服务器元数据评估计算机。 设备发现本地计算机，并将计算机元数据/性能数据发送到 Azure 迁移。
- 使用以逗号分隔值 （CSV） 格式导入的服务器元数据评估计算机。

## <a name="how-do-i-assess-with-the-appliance"></a>如何使用产品进行评估？

如果要部署 Azure 迁移设备以发现本地服务器，请执行以下操作：

1. 将 Azure 和本地环境设置为使用服务器评估。
2. 对于第一次评估，请创建 Azure 项目，并将服务器评估工具添加到其中。
3. 部署轻量级 Azure 迁移设备。 设备不断发现本地计算机，并将计算机元数据和性能数据发送到 Azure 迁移。 设备部署为 VM 或物理计算机。 无需在要评估的计算机上安装任何内容。
4. 设备开始发现机器后，您可以将要评估的计算机收集到组中，并为组运行评估。

您可以按照我们的[VMware、Hyper-V](tutorial-prepare-vmware.md)或[物理服务器](tutorial-prepare-physical.md)教程来试用这些步骤。 [Hyper-V](tutorial-prepare-hyper-v.md)

## <a name="how-do-i-assess-with-imported-data"></a>如何使用导入的数据进行评估？

如果您正在使用 CSV 文件评估服务器，则不需要设备。 相反，您可以执行以下操作：

1. 将 Azure 设置为使用服务器评估。
2. 对于第一次评估，请创建 Azure 项目，并将服务器评估工具添加到其中。
3. 下载 CSV 模板，并将服务器数据添加到其中。
4. 将模板导入服务器评估。
5. 发现随导入一起添加的服务器，然后收集到组中，并为该组运行评估。

## <a name="what-data-does-the-appliance-collect"></a>产品收集哪些数据？

如果使用 Azure 迁移设备进行评估，请了解为[VMware](migrate-appliance.md#collected-data---vmware)和[Hyper-V](migrate-appliance.md#collected-data---hyper-v)收集的元数据和性能数据。

## <a name="how-does-the-appliance-calculate-performance-data"></a>设备如何计算性能数据？

如果使用设备进行发现，则计算设置的性能数据将收集如下：

1. 产品收集实时采样点：

    - **VMware VM**： 设备每 20 秒收集一个实时采样点。
    - **Hyper-V VM**：实时采样点每 30 秒收集一次。
    - **物理服务器**：实时采样点每五分钟收集一次。 
    
2. 产品将采样点（20 秒、30 秒、5 分钟）汇总一次，每 10 分钟创建一个数据点。 要创建单点，设备将从所有示例中选择峰值，然后将其发送到 Azure。
3. 服务器评估存储上个月的所有 10 分钟采样点。
4. 创建评估时，服务器评估会根据*性能历史记录*和*百分位数利用率*的百分位数值标识用于正确调整大小的适当数据点。

    - 例如，如果性能历史记录设置为一周，并且百分位数利用率是第 95 百分位，则服务器评估会按升序对上周的 10 分钟采样点进行排序，并选择右调整大小的第 95 个百分位数值。 
    - 第 95 个百分位值可确保忽略任何异常值，如果选择第 99 个百分位，可能会包括这些异常值。
    - 如果要选择期间的峰值使用率，并且不想错过任何异常值，则应选择百分位数利用率的第 99 百分位数。

5. 此值乘以舒适系数，以获得每个指标的有效性能利用率数据（CPU 利用率、内存利用率、磁盘 IOPS（读写）、磁盘吞吐量（读取和写入）和网络吞吐量（进出）设备收集。



## <a name="how-are-assessments-calculated"></a>如何计算评估？ 

服务器评估中的评估使用本地计算机的元数据/性能数据进行计算。 如果部署 Azure 迁移设备，则使用设备收集的数据进行评估。 如果对使用 导入的计算机运行评估。CSV 文件，提供计算的元数据。 计算分三个阶段进行：

1. **计算 Azure 就绪性**：评估计算机是否适合迁移到 Azure。
2. **计算大小调整建议**：估计计算、存储和网络大小调整。 
2. **计算每月成本**：计算迁移后在 Azure 中运行计算机的估计每月计算和存储成本。

计算顺序，并且计算机服务器仅在通过前一个阶段时才移动到稍后阶段。 例如，如果服务器未通过 Azure 就绪，则将其标记为不适合 Azure，并且不会为该服务器执行大小调整和成本计算。


## <a name="whats-in-an-assessment"></a>评估内容有哪些？

以下是服务器评估中评估中包含的内容。

**属性** | **详细信息**
--- | ---
**目标位置** | 要迁移到的位置。服务器评估当前支持这些目标 Azure 区域：<br/><br/> 澳大利亚东部、澳大利亚东南部、巴西南部、加拿大中部、加拿大东部、印度中部、美国中部、中国东部、华北、东亚、美国东部、美国东部、德国中部、德国东北部、日本东部、日本西部、韩国中部、韩国南部、北部美国中部、北欧、美国中南部、东南亚、南印度、英国南部、英国西部、美国亚利桑那州政府、美国得克萨斯州政府、美国弗吉尼亚州政府、美国中西部、西欧、西印度、美国西部和美国西部2。
*目标存储磁盘（大小调整）** | 用于在 Azure 中存储的磁盘的类型。 <br/><br/> 将目标存储磁盘指定为高级托管磁盘、标准 SSD 托管磁盘或标准 HDD 托管磁盘。
**目标存储磁盘（基于性能的尺寸调整）** | 将目标存储磁盘的类型指定为自动、高级托管、标准硬盘托管或标准 SSD 托管。<br/><br/> **自动**：磁盘建议基于磁盘的性能数据（每秒输入/输出操作 （IOPS） 和吞吐量）。<br/><br/>**高级/标准**：评估建议在所选存储类型内使用磁盘 SKU。<br/><br/> 如果要实现单个实例 VM SLA 的 99.9%，则考虑使用高级托管磁盘。 这可确保建议将评估中的所有磁盘作为高级管理磁盘。<br/><br/> Azure Migrate 仅支持使用托管磁盘进行迁移评估。
**保留实例 （R）** | 在 Azure 中指定[预留实例](https://azure.microsoft.com/pricing/reserved-vm-instances/)，以便评估中的成本估计会考虑 RI 折扣。<br/><br/> 当前仅支持 Azure 迁移中的即用即付产品/服务。
**调整标准大小** | 用于在 Azure 中调整 VM 的大小。<br/><br/> 使用按大小调整或基于性能的尺寸调整。
**性能历史记录** | 与基于性能的尺寸调整一起使用。 指定评估性能数据时使用的持续时间。
**百分位使用率** | 与基于性能的尺寸调整一起使用。 指定用于右大小调整的性能示例的百分位数值。 
**VM 系列** | 指定要考虑调整大小的 Azure VM 系列。 例如，如果 Azure 中没有需要 A 系列 VM 的生产环境，则可以从列表或系列中排除 A 系列。
**舒适因子** | 评估期间使用的缓冲区。 应用于 VM（CPU、内存、磁盘和网络）的计算机利用率数据之上。 它考虑了季节性使用、性能历史记录短以及未来使用量可能增加等问题。<br/><br/> 例如，利用率为 20% 的 10 核 VM 通常会导致双核 VM。 舒适系数为 2.0 倍，其结果是四核 VM。
**提供** | 显示您注册的[Azure 产品/服务](https://azure.microsoft.com/support/legal/offer-details/)。 服务器评估相应地估计成本。
**货币** | 为您的帐户计费币种。
**折扣 (%)** | 列出您在 Azure 产品/服务顶部收到的任何特定于订阅的折扣。 默认设置是 0%。
**VM 运行时间** | 如果 Azure VM 不会每周 7 天、每天 24 小时运行，则可以指定它们将运行的持续时间（每月天数和小时）。 成本估算将相应地处理。<br/><br/> 默认值为“每月 31 天和每天 24 小时”。
**Azure 混合权益** | 指定您是否具有软件保证并有资格享受[Azure 混合权益](https://azure.microsoft.com/pricing/hybrid-use-benefit/)。 如果设置为"是"（默认设置），则 Windows VM 会考虑非 Windows Azure 价格。

[查看](best-practices-assessment.md)使用服务器评估创建评估的最佳做法。


## <a name="calculate-readiness"></a>计算就绪情况

并非所有计算机都适合在 Azure 中运行。 服务器评估评估每个本地计算机，并将其分配为就绪类别。 
- **已为 Azure 做好准备**：可以根据需要将计算机迁移到 Azure，而无需进行任何更改。 它将在 Azure 中开始，支持 Azure。
- **有条件地为 Azure 做好准备**：计算机可能在 Azure 中启动，但可能没有完整的 Azure 支持。 例如，Azure 不支持运行旧版本的 Windows Server 的计算机。 在将这些计算机迁移到 Azure 之前，必须小心谨慎。 按照评估中建议的补救指南进行修复，以修复就绪问题。
- **尚未准备好使用 Azure**：计算机不会在 Azure 中启动。 例如，如果本地计算机磁盘超过 64 TB，则无法将其托管在 Azure 中。 按照修正指南在迁移之前修复问题。 
- **就绪性未知**：由于元数据不足，Azure 迁移无法确定计算机的就绪情况。

为了计算就绪情况，服务器评估会审核下表中汇总的计算机属性和操作系统设置。 

### <a name="machine-properties"></a>计算机属性

服务器评估会检查本地 VM 的以下属性，以确定是否可以在 Azure 上运行。

**属性** | **详细信息** | **Azure 迁移就绪性状态**
--- | --- | ---
**启动类型** | Azure 支持具有 BIOS 启动类型的 VM，而不是 UEFI。 | 如果引导类型为 UEFI，则有条件就绪。
**核心** | 计算机中的内核数必须等于或小于 Azure VM 支持的最大内核数 （128）。<br/><br/> 如果性能历史记录可用，Azure Migrate 会考虑已利用的内核数以进行比较。 如果在评估设置中指定了舒适因子，则将已利用的内核数乘以此舒适因子。<br/><br/> 如果没有性能历史记录，Azure 迁移将使用分配的内核，而无需应用舒适系数。 | 如果小于或等于限制，则状态为就绪。
**内存** | 计算机内存大小必须等于或小于 Azure VM 允许的最大内存（Azure M 系列Standard_M128m&nbsp;<sup>2</sup>上 3892 GB）。 [了解详情](https://docs.microsoft.com/azure/virtual-machines/windows/sizes)。<br/><br/> 如果性能历史记录可用，Azure Migrate 会考虑已利用的内存以进行比较。 如果指定了舒适因子，则将已利用的内存乘以此舒适因子。<br/><br/> 如果没有历史记录，则不使用分配内存，而不应用舒适系数。<br/><br/> | 如果在限制范围内，则状态为就绪。
**存储磁盘** | 磁盘的分配大小必须为 32 TB 或更少。 尽管 Azure 支持具有超 SSD 磁盘的 64 TB 磁盘，但 Azure 迁移：服务器评估当前会检查 32 TB 作为磁盘大小限制，因为它还不支持超 SD。 <br/><br/> 连接到计算机的磁盘数必须为 65 个或更少，包括操作系统磁盘。 | 如果在限制范围内，则状态为就绪。
**网络连接** | 计算机必须连接 32 个或更少的网络接口 （NIC）。 | 如果在限制范围内，则状态为就绪。

### <a name="guest-operating-system"></a>来宾操作系统
除了 VM 属性外，服务器评估还查看计算机的来宾操作系统，以确定是否可以在 Azure 上运行。

> [!NOTE]
> 对于 VMware VM，服务器评估使用为 vCenter 服务器中为 VM 指定的操作系统来处理来宾操作系统分析。 对于在 VMware 上运行的 Linux VM，它当前无法标识来宾操作系统的确切内核版本。

服务器评估使用以下逻辑来根据操作系统标识 Azure 就绪状态。

**操作系统** | **详细信息** | **Azure 迁移就绪性状态**
--- | --- | ---
Windows Server 2016 和所有 SP | Azure 提供完全支持。 | 已做好 Azure 迁移准备
Windows Server 2012 R2 和所有 SP | Azure 提供完全支持。 | 已做好 Azure 迁移准备
Windows Server 2012 和所有 SP | Azure 提供完全支持。 | 已做好 Azure 迁移准备
Windows Server 2008 R2 和所有 SP | Azure 提供完全支持。| 已做好 Azure 迁移准备
Windows Server 2008（32 位和 64 位） | Azure 提供完全支持。 | 已做好 Azure 迁移准备
Windows Server 2003、2003 R2 | 这些操作系统已过了其终止支持日期，并且需要[自定义支持协议 （CSA）](https://aka.ms/WSosstatement)来在 Azure 中提供支持。 | 有条件地为 Azure 做好准备。 请考虑在迁移到 Azure 之前升级操作系统。
Windows 2000、98、95、NT、3.1、MS-DOS | 这些操作系统已过了其支持终止日期。 计算机可能在 Azure 中启动，但 Azure 不提供操作系统支持。 | 有条件地为 Azure 做好准备。 我们建议您在迁移到 Azure 之前升级操作系统。
Windows Client 7、8 和 10 | Azure 仅通过[可视化工作室订阅提供支持。](https://docs.microsoft.com/azure/virtual-machines/windows/client-images) | 已做好特定条件下的 Azure 迁移准备
Windows 10 专业版桌面 | Azure 提供了对[多租户托管权限](https://docs.microsoft.com/azure/virtual-machines/windows/windows-desktop-multitenant-hosting-deployment)的支持。 | 已做好特定条件下的 Azure 迁移准备
Windows Vista、XP Professional | 这些操作系统已过了其支持终止日期。 计算机可能在 Azure 中启动，但 Azure 不提供操作系统支持。 | 有条件地为 Azure 做好准备。 我们建议您在迁移到 Azure 之前升级操作系统。
Linux | Azure 予以认可这些 [Linux 操作系统](../virtual-machines/linux/endorsed-distros.md)。 其他 Linux 操作系统可能在 Azure 中启动，但我们建议您在迁移到 Azure 之前将操作系统升级到支持的版本。 | 如果版本受到认可，则为 Azure 已就绪。<br/><br/>如果版本不受认可，则为 Azure 有条件的就绪。
其他操作系统<br/><br/> 例如，甲骨文索拉里斯，苹果macOS等，FreeBSD等。 | Azure 不认可这些操作系统。 计算机可能在 Azure 中启动，但 Azure 不提供操作系统支持。 | 有条件地为 Azure 做好准备。 我们建议您在迁移到 Azure 之前安装受支持的操作系统。  
vCenter Server 中指定为“其他”**** 的 OS | 在此情况下，Azure Migrate 无法确认 OS。 | 就绪性未知。 确保 VM 内部运行的 OS 在 Azure 中受到支持。
32 位操作系统 | 计算机可能在 Azure 中启动，但 Azure 可能无法提供完全支持。 | 有条件地为 Azure 做好准备。 在迁移到 Azure 之前，请考虑将计算机的操作系统从 32 位操作系统升级到 64 位操作系统。

## <a name="calculating-sizing"></a>计算大小调整


在计算机标记为已准备好 Azure 后，服务器评估会制定大小调整建议以标识 Azure VM 和磁盘 SKU。 大小调整计算取决于您使用的是本地大小调整还是基于性能的尺寸调整。

### <a name="calculate-sizing-as-is-on-premises"></a>计算大小调整（按本地大小调整）

 如果使用 as-is 本地大小调整，服务器评估不考虑 VM 和磁盘的性能历史记录。

- **计算大小调整**：它根据在本地分配的大小分配 Azure VM SKU。
- **存储/磁盘大小调整**：服务器评估查看评估属性（标准 HDD/SSD/高级）中指定的存储类型，并相应地推荐磁盘类型。 默认存储类型为高级磁盘。
- **网络大小调整**：服务器评估考虑本地计算机上的网络适配器。


### <a name="calculate-sizing-performance-based"></a>计算大小调整（基于性能）

如果使用基于性能的尺寸调整，服务器评估会按如下方式调整大小建议：

- 服务器评估会考虑计算机的性能历史记录，以标识 Azure 中的 VM 大小和磁盘类型。
- 如果已使用 CSV 文件导入服务器，则使用您指定的值。 如果过度分配了本地计算机，利用率实际上很低，并且希望调整 Azure 中的 VM 大小以节省成本，则此方法特别有用。 
- 如果不想使用性能数据，请将大小调整条件重置为"本地原样"，如上一节所述。

#### <a name="calculate-storage-sizing"></a>计算存储大小

对于存储大小调整，Azure 迁移尝试将附加到计算机的每个磁盘映射到 Azure 中的磁盘，其工作方式如下：

1. 服务器评估添加磁盘的读取和写入 IOPS，以获得所需的总 IOPS。 同样，它添加读写吞吐量值，以获得每个磁盘的总吞吐量。
2. 如果已根据有效的 IOPS 和吞吐量值将存储类型指定为"自动"，则服务器评估将确定磁盘应映射到 Azure 中的标准 HDD、标准 SSD 或高级磁盘。 如果存储类型设置为标准 HDD/SSD/高级，服务器评估将尝试在所选存储类型（标准硬盘/SSD/高级磁盘）中找到磁盘 SKU。
3. 选择磁盘如下：
    - 如果服务器评估找不到具有所需 IOPS 和吞吐量的磁盘，则它将计算机标记为不适合 Azure。
    - 如果服务器评估找到一组合适的磁盘，它将选择支持评估设置中指定位置的磁盘。
    - 如果有多个符合条件的磁盘，服务器评估会选择成本最低的磁盘。
    - 如果任何磁盘的性能数据不可用，则磁盘的配置数据（磁盘大小）用于在 Azure 中查找标准 SSD 磁盘。

#### <a name="calculate-network-sizing"></a>计算网络大小

服务器评估尝试查找一个 Azure VM，该 VM 可以支持连接到本地计算机的网络适配器数量以及这些网络适配器所需的性能。
- 为了获得本地 VM 的有效网络性能，服务器评估将每秒传输的数据 （MBps） 聚合到计算机（网络外），跨所有网络适配器，并应用舒适系数。 它使用此编号查找可支持所需网络性能的 Azure VM。
- 除了网络性能外，服务器评估还考虑 Azure VM 是否可以支持所需的网络适配器数。
- 如果没有可用的网络性能数据，服务器评估将仅考虑 VM 大小调整的网络适配器计数。


#### <a name="calculate-compute-sizing"></a>计算大小调整

计算存储和网络要求后，服务器评估会考虑 CPU 和内存要求，以在 Azure 中找到合适的 VM 大小。
- Azure 迁移查看有效利用的核心和内存，以在 Azure 中找到合适的 VM 大小。
- 如果找不到合适的大小，计算机将标记为不适用于 Azure。
- 如果找到了合适的大小，Azure Migrate 将应用存储和网络计算。 然后，它将为最终 VM 大小建议应用位置和定价层设置。
- 如果有多个合格的 Azure VM 大小，建议选择成本最低的那一个。


## <a name="confidence-ratings-performance-based"></a>置信度（基于绩效）

Azure 迁移中的每个基于性能的评估都与从一星（最低）到五星（最高）的置信度评级相关联。 置信度可帮助您估计 Azure 迁移提供的大小建议的可靠性。

- 为评估分配置信度时，会考虑到进行评估计算时所需数据点的可用性。
- 对于基于性能的尺寸调整，服务器评估需要：
    - CPU 和 VM 内存的利用率数据。
    - 连接到 VM 的每个磁盘的磁盘 IOPS 和吞吐量数据。
    - 网络 I/O，用于处理连接到 VM 的每个网络适配器的基于性能的尺寸调整。
    - 如果这些利用率编号中的任何一个不可用，则大小建议可能不可靠。

> [!NOTE]
> 对于使用导入的 评估的服务器，不会分配置信度。CSV 文件。 评级也不适用于本地评估。
   
### <a name="ratings"></a>评级

根据可用数据点的百分比，评估的置信度评级如下。

   **数据点的可用性** | **置信度分级**
   --- | ---
   0-20% | 1 星
   21-40% | 2 星
   41-60% | 3 星
   61-80% | 4 星
   81-100% | 5 星

### <a name="low-confidence-ratings"></a>低置信度

以下是评估可能获得低置信度的几个原因：

- 在创建评估的持续时间内，您没有分析您的环境。 例如，如果创建评估时，性能持续时间设置为一天，则必须在开始发现要收集的所有数据点后至少等待一天。
- 一些 VM 在进行评估计算期间关闭。 如果任何 VM 在一段时间内关闭，服务器评估无法收集该期间的性能数据。
- 在计算评估期间创建了一些 VM。 例如，如果为上个月的性能历史记录创建了评估，但某些 VM 仅在一周前在环境中创建，则新 VM 的性能历史记录将不存在整个持续时间。

> [!NOTE]
> 如果任何评估的置信度低于五星，我们建议您至少等待一天，让产品分析环境，然后重新计算评估。 如果没有，基于性能的尺寸调整可能不可靠。 在这种情况下，我们建议您将评估切换到本地大小调整。

## <a name="calculate-monthly-costs"></a>计算每月成本

调整大小建议完成后，Azure 迁移计算迁移后的计算和存储成本。

- 计算成本****：使用建议的 Azure VM 大小，Azure Migrate 使用计费 API 来计算 VM 每月成本。
    - 该计算会考虑操作系统、软件保障、预留实例、VM 运行时间、位置和货币设置。
    - 它聚合所有机器的成本，以计算每月计算总成本。
- **存储成本**：机器的每月存储成本通过聚合连接到计算机的所有磁盘的每月成本来计算，如下所示：
    - 服务器评估通过聚合所有计算机的存储成本来计算每月总存储成本。
    - 目前，计算不考虑评估设置中指定的报价。

成本以在评估设置中指定的币种显示。


## <a name="next-steps"></a>后续步骤

[查看](best-practices-assessment.md)创建评估的最佳做法。 


- 了解[VMware VM、](tutorial-prepare-vmware.md)[超 V VM](tutorial-prepare-hyper-v.md)和[物理服务器](tutorial-prepare-physical.md)的运行评估。
- 了解如何评估[使用 CSV 文件导入的](tutorial-assess-import.md)服务器。
- 了解如何设置[依赖项可视化](concepts-dependency-visualization.md)。