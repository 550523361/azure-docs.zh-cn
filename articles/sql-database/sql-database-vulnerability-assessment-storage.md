---
title: 存储漏洞评估扫描会导致在防火墙和 VNet 后访问存储帐户
description: 提供有关如何将漏洞评估 （VA） 扫描存储在可通过防火墙或 VNet 访问的存储帐户中的说明
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.topic: conceptual
author: barmichal
ms.author: mibar
ms.reviewer: vanto
ms.date: 04/17/2020
ms.openlocfilehash: 36783c84acc22d6bc1084c2c13f455dedbfc77ca
ms.sourcegitcommit: d57d2be09e67d7afed4b7565f9e3effdcc4a55bf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/22/2020
ms.locfileid: "81771854"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>存储漏洞评估扫描会导致在防火墙和 VNet 后访问存储帐户

如果要限制对某些 VNet 或服务的 Azure 中的存储帐户的访问权限，则需要启用适当的配置，以便针对 SQL 数据库或托管实例进行漏洞评估 （VA） 扫描才能访问该存储帐户。

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>启用 Azure SQL 数据库 VA 扫描对存储帐户的访问

如果已将 VA 存储帐户配置为仅由某些网络或服务访问，则需要确保 Azure SQL 数据库的 VA 扫描能够将扫描存储在存储帐户上。 要了解正在使用哪些存储帐户，请转到[Azure 门户](https://portal.azure.com)中的**SQL 服务器**窗格，在 **"安全"** 下，选择**高级数据安全性**。

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/va-storage.png" alt-text="va 存储":::

您可以使用现有存储帐户，或创建新的存储帐户来存储 Azure SQL Server 上所有数据库的 VA 扫描结果。

转到包含存储帐户**的资源组**并访问 **"存储帐户"** 窗格。 在 **"设置"** 下，选择**防火墙和虚拟网络**。

确保选中**允许受信任的 Microsoft 服务访问此存储帐户**。

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="存储允许-微软服务":::

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>在可在防火墙或 VNet 后访问的存储帐户中存储 Azure SQL 托管实例的 VA 扫描结果

由于托管实例不是受信任的 Microsoft 服务，并且具有与存储帐户不同的 VNet，因此执行 VA 扫描将导致错误。

要支持托管实例上的 VA 扫描，请按照以下步骤操作：

1. 在**SQL 托管实例**窗格中，在 **"概述"** 标题下，单击**虚拟网络/子网**链接。 这将带您到**虚拟网络**窗格。

   :::image type="content" source="media/sql-database-managed-instance-public-endpoint-configure/mi-overview.png" alt-text="mi-概述2":::

1. 在 **"设置"** 下，选择**子网**。 单击新窗格中的**子网**以添加子网，并将其委派给*Microsoft.sql_托管实例*。 有关详细信息，请参阅[管理子网](../virtual-network/virtual-network-manage-subnet.md)。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="mi 子网":::

1. 在**虚拟网络**窗格中，**在"设置"** 下，选择 **"服务终结点**"。 单击"在新窗格中**添加**"，并将*Microsoft.存储*服务添加为新的服务终结点。 确保选择了*托管实例*子网。 单击“添加”  。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="mi 服务端点":::

1. 转到已选择的**存储帐户**以存储 VA 扫描。 在 **"设置"** 下，选择**防火墙和虚拟网络**。 单击“添加现有虚拟网络”****。 选择托管实例虚拟网络和子网，然后单击"**添加**"。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="存储防火墙":::

现在，您应该能够将托管实例的 VA 扫描存储在存储帐户中。

## <a name="next-steps"></a>后续步骤

- [漏洞评估](sql-vulnerability-assessment.md)
- [创建 Azure 存储帐户](../storage/common/storage-account-create.md)
- [Azure SQL 数据库的高级数据安全](sql-database-advanced-data-security.md)