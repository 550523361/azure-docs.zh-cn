---
title: 存储漏洞评估扫描结果在防火墙和 Vnet 后可访问的存储帐户中
description: 提供有关如何在可以通过防火墙或 VNet 访问的存储帐户中存储漏洞评估（VA）扫描的说明
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.topic: conceptual
author: barmichal
ms.author: mibar
ms.reviewer: vanto
ms.date: 04/17/2020
ms.openlocfilehash: 36783c84acc22d6bc1084c2c13f455dedbfc77ca
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2020
ms.locfileid: "81771854"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>存储漏洞评估扫描结果在防火墙和 Vnet 后可访问的存储帐户中

如果在 Azure 中限制特定 Vnet 或服务的存储帐户的访问权限，则需要启用相应的配置，以使 SQL 数据库或托管实例的漏洞评估（VA）扫描能够访问该存储帐户。

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>启用对存储帐户的 Azure SQL 数据库 VA 扫描访问

如果已将 VA 存储帐户配置为仅可供某些网络或服务访问，则需要确保对 Azure SQL 数据库的 VA 扫描能够在存储帐户上存储扫描。 若要找出正在使用的存储帐户，请在[Azure 门户](https://portal.azure.com)"**安全**" 下的 " **SQL server** " 窗格中，选择 "**高级数据安全性**"。

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/va-storage.png" alt-text="va-存储":::

可以使用现有存储帐户，也可以创建新的存储帐户来存储 Azure SQL Server 上所有数据库的 VA 扫描结果。

中转到包含该存储帐户的**资源组**，然后访问**存储帐户**窗格。 在 "**设置**" 下，选择 "**防火墙和虚拟网络**"。

确保选中 "**允许受信任的 Microsoft 服务访问此存储帐户**"。

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="存储-允许-microsoft-服务":::

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>将 Azure SQL 托管实例的 VA 扫描结果存储在可在防火墙或 VNet 后面访问的存储帐户中

由于托管实例不是受信任的 Microsoft 服务，并且具有与存储帐户不同的 VNet，因此执行 VA 扫描将导致错误。

若要支持对托管实例的 VA 扫描，请执行以下步骤：

1. 在 " **SQL 托管实例**" 窗格中的 "**概述**" 标题下，单击 "**虚拟网络/子网**" 链接。 这会转到 "**虚拟网络**" 窗格。

   :::image type="content" source="media/sql-database-managed-instance-public-endpoint-configure/mi-overview.png" alt-text="mi-overview2":::

1. 在 "**设置**" 下，选择 "**子网**"。 在新窗格中单击 "**子网**" 以添加子网，并将其委托给*sql\managedInstance*。 有关详细信息，请参阅[管理子网](../virtual-network/virtual-network-manage-subnet.md)。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="mi 子网":::

1. 在 "**虚拟网络**" 窗格中的 "**设置**" 下，选择 "**服务终结点**"。 在新窗格中单击 "**添加**"，并添加 " *Microsoft. 存储*服务" 作为新的服务终结点。 请确保已选择*ManagedInstance*子网。 单击“添加”  。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="mi-服务终结点":::

1. 中转到你选择的**存储帐户**来存储 VA 扫描。 在 "**设置**" 下，选择 "**防火墙和虚拟网络**"。 单击“添加现有虚拟网络”****。 选择托管实例的虚拟网络和子网，然后单击 "**添加**"。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="存储-防火墙":::

现在应能够在存储帐户中存储托管实例的 VA 扫描。

## <a name="next-steps"></a>后续步骤

- [漏洞评估](sql-vulnerability-assessment.md)
- [创建 Azure 存储帐户](../storage/common/storage-account-create.md)
- [Azure SQL 数据库的高级数据安全](sql-database-advanced-data-security.md)