---
title: 配置管理员同意工作流 - Azure 活动目录 |微软文档
description: 了解如何为最终用户配置一种请求访问需要管理员同意的应用程序的方法。
services: active-directory
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.topic: conceptual
ms.date: 10/29/2019
ms.author: mimart
ms.reviewer: luleon
ms.collection: M365-identity-device-management
ms.openlocfilehash: 83b3f0d97daf0b4ac17f74981119b380d1776d97
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/27/2020
ms.locfileid: "75430205"
---
# <a name="configure-the-admin-consent-workflow-preview"></a>配置管理员同意工作流（预览）

本文介绍如何启用管理员同意工作流（预览）功能，该功能为最终用户提供了一种请求访问需要管理员同意的应用程序的方法。

如果没有管理员同意工作流，当租户尝试访问任何需要访问组织数据权限的应用时，将阻止用户同意被禁用。 用户看到一条通用错误消息，指出他们未经授权访问应用，他们应该向管理员寻求帮助。 但是，用户通常不知道要联系谁，因此他们要么放弃，要么在应用程序中创建新的本地帐户。 即使收到通知，也并不总是有简化的过程来帮助管理员授予访问权限并通知其用户。
 
管理员同意工作流为管理员提供了一种安全的方式来授予对需要管理员批准的应用程序的访问权限。 当用户尝试访问应用程序但无法提供同意时，他们可以发送管理员批准请求。 请求通过电子邮件发送给被指定为审阅者的管理员。 审阅者对请求执行操作，并通知用户该操作。

要批准请求，审阅者必须是全局管理员、云应用程序管理员或应用程序管理员。 审阅者必须已经分配了这些管理员角色之一;简单地指定他们为审阅者不会提升他们的特权。

## <a name="enable-the-admin-consent-workflow"></a>启用管理员同意工作流

要启用管理员同意工作流并选择审阅者，请执行以下操作：

1. 以全局管理员身份登录到 [Azure 门户](https://portal.azure.com)。
2. 在左侧导航菜单的顶部单击“所有服务”。**** 此时会打开“Azure Active Directory 扩展”。****
3. 在筛选器搜索框中，键入 **"Azure 活动目录**"并选择**Azure 活动目录**项。
4. 在导航菜单中，单击“企业应用程序”****。 
5. 在“管理”下，选择“用户设置”********。
6. 在**管理员同意请求（预览）** 下，设置**用户可以请求管理员同意他们无法同意为****的应用**。

   ![配置管理员同意工作流设置](media/configure-admin-consent-workflow/admin-consent-requests-settings.png)
 
6. 配置以下设置：

   * **选择用户以查看管理员同意请求**。 从具有全局管理员、云应用程序管理员和应用程序管理员角色的一组用户中选择此工作流的审阅者。
   * **选定的用户将收到请求的电子邮件通知**。 发出请求时启用或禁用向审阅者发送电子邮件通知。  
   * **选定的用户将收到请求过期提醒**。 当请求即将过期时，启用或禁用提醒电子邮件通知给审阅者。  
   * **同意请求将在 （天） 后过期**。 指定请求保持有效的时间。

7. 选择“保存”。**** 启用该功能最多可能需要一个小时。

> [!NOTE]
> 您可以通过修改 **"选择管理员同意请求审阅者**列表"来添加或删除此工作流的审阅者。 请注意，此功能的当前限制是，审阅者可以保留查看在指定为审阅者时发出的请求的能力。

## <a name="how-users-request-admin-consent"></a>用户如何请求管理员同意

启用管理员同意工作流后，用户可以请求管理员批准他们未经授权同意的应用程序。 以下步骤描述了用户在请求审批时的体验。 

1. 用户尝试登录到应用程序。

2. 将显示 **"批准"要求**的消息。 用户键入需要访问应用的理由，然后选择**请求批准**。

   ![管理员同意用户请求和理由](media/configure-admin-consent-workflow/end-user-justification.png)

3. **发送的请求**消息确认请求已提交给管理员。如果用户发送多个请求，则仅向管理员提交第一个请求。

   ![管理员同意用户请求和理由](media/configure-admin-consent-workflow/end-user-sent-request.png)

 4. 当用户的请求被批准、拒绝或阻止时，用户会收到电子邮件通知。 

## <a name="review-and-take-action-on-admin-consent-requests"></a>审核管理员同意请求并采取行动

要查看管理员同意请求并采取措施：

1. 作为管理员同意工作流的注册审阅者之一登录到[Azure 门户](https://portal.azure.com)。
2. 选择左侧导航菜单顶部**的所有服务**。 此时会打开“Azure Active Directory 扩展”。****
3. 在筛选器搜索框中，键入 **"Azure 活动目录**"并选择**Azure 活动目录**项。
4. 在导航菜单中，单击“企业应用程序”****。
5. 在 **"活动"** 下，选择**管理员同意请求（预览）。**

   > [!NOTE]
   > 审阅者将只看到在指定为审阅者后创建的管理员请求。

1. 选择正在请求的应用程序。
2. 查看有关请求的详细信息：  

   * 要查看谁在请求访问以及原因，请选择"**按请求"** 选项卡。
   * 要查看应用程序请求的权限，请选择 **"审阅权限"和"同意**"。

8. 评估请求并采取相应操作：

   * **批准请求**。 要批准请求，请授予管理员对申请的同意。 请求获得批准后，将通知所有请求者他们已被授予访问权限。  
   * **拒绝请求**。 要拒绝请求，必须提供将提供给所有请求者的理由。 请求被拒绝后，将通知所有请求者他们被拒绝访问应用程序。 拒绝请求不会阻止用户将来再次请求管理员同意应用。  
   * **阻止请求**。 要阻止请求，必须提供将提供给所有请求者的理由。 阻止请求后，将通知所有请求者他们被拒绝访问应用程序。 阻止请求会为处于禁用状态的租户中的应用程序创建服务主体对象。 用户将来将无法请求管理员同意应用程序。
 
## <a name="email-notifications"></a>电子邮件通知
 
如果配置，所有审阅者在：

* 已创建新请求
* 请求已过期
* 请求已接近到期日期  
 
请求者将在：

* 他们提交新的访问请求
* 他们的请求已过期
* 他们的请求被拒绝或被阻止
* 他们的请求已经获得批准
 
## <a name="audit-logs"></a>审核日志 
 
下表概述了可用于管理员同意工作流的方案和审核值。 

> [!NOTE]
> 在所有方案中，审核参与者的用户上下文当前都缺失。 这是预览版本中的已知限制。


|方案  |审计服务  |审核类别  |审核活动  |审核参与者  |审核日志限制  |
|---------|---------|---------|---------|---------|---------|
|管理员启用同意请求工作流        |访问评审           |UserManagement           |创建治理策略模板          |应用上下文            |当前您找不到用户上下文            |
|管理员禁用同意请求工作流       |访问评审           |UserManagement           |删除治理策略模板          |应用上下文            |当前您找不到用户上下文           |
|管理员更新同意工作流配置        |访问评审           |UserManagement           |更新治理策略模板          |应用上下文            |当前您找不到用户上下文           |
|最终用户为应用创建管理员同意请求       |访问评审           |策略         |创建请求           |应用上下文            |当前您找不到用户上下文           |
|审核员批准管理员同意请求       |访问评审           |UserManagement           |批准业务流中的所有请求          |应用上下文            |目前，您无法找到获得管理员同意的用户上下文或应用 ID。           |
|审阅者拒绝管理员同意请求       |访问评审           |UserManagement           |批准业务流中的所有请求          |应用上下文            | 目前，您找不到拒绝管理员同意请求的 Actor 的用户上下文          |

## <a name="faq"></a>FAQ 

**我打开此工作流，但在测试功能时，为什么看不到新的"需要审批"提示，允许我请求访问？**

打开该功能后，最终用户最多可能需要 60 分钟才能看到更新。 您可以通过在`https://graph.microsoft.com/beta/settings`API 中查看**启用Admin同意请求**值来验证配置是否正确生效。

**作为审阅者，为什么我看不到所有挂起的请求？**

审阅者只能查看在指定为审阅者后创建的管理员请求。 因此，如果您最近被添加为审阅者，则看不到在分配之前创建的任何请求。

**作为审阅者，为什么会看到同一应用程序的多个请求？**
  
如果应用程序开发人员已将其应用配置为使用静态和动态同意请求访问其最终用户的数据，您将看到两个管理员同意请求。 一个请求表示静态权限，另一个请求表示动态权限。

**作为请求者，我可以检查请求的状态吗？**  

否，现在请求者只能通过电子邮件通知获取更新。

**作为审阅者，是否可以批准应用程序，但并非对所有人？**
 
如果您担心授予管理员同意并允许租户中的所有用户使用该应用程序，我们建议您拒绝该请求。 然后，通过要求用户分配和向应用程序分配用户或组来限制对应用程序的访问，从而手动授予管理员同意。 有关详细信息，请参阅[分配用户和组的方法](methods-for-assigning-users-and-groups.md)。

## <a name="next-steps"></a>后续步骤

有关许可应用程序的详细信息，请参阅 [Azure Active Directory 许可框架](../develop/consent-framework.md)。

[配置最终用户如何同意应用程序](configure-user-consent.md)

[向应用程序授予租户范围的管理员许可](grant-admin-consent.md)

[Microsoft 标识平台中的权限和许可](../develop/active-directory-v2-scopes.md)

[StackOverflow 上的 Azure AD](https://stackoverflow.com/questions/tagged/azure-active-directory)
