---
title: Azure 安全中心中的内置漏洞扫描程序
description: Azure 安全中心包含来自 Qualys 的完全集成的漏洞评估解决方案。 在此页上了解有关此安全中心扩展的详细信息。
services: security-center
documentationcenter: na
author: memildin
manager: rkarlin
ms.service: security-center
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/30/2020
ms.author: memildin
ms.openlocfilehash: 080d43411c8893cbe840a9c4402a1eb990dec222
ms.sourcegitcommit: c8a0fbfa74ef7d1fd4d5b2f88521c5b619eb25f8
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/05/2020
ms.locfileid: "82801546"
---
# <a name="integrated-vulnerability-scanner-for-virtual-machines-standard-tier-only"></a>虚拟机的集成漏洞扫描器（仅适用于标准层）

Azure 安全中心随附的漏洞扫描程序由 Qualys 提供支持。 Qualys 的扫描程序是用于实时识别 Azure 虚拟机中的漏洞的领先工具。 它仅适用于标准定价层上的用户。 不需要 Qualys 许可证，甚至 Qualys 帐户-所有内容都在安全中心内无缝处理。

此功能目前以预览版提供。  

> [!NOTE]
> 安全中心支持其他供应商提供的工具集成，但你需要处理许可成本、部署和配置。 有关详细信息，请参阅[部署合作伙伴漏洞扫描解决方案](partner-vulnerability-assessment.md)。 如果选择不使用 Azure 安全中心随附的内置漏洞扫描程序，则还可以使用这些说明来集成组织自己的 Qualys 许可证。


## <a name="overview-of-the-integrated-vulnerability-scanner"></a>集成漏洞扫描器概述

漏洞扫描程序扩展的工作原理如下所示：

1. **部署**-Azure 安全中心将 Qualys 扩展部署到所选的虚拟机。

1. **收集信息**-扩展会收集项目，并在定义的区域中的 Qualys 云服务中发送这些项目以进行分析。

1. **分析**-Qualys 的云服务执行漏洞评估，并将其结果发送到安全中心。 

    > [!IMPORTANT]
    > 为了确保客户的隐私、机密性和安全性，Microsoft 不会与 Qualys 共享客户的详细信息。 [详细了解内置于 Azure 中的隐私标准](https://www.microsoft.com/trust-center/privacy)。


1. **报表**-安全中心提供的结果。

[![Azure 安全中心内置漏洞扫描程序的流程流程图](media/built-in-vulnerability-assessment/va-vm-flow-diagram.png)](media/built-in-vulnerability-assessment/va-vm-flow-diagram.png#lightbox)



## <a name="deploying-the-qualys-built-in-vulnerability-scanner"></a>部署 Qualys 内置漏洞扫描程序

若要扫描基于 Azure 的虚拟机是否存在漏洞，最简单的方法是使用内置漏洞扫描程序。 

部署漏洞扫描程序扩展：

1. 打开 Azure 安全中心，并前往标准定价层上的订阅的**建议**页面。

1. 选择名为 **"在虚拟机上启用内置漏洞评估解决方案（由 Qualys 提供支持）"** 的建议。

    [![Azure 安全中心中的建议页已筛选为 Qualys 建议](media/built-in-vulnerability-assessment/va-recommendations-enable-selected.png)](media/built-in-vulnerability-assessment/va-recommendations-enable-selected.png#lightbox)

    Vm 将显示在以下一个或多个组中：

    * **正常资源**–漏洞扫描器扩展已部署到这些 vm。
    * 不**正常的资源**–漏洞扫描程序扩展可部署到这些 vm。 
    * **不适用的资源**-这些 vm 不能部署漏洞扫描程序扩展。 你的 VM 可能在此选项卡中，因为它位于免费定价层上，因此缺少 ImageReference 类（与从备份还原的自定义映像和 Vm 相关，如[此 Azure for .net 页](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.imagereference?view=azure-dotnet)中所述），或者它不是在运行受支持的操作系统之一：


        | **供应商** | 操作系统  | **支持的版本** |
        |----|----|----|
        |Microsoft|Windows|All|
        |Red Hat|企业 Linux|5.4 +、6、7.0-7.7、8|
        |Red Hat|CentOS|5.4 +、6、7.0-7。7|
        |Red Hat|Fedora|22-25|
        |SUSE|Linux Enterprise Server （SLES）|11、12、15|
        |SUSE|OpenSUSE|12、13|
        |SUSE|闰月|42.1|
        |Oracle|企业 Linux|5.11、6、7.0-7。5|
        |Debian|Debian|7. x-九点|
        |Ubuntu|Ubuntu|12.04 LTS，14.04 LTS，，16.04 LTS，18.04 LTS|

1. 在 "不正常资源" 选项卡中，选择要在其上部署 Qualys 扫描器的 Vm，然后单击 "**修正**"。 

    ![为 Qualys 扫描器选择 Vm](media/built-in-vulnerability-assessment/va-remediating.png)

    系统将在所有选定的 Vm 上安装 scanner 扩展。
    
    一旦扩展成功部署，扫描就会自动开始。 然后，扫描将按四个小时的时间间隔运行。 此间隔是硬编码的，不可配置。 

1. 如果一个或多个 Vm 上的部署失败，请确保目标 Vm 可以在以下两个 IP 地址上与 Qualys 的云服务进行通信：

    - 64.39.104.113
    - 154.59.121.74 


## <a name="viewing-and-remediating-discovered-vulnerabilities"></a>查看并修正发现的漏洞

当安全中心识别到漏洞时，它会提供结果和相关信息作为建议。 相关信息包括修正步骤、相关标识符、CVSS 评分等。 您可以查看一个或多个订阅或特定 VM 的已标识漏洞。

查看发现并修正识别的漏洞：

1. 打开 Azure 安全中心，并中转到 "**建议**" 页。 

1. 选择名为 "修正虚拟机上发现的漏洞（由 Qualys 提供支持）" 的建议。

    安全中心显示了当前所选订阅中所有 Vm 的所有发现。 这些结果按严重性排序。 

    [![所有所选订阅的 Qualys 的结果列表](media/built-in-vulnerability-assessment/va-findings-all.png)](media/built-in-vulnerability-assessment/va-findings-all.png#lightbox)

1. 若要筛选特定 VM 的发现，请打开 "受影响的资源" 部分，然后单击你感兴趣的 VM。 也可以从 "资源运行状况" 视图中选择一个 VM，然后查看该资源的所有相关建议。

    安全中心显示该 VM 的发现，按严重性排序。 

    [![特定虚拟机的结果](media/built-in-vulnerability-assessment/va-findings.png)](media/built-in-vulnerability-assessment/va-findings.png#lightbox)

    在此示例中，可以看到已发现94个漏洞，其中有5个是中等严重性。

1. 若要了解有关特定漏洞的详细信息，请选择它。 

    [![漏洞 #91426 的详细信息窗格](media/built-in-vulnerability-assessment/va-vulnerability-details.png)](media/built-in-vulnerability-assessment/va-vulnerability-details.png#lightbox)

    显示的详细信息窗格包含有关此漏洞的广泛信息，其中包括：
    
    * 指向所有相关标识符的链接（如果可用）
    * 修正步骤
    * 任何其他参考页

1. 若要修正查找，请按照此详细信息窗格中的更正步骤进行操作。



## <a name="exporting-results"></a>导出结果

若要导出漏洞评估结果，需要使用[Azure 资源图](https://azure.microsoft.com/features/resource-graph/)（ARG）。 使用此工具，可以通过强大的筛选、分组和排序功能，在你的云环境中对资源信息进行即时访问。 这是一种以编程方式或从 Azure 门户中查询 Azure 订阅的信息的快捷有效方法。

有关完整说明和示例 ARG 查询，请参阅此技术社区文章：[在 Azure 安全中心中导出漏洞评估结果](https://techcommunity.microsoft.com/t5/azure-security-center/exporting-vulnerability-assessment-results-in-azure-security/ba-p/1212091)。


## <a name="built-in-qualys-vulnerability-scanner-faq"></a>内置 Qualys 漏洞扫描程序常见问题

### <a name="are-there-any-additional-charges-for-the-qualys-license"></a>Qualys 许可证是否需要支付额外费用？
不能。 内置扫描程序可供所有标准层用户免费。 "在虚拟机上启用内置漏洞评估解决方案（由 Qualys 提供支持）" 建议使用其授权和配置信息部署扫描程序。 不需要其他许可证。 

### <a name="what-prerequisites-and-permissions-are-required-to-install-the-qualys-extension"></a>安装 Qualys 扩展所需的先决条件和权限是什么？
对于要在其上部署扩展的任何 VM，你将需要具有写入权限。

Azure 安全中心漏洞评估扩展（由 Qualys 提供支持）与其他扩展一样，在 Azure 虚拟机代理之上运行。 因此，它作为 Windows 上的本地主机和 Linux 上的根目录运行。

在安装过程中，安全中心将进行检查以确保 VM 可以与 Qualys 的云服务进行通信，这两个 IP 地址如下：

- 64.39.104.113
- 154.59.121.74


### <a name="can-i-remove-the-security-center-qualys-extension"></a>是否可以删除安全中心 Qualys 扩展？ 
如果要从 VM 中删除扩展，可以手动或使用任何编程工具来执行此操作。 

你将需要以下详细信息：

* 在 Linux 上，该扩展名为 "LinuxAgent. AzureSecurityCenter"，提供程序名称为 "Qualys"
* 在 Windows 上，该扩展名为 "WindowsAgent. AzureSecurityCenter"，提供程序名称为 "Qualys"

### <a name="how-does-the-extension-get-updated"></a>扩展的更新方式是什么？
与 Azure 安全中心代理本身以及其他所有 Azure 扩展一样，Qualys 扫描程序的次要更新可能会在后台自动发生。 所有代理和扩展会在自动部署之前广泛地测试。

漏洞扫描程序扩展的某些更新可能需要手动部署。 例如，**如果你运行的是 v 1.0.0.4，则必须执行以下步骤**：

1. 验证 VM 上运行的 Qualys 漏洞扫描程序扩展的版本：

    1. 在 Azure 门户中，打开 "虚拟机"。
    1. 选择要在其上安装代理的 VM。
    1. 从侧栏导航中，打开 "**扩展**" 并选择以下扩展：

        名称： **WindowsAgent。 AzureSecurityCenter**类型： **Qualys. WindowsAgent. AzureSecurityCenter**

    1. 查看扩展的版本信息。

        ![Qualys 代理扩展版本信息](media/built-in-vulnerability-assessment/qualys-agent-extension-version.png)

    1. 如果版本为1.0.0.4，请单击 "**卸载**" 并等待，直到 VM 的 "扩展" 页中不再列出该扩展。

    1. 重启 VM。
    
    1. 当 VM 的状态为 "正在运行" 时，部署[Qualys 内置漏洞扫描程序](#deploying-the-qualys-built-in-vulnerability-scanner)中如上所述的部署扩展。

### <a name="why-does-my-vm-show-as-not-applicable-in-the-recommendation"></a>为什么我的 VM 在建议中显示为 "不适用"？
**"在虚拟机上启用内置漏洞评估解决方案（由 Qualys 提供支持）"** 的 "建议详细信息" 页建议在以下一个或多个列表中对 vm 进行分组 **：正常资源**、不**正常资源**和**不适用的资源**。

如果 "**不适用的资源**" 组中有 vm，则意味着安全中心无法在这些 vm 上部署漏洞扫描程序扩展。 

VM 可能在此选项卡中，原因如下：

- 此功能位于免费定价层上，如上所述，Azure 安全中心随附的漏洞扫描器仅适用于标准定价层中的用户。

- 缺少 ImageReference 类（与从备份还原的自定义映像和 Vm 相关，如[此 Azure for .net 页](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.imagereference?view=azure-dotnet)中所述）。

- 它未运行受支持的操作系统之一：

    | **供应商** | 操作系统  | **支持的版本** |
    |----|----|----|
    |Microsoft|Windows|All|
    |Red Hat|企业 Linux|5.4 +、6、7.0-7.7、8|
    |Red Hat|CentOS|5.4 +、6、7.0-7。7|
    |Red Hat|Fedora|22-25|
    |SUSE|Linux Enterprise Server （SLES）|11、12、15|
    |SUSE|OpenSUSE|12、13|
    |SUSE|闰月|42.1|
    |Oracle|企业 Linux|5.11、6、7.0-7。5|
    |Debian|Debian|7. x-九点|
    |Ubuntu|Ubuntu|12.04 LTS，14.04 LTS，，16.04 LTS，18.04 LTS|

### <a name="what-is-scanned-by-the-built-in-vulnerability-scanner"></a>内置漏洞扫描程序会扫描哪些内容？
该扫描程序正在虚拟机上运行，并寻找 VM 本身的漏洞。 无法在虚拟机上扫描网络。

### <a name="does-the-scanner-integrate-with-my-existing-qualys-console"></a>扫描仪是否与现有的 Qualys 控制台集成？
安全中心扩展是一个独立于现有 Qualys 扫描程序的工具。 许可限制意味着只能在 Azure 安全中心内使用。

### <a name="microsoft-defender-advanced-threat-protection-also-includes-threat--vulnerability-management-tvm-how-is-the-security-center-vulnerability-assessment-extension-different"></a>Microsoft Defender 高级威胁防护还包括威胁 & 漏洞管理（TVM）。 安全中心漏洞评估扩展的不同之处是什么？
Microsoft 正在积极地利用 Windows 中内置的 Microsoft Defender ATP 威胁 & 漏洞管理解决方案来开发世界级漏洞管理。

如今，Azure 安全中心的漏洞评估扩展由 Qualys 提供支持。 Qualys 扩展可确保对 Windows 和 Linux Vm 都提供支持。 此扩展还可以从 Qualys 的自己了解尚未获得标识符的漏洞中获益。

## <a name="next-steps"></a>后续步骤
本文介绍了 Azure 安全中心漏洞评估扩展（由 Qualys 提供支持），用于扫描 Vm。 有关相关材料，请参阅以下文章：

- [了解建议的不同元素](security-center-recommendations.md)
- [了解如何修正建议](security-center-remediate-recommendations.md)