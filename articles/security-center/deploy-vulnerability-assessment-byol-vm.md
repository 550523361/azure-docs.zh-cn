---
title: Azure 安全中心中的 BYOL VM 漏洞评估
description: 在 Azure 虚拟机上部署 BYOL 漏洞评估解决方案，以便在 Azure 安全中心获取有助于保护虚拟机的建议。
services: security-center
documentationcenter: na
author: memildin
manager: rkarlin
ms.service: security-center
ms.devlang: na
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/22/2020
ms.author: memildin
ms.openlocfilehash: 598eb2295196ec767bc6abe7468ab31c73d208d0
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/09/2020
ms.locfileid: "91449482"
---
# <a name="deploy-a-bring-your-own-license-byol-vulnerability-assessment-solution"></a>部署自带许可证 (BYOL) 漏洞评估解决方案

如果已为服务器启用了 **Azure Defender**，则可以使用 Azure 安全中心的内置漏洞评估工具，如 [虚拟机的集成漏洞扫描程序](built-in-vulnerability-assessment.md)中所述。 此工具已集成到 Azure Defender 中，无需任何外部许可证-所有内容都在安全中心内无缝处理。

或者，你可能想要从 [Qualys](https://www.qualys.com/lp/azure) 或 [Rapid7](https://www.rapid7.com/products/insightvm/) 部署你自己的专用许可漏洞评估解决方案。 可以在属于同一订阅的多个 VM 上安装这些合作伙伴解决方案之一。

## <a name="deploy-a-byol-solution-from-the-azure-portal"></a>从 Azure 门户部署 BYOL 解决方案

BYOL 选项指支持的第三方漏洞评估解决方案。 目前，Qualys 和 Rapid7 都是支持的提供程序。

支持的解决方案会向合作伙伴的管理平台报告漏洞数据。 反过来，该平台也会向安全中心提供漏洞和运行状况监视数据。 可以在安全中心仪表板上标识易受攻击的 Vm，并直接从安全中心切换到合作伙伴管理控制台，获取其他报表和信息。

1. 在 [Azure 门户](https://azure.microsoft.com/features/azure-portal/)中，打开“安全中心”。

1. 在安全中心的菜单中，打开 " **建议** " 页。

1. 选择建议在 **虚拟机上启用漏洞评估解决方案**。

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png" alt-text="应在虚拟机上启用 &quot;安全漏洞评估&quot; 解决方案中的计算机分组 * * 建议页面" lightbox="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png":::

    你的 VM 将出现在以下一个或多个组中：

    * **正常资源** –安全中心检测到在这些 vm 上运行的漏洞评估解决方案。
    * 不**正常资源**–可以将漏洞扫描程序扩展部署到这些 vm。 
    * **不适用的资源** -这些 vm 不能部署漏洞扫描程序扩展。

1. 在不正常的计算机列表中，选择要接收漏洞评估解决方案的计算机，然后选择 " **更正**"。

    >[!IMPORTANT]
    > 根据您的配置，您可能只会看到此列表的子集。 
    >
    > - 如果尚未配置第三方漏洞扫描程序，则无法进行部署。
    > - 如果所选 Vm 未使用 Azure Defender 进行保护，则 "ASC 集成漏洞扫描程序" 选项将不可用。

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-remediation-options.png" alt-text="应在虚拟机上启用 &quot;安全漏洞评估&quot; 解决方案中的计算机分组 * * 建议页面" **部署已配置的第三方漏洞扫描程序**"，然后 **继续**。

在目标计算机上安装漏洞评估解决方案后，安全中心会执行扫描以检测和识别系统和应用程序中的漏洞。 完成第一次扫描可能需要数小时。 之后，它每小时运行一次。



## <a name="deploy-a-byol-solution-using-powershell-and-the-rest-api"></a>使用 PowerShell 和 REST API 部署 BYOL 解决方案

若要以编程方式从 [Qualys](https://www.qualys.com/lp/azure) 或 [Rapid7](https://www.rapid7.com/products/insightvm/)部署你自己的私有许可漏洞评估解决方案，请使用提供的脚本 [PowerShell > 漏洞解决方案](https://github.com/Azure/Azure-Security-Center/tree/master/Powershell%20scripts/Vulnerability%20Solution)。 此脚本使用 REST API 在 ASC 中创建新的安全解决方案。 你将需要一个许可证和服务提供商提供的密钥， (Qualys 或 Rapid7) 。

> [!IMPORTANT] 
> 每个许可证只能创建一个解决方案。 尝试使用同一名称/许可证/密钥创建另一个解决方案将会失败。

### <a name="prerequisites"></a>必备条件

所需的 PowerShell 模块：

- 安装模块 Az
- 安装模块 Az. security

### <a name="run-the-script"></a>运行脚本

若要运行该脚本，需要以下参数的相关信息。

| **参数** | **必需** | **说明** |
|----|:----:|----|
|**SubscriptionId**|✔|包含要分析的资源的 Azure 订阅的 subscriptionID。|
|**ResourceGroupName**|✔|资源组的名称。 使用任何现有的资源组，包括默认 ( "DefaultResourceGroup-xxx" ) 。 由于解决方案不是 Azure 资源，因此它不会列在资源组中，但仍附加到该资源组。|
|**vaSolutionName**|✔|新解决方案的名称。|
|**vaType**|✔|Qualys 或 Rapid7。|
|**licenceCode**|✔|供应商提供的许可字符串。|
|**publicKey**|✔|供应商提供的公钥。|
|**更新**|-|启用 (true) 或禁用此 VA 解决方案) 自动部署 (false。 启用后，订阅中的每个新 VM 将自动尝试链接到该解决方案。<br/>（默认值：False）|
||||

语法：

```azurepowershell
.\New-ASCVASolution.ps1 -subscriptionId <Subscription Id> -resourceGroupName <RG Name>
-vaSolutionName <New solution name> -vaType <Qualys / Rapid7> -autoUpdate <true/false>
-licenceCode <License code from vendor> -publicKey <Public Key received from vendor>
```

示例 (本示例不包括) 有效的许可证详细信息：

```azurepowershell
.\New-ASCVASolution.ps1 -subscriptionId 'f4cx1b69-dtgb-4ch6-6y6f-ea2e95373d3b' -resourceGroupName 'DefaultResourceGroup-WEU' -vaSolutionName 'QualysVa001' -vaType 'Qualys' -autoUpdate 'false' `
-licenceCode 'eyJjaWQiOiJkZDg5OTYzXe4iMTMzLWM4NTAtODM5FD2mZWM1N2Q3ZGU5MjgiLCJgbTYuOiIyMmM5NDg3MS1lNTVkLTQ1OGItYjhlMC03OTRhMmM3YWM1ZGQiLCJwd3NVcmwiOiJodHRwczovL3FhZ3B1YmxpYy1wMDEuaW50LnF1YWx5cy5jb20vQ2xvdSKJY6VudC8iLCJwd3NQb3J0IjoiNDQzIn0=' `
-publicKey 'MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCOiOLXjOywMfLZIBGPZLwSocf1Q64GASLK9OHFEmanBl1nkJhZDrZ4YD5lM98fThYbAx1Rde2iYV1ze/wDlX4cIvFAyXuN7HbdkeIlBl6vWXEBZpUU17bOdJOUGolzEzNBhtxi/elEZLghq9Chmah82me/okGMIhJJsCiTtglVQIDAQAB'
```

## <a name="next-steps"></a>后续步骤

> [!div class="nextstepaction"]
> [修正漏洞评估解决方案中的发现](remediate-vulnerability-findings-vm.md)


安全中心还为以下内容提供漏洞分析：

- SQL 数据库 - 请参阅[在漏洞评估仪表板中浏览漏洞评估报告](defender-for-sql-usage.md#explore-vulnerability-assessment-reports)
- Azure 容器注册表映像-请参阅 [使用 Azure Defender 容器注册表扫描映像中的漏洞](defender-for-container-registries-usage.md)