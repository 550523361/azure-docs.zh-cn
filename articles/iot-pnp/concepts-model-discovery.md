---
title: 实现 IoT 即插即用预览模型发现 |微软文档
description: 作为解决方案开发人员，了解如何在解决方案中实现 IoT 即插即用模型发现。
author: ChrisGMsft
ms.author: chrisgre
ms.date: 12/26/2019
ms.topic: conceptual
ms.custom: mvc
ms.service: iot-pnp
services: iot-pnp
manager: philmea
ms.openlocfilehash: 66da0321930ac38217a336380c9889963a433e67
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/27/2020
ms.locfileid: "75531354"
---
# <a name="implement-iot-plug-and-play-preview-model-discovery-in-an-iot-solution"></a>在 IoT 解决方案中实现 IoT 即插即用预览模型发现

本文介绍，作为解决方案开发人员，如何在 IoT 解决方案中实现 IoT 即插即用预览模型发现。  IoT 即插即用模型发现是 IoT 即插即用设备如何识别其支持的功能模型和接口，以及 IoT 解决方案如何检索这些功能模型和接口。

IoT 解决方案分为两大类：专门构建的解决方案与一组已知的 IoT 即插即用设备配合使用，以及适用于任何 IoT 即插即用设备的模型驱动解决方案。

此概念文章介绍如何在这两种类型的解决方案中实现模型发现。

## <a name="model-discovery"></a>模型发现

当 IoT 即插即用设备首次连接到 IoT 中心时，它会发送模型信息遥测消息。 此消息包括设备实现的接口的 IT。 要使解决方案与设备配合使用，它必须解析这些 IT 并检索每个接口的定义。

以下是 IoT 即插即用设备使用设备预配服务 （DPS） 连接到集线器时采取的步骤：

1. 打开设备后，它将连接到 DPS 的全局端点，并使用允许的方法之一进行身份验证。
1. 然后，DPS 对设备进行身份验证，并查找告知其将设备分配给哪个 IoT 中心的规则。 然后，DPS 将设备注册到该集线器。
1. DPS 将 IoT 中心连接字符串返回给设备。
1. 然后，设备向 IoT 中心发送发现遥测消息。 发现遥测消息包含设备实现的接口的 IT。
1. IoT 即插即用设备现已准备好使用使用 IoT 中心的解决方案。

如果设备直接连接到 IoT 中心，则使用嵌入在设备代码中的连接字符串进行连接。 然后，设备向 IoT 中心发送发现遥测消息。

请参阅[模型信息](concepts-common-interfaces.md)界面，了解有关模型信息遥测消息的详细信息。

### <a name="purpose-built-iot-solutions"></a>专门构建的物联网解决方案

专门构建的 IoT 解决方案可与一组已知的 IoT 即插即用设备功能模型和接口配合使用。

您将获得将提前连接到解决方案的设备的功能模型和接口。 使用以下步骤准备解决方案：

1. 将接口 JSON 文件存储在 Azure 中，以便解决方案可以读取它们。
1. 基于预期的 IoT 即插即用功能模型和接口，在 IoT 解决方案中编写逻辑。
1. 订阅来自解决方案使用的 IoT 中心的通知。

收到新设备连接的通知时，请按照以下步骤操作：

1. 读取发现遥测消息，以检索设备实现的功能模型和接口的 I。
1. 将功能模型的 ID 与您提前存储的功能模型的 ID 进行比较。
1. 现在，您知道已连接了哪种类型的设备。 使用您之前编写的逻辑，使用户能够与设备进行适当的交互。

### <a name="model-driven-solutions"></a>模型驱动解决方案

模型驱动的 IoT 解决方案可用于任何 IoT 即插即用设备。 构建模型驱动的 IoT 解决方案更为复杂，但好处是您的解决方案适用于将来添加的任何设备。

要构建模型驱动的 IoT 解决方案，您需要根据 IoT 即插即用接口基元构建逻辑：遥测、属性和命令。 IoT 解决方案的逻辑通过组合多个遥测、属性和命令功能来表示设备。

您的解决方案还必须订阅来自它使用的 IoT 中心的通知。

当您的解决方案收到有关新设备连接的通知时，请按照以下步骤操作：

1. 读取发现遥测消息，以检索设备实现的功能模型和接口的 I。
1. 对于每个 ID，请阅读完整的 JSON 文件以查找设备的功能。
1. 检查每个接口是否存在于为存储解决方案之前检索的 JSON 文件而构建的任何缓存中。
1. 然后，检查公共模型存储库中是否存在具有该 ID 的接口。 有关详细信息，请参阅[公共模型存储库](howto-manage-models.md)。
1. 如果公共模型存储库中不存在该接口，请尝试在解决方案已知的任何公司模型存储库中查找该接口。 您需要一个连接字符串来访问公司模型存储库。 有关详细信息，请参阅[公司模型存储库](howto-manage-models.md)。
1. 如果在公共模型存储库或公司模型存储库中找不到所有接口，则可以检查设备是否可以提供接口定义。 设备可以实现标准[ModelDefinition](concepts-common-interfaces.md)接口，以发布有关如何使用命令检索接口文件的信息。
1. 如果找到设备实现的每个接口的 JSON 文件，则可以枚举设备的功能。 使用您之前编写的逻辑使用户能够与设备交互。
1. 您可以随时调用数字孪生 API 来检索设备的功能模型 ID 和接口 ID。

## <a name="next-steps"></a>后续步骤

现在，您已经了解了模型发现 IoT 解决方案，请详细了解 Azure [IoT 平台](overview-iot-plug-and-play.md)，以利用其他功能进行解决方案。
