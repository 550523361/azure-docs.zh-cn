---
title: 如何创建自定义语音字体
titlesuffix: Azure Cognitive Services
description: 本文概述了文本转语音这一语音自定义功能，说明如何通过该功能创建可识别的特色语音。
services: cognitive-services
author: PanosPeriorellis
manager: nitinme
ms.service: cognitive-services
ms.subservice: speech-service
ms.topic: conceptual
ms.date: 01/28/2019
ms.author: panosper
ms.openlocfilehash: 24b98ce8cd2c587f0d39390954eb8a64747ca2ab
ms.sourcegitcommit: 90cec6cccf303ad4767a343ce00befba020a10f6
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/07/2019
ms.locfileid: "55868321"
---
# <a name="creating-custom-voice-fonts"></a>创建自定义语音字体

使用文本转语音 (TTS) 语音自定义功能可以创建可识别的特色语音，该语音带有你的特色：语音字体。

若要创建语音字体，请先进行录音，然后将关联的脚本以训练数据的形式上传。 然后，此服务会根据你的录音创建唯一的语音模型。 然后，你就可以使用此语音字体来合成语音。

一开始可以使用少量数据进行概念证明。 不过，提供的数据越多，语音听起来越自然，越专业。

## <a name="prerequisites"></a>先决条件

需要一个 Azure 帐户和语音服务的订阅。 如果还没有该订阅，请[创建一个](https://docs.microsoft.com/azure/cognitive-services/speech-service/get-started)。 将订阅连接到自定义语音门户，如此处所示。

1. 通过申请访问时使用过的 Microsoft 帐户登录到[自定义语音门户](https://customvoice.ai)。

2. 在右上角的帐户名称下，转到“订阅”。

    ![订阅](media/custom-voice/subscriptions.png)

3. 在“订阅”页上，选择“连接现有订阅”。 请注意，语音服务支持不同的区域。 检查创建订阅密钥的区域，并确保将密钥连接到正确的子门户。  

4. 将订阅密钥粘贴到表中，如以下示例中所示。 每个订阅都有两个密钥，可使用其中任意一个。

     ![添加订阅](media/custom-voice/add-subscription.png)

你已准备就绪！

## <a name="prepare-recordings-and-transcripts"></a>准备录音和脚本

语音训练数据集包含一组音频文件，以及一个文本文件，其中包含这些音频文件的脚本。

可以采用两种方式来准备这些文件。 先撰写脚本，然后让语音专家朗读该脚本；或者使用公开提供的音频，然后将其转录成文本。 如果是后一种情况，请编辑音频文件中的不流畅之处，例如“嗯”之类的无意义声音、口吃音、喃喃自语或错读音。

若要生成好的语音字体，请在安静的房间中使用高品质麦克风进行录制。 若要生成良好的数字语音，必须确保使用一致的音量、语速、语调以及有表现力的语音方式。

若要创建生产用的语音，建议使用专业录音棚和语音专家。 有关详细信息，请参阅[如何录制自定义语音的语音示例](record-custom-voice-samples.md)。

### <a name="audio-files"></a>音频文件

每个音频文件应包含一个表述（例如，一个句子，或者对话系统的一个轮次）。 所有文件必须使用相同的语言。 （不支持多语言自定义语音。）每个音频文件还必须有唯一的带文件名扩展名 `.wav` 的数字文件名。

音频文件应按如下方式准备。 其他格式不受支持，会被拒绝。

| **属性** | **值** |
| ------------ | --------- |
| 文件格式  | RIFF (.wav)|
| 采样率| 至少 16,000 Hz |
| 示例格式| PCM，16 位 |
| 文件名    | 数字，带 `.wav` 扩展名 |
| 存档格式| .zip      |
| 最大存档大小|200 MB|

> [!NOTE]
> 采样率低于 16,000 Hz 的 .wav 文件将被拒绝。 如果 .zip 文件包含具有不同采样率的波形，只会导入等于或高于 16,000 Hz 的波形。
> 门户目前可以导入的 .zip 存档最多只能为 200 MB。 但是，可以上传多个存档。 至于允许的最大数据集数目，免费订阅用户为 10 个 .zip 文件，标准订阅用户为 50 个。

### <a name="transcripts"></a>脚本

听录文件是纯文本文件（ANSI、UTF-8、UTF-8-BOM、UTF-16-LE 或 UTF-16-BE）。 听录文件的每一行都必须有音频文件的名称，后跟制表符（码位为 9），最后是脚本。 不允许使用空行。

例如：

```
0000000001  This is the waistline, and it's falling.
0000000002  We have trouble scoring.
0000000003  It was Janet Maslin.
```

自定义语音系统会将文本转换为小写并删除多余的标点，使脚本规范化。 必须确保脚本是相应音频录制内容的完全准确的听录。

> [!TIP]
> 如果生成生产型“文本转语音”语音，请在选择表述（或撰写脚本）时既要考虑到语音覆盖率，又要考虑到效率。 无法获得所需的结果？ [与自定义语音团队联系](mailto:speechsupport@microsoft.com)以了解有关让我们咨询的更多信息。

## <a name="upload-your-datasets"></a>上传数据集

准备好音频文件存档和脚本以后，请通过[自定义语音服务门户](https://customvoice.ai)上传它们。

> [!NOTE]
> 数据集在上传后不能编辑。 例如，如果忘记包括某些音频文件的脚本，或者意外地选择了错误的性别，则必须再次上传整个数据集。 在上传之前，请仔细检查数据集和设置。

1. 登录到门户。

2. 在主页的“自定义语音”下选择“数据”。   

    此时会显示“我的语音”表。 如果尚未上传任何语音数据集，则它是空的。

3. 若要打开用于上传新数据集的页面，请选择“导入数据”。

    ![导入语音数据](media/custom-voice/import-voice-data.png)

4. 在提供的字段中输入名称和说明。

5. 选择语音字体的区域设置。 确保区域设置信息与录制数据和脚本的语言相符。

6. 选择要使用其语音的朗读者的性别。

7. 选择要上传的脚本和音频文件。

8. 选择“导入”以上传数据。 导入大型数据集可能需要几分钟的时间。

> [!NOTE]
> 免费订阅用户可以一次上传两个数据集。 标准订阅用户可以同时上传五个数据集。 如果达到限制，请先等待，直至至少其中一个数据集导入完毕。 然后重试。

上传完成后，会再次显示“我的语音数据”表。 此时会看到一个与刚上传的数据集相对应的条目。

数据集在上传后会自动进行验证。 数据验证包括针对音频文件执行一系列检查以验证文件格式、大小和采样率。 针对听录文件执行检查时，会验证文件格式并执行一些文本规范化操作。 话语是使用语音识别转录的。 然后，生成的文本将与提供的脚本进行比较。

![我的语音数据](media/custom-voice/my-voice-data.png)

下表显示了已导入数据集的处理状态：

| 状态 | 含义
| ----- | -------
| `NotStarted` | 数据集已收到，正在排队等候处理。
| `Running` | 数据集正在接受验证。
| `Succeeded` | 数据集已验证，现在可以用来生成语音字体了。

验证完成后，可以在“话语”列中看到每个数据集的已匹配话语总数。

可以下载一个报告，检查每个录音的发音分数和噪音级别。 发音评分范围为 0 到 100。 评分低于 70 通常表示语音错误或脚本不匹配。 口音重可能会降低发音分数，影响生成的数字语音。

信噪比 (SNR) 高表明音频中的噪音少。 通过专业录音棚录音通常可以达到 50+ 的 SNR。 音频的 SNR 低于 20 可能导致生成的语音中出现明显的噪音。

考虑重写录制发音分数低或信噪比不佳的表述。 如果无法重新录制，可以从数据集中排除这些话语。

## <a name="build-your-voice-font"></a>生成语音字体

数据集经过验证后，可用它来生成自定义语音字体。

1.  在“自定义语音”下拉菜单中选择“模型”。

    此时会显示“我的语音字体”表，其中会列出已创建的任何自定义语音字体。

1. 在表标题下单击“创建语音”。

    此时会显示用于创建语音字体的页面。 表的第一行中会显示当前的区域设置。 更改区域设置，以另一种语言创建语音。 区域设置必须与用来创建语音的数据集保持一致。

1. 就像上传数据集时所做的那样，输入用于标识此模型的名称和说明。

    请谨慎选择名称。 此处输入的名称将是在 SSML 输入过程中在请求中指定语音合成所需语音时使用的名称。 只允许字母、数字以及一些标点字符，例如 `-`、`_` 和 `(', ')`。

    通常使用“说明”字段来记录创建模型时所使用的数据集的名称。

1. 选择语音字体的性别。 它必须与数据集的性别相符。

1. 选择需要用来训练语音字体的数据集。 使用的所有数据集必须源自同一朗读者。

1. 单击“创建”，开始创建语音字体。

    ![创建模型](media/custom-voice/create-model.png)

新模型会显示在“我的语音字体”表中。

![我的语音字体](media/custom-voice/my-voice-fonts.png)

显示的状态反映了将数据集转换为语音字体的过程，如下所示。

| 状态 | 含义
| ----- | -------
| `NotStarted` | 创建语音字体的请求正在排队等候处理。
| `Running` | 语音字体正在创建。
| `Succeeded` | 语音字体已创建，可以部署了。

训练时间因处理的音频数据量而异。 通常情况下，处理数百个表述需要大约 30 分钟的时间，处理 20,000 个表述需要 40 小时。

> [!NOTE]
> 免费订阅用户一次可以定型一种语音字体。 标准订阅用户可以同时训练三种语音。 如果达到限制，请先等待，直至至少其中一种语音字体训练完毕，然后再试。

## <a name="test-your-voice-font"></a>测试语音字体

成功生成语音字体以后，可以对其先测试后部署，然后就可以使用了。 在“操作”列中选择“测试”。 此时会显示所选语音字体对应的测试页。 如果尚未提交任何语音测试请求，则此表为空。

若要显示用于提交文本请求的弹出菜单，请在表标题下选择“使用文本进行测试”按钮。 可以以纯文本或 SSML 格式提交测试请求。 最大输入大小为 1,024 个字符，包括 SSML 请求的所有标记。 文本的语言必须与语音字体的语言相同。

在文本框中进行填充并确认输入模式以后，请选择“是”，以便提交测试请求并返回到测试页。 表中现在会有新请求的对应条目以及状态列。 可能需要数分钟来合成语音。 状态列显示“成功”后，即可下载文本输入（`.txt` 文件）和音频输出（`.wav` 文件），然后试听后者以检查其质量。

## <a name="create-and-use-a-custom-endpoint"></a>创建并使用自定义终结点

成功创建并测试语音模型以后，即可在自定义的文本转语音终结点中部署它。 然后即可在通过 REST API 发出文本转语音请求时使用此终结点来替代常用的终结点。 只能通过部署字体时所用的订阅来调用自定义终结点。

若要创建新的自定义终结点，请从页面顶部的“自定义语音”菜单中选择“终结点”。 此时会显示“我的已部署语音”页，其中的表包含当前的自定义语音终结点（如果有）。 表的第一行中会反映当前的区域设置。 若要为其他语言创建部署，请更改显示的区域设置。 （它必须与要部署的语言匹配。）

若要创建新的终结点，请选择“部署语音”按钮。 输入自定义终结点的“名称”和“说明”。

从“订阅”菜单上，选择要使用的订阅。 免费订阅用户一次只能部署一个模型。 标准订阅用户可以创建多达 20 个终结点，每个都有其自己的自定义语音。

![创建终结点](media/custom-voice/create-endpoint.png)

选择要部署的模型后，请选择“创建”。 “我的已部署语音”页会再次显示，这次有一个对应于新终结点的条目。 新终结点的实例化可能需要数分钟。 当部署状态为“成功”时，终结点便可供使用。

![我的已部署语音](media/custom-voice/my-deployed-voices.png)

当部署状态为“成功”时，已部署语音字体的终结点会显示在“我的已部署语音”表中。 可以直接在 HTTP 请求中使用此 URI。

也可通过自定义语音门户对终结点进行联机测试。 若要测试终结点，请从“自定义语音”下拉菜单中选择“终结点测试”。 此时会显示终结点测试页。 选择已部署的自定义语音，然后在文本框中输入要朗读的文本（采用纯文本或 SSML 格式）。

> [!NOTE]
> 使用 SSML 时，`<voice>` 标记必须指定一个名称，该名称是在创建自定义语音时提供给自定义语音的。 如果提交纯文本，则始终使用自定义语音。

若要收听以自定义语音字体朗读的文本，请选择“播放”。

![终结点测试](media/custom-voice/endpoint-testing.png)

从功能上说，自定义终结点与用于文本转语音请求的标准终结点相同。 有关详细信息，请参阅 [REST API](rest-apis.md)。

## <a name="language-support"></a>语言支持

可以使用以下语言进行语音自定义：

| 语言 | 区域设置 |
|----------|--------|
| 中文(中国) | zh-CN |
| 英语(美国) | en-US |
| 法语 | fr-FR |
| 德语 | de-DE |
| 意大利语 | it-IT |

> [!NOTE]
> 法语、德语和意大利语音训练从包含 2,000 多条话语的数据集开始。 中英双语模型也支持 2000 多句话语的数据集。

## <a name="next-steps"></a>后续步骤

- [获取语音试用订阅](https://azure.microsoft.com/try/cognitive-services/)
- [录制语音样本](record-custom-voice-samples.md)
