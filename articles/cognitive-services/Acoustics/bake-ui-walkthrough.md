---
title: 使用 Project Acoustics 制作音效 - 认知服务
description: 本文档介绍使用 Unity 编辑器扩展提交音效制作的过程。
services: cognitive-services
author: kegodin
manager: noelc
ms.service: cognitive-services
ms.component: acoustics
ms.topic: article
ms.date: 08/17/2018
ms.author: kegodin
ms.openlocfilehash: 0e16ec765ae3cbef8a941f43a149428ffdf5bd8d
ms.sourcegitcommit: 1aedb52f221fb2a6e7ad0b0930b4c74db354a569
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/17/2018
ms.locfileid: "40181161"
---
# <a name="bake-acoustics"></a>制作音效

本文档介绍使用 Unity 编辑器扩展提交音效制作的过程。 有关音效的更多背景知识，请参阅[什么是音效](what-is-acoustics.md)。 如需快速入门指南，请参阅[入门](getting-started.md)。

## <a name="import-the-plugin"></a>导入插件

将 Acoustics 插件包导入项目。 然后通过选择 Unity 菜单中的“窗口”>“音效”，打开音效 UI：

![打开“音效”窗口](media/WindowAcoustics.png)

## <a name="principles"></a>原理

Acoustics 工具窗口收集音效引擎计算场景音效所需的信息。 制作过程包括 5 个步骤：

1. 创建或标记播放器导航网格
2. 标记声学几何体
3. 将音效材料属性分配给几何体
4. 预览探测放置
5. 制作

制作完成后，请参阅[音效设计过程概述](design-process.md)，了解可选的制作设计后期步骤。

## <a name="create-or-mark-a-navigation-mesh"></a>创建或标记导航网格

导航网格用于放置模拟的探测点。 可以使用 Unity 的[导航网格工作流](https://docs.unity3d.com/Manual/nav-BuildingNavMesh.html)，也可以指定自己的导航网格。 音效系统选取使用 Unity 的工作流创建的导航网格。 要使用自己的网格，请在“对象”选项卡中标记它们，如下面的步骤中所述。

## <a name="objects-tab"></a>“对象”选项卡

打开“音效”窗口的“对象”选项卡。 使用此选项卡标记场景中的对象，只是将 AcousticsGeometry 或 AcousticsNavigation 组件添加到该对象。 此外，还可以使用[标准 Unity 组件工作流](https://docs.unity3d.com/Manual/UsingComponents.html)标记或取消标记对象。

如下所述，选择场景窗口或层次结构中的一个或多个对象，然后针对 AcousticsGeometry 或 AcousticsNavigation 标记或取消标记该对象。 如果未选择任何对象，可以同时标记或取消标记场景中的所有对象。

只能标记网格呈现器和地形。 系统会忽略其他所有对象类型。 复选框会标记或取消标记受影响的所有对象。

如果未选择场景中的任何对象，将如下图所示：

![“对象”选项卡 无选定内容](media/ObjectsTabNoSelectionDetail.png)

如果选择了场景或层次结构窗口中的某些对象，将如下图所示：

![“对象”选项卡 无选定内容](media/ObjectsTabWithSelectionDetail.png)

### <a name="objects-tab-parts"></a>“对象”选项卡控件部件

选项卡页的控件部件有：

1. 选项卡选择按钮（已选择“对象”选项卡）。 使用这些按钮可从左到右演示进行音效制作的各个步骤。
2. 有关使用此页面需要执行的操作的简短说明。
3. 层次结构窗口的适用筛选器。 使用该筛选器可按指定类型的对象筛选层次结构窗口，以便更轻松标记这些窗口。 如果还没有为音效标记任何对象，选择最后两个选项不会显示任何内容。 但是如果进行了标记，则它们可用于查找标记的对象。
4. 如果未选择任何对象，本部分则显示场景中所有对象的状态：
    * 总计 - 场景中活动的非隐藏对象的总数。
    * 忽略 - 非 Mesh Renderer 或 Terrain 对象的数目。
    * 网格 - 场景中 Mesh Renderer 对象的数目
    * 地形 - 场景中 Terrain 对象的数目
    * 几何体 - 场景中标记为“声学几何体”的 Mesh 或 Terrain 对象的数目
    * 导航 - 场景中标记为“音效导航”的 Mesh 或 Terrain 对象的数目。 该数目不包括 Unity 的 NavMesh。
5. 显示场景中“可标记”对象的总数，该对象仅限 Mesh Renderer 和 Terrain。 显示可用于为音效将这些对象标记（向其添加相应的组件）为几何体或导航的复选框
6. 若未选择任何对象，在需要时，此说明可提醒选择对象进行标记。 此外，还可以选中一个或两个复选框以标记场景中的所有对象，无需选择所有对象。
7. 若已选择某些对象，本部分则仅显示场景中所选对象的状态。
8. 显示“可标记”选定对象的总数。 选中或取消选中复选框将仅标记或取消标记选定对象。

如果部分对象已标记，部分未标记，相应的复选框则显示“混合”值：

![混合值复选框](media/MixedObjectSelectionDetail.png)

单击复选框可强制标记所有对象，再次单击可取消标记所有对象。

可同时为几何体和导航标记对象。

### <a name="guidelines-for-marking-objects"></a>标记对象指南

如果对象应该遮蔽、反射或吸收声音，请务必将其标记为“声学几何体”。 声学几何体可以包括地面、墙壁、屋顶、窗户、窗户玻璃、地毯和大型家具等物体。 可以添加较小的物体，例如灯、装饰物品、灯具等，因为它们不会明显增加制作成本。 请务必不要遗漏地面或天花板等主要元素。 此外，不要添加不应影响音效（例如冲突网格）的物体。

制作结果中修复了对象在（通过下面的“探测”选项卡）探测计算时的转换。 移动场景中任何标记的对象都需要重做探测计算并重做场景。

## <a name="materials-tab"></a>“材料”选项卡

对象标记后，单击“材料”按钮可转到“材料”选项卡。

### <a name="parts-of-the-materials-tab"></a>“材料”选项卡的控件部件

![“材料”选项卡详细信息](media/MaterialsTabDetail.png)

1. “材料”选项卡按钮，用于打开此页面。
2. 有关使用此页面需要执行的操作的简短说明。
3. 选中后，仅列出标记为“声学几何体”的对象所用的材料。 否则，将列出场景中使用的所有材料。
4. 使用以下选项可更改单击下方“音效”列 (#6) 中的下拉列表时所示下拉列表菜单的顺序。 “名称”按名称对音效材料进行排序。 “吸收能力”按吸收能力从低到高对材料进行排序。
5. 场景中所用的材料列表，按字母顺序排序。 如果已选中“仅显示已标记”复选框 (#3)，则仅显示标记为“声学几何体”的对象所用的材料。 此时单击材料可选择场景中使用该材料的所有对象。
6. 显示已分配给场景材料的声学材料。 单击下拉列表，向其他声学材料重新分配场景材料。 使用上方的“音效排序依据:”选项 (#4) 可更改单击此处的项目时所示的菜单排序顺序。
7. 显示上一列中所选材料的噪音吸收系数。 值为零表示完美反射（无吸收），而值为 1 表示完美吸收（无反射）。 吸收系数无法更改，除非所选材料为“自定义”。
8. 若材料已分配给“自定义”，则滑块不再禁用，可以使用滑块或键入值来选择吸收系数。 有关材料属性的详细信息，请参阅[音效设计过程概述](design-process.md)。

### <a name="guidelines-for-assigning-materials-or-absorption-values"></a>分配材料（或吸收值）指南

此选项卡尝试根据名称猜测吸收材料。 例如，如果你的场景材料名为 LivingRoom_WoodTable，则分配给它的初始声学材料为“木头”。 若材料无法确定为某种已知材料，则向其分配具有类似混凝土的吸音效果的“默认”材料。

可以向每个场景材料重新分配声学材料。 例如，如果房间回音过大，请将墙壁、地板或天花板的声学材料更改为吸收率更高的某种材料。 声学材料分配适用于所有使用该场景材料的对象。

## <a name="probes-tab"></a>“探测”选项卡

分配材料后，切换到“探测”选项卡。

### <a name="parts-of-the-probes-tab"></a>“探测”选项卡的控件部件

![“探测”选项卡详细信息](media/ProbesTabDetail.png)

1. “探测”选项卡按钮，用于打开此页面
2. 有关需要使用此页面执行的操作的简短说明
3. 使用它们可选择粗糙或精细分辨率。 粗糙分辨率的速度更快，但需要进行某种权衡。 请参阅下方的[“粗糙与精细分辨率”](#Coarse-vs-Fine-Resolution)，了解详细信息。
4. 使用此字段，选择应该放置声学数据文件的位置。 单击具有“...”的按钮以使用文件夹选取器。 默认值为 Assets/AcousticsData。 此外，还将在此位置下创建“Editor”子文件夹。 有关数据文件的详细信息，请参阅下方的[“数据文件”](#Data-Files)。
5. 系统使用此处提供的前缀命名该场景的数据文件。 默认值为“Acoustics_[Scene Name]”。
6. 计算完探测后，将禁用上述控件。 单击“清除”按钮，清除计算并启用控件，以便可以使用新设置重新计算。
7. 单击“计算...”按钮可体素化场景并计算探测点位置。 此操作在计算机本地执行，并且必须在进行制作前完成。

在此版本的 Project Acoustics 中，不能手动放置探测，必须通过“探测”选项卡中提供的自动化进程进行放置。

### <a name="what-the-calculate-button-calculates"></a>“计算...”按钮计算的内容

“计算...”按钮采用到目前为止提供的所有数据（几何体、导航、材料和粗糙/精细设置）并执行以下几个步骤：

1. 它采用场景网格中的几何体并计算体素体。 体素体是一个三维体，包含整个场景，并由较小的立方“体素”组成。 体素的大小由模拟频率决定，而模拟频率通过“模拟分辨率”设置进行设定。 每个体素都被标记为“露天”或包含场景几何体。 如果体素包含几何体，则使用分配给该几何体的材料的吸收系数标记该体素。
2. 然后它使用导航数据计算播放器可能到达的在声学上有趣的位置。 它会尝试查找少量包括较小区域的这些位置，例如门廊和走廊，然后到房间，再到开放的空间。 小型场景通常包含不到 100 个位置，而大型场景可能多达 1000 个位置。
3. 对于它计算的每个最终侦听器位置，它将确定多个参数，例如空间“开阔”程度如何，所在房间的大小等等。
4. 这些计算的结果存储在指定位置的文件中（请参阅下方的[“数据文件”](#Data-Files)）

这些计算可能需要几分钟，具体取决于场景的大小和计算机的速度。

这些计算完成后，便可以预览体素数据和探测点的位置，以帮助确保制作结果良好。 在预览中一般可以快速显示错误的导航网格或缺失/额外的几何体等内容，以便可以进行纠正。

### <a name="scene-rename"></a>场景重命名

场景名称用于连接场景和存储探测点放置和体素化的文件。 如果在计算探测点后重命名场景，材料的分配和放置数据将丢失，应重新运行。

## <a name="debug-display-through-gizmos"></a>通过 Gizmos 调试显示

默认情况下，将同时开启“探测”和“体素”gizmos。 此操作可显示所计算的体素和探测点的位置。 使用 Gizmos 菜单可以启用或禁用它们：

![Gizmos 菜单](media/GizmosMenu.png)

### <a name="voxels"></a>体素

体素以参与几何体周围的绿色立方体的形式显示在场景窗口中。 不显示仅包含空气的体素。 整个场景周围有一个大型的绿色框，表示将用于模拟的完整体素体。
在场景中移动并验证应该为几何体的所有内容均包含体素。 场景照相机必须在对象 5 米范围内，以便体素显示。

如果比较使用粗糙分辨率和精细分辨率创建的体素，就会发现粗糙体素为两倍大小。

![体素预览](media/VoxelCubesPreview.png)

### <a name="probe-points"></a>探测点

探测点是可能的播放器（侦听器）位置的代名词。 执行制作时，针对每个探测点计算场景中任意位置的声源音效。 如果播放器未直接位于探测点位置，最靠近播放器的探测点的数据将用于在该位置内插参数。

因此，请务必确保探测点存在于场景中播放器应该行走的任意位置，并且充分表示较小的区域和门廊。 Project Acoustics 引擎根据场景的几何体解释放置探测点，探测点无法移动或在此设计器预览版中编辑。 请改为使用它们验证几何体标记和导航提示数据的正确性。

![探测预览](media/ProbesPreview.png)

### <a name="Coarse-vs-Fine-Resolution"></a>粗糙与精细分辨率

粗糙和精细分辨率设置之间的唯一区别是执行模拟的频率。 精细所用频率是粗糙的两倍。
虽然这看似简单，但它对声学模拟具有多种影响：

* 粗糙的波段是精细的两倍，因此体素大小也是两倍。
* 模拟时间与体素大小直接相关，粗糙制作比精细制作快 16 倍。
* 不能模拟小于体素大小的门户（例如门或窗户）。 粗略设置可能导致部分较小的门户无法模拟；因此，它们在运行时不会传递声音。 通过查看体素可确定是否发生该情况。
* 更低的模拟频率将减少角和边周围的衍射。
* 无法在“已填充”体素内找到声源，因为该体素包含几何体，这将导致没有声音。 定位声源更困难，因此它们不在比使用精细设置更大的粗糙设置的体素中。
* 如下所示，更大的体素将更多地挤入门户。 第一个图像是使用粗糙分辨率创建的，而第二个是使用精细分辨率创建的同一门廊。 如红色标记所示，使用精细设置可以更少地挤入门廊。 蓝色线条是几何体定义的门廊，而红色线条是体素大小定义的有效声学门户。 这种侵入如何在给定的情况下播放出来完全取决于体素与门户几何体的一致程度，后者由场景中对象的大小和位置决定。

![粗糙门廊](media/CoarseVoxelDoorway.png)

![精细门廊](media/FineVoxelDoorway.png)

## <a name="bake-tab"></a>“制作”选项卡

对预览数据满意后，使用“制作”选项卡将制作提交到云。

### <a name="parts-of-the-bake-tab"></a>“制作”选项卡的控件部件

![“制作”选项卡详细信息](media/BakeTabDetails.png)

1. “制作”选项卡，按钮用于打开此页面。
2. 有关要在此页上所执行操作的简短说明。
3. 创建 Azure 帐户后，用于输入 Azure 凭据的字段。 有关详细信息，请参阅[创建 Azure Batch 帐户](create-azure-account.md)。
4. Azure Batch 计算用于计算的节点类型。 节点类型必须受 Azure 数据中心位置支持。 如果不确定，则保留 Standard_F8。
5. 要用于此计算的节点数。 此处输入的数字将影响完成制作的时间，并受 Azure Batch 核心分配限制。 默认分配仅允许使用两个 8 核节点或一个 16 核节点，但可以进行扩展。 有关核心分配约束的详细信息，请参阅[创建 Azure Batch 帐户](create-azure-account.md)。
6. 场景的探测计数在“探测”选项卡上计算得出。探测数决定需要在云中运行的模拟次数。 不能指定多于探测数的节点数。
7. 作业在云中运行预计需要的运行时间。 这不包括节点启动时间。 作业开始运行后，这是返回结果前需要等待的时间。 请注意，这只是估计值。
8. 运行模拟所需的总计算时间。 这是 Azure 中将使用的总的节点计算时间。 有关如何使用该值的详细信息，请参阅[估计制作成本](#Estimating-bake-cost)。
9. 此消息告知了作业完成后制作结果保存的位置。
10. （仅限高级使用）如果出于某种原因需要强制 Unity 忘记已提交的制作（例如使用其他计算机下载结果），请单击“清除状态”按钮，以忘记已提交的作业。 请注意，这表示准备就绪后，将不下载结果文件，且这不同于取消作业。 如果运行，该作业将继续在云中运行。
11. 单击“制作”按钮，将制作提交到云。 运行作业时，这将改为显示“取消作业”。
12. 此区域显示制作的状态。 完成后，它应显示“已下载”。

在 [Azure 门户](https://portal.azure.com)可始终获得有关活动作业、计算池和存储空间的完整信息。

作业运行时，“制作”按钮将变为“取消作业”。 使用此按钮可取消正在进行中的作业。 取消作业前需要先进行确认。 取消作业无法撤消，不会显示任何结果，但用户仍需要为使用的任何 Azure 计算时间付费。

开始制作后，即可以关闭 Unity。 云制作可能需要数个小时，具体取决于项目、节点类型和节点数。 重新加载该项目并打开“音效”窗口时，制作作业状态将更新。 如果作业已完成，将下载输出文件。

Azure 凭据安全地存储在本地计算机上，并与 Unity 编辑器相关联。 它们仅用于建立与 Azure 的安全连接。

### <a name="Estimating-bake-cost"></a>估计制作成本

要估计给定制作的成本，请采用“估计的计算成本”中显示的值（一段持续时间），再乘以所选 VM 节点类型的每小时费用（当地货币）。 结果不包括节点启动和运行所需的节点时间。 例如，如果对节点类型选择 Standard_F8，其费用为 $0.75/小时，而“估计计算成本”为 3 小时 57 分钟，则运行作业的估计成本为 $0.75 * ~4 小时 = ~$3.00。 实际成本很可能略高，因为开始使用节点时会产生的额外时间。 在 [Azure Batch 定价](https://azure.microsoft.com/pricing/details/virtual-machines/linux)页可找到每小时的节点费用（对类别选择“优化计算”或“高性能计算”）。

### <a name="reviewing-the-bake-results"></a>查看制作结果

制作完成后，通过运行运行时插件，检查体素和探测点是否位于预期的位置。 请参阅[音效设计过程概述](design-process.md)，了解详细信息。

## <a name="Data-Files"></a>数据文件

此插件在不同位置创建了 4 个数据文件。 运行时仅需一个，因此其他三个文件位于名为“Editor”的文件夹中，因此不会编译到项目中。

* Assets/Editor/[SceneName]\_AcousticsParameters.asset：此文件存储在音效 UI 中的字段中输入的数据。 不能更改此文件的位置和名称。 此文件中存储影响制作的其他值，但它们针对高级用户且不得更改。
* Assets/AcousticsData/Acoustics\_[SceneName].ace.bytes：此文件创建于制作模拟过程中，包含运行时所用的查找数据，以呈现场景的音效。 使用“探测”选项卡上的字段可更改此文件的位置和名称。
* Assets/AcousticsData/Editor/Acoustics_[SceneName].vox：此文件存储体素化的声学几何体和材料属性。 使用“探测”选项卡上的“计算...”按钮进行计算。可以使用“探测”选项卡上的字段更改此文件的位置和名称。
* Assets/AcousticsData/Editor/Acoustics\_[SceneName]\_config.xml：此文件存储使用“探测”选项卡上的“计算...”按钮进行计算的参数。使用“探测”选项卡上的字段可更改此文件的位置和名称。

请注意，不要删除从制作中下载的 *.ace.bytes 文件。 除重新制作场景外，此文件是无法恢复的。

## <a name="next-steps"></a>后续步骤
* 将制作结果应用于[音效设计过程概述](design-process.md)中的声源。

