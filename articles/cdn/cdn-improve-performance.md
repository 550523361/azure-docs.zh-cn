<properties 
	pageTitle="CDN - 过压缩文件来提高性能" 
	description="你可以通过压缩文件来提高文件传输速度和页面加载性能。" 
	services="cdn" 
	documentationCenter=".NET" 
	authors="juliako" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="cdn" 
	ms.date="09/01/2015" 
	wacn.date=""/>

#通过压缩文件来提高性能

本主题讨论如何通过压缩文件来提高文件传输速度和页面加载性能。

CDN 可以通过两种方式来支持压缩：

- 你可以在源服务器上启用压缩，这种情况下 CDN 将默认支持压缩，会将压缩文件传递到客户端。 
- 你可以直接在 CDN 边缘服务器上启用压缩，这种情况下 CDN 会压缩文件并将其提供给最终用户。

##定义

- **Accept-Encoding** 请求标头 - 此标头指示用户代理支持的压缩方法。它必须包括在请求标头中。有关详细信息，请参阅[标头字段定义](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)。
- **内容类型** - 若要进行压缩，必须添加内容类型的列表。只有文本文件可以进行压缩。例如，文本/无格式、文本/html。
- **压缩方法** - 支持的压缩方法为 gzip/deflate/bzip2。必须在 Accept-Encoding 请求标头中设置支持的方法。 
- **缓存状态** - 缓存状态表示请求的内容是否已缓存在最接近请求者的 POP 上。  
- **文件大小** - 默认情况下，压缩仅支持大于 1 字节且小于 1MB 的文件。  

##工作流

1. 请求者发送内容请求。
2. 边缘服务器检查是否存在 **Accept-Encoding** 标头。
	1. 如果存在，则可以通过该标头来确定请求的压缩方法。
	1. 如果不存在，则该类请求会以非压缩格式提供。
3.	最接近的边缘 POP 会检查缓存状态、压缩方法以及该请求是否存在有效的 TTL。
	1.	缓存未命中：如果请求的版本未进行缓存，则会将请求转发到源。
	2.	使用相同压缩方法的缓存命中：边缘服务器会立即将压缩内容交付给客户端。
	3.	使用不同压缩方法的缓存命中：边缘服务器会通过转码将资产转换成所请求的压缩方法。 
	4.	缓存命中且未压缩：如果初始请求导致资产被缓存成未压缩的格式，则会进行检查，看请求是否有资格进行边缘服务器压缩（根据上述定义/要求部分的条件）。
		1.	如果请求符合资格，则边缘服务器会对文件进行压缩并将其提供给客户端。
		2.	如果请求不符合资格，边缘服务器会立刻将未压缩的内容交付给客户端。 

![文件压缩](./media/cdn-file-compression/cdn-compress-files.png)

##注意事项 

1. 对于启用了 CDN 的媒体服务型流式处理终结点，以下内容类型默认启用压缩：application/vnd.ms-sstr+xml、application/dash+xml、application/vnd.apple.mpegurl、application/f4m+xml。你不能通过 Azure 门户对上述类型启用/禁用压缩。  
2. 在边缘服务器上只会缓存一个文件版本（压缩或未压缩）。如果请求其他版本，则边缘服务器会对内容进行转码操作。  

<!---HONumber=74-->