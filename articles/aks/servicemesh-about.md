---
title: 关于服务网格
description: 获取服务网格的概述、其体系结构和功能，以及在选择部署时应考虑的条件。
author: paulbouwer
ms.topic: article
ms.date: 10/09/2019
ms.author: pabouwer
ms.openlocfilehash: eca49a3fac1ea0398ebe1d05bde20fbca3c81232
ms.sourcegitcommit: 99ac4a0150898ce9d3c6905cbd8b3a5537dd097e
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/25/2020
ms.locfileid: "77594305"
---
# <a name="about-service-meshes"></a>关于服务网格

服务网格向工作负荷提供诸如流量管理、复原、策略、安全性、强标识和可观察性的功能。 您的应用程序与这些操作功能分离，服务网格将它们移出应用程序层，并向下移动到基础结构层。

## <a name="scenarios"></a>方案

使用服务网格时，可以为工作负荷启用以下方案：

- **对群集中的所有流量进行加密**-启用群集中指定服务之间的相互 TLS。 这可以扩展到网络外围的入口和出口。 提供安全的默认选项，无需对应用程序代码和基础结构进行任何更改。

- "未分类"**和 "分阶段部署**"-指定要路由到群集中的一组新服务的流量子集的条件。 在测试不足发布后，删除条件路由和阶段，将所有流量逐渐增加到新服务。 最终，所有流量都将定向到新服务。

- **流量管理和操作**-在服务上创建一个策略，该策略将速率限制为来自特定源的服务的所有流量。 或策略，它将重试策略应用于指定服务之间的故障类别。 在迁移过程中将实时流量镜像到新版本的服务，或调试问题。 在测试环境中的服务之间注入错误，以测试复原能力。

- **可观察性**-深入了解服务如何连接到它们之间流动的流量。 为群集中的所有流量以及入口/出口获取指标、日志和跟踪。 向应用程序添加分布式跟踪功能。

## <a name="architecture"></a>体系结构

服务网格通常由控制平面和数据平面构成。

**控制平面**具有多个支持管理服务网格的组件。 这通常包括一个可为 UI 或 API 的管理界面。 通常，还会有一个组件，用于管理定义服务网格应如何实现特定功能的规则和策略定义。 还提供了一些组件，用于管理安全性的各个方面，如 mTLS 的强标识和证书。 服务网格还将具有从工作负荷收集和聚合指标和遥测数据的指标或可观察性组件。

**数据平面**通常包含一个代理，该代理可以透明地注入到工作负荷中的挎斗。 此代理配置为控制进出包含工作负荷的 pod 的所有网络流量。 这允许将代理配置为通过 mTLS 确保流量的安全、动态路由流量、向流量应用策略以及收集指标和跟踪信息。 

![典型服务网格体系结构](media/servicemesh/typical-architecture.png)

## <a name="capabilities"></a>功能

每个服务网格都具有很大的吻合性，重点是支持特定的方案，但你通常会发现，大多数情况下都将实现以下两个功能。

### <a name="traffic-management"></a>流量管理 

- **协议**–第7层（http、grpc）
- **动态路由**-条件、加权、镜像
- **复原能力**–超时、重试、断路熔断器
- **策略**–访问控制、速率限制、配额
- **测试**-错误注入

### <a name="security"></a>安全性

- **加密**– mTLS，证书管理，外部 CA
- **强标识**– SPIFFE 或类似
- **Auth** – authentication、授权

### <a name="observability"></a>可观察性

- **指标**-黄金指标、prometheus、grafana
- **跟踪**-跨工作负荷的跟踪
- **流量**-群集、入口/出口

### <a name="mesh"></a>交错

- **支持**的 Kubernetes、虚拟机
- **多群集**-网关，联合

## <a name="selection-criteria"></a>选择条件

选择服务网格之前，请确保了解要求以及安装服务网格的原因。 请尝试提出以下问题。

- **入口控制器是否足以满足我的需求？** -有时有一项功能（如 a/b 测试或通信拆分）足以支持所需的方案。 不要在环境中增加复杂性。

- **我的工作负荷和环境是否能容忍额外的开销？** -支持服务网格所需的所有其他组件都需要更多资源，如 cpu 和内存。 此外，所有代理及其关联的策略会检查为流量添加延迟。 如果你的工作负荷对延迟很敏感，或者无法提供额外资源来涵盖服务网格组件，请重新考虑。

- **这是否会增加额外的复杂性？** -如果安装服务网格的原因是要获取对业务团队或运营团队不一定至关重要的功能，请考虑是否值得使用额外的安装、维护和配置的复杂性。

- **是否可以采用增量方法采用这种做法？** -提供多种功能的某些服务网格可以采用更增量式的方式。 只安装所需的组件以确保成功。 如果更自信并需要其他功能，请浏览这些功能。 抵御从一开始就安装*一切*的情况。

仔细考虑后，如果你决定需要服务网格来提供所需的功能，那么下一步决定是哪种*服务网格？*

请考虑以下几个方面，其中哪些区域最符合你的要求。 这会指导你最适合你的环境和工作负荷。 "[后续步骤](#next-steps)" 部分将指导你了解有关特定服务网格及其如何映射到这些区域的详细信息。

- **技术**流量管理，策略，安全性，可观察性

- **企业**商业支持，基础（CNCF），OSS 许可证，调控

- **操作**–安装/升级、资源要求、性能要求、集成（指标、遥测、仪表板、工具、SMI）、混合工作负荷（Linux 和 Windows 节点池）、计算（Kubernetes、虚拟机）、多群集

- **安全**身份验证、标识、证书管理和旋转、可插接式外部 CA


## <a name="next-steps"></a>后续步骤

以下文档提供了有关可在 Azure Kubernetes Service （AKS）上试用的服务网格的详细信息：

> [!div class="nextstepaction"]
> [了解有关 Istio 的详细信息 .。。][istio-about]

> [!div class="nextstepaction"]
> [了解有关 Linkerd 的详细信息 .。。][linkerd-about]

> [!div class="nextstepaction"]
> [了解有关 Consul 的详细信息 .。。][consul-about]

你可能还需要浏览服务网格接口（SMI-S），这是 Kubernetes 上服务网格的标准接口：

- [服务网格接口（SMI-S）][smi]


<!-- LINKS - external -->
[smi]: https://smi-spec.io/

<!-- LINKS - internal -->
[istio-about]: ./servicemesh-istio-about.md
[linkerd-about]: ./servicemesh-linkerd-about.md
[consul-about]: ./servicemesh-consul-about.md