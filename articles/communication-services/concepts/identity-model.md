---
title: 标识模型
titleSuffix: An Azure Communication Services concept
description: 了解标识和访问令牌
author: tomaschladek
manager: nmurav
services: azure-communication-services
ms.author: tchladek
ms.date: 10/26/2020
ms.topic: conceptual
ms.service: azure-communication-services
ms.openlocfilehash: 996f138a14923319381738e7a55cd7ba4e8c4320
ms.sourcegitcommit: 5831eebdecaa68c3e006069b3a00f724bea0875a
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/11/2020
ms.locfileid: "94517761"
---
# <a name="identity-model"></a>标识模型

Azure 通信服务是标识不可知服务。 此设计具有多项优势：
- 重新使用标识管理系统中的现有标识
- 集成方案的灵活性
- 使标识专用于 Azure 通信服务

您不会复制系统中的现有信息，而是保留特定于业务案例的映射关系。 例如，映射标识1:1，1： N，N：1，N:M。 外部标识符 (如电话号码、用户、设备、应用程序、GUID) 不能用作 Azure 通信标识。 为 Azure 通信服务标识生成的访问令牌用于访问聊天或调用等基元。 

## <a name="identity"></a>标识

标识是通过 Azure 通信服务管理库创建的。 标识用作会话中的标识符，用于创建访问令牌。 相同的标识可能会在多个设备之间加入多个会话。 标识可以同时拥有多个活动的访问令牌。 删除标识、资源或订阅会导致其所有访问令牌失效，并删除为此标识存储的所有数据。 已删除的标识无法颁发新的访问令牌，也不能访问以前存储的数据 (例如，聊天消息) 。 

你不需要支付你拥有的标识数量，而是通过使用基元进行收费。 标识数量不必限制，如何将应用程序的标识映射到 Azure 通信服务标识。 由于存在自由映射，因此需要承担隐私条款。 如果你的应用程序的用户要从系统中删除，则需要删除与该用户相关联的所有标识。

Azure 通信服务不为匿名用户提供特殊身份。 它不会保留用户和标识之间的映射，也不能了解标识是否是匿名的。 您可以根据自己的要求设计该概念。 建议为每个应用程序的匿名用户创建新的标识。 拥有有效的访问令牌后，任何人都可以访问标识的 "不删除" 内容。 例如，聊天用户发送的消息。 仅限访问令牌中的作用域的访问权限。 有关范围的详细信息，请 *访问访问令牌* 部分。

### <a name="mapping-of-identities"></a>标识映射

Azure 通信服务不会复制 IMS 的功能。 它不会为客户提供使用特定于客户的标识的方式。 例如，电话号码或电子邮件地址。 相反，它提供了可分配给应用程序标识的唯一标识符。 Azure 通信服务不存储任何类型的信息，这可能会泄露用户的真实身份。

建议你进行设计，而不是进行重复，你的标识域中的用户将如何映射到 Azure 通信服务标识。 可以遵循任何种类的模式1:1、1： N、N：1或 M:N。 您可以决定是将单个用户映射到单个标识还是映射到多个标识。 创建新标识后，建议将此标识的映射存储到应用程序的用户或用户。 由于标识需要访问令牌来使用基元，因此，需要为应用程序的用户或用户提供标识。

如果使用关系数据库存储用户，则根据映射方案，实现可能会有所不同。 对于映射为1:1 或 N：1的方案，可以将 *CommunicationServicesId* 列添加到表中以存储 Azure 通信服务标识。 在关系1： N 或 N:M 的方案中，您可以考虑在关系数据库中创建一个单独的表。

## <a name="access-token"></a>访问令牌

访问令牌是一个 JWT 令牌，可用于获取对 Azure 通信服务基元的访问权限。 颁发的访问令牌具有完整性保护，发出后无法更改其声明。 也就是说，手动更改标识、过期或范围等属性将使访问令牌无效。 使用带有无效标记的基元将导致拒绝对基元的访问。 

访问令牌的属性包括： *标识、过期* 和 *作用域* 。 访问令牌始终有效24小时。 此时间过后，访问令牌会失效，无法用于访问任何基元。 标识必须有一种方法，即如何从服务器端服务请求新的访问令牌。 参数 *作用域* 定义可使用的一组非空基元。 Azure 通信服务支持以下访问令牌作用域：

|名称|说明|
|---|---|
|聊天|  授予加入聊天的能力|
|VoIP|  授予调用标识和电话号码的能力|


如果你想要在访问令牌过期之前撤销该访问令牌，则可以使用 Azure 通信服务管理库来执行此操作。 吊销令牌不是即时的，最多需要15分钟才能进行传播。 删除标识、资源或订阅将导致吊销所有访问令牌。 如果希望删除用户访问特定功能的能力，请撤消所有访问令牌。 然后，使用一组更有限的作用域颁发新的访问令牌。
Azure 通信服务的访问密钥的轮替将导致吊销使用以前的访问密钥创建的所有活动的访问令牌。 所有标识都将失去对 Azure 通信服务的访问权限，并且需要颁发新的访问令牌。 

建议在服务器端服务而不是客户端的应用程序中颁发访问令牌。 原因是，该颁发需要访问密钥或托管标识。 出于安全原因，不建议将访问密钥与客户端的应用程序共享。 客户端应用程序应使用可以对客户端进行身份验证的受信任的服务终结点，并代表其发出访问令牌。 可在 [此处](./client-and-server-architecture.md)找到有关体系结构的更多详细信息。

如果将访问令牌缓存到后备存储，建议使用加密。 访问令牌是敏感数据，如果不受保护，则可将其用于恶意活动。 拥有访问令牌后，即可初始化 SDK 并获取对 API 的访问权限。 可访问的 API 仅基于作用域的访问令牌。 建议仅使用需要的作用域来颁发访问令牌。

## <a name="next-steps"></a>后续步骤

* 有关访问令牌管理的简介，请参阅 [创建和管理访问令牌](https://docs.microsoft.com/azure/communication-services/quickstarts/access-tokens)
* 有关身份验证的简介，请参阅对 [Azure 通信服务进行身份验证](https://docs.microsoft.com/azure/communication-services/concepts/authentication)
* 有关数据驻留和隐私的简介，请参阅 [区域可用性和数据驻留](https://docs.microsoft.com/azure/communication-services/concepts/privacy)