---
title: 在 3DSMax 中设置基于物理的渲染材料
description: 说明如何在 3DSMax 中设置基于物理的渲染材料，并将其导出为 FBX 格式。
author: muxanickms
ms.author: misams
ms.date: 06/16/2020
ms.topic: tutorial
ms.openlocfilehash: df4be8963c93199f9fad23ab3f709f691e1da768
ms.sourcegitcommit: 9b5c20fb5e904684dc6dd9059d62429b52cb39bc
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/02/2020
ms.locfileid: "85857502"
---
# <a name="tutorial-set-up-physically-based-rendering-materials-in-3d-studio-max"></a>教程：在 3D Studio Max 中设置基于物理的渲染材料

## <a name="overview"></a>概述
在本教程中，你将学习如何：

>[!div class="checklist"]
>
> * 将具有高级照明的材料分配给场景中的对象。
> * 处理对象和材料的实例化。
> * 将场景导出为 FBX 格式并选择重要选项。

在 3D Studio Max (3DSMax) 中创建[基于物理的渲染 (PBR) 材料](../../overview/features/pbr-materials.md)是一项相对简单的任务。 它在许多方面与 Maya 等其他内容创建应用中的 PBR 设置类似。 本教程介绍如何为 Azure 远程渲染项目实现基本 PBR 着色器设置和 FBX 导出。

本教程中的示例场景包含许多多边形 box 对象。 并为它们分配了不同的材料，如木材、金属、喷漆金属、塑料和橡胶。 广泛地说，每种材料包含以下所有或大多数纹理：

* **反照率**，它是材料的颜色贴图，也称为“漫反射”或“基础颜色” 。
* **金属度**，用于确定材料是否为金属以及哪些部分是金属。 
* **粗糙度**，用于确定表面的粗糙度或平滑度。
它还会影响表面上的反射和高光的清晰度或模糊度。
* **法线**，无需添加更多多边形即可向表面添加细节。 细节的例子包括金属表面上的点蚀或凹痕或木材中的颗粒。
* **环境光遮蔽**，用于向模型添加软底纹和接触阴影。 它是一个灰度图，指示模型的哪些区域接收完整照明（白色）或完整阴影（黑色）。

## <a name="prepare-the-scene"></a>准备场景
在 3D Studio Max 中，设置 PBR 材料的过程如下所示。

首先，如你在示例场景中所见，我们已创建了一些 Box 对象，其中每个对象表示不同类型的材料：

>[!TIP]
>值得注意的是，在开始为 ARR 创建资产之前，它使用“米”作为度量单位。  
>因此，建议将场景系统单位设置为“米” 。 此外，在导出时，建议在 FBX 导出设置中将单位设置为“米”。

下图说明了在 3D Studio Max 中将系统单位设置为“米”的步骤。 在主菜单中，转到“自定义” > “单位设置” > “系统单位设置”，然后在“系统单位标度”下拉列表中选择“米”    。 
![系统单位](media/3dsmax/system-units.jpg)

将系统单位设置为“米”后，即可开始创建模型。 在示例场景中，我们创建了多个 Box 对象，每个对象表示不同类型的材料，例如金属、橡胶、塑料等。 

>[!TIP]
>在创建资产时，最好正确命名资产。 如果场景包含大量对象，这样更易于查找

![重命名对象](media/3dsmax/rename-objects.jpg)

## <a name="assign-materials"></a>分配材料

我们在场景中创建了一些对象（在本例中是一些立方体），接下来可开始 PBR 设置：

* 在主工具栏中，单击“材料编辑器”图标，如下图所示。 还可点击键盘上的 M 打开编辑器。 材料编辑器有两种模式 - “密实材料编辑器”模式和“板岩材料”模式，你可在“模式”下拉菜单中进行选择  。 由于此场景相对简单，我们将使用密实模式。

* 在材料编辑器中，你会看到许多球体，这些球体就是我们的材料。 我们会将其中一项材料分配给场景中的每个 Box 对象。 要执行此分配，请先在主视区中选择一个对象。 选择后，单击“材料编辑器”窗口中的第一个球体。 分配到某个对象后，所选材料将突出显示，如下图所示。

* 单击“将材料分配给所选对象”按钮，如下所示。 选定的材料现已分配给所选对象。
![分配材料](media/3dsmax/assign-material.jpg)

在材料编辑器中，你可根据自己的用例从各种材料中进行选择。 通常情况下，材料类型默认设置为“标准”。 这种材料是基本材料，不适合 PBR 设置，因此我们需要将材料类型更改为 PBR 材料。 Azure 远程渲染项目的首选 3DSMax 材料是物理材料 。

* 在材料编辑器中，单击“标准”选项卡，然后在打开的材料/贴图浏览器中，选择“物理材料” 。 此操作会将所分配的标准材料转换为 PBR 物理材料 。
![物理材料](media/3dsmax/physical-material.jpg)

* 在材料编辑器中，你现将看到物理材料的属性（见下文），接下来我们可开始向资产分配纹理。
![纹理列表](media/3dsmax/textures-list.jpg)

如上图中所示，你可将各种贴图和纹理添加到材料中。 不过在本例中，我们仅使用材料中的 5 个纹理槽。

>[!TIP]
>最好正确命名材料，如上图所示。

现在，我们可开始考虑向材料分配纹理。 生成纹理的方式可能因偏好设置或使用情况而异。 例如，你可能喜欢使用可应用于任何资产的平铺纹理，也可能需要项目/资产的特定部分具有其自己的一组自定义纹理。 我们建议你使用在线获取的通用平铺纹理，或者在 Photoshop、Quixel Suite 和 Substance Suite 等应用中自行创建纹理  。 

在开始分配纹理之前，我们需要考虑资产纹理坐标 (UVW)。 在将纹理应用到模型上时，最佳做法是确保模型已进行解包（如果没有正确进行 UV 解包，纹理将不会正确显示）。如果我们打算在模型上使用环境光遮蔽贴图，这就对我们的目标非常重要。 与 Maya 中的 Stingray 着色器不同，3DSMax 中的物理材料没有专用的“环境光遮蔽”纹理槽    。 因此，我们会将环境光遮蔽贴图应用到另一个槽，让它能够与其他纹理（例如平铺纹理）分开使用，我们将为它分配一个它自己的 UVW 贴图通道。 

首先，将“解包 UVW 修饰符”分配给模型，如下所示：

* 在所选对象属性编辑器中，单击修饰符列表，在打开的下拉列表中向下滚动并选择“解包 UVW”。 此操作会将解包 UVW 修饰符应用到资产。
![解包修饰符](media/3dsmax/unwrap-modifier.jpg)

* 将贴图通道设置为 1。 主要的解包操作通常是在贴图通道 1 中完成的。 在本例中，对象已在无重叠纹理坐标 (UV) 的情况下进行解包。
![解包 UVW](media/3dsmax/unwrapped-uvw.jpg)

接下来是创建第二个 UV 贴图通道。

* 关闭 UV 编辑器（如果它已打开），并在“编辑 UV”菜单的通道部分中，将通道号更改为 2。 贴图通道 2 是环境光遮蔽贴图的预期通道。 

* 打开的“通道更改警告”对话框将为你提供以下两个选项：将通道 1 中的现有 UV“移动”到新的通道 2，或者“放弃”将自动创建新的 UV 解包的现有 UV   。 如果打算为环境光遮蔽贴图新建不同于贴图通道 1 中的 UV 的 UV 解包，可仅选择“放弃”（例如，如果要在通道 1 中使用平铺纹理） 。 在本例中，我们将 UV 从通道 1 移动到通道 2，因为我们不需要编辑新的 UV 通道。

>[!NOTE]
>即使你已将 UV 解包从贴图通道 1 复制（移动）到贴图通道 2，你也可以在新的通道 UV 中进行任何必要的编辑，而不会影响原始贴图通道。

![通道更改](media/3dsmax/channel-change.jpg)

创建新的贴图通道后，我们可回到材料编辑器中的物理材料，并开始向其添加纹理。 我们首先将添加环境光遮蔽 (AO) 贴图，因为要使它能够正常使用，还需执行一个步骤。 将 AO 贴图插入材料后，我们需要指示它使用贴图通道 2。

* 如前文所述，3DSMax 物理材料中没有专门用于 AO 贴图的槽。 因此，我们改为将 AO 贴图应用到“漫反射粗糙度”槽。

* 在物理材料的“通用贴图”列表中，单击“漫反射粗糙度”的“无贴图”槽并加载 AO 贴图  。

* 在 AO 纹理属性中，你将看到贴图通道默认设置为 1。 将此值更改为 2。 此操作完成了添加环境光遮蔽贴图所需的步骤。

>[!IMPORTANT]
>此步骤非常重要，当通道 2 中的 UV 与通道 1 中的 UV 不同时尤其如此，因为如果选择错误的通道，AO 将无法正确映射。

![分配 AO 贴图](media/3dsmax/assign-ao-map.jpg)

现在，我们执行将法线贴图分配给 PBR 材料的操作。 此操作在某种程度上与 Maya 不同，因为法线贴图不会直接应用于凹凸贴图槽（3DSMax 物理材料中没有法线贴图槽），而是添加到将插入法线槽的法线贴图修饰符  。

* 在物理材料属性（位于材料编辑器中）的“特殊贴图”部分，单击“凹凸贴图”的“无贴图”槽  。 

* 在材料/贴图浏览器中，找到并单击“法线凹凸”。 此操作会向材料添加法线凹凸修饰符。

* 在法线凹凸修饰符中，单击法线的“无贴图”，然后找到并加载你的法线贴图  。

* 检查方法是否设置为“切线”（应默认为此设置），并在必要时切换“翻转绿色(Y)” 。

![法线凹凸](media/3dsmax/normal-bump.jpg)
![加载法线凹凸](media/3dsmax/load-normal-map.jpg)

正确分配法线贴图后，便可继续分配剩余的纹理，以完成物理材料设置。 此过程很简单，无需考虑特殊设置。 下图显示了分配给材料的一整套纹理：![所有纹理](media/3dsmax/all-textures.jpg)

创建和设置了 PBR 材料后，值得考虑的是如何在场景中实例化对象。 在场景中实例化类似对象（例如螺母、螺栓、螺钉垫圈），相同的任何对象本质上都可在文件大小方面产生显著节省。 主对象的实例可具有自己的缩放、旋转和转换，以便可在场景中按需放置。 在 3D Studio Max 中，实例化的过程十分简单 。

* 在主视区中，选择要导出的一个或多个对象。

* 按住 Shift 并使用转换（移动）工具向上拖动资产 

* 在打开的“克隆选项”对话框中，将“对象”设置为“实例”并单击“确定”   。 
![实例对象](media/3dsmax/instance-object.jpg)

此操作会创建对象的一个实例，它可独立于父对象以及该父对象的其他实例进行旋转或缩放。

>[!IMPORTANT]
>但是，在处于子对象模式期间对实例进行的任何更改都会传输到对象的所有实例，因此，如果使用的是实例化对象组件（顶点、多边形面等），请先确保你需要所作的任何更改都影响所有这些实例。 请记住，任何实例对象都可随时成为唯一的对象。 

>[!TIP]
>关于在场景中进行实例化，最佳做法是在进行过程中创建它们，因为以后将“副本”替换为实例化对象非常困难。 

在转到导出过程之前需要注意的最后一点是，你需要如何打包你的场景/资产来进行共享。 理想情况下，如果将资产传递给客户端或团队成员，你将希望他们能够尽可能顺利打开并查看资产。 因此，请务必使资产纹理路径相对于场景文件。 如果资产的纹理路径指向本地驱动器或绝对路径/位置，则在其他计算机上打开时，它们将不会加载到场景中，即使 .max 文件与纹理位于同一文件夹中也是如此。 使纹理路径相对于 3D Studio Max 即可解决此问题，该操作非常简单。

* 在主工具栏中，转到“文件” > “参考” > “资产跟踪切换”  。 

* 在打开的资产跟踪浏览器中，你将看到已应用于“贴图/着色器”列中列出的 PBR 材料的所有或大部分纹理。

* 在“完整路径”列中，你将在相应纹理旁边看到纹理位置的文件路径（最有可能是它们在本地计算机上的位置）。

* 最后，你将看到一个名为“状态”的列。 此列指示是否已找到给定纹理并将其应用到场景，并将使用下面一个词来标记该纹理：“确定”、“找到”或“文件缺失”  。 前两个词表示已找到并已加载文件，最后一个词表示跟踪器未能找到文件。
![纹理路径](media/3dsmax/texture-paths.jpg)

你可能会发现，在首次打开跟踪器时，其中并未列出所有纹理。 不过无需担心，因为运行一两次路径查找过程通常即可找到所有场景纹理。 路径查找过程如下所示： 

* 在资产跟踪器窗口中，按 Shift + 单击“贴图/着色器”列表中的第一个纹理，按住 Shift 不松并单击列表中的最后一个纹理  。 此操作将选中列表中的所有纹理。 所选纹理现将突出显示为蓝色（见上图）。

* 右键单击所选内容，然后在打开的弹出菜单中，选择“设置路径”。

* 在打开的“指定资产路径”框中，选择所显示纹理的本地路径，然后将其替换为 `.\` 并单击“确定” 。 

* 经过一段时间后（时间视场景中的纹理数量和场景大小而定），资产跟踪器应该会自行解析（请参阅下图）。
![解析纹理](media/3dsmax/resolve-textures.jpg)

请注意，“完整路径”列现在是空白的。 这意味着场景不再查找特定（绝对）位置中的相关纹理，但只要 max 文件或相关 FBX 文件位于纹理所在的同一文件夹中，就总会找到它们。 

>[!NOTE]
>有时，你可能需要多次重复此过程来查找和解析所有纹理和路径。 不必担心，你只需重复此操作，直到处理完所有相关资产即可。 也可能会发生有些文件再也无法找到的情况。 在这种情况下，只需选择列表中的所有资产，并单击“删除缺失的路径”即可（见上图）

## <a name="fbx-export"></a>FBX 导出

完成资产跟踪后，现可继续到 FBX 导出操作。 同样，此过程也很简单，可通过多种方式完成。 

>[!TIP]
>好的做法是，除非你希望导出整个场景，否则请选择仅导出所需的那些资产。 特别是在使用大量资源的场景下，导出操作可能会耗费很长时间，因此最好只导出所需的内容
>
>如果你使用了修饰符（例如 Turbosmooth 或 Open SubDiv 等），则最好在导出之前进行折叠，因为它们会导致导出过程出现问题 。 在执行此操作之前，请始终保存你的场景！ 

* 在场景中，选择要导出的资产，然后在主工具栏中，转到“文件” > “导出” > “导出所选项”  

* 在“选择要导出的文件”对话框中，键入或选择输出文件名，并在“保存类型”选项中选择“Autodesk (*.fbx)”  。 此操作将打开 FBX 导出菜单。 

* 请记住，如果在场景中创建了实例，那么请务必在 FBX 导出设置中打开“保留实例”。 
![FBX 导出](media/3dsmax/fbx-export.jpg)

请记住，前面提到过，有几种方法可以导出文件。 如果导出目的是将 FBX 与文件夹/目录中的纹理文件一起共享，那么下图中显示的设置应该适用并可正常工作。 选择设置后，单击“确定”。
![FBX 设置](media/3dsmax/fbx-settings.jpg)

但是，如果不希望与 FBX 一起共享大型纹理文件夹/目录，可选择在 FBX 中嵌入纹理。 这意味着整个资产（包含纹理）将添加到一个 FBX 中。 不过请注意，尽管它将导出内容合并为一个资产，但最终 FBX 文件要大得多。

>[!IMPORTANT]
>如果生成的 FBX 文件大于 2.4 GB，则 FBX 导出设置（参见上文）的最低版本应至少为 2016 版。 由于较新版本具有 64 位支持，因此支持更大的文件。

* 在“FBX 导出设置”中，打开**“嵌入媒体”，然后单击“确定”来进行导出（包含纹理）。 

如果在使用物理材料时导出到 FBX，则在导出对话框中单击“确定”后，你可能会看到以下警告弹出窗口：![导出警告](media/3dsmax/export-warnings.jpg)

此警告只是通知用户导出的材料可能与其他软件包不兼容。 由于物理材料与 Azure 远程渲染兼容，因此不必担心。 只需单击“确定”完成该过程，然后关闭窗口即可。

## <a name="conclusion"></a>结束语

一般而言，此类型的材料看起来更真实，因为它基于现实世界的光线物理原理。 它创造了一种额外的沉浸式效果，使场景反映出现实世界的特征。

## <a name="next-steps"></a>后续步骤

你现在已知道如何为场景中的对象设置具有高级照明的材料。 你也知道了如何将对象导出为 Azure 远程渲染支持的 FBX 格式。 下一步是转换 FBX 文件，并在 Azure 远程渲染中将其可视化。

>[!div class="nextstepaction"]
>[快速入门：转换要渲染的模型](../../quickstarts\convert-model.md)