---
title: "计划任务和定期运行的工作流 - Azure 逻辑应用 | Microsoft Docs"
description: "使用逻辑应用创建和计划定期运行的任务、操作、工作流、过程和工作负荷"
services: logic-apps
documentationcenter: 
author: ecfan
manager: anneta
editor: 
tags: connectors
ms.assetid: 51dd4f22-7dc5-41af-a0a9-e7148378cd50
ms.service: logic-apps
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/25/2017
ms.author: LADocs; estfan
ms.openlocfilehash: 0dead955f9eb723dfa232d3ce751498a09ce1b29
ms.sourcegitcommit: 0b02e180f02ca3acbfb2f91ca3e36989df0f2d9c
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/05/2018
---
# <a name="create-and-schedule-regularly-running-tasks-with-azure-logic-apps"></a>使用 Azure 逻辑应用创建和计划定期运行的任务

若要计划定期运行的任务、操作、工作负荷或过程，可以创建一个能够通过“计划 - 定期”[触发器](../logic-apps/logic-apps-overview.md#logic-app-concepts)启动的逻辑应用工作流。 使用此触发器，可以设置定期计划的开始日期和时间，以及一个用于执行任务的定期计划，部分示例如下：

* 获取内部数据：每天[运行 SQL 存储过程](../connectors/connectors-create-api-sqlazure.md)。
* 获取外部数据：每隔 15 分钟从 NOAA 提取天气报告。
* 报告数据：通过电子邮件发送过去一周内超过特定金额的所有订单的摘要。
* 处理数据：在每个工作日的非高峰时间压缩当日的已上传图像。
* 清除数据：删除超过三个月的所有推文。
* 存档数据：每月将发票推送到备份服务。

此触发器支持多种模式，例如：

* 立即运行，并每隔 *n* 秒、分钟、小时、天、周或月重复运行。
* 在特定的时间启动，然后运行并每隔 *n* 秒、分钟、小时、天、周或月重复运行。
* 运行并在每天的一个或多个不同时间（例如 8:00 AM 和 5:00 PM）重复。
* 运行并在每周的特定星期日期（例如星期六和星期日）重复。
* 运行并在每周的特定星期日期和时间（例如星期一到星期五的 8:00 AM 和 5:00 PM）重复。

每当激发定期触发器时，逻辑应用会创建并运行逻辑应用工作流的新实例。

## <a name="prerequisites"></a>先决条件

* Azure 订阅。 如果没有订阅，可以[从免费的 Azure 帐户着手](https://azure.microsoft.com/free/)。 也可以[注册即用即付订阅](https://azure.microsoft.com/pricing/purchase-options/)。

* 有关[如何创建逻辑应用](../logic-apps/quickstart-create-first-logic-app-workflow.md)的基本知识 

## <a name="add-a-recurrence-trigger-to-your-logic-app"></a>将定期触发器添加到逻辑应用

1. 登录到 [Azure 门户](https://portal.azure.com)。 创建空白逻辑应用，或了解[如何创建空白逻辑应用](../logic-apps/quickstart-create-first-logic-app-workflow.md)。

2. 显示逻辑应用设计器后，在搜索框中输入“定期”作为筛选器。 选择“计划 - 定期”触发器。 

   ![“计划 - 定期”触发器](./media/connectors-native-recurrence/add-recurrence-trigger.png)

   此触发器现在是逻辑应用中的第一个步骤。

3. 设置定期计划的间隔和频率。 在此示例中，请将这些属性设置为每周运行工作流。 

   ![设置间隔和频率](./media/connectors-native-recurrence/recurrence-trigger-details.png)

4. 如需更多计划选项，请选择“显示高级选项”。 

   ![更多选项](./media/connectors-native-recurrence/recurrence-trigger-more-options.png)

5. 现在，可以设置这些选项： 

   * 设置激发触发器的开始日期和时间。 
   如果指定了开始日期和时间，则还可以应用时区。 

   * 如果选择“天”或“周”作为频率，则可以选择定期计划的特定时间。 

   * 如果选择了“周”，则也可以选择特定的星期日期。
   
   ![高级计划选项](./media/connectors-native-recurrence/recurrence-trigger-more-options-details.png)

   例如，假设当天是 2017 年 9 月 4 日星期一。 
   以下定期触发器不会在开始日期和时间 2017 年 9 月 18 日星期一 8:00 AM（太平洋标准时间）之前激发。 
   但是，该定期计划设置为仅在每个星期一的 10:30 AM、12:30 PM 和 2:30 PM 运行。 因此，首次激发触发器并创建逻辑应用工作流实例的时间为 10:30 AM。 
   若要详细了解开始时间的工作方式，请参阅这些[开始时间示例](#start-time)。
   将来的运行发生在同一天的 12:30 PM 和 2:30 PM。 
   每个定期计划会创建其自身的工作流实例。 之后，在下一个星期一，整个计划会再次从头开始重复。 
   [*还有哪些计划示例？*](#example-recurrences)

   ![高级计划示例](./media/connectors-native-recurrence/recurrence-trigger-more-options-advanced-schedule.png)

   > [!NOTE]
   > 仅当选择“天”或“周”作为频率时，触发器才显示指定的定期计划的预览。
   
6. 现在，请使用操作或流控制语句生成剩余的工作流。 有关可添加的其他操作，请参阅[连接器](../connectors/apis-list.md)。 

## <a name="trigger-details"></a>触发器详细信息

可为定期触发器配置以下属性。

| 名称 | 必选 | 属性名称 | Type | 说明 | 
|----- | -------- | ------------- | ---- | ----------- | 
| **频率** | 是 | 频率 | String | 定期计划的时间单位：“秒”、“分钟”、“小时”、“天”、“周”或“月” | 
| **间隔** | 是 | interval | Integer | 一个正整数，描述工作流基于频率运行的频繁度。 <p>默认间隔为 1。 下面是最小和最大间隔： <p>- 月：1-16 个月 </br>- 天：1-500 天 </br>- 小时：1-12,000 小时 </br>- 分钟：1-72,000 分钟 </br>- 秒：1-9,999,999 秒<p>例如，如果间隔为 6，频率为“月”，则重复周期为每 6 个月。 | 
| **时区** | 否 | timezone | String | 仅当指定启动时间时才适用，因为此触发器不接受 [UTC 时差](https://en.wikipedia.org/wiki/UTC_offset)。 选择要应用的时区。 | 
| **开始时间** | 否 | startTime | String | 按以下格式提供开始时间： <p>如果选择了时区，则格式为 YYYY-MM-DDThh:mm:ss <p>-或- <p>如果未选择时区，则格式为 YYYY-MM-DDThh:mm:ssZ <p>例如，如果希望开始时间为 2017 年 9 月 18 日 2:00 PM，请指定“2017-09-18T14:00:00”并选择时区（例如“太平洋时间”）。 或者指定“2017-09-18T14:00:00Z”且不选择时区。 <p>**注意：**此开始时间必须遵循 [UTC 日期时间格式](https://en.wikipedia.org/wiki/Coordinated_Universal_Time)中的 [ISO 8601 日期时间规范](https://en.wikipedia.org/wiki/ISO_8601#Combined_date_and_time_representations)，但没有 [UTC 时差](https://en.wikipedia.org/wiki/UTC_offset)。 如果未选择时区，必须在末尾添加字母“Z”（无空格）。 这个“Z”指等效的[航海时间](https://en.wikipedia.org/wiki/Nautical_time)。 <p>对于简单计划，开始时间指首次运行时间；对于复杂计划，触发器的激发时间不会早于开始时间。 [*可通过哪些方式使用开始日期和时间？*](#start-time) | 
| **在这些日期** | 否 | 工作日 | 字符串或字符串数组 | 如果选择了“周”，则可以选择一个或多个星期日期作为运行工作流的时间：“星期一”、“星期二”、“星期三”、“星期四”、“星期五”、“星期六”和“星期日” | 
| **在这些小时** | 否 | 小时 | 整数或整数数组 | 如果选择了“天”或“周”，则可以从 0 到 23 的范围内选择一个或多个整数，作为当天要运行工作流的小时时间。 <p>例如，如果指定“10”、“12”和“14”，则会将上午 10 点、中午 12 点和下午 2 点作为小时标记。 | 
| **在这些分钟** | 否 | 分钟数 | 整数或整数数组 | 如果选择了“天”或“周”，则可以从 0 到 59 的范围内选择一个或多个整数，作为要运行工作流的小时时间的分钟时间。 <p>例如，可以指定“30”作为分钟标记并使用前面示例中的当天小时时间，这样，便可以指定10:30 AM、12:30 PM 和 2:30 PM 作为开始时间。 | 
||||| 

## <a name="json-example"></a>JSON 示例

下面是[定期触发器定义](../logic-apps/logic-apps-workflow-actions-triggers.md#recurrence-trigger)的示例：

``` json
{
    "triggers": {
        "Recurrence": {
            "type": "Recurrence",
            "recurrence": {
                "frequency": "Week",
                "interval": 1,
                "schedule": {
                    "hours": [
                        10,
                        12,
                        14
                    ],
                    "minutes": [
                        30
                    ],
                    "weekDays": [
                        "Monday"
                    ]
                },
               "startTime": "2017-09-07T14:00:00",
               "timeZone": "Pacific Standard Time"
            }
        }
    }
}
```

## <a name="faq"></a>常见问题

<a name="example-recurrences"></a>

**问：**还有哪些定期计划示例？ </br>
**答：**更多示例如下：

| 定期 | 时间间隔 | 频率 | 开始时间 | 在这些日期 | 在这些小时 | 在这些分钟 | 注意 |
| ---------- | -------- | --------- | ---------- | ------------- | -------------- | ---------------- | ---- |
| 每隔 15 分钟运行（没有开始日期和时间） | 15 | 分钟 | {无} | {不可用} | {无} | {无} | 此计划立即启动，然后根据上次运行时间计算将来的重复周期。 | 
| 每隔 15 分钟运行（有开始日期和时间） | 15 | 分钟 | *startDate*T*startTime*Z | {不可用} | {无} | {无} | 此计划不会在指定的开始日期和时间之前启动，将根据上次运行时间计算将来的重复周期。 | 
| 每隔一小时整点运行（有开始日期和时间） | 1 | 小时 | *startDate*Thh:00:00Z | {不可用} | {无} | {无} | 此计划不会在指定的开始日期和时间之前启动。 将来的定期计划每隔一小时按“00”分钟标记运行。 <p>如果频率为“周”或“月”，则此计划只会分别在每周的一个星期日期或每月的一个日期运行。 | 
| 每天每隔一小时运行（没有开始日期和时间） | 1 | 小时 | {无} | {不可用} | {无} | {无} | 此计划立即启动，并根据上次运行时间计算将来的重复周期。 <p>如果频率为“周”或“月”，则此计划只会分别在每周的一个星期日期或每月的一个日期运行。 | 
| 每天每隔一小时运行（有开始日期和时间） | 1 | 小时 | *startDate*T*startTime*Z | {不可用} | {无} | {无} | 此计划不会在指定的开始日期和时间之前启动，将根据上次运行时间计算将来的重复周期。 <p>如果频率为“周”或“月”，则此计划只会分别在每周的一个星期日期或每月的一个日期运行。 | 
| 每隔一小时在整点过后的第 15 分钟运行（有开始日期和时间） | 1 | 小时 | *startDate*T00:15:00Z | {不可用} | {无} | {无} | 此计划不会在指定的开始日期和时间之前启动，在 00:15 AM、1:15 AM、2:15 AM 等有规律的时间运行。 | 
| 每隔一小时在整点过后的第 15 分钟运行（没有开始日期和时间） | 1 | 日期 | {无} | {不可用} | 0、1、2、3、4、5、6、7、8、9、10、11、12、13、14、15、16、17、18、19、20、21、22、23 | 15 | 此计划在 00:15 AM、1:15 AM、2:15 AM 等有规律的时间运行。 此外，此计划相当于频率为“小时”且开始时间为“15”分钟。 | 
| 按 15 分钟标记每隔 15 分钟运行（没有开始日期和时间） | 1 | 日期 | {无} | {不可用} | 0、1、2、3、4、5、6、7、8、9、10、11、12、13、14、15、16、17、18、19、20、21、22、23 | 0、15、30、45 | 此计划在下一个指定的 15 分钟标记之前不会启动。 | 
| 每天的 8:00 AM 运行（没有开始日期和时间） | 1 | 日期 | {无} | {不可用} | 8 | {无} | 此计划基于指定的计划在每天的 8:00 AM 运行。 | 
| 每天的 8:00 AM 运行（有开始日期和时间） | 1 | 日期 | *startDate*T08:00:00Z | {不可用} | {无} | {无} | 此计划基于指定的开始时间在每天的 8:00 AM 运行。 | 
| 每天的 8:30 AM 运行（没有开始日期和时间） | 1 | 日期 | {无} | {不可用} | 8 | 30 | 此计划基于指定的计划在每天的 8:30 AM 运行。 | 
| 每天的 8:30 AM 运行（有开始日期和时间） | 1 | 日期 | *startDate*T08:30:00Z | {不可用} | {无} | {无} | 此计划在指定的开始日期的 8:30 AM 启动。 | 
| 在每天的 8:30 AM 和 4:30 PM 运行 | 1 | 日期 | {无} | {不可用} | 8, 16 | 30 | | 
| 在每天的上午 8:30、8:45 和下午 4:30、4:45 运行 | 1 | 日期 | {无} | {不可用} | 8, 16 | 30, 45 | | 
| 在每个星期六的 5:00 PM 运行（没有开始日期和时间） | 1 | 周次 | {无} | “星期六” | 17 | 00 | 此计划在每个星期六的 5:00 PM 运行。 | 
| 在每个星期六的 5:00 PM 运行（有开始日期和时间） | 1 | 周次 | *startDate*T17:00:00Z | “星期六” | {无} | {无} | 此计划不会在指定的开始日期和时间（在本例中为 2017 年 9 月 9 日 5:00 PM）之前启动。 将来的定期计划在每个星期六的 5:00 PM 运行。 | 
| 在每个星期二和星期四的 5:00 PM 运行 | 1 | 周次 | {无} | “星期二”、“星期四” | 17 | {无} | 此计划在每个星期二和星期四的 5:00 PM 运行。 | 
| 在工作时间每隔一小时运行 | 1 | 周次 | {无} | 选择除星期六和星期日以外的所有星期日期。 | 选择所需的日期小时。 | 选择所需的任何小时分钟。 | 例如，如果工作时间为 8:00 AM 到 5:00 PM，则选择“8、9、10、11、12、13、14、15、16、17”作为日期小时。 <p>如果工作时间为 8:30 AM 到 5:30 PM，则选择前面的日期小时加上“30”作为小时分钟。 | 
| 在周末每隔一个星期日期运行一次 | 1 | 周次 | {无} | “星期六”、“星期日” | 选择所需的日期小时。 | 选择适当的任何小时分钟。 | 此计划根据指定的计划在每个星期六和星期日运行。 | 
| 仅每两周在星期一每隔 15 分钟运行 | 2 | 周次 | {无} | “星期一” | 0、1、2、3、4、5、6、7、8、9、10、11、12、13、14、15、16、17、18、19、20、21、22、23 | 0、15、30、45 | 此计划按每个 15 分钟标记每隔两周在星期一运行。 | 
| 在每个月每隔一小时运行一天 | 1 | 月份 | {参阅备注} | {不可用} | 0、1、2、3、4、5、6、7、8、9、10、11、12、13、14、15、16、17、18、19、20、21、22、23 | {参阅备注} | 如果未指定开始日期和时间，则此计划使用创建日期和时间。 若要控制定期计划的分钟，请指定小时分钟和开始时间，或使用创建时间。 例如，如果开始时间或创建时间为 8:25 AM，则此计划在 8:25 AM、9:25 AM、10:25 AM 等有规律的时间运行。 | 
||||||||| 

<a name="start-time"></a>

**问：**可通过哪些方式使用开始日期和时间？ </br>
**答：**下面这些模式演示如何使用开始日期和时间控制定期计划，以及逻辑应用引擎如何执行这些定期计划：

| 开始时间 | 不按计划循环 | 按计划循环 | 
| ---------- | --------------------------- | ------------------------ | 
| {无} | 即时运行第一个工作负荷。 <p>基于上次运行时间运行将来的工作负荷。 | 即时运行第一个工作负荷。 <p>基于指定的计划运行将来的工作负荷。 | 
| 开始时间在过去 | 基于指定的开始时间计算运行时间，并丢弃过去的运行时间。 在下一个将来运行时间运行第一个工作负荷。 <p>基于上次运行时间的计算结果运行将来的工作负荷。 <p>有关详细说明，请参阅此表格后面的示例。 | 基于从开始时间计算的计划，在不早于开始时间的时间运行第一个工作负荷。 <p>基于指定的计划运行将来的工作负荷。 <p>**注意：**如果为计划指定了重复周期，但没有为计划指定小时或分钟，则会分别使用首次运行时间的小时或分钟计算将来的运行时间。 | 
| 开始时间在当前或将来 | 在指定的开始时间运行第一个工作负荷。 <p>基于上次运行时间的计算结果运行将来的工作负荷。 | 基于从开始时间计算的计划，在不早于开始时间的时间运行第一个工作负荷。 <p>基于指定的计划运行将来的工作负荷。 <p>**注意：**如果为计划指定了重复周期，但没有为计划指定小时或分钟，则会分别使用首次运行时间的小时或分钟计算将来的运行时间。 | 
||||

**过去的开始时间有重复周期但没有计划的示例** 

| 开始时间 | 当前时间 | 定期 | 计划 |
| ---------- | ------------ | ---------- | -------- | 
| 2017-09-**07**T14:00:00Z | 2017-09-**08**T13:00:00Z | 每 2 天 | {无} | 
||||| 

在这种情况下，逻辑应用引擎会基于开始时间计算运行时间，丢弃过去的运行时间，并为首次运行使用下一个将来开始时间。 完成首次运行后，将来的运行基于从开始时间计算的计划。 下面是此重复周期的大致形式：

| 开始时间 | 首次运行时间 | 将来的运行时间 | 
| ---------- | ------------ | ---------- | 
| 2017-09-**07** 的 2:00 PM | 2017-09-**09** 的 2:00 PM | 2017-09-**11** 的 2:00 PM </br>2017-09-**13** 的 2:00 PM </br>2017-09-**15** 的 2:00 PM </br>依此类推...
||||| 

因此，对于这种情况，不管在过去的多长期限内指定了开始时间（例如，2017-09-**05** 的 2:00 PM，或 2017-09-**01** 的 2:00 PM）首次运行时间都是相同的。

## <a name="next-steps"></a>后续步骤

* [工作流操作和触发器](../logic-apps/logic-apps-workflow-actions-triggers.md#recurrence-trigger)
* [连接器](../connectors/apis-list.md)
