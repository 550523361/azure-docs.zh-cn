---
title: 管理群集横向扩展（横向扩展），以匹配 Azure 数据资源管理器中的需求
description: 本文介绍如何根据不断变化的需求采用相关步骤对 Azure 数据资源管理器群集进行横向缩放。
author: orspod
ms.author: orspodek
ms.reviewer: gabil
ms.service: data-explorer
ms.topic: conceptual
ms.date: 12/09/2019
ms.openlocfilehash: ff7420619cffc2287ab8ff6332df605d56329549
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/28/2020
ms.locfileid: "77664127"
---
# <a name="manage-cluster-horizontal-scaling-scale-out-in-azure-data-explorer-to-accommodate-changing-demand"></a>在 Azure 数据资源管理器中管理水平缩放（横向扩展）群集以适应不断变化的需求

调整好群集的大小对于 Azure 数据资源管理器的性能至关重要。 静态群集大小可能导致利用不充分或利用过度，二者都不理想。 由于无法绝对准确地预测群集的需求，更好的方法是对群集进行*缩放*，根据不断变化的需求添加或删除容量和 CPU 资源。 

有两个工作流可用于缩放 Azure 数据资源管理器群集： 
* 水平缩放，也称为横向缩放。
* [垂直缩放](manage-cluster-vertical-scaling.md)，也称为向上和向下缩放。
本文介绍水平缩放工作流。

## <a name="configure-horizontal-scaling"></a>配置水平缩放

借助水平缩放，可以根据预定义的规则和计划自动缩放实例计数。 若要指定群集的自动缩放设置，请执行以下操作：

1. 在 Azure 门户中，转到 Azure 数据资源管理器群集资源。 在“设置”下选择“横向扩展”。******** 

2. 在 **"横向扩展"** 窗口中，选择所需的自动缩放方法：**手动缩放**、**优化自动缩放**或**自定义自动缩放**。

### <a name="manual-scale"></a>手动缩放

手动缩放是群集创建过程中的默认设置。 群集有一个不会自动更改的静态容量。 可以使用“实例计数”栏选择静态容量。**** 群集的缩放保持在该设置，除非你再次进行更改。

   ![手动缩放方法](media/manage-cluster-horizontal-scaling/manual-scale-method.png)

### <a name="optimized-autoscale-preview"></a>优化自动缩放（预览）

优化自动缩放是推荐的自动缩放方法。 此方法优化群集性能和成本。 如果群集接近利用率不足的状态，则将放大该群集。 此操作可降低成本，但保持性能水平。 如果群集接近过度使用状态，则将其横向扩展以保持最佳性能。 要配置优化自动缩放：

1. 选择 **"优化自动缩放**"。 

1. 选择最小实例计数和最大实例计数。 基于负载的群集在这两个数字之间自动缩放范围。

1. 选择“保存”。****

   ![优化自动缩放方法](media/manage-cluster-horizontal-scaling/optimized-autoscale-method.png)

优化的自动缩放开始工作。 其操作现在在群集的 Azure 活动日志中可见。

#### <a name="logic-of-optimized-autoscale"></a>优化自动缩放的逻辑 

**横向扩展**

当群集接近过度使用状态时，横向扩展以保持最佳性能。 在：
* 群集实例数低于用户定义的最大实例数。
* 缓存利用率高达一个多小时。
* CPU 高一个多小时。
* 摄入利用率高达一个多小时。

> [!NOTE]
> 横向扩展逻辑当前不考虑引入利用率指标。 如果此指标对用例很重要，请使用[自定义自动缩放](#custom-autoscale)。

**缩小**

当群集接近利用率不足的状态时，请扩展以降低成本但保持性能。 多个指标用于验证在群集中扩展是否安全。 执行比例之前每小时计算 6 小时以下规则：
* 实例数高于 2，高于定义的最小实例数。
* 为确保资源不会过载，必须在执行规模之前验证以下指标： 
    * 缓存利用率不高
    * CPU 低于平均值 
    * 摄入利用率低于平均水平 
    * 流式处理利用率（如果使用流式处理）不高
    * 保持活动事件高于定义的最小值，处理正确，并按时处理。
    * 无查询限制 
    * 失败查询的数量低于定义的最小值。

> [!NOTE]
> 逻辑中的比例当前需要 7 天的评估，然后才能实施优化的刻度。 此评估每 24 小时进行一次。 如果需要快速更改，请使用[手动缩放](#manual-scale)。

### <a name="custom-autoscale"></a>自定义自动缩放

使用自定义自动缩放，可以根据指定的指标动态地缩放群集。 下图显示配置自定义自动缩放的流程和步骤。 图后面提供了更多详细信息。

1. 在“自动缩放设置名称”框中输入一个名称，例如“横向扩展: 缓存使用率”。****** 

   ![缩放规则](media/manage-cluster-horizontal-scaling/custom-autoscale-method.png)

2. 至于“缩放模式”****，请选择“基于指标缩放”。**** 此模式提供动态缩放。 也可选择“缩放为具体实例数”。****

3. 选择“+ 添加规则”****。

4. 在右侧的“缩放规则”部分，输入每项设置的值。****

    **标准**

    | 设置 | 说明和值 |
    | --- | --- |
    | **时间聚合** | 选择聚合条件，例如“平均”。**** |
    | **指标名称** | 选择要求缩放操作依赖的指标，例如“缓存使用率”。**** |
    | 时间粒度统计信息**** | 在 **Average**、**Minimum**、**Maximum** 和 **Sum** 之间选择。 |
    | **运算符** | 选择适当的选项，例如“大于或等于”。**** |
    | **阈 值** | 选择适当的值。 例如，对于缓存使用率，一开始可以选择 80%。 |
    | **持续时间（分钟）** | 选择适当的时间值，以便系统在计算指标时进行回溯。 一开始可将默认值设置为 10 分钟。 |
    |  |  |

    **操作**

    | 设置 | 说明和值 |
    | --- | --- |
    | **操作** | 选择进行横向缩放的适当选项。 |
    | **实例计数** | 选择在符合指标条件的情况下，需要添加或删除的节点或实例的数目。 |
    | **冷却(分钟)** | 选择需要在两项缩放操作之间等待的适当时间间隔。 一开始可将默认值设置为 5分钟。 |
    |  |  |

5. 选择“添加”****。

6. 在左侧的“实例限制”部分，输入每项设置的值。****

    | 设置 | 说明和值 |
    | --- | --- |
    | **最低** | 群集在缩放时不管使用率如何都不得低于的实例数。 |
    | **最大** | 群集在缩放时不管使用率如何都不得高于的实例数。 |
    | **默认** | 默认实例数。 在出现资源指标读取问题时使用此设置。 |
    |  |  |

7. 选择“保存”。****

现在已为 Azure 数据资源管理器群集配置了水平缩放。 添加另一个垂直缩放规则。 如果在解决群集缩放问题时需要帮助，请在 Azure 门户中[提交支持请求](https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/overview)。

## <a name="next-steps"></a>后续步骤

* [通过指标监视 Azure 数据资源管理器的性能、运行状况和使用情况](using-metrics.md)
* [管理群集垂直缩放](manage-cluster-vertical-scaling.md)，以便适当地调整群集的大小。
