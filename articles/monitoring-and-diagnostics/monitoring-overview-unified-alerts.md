---
title: Azure Monitor 中的统一警报
description: 介绍 Azure 中可用于管理各个 Azure 服务的警报和警报规则的统一警报功能。
author: manishsm-msft
services: monitoring
ms.service: azure-monitor
ms.topic: conceptual
ms.date: 06/07/2018
ms.author: mamit
ms.component: alerts
ms.openlocfilehash: c4c8279a1d4638a1c5d889b53e2d9e89e458cc37
ms.sourcegitcommit: 7827d434ae8e904af9b573fb7c4f4799137f9d9b
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/18/2018
ms.locfileid: "39117167"
---
# <a name="unified-alerts-in-azure-monitor"></a>Azure Monitor 中的统一警报

## <a name="overview"></a>概述

> [!NOTE]
>  公共预览版中目前已引入一项新的统一警报体验，支持管理多个订阅的警报，还引入了警报状态和智能组。 有关此增强型体验的介绍及其启用过程，请参阅本文的最后一部分。


本文介绍 Azure Monitor 中的统一警报体验。 [以前的警报体验](monitoring-overview-alerts.md)在 Azure Monitor 菜单的“警报(经典)”选项中提供。 

## <a name="features-of-the-unified-alert-experience"></a>统一警报体验的功能

统一体验与经典体验相比具有以下优点：

-   **更好的通知系统**：[操作组](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-action-groups)指通知和操作的已命名组，可在多个警报中重复使用。 
- **统一的创作体验**：可在一个位置针对 Azure Monitor、Log Analytics 和 Application Insights 中的指标、日志和活动日志管理警报和警报规则。 
- **在 Azure 门户中查看触发的 Log Analytics 警报**：目前可在 Azure 门户中查看 Log Analytics 警报，以及来自其他源的警报。 以前，来自其他源的警报在单独的门户中。
- **触发的警报和警报规则的分离**：警报规则现在与警报有所区分。 警报规则是触发警报的条件定义。 警报是警报规则触发实例。
- **更好的工作流**：统一警报创作体验会引导你完成配置警报规则的过程。
 
与经典指标警报相比，指标警报已得到以下改进：

-   **延迟降低**：指标警报的运行频率可达每分钟一次。 经典指标警报始终每隔 5 分钟运行一次。 由于引入日志需要时间，日志警报的延迟仍然超过 1 分钟。 
-   **支持多维指标**：可以针对维度指标发出警报，也就是可以监视特定的指标实例。
-   **对指标条件进行更好的控制**：可以定义更丰富的警报规则用于支持指标最大、最小、平均和总计值的监视。
-   **综合监视多个指标**：最多可以使用单个规则监视两个指标。 如果两个指标在指定时间段内违反其各自的阈值，则会触发警报。
-   **日志中的指标**（受限公共预览版）：现在可提取某些进入 Log Analytics 的日志数据并将其转换为 Azure Monitor 指标，然后基于这些指标发出警报（就像其他指标一样）。 


## <a name="alert-rules"></a>警报规则
在跨不同的警报类型统一创作体验时，统一警报体验使用以下概念来区分警报规则和警报。

| Item | 定义 |
|:---|:---|
| 警报规则 | 用于创建警报的条件的定义。 警报规则由目标资源、信号、条件和逻辑构成。 仅当警报规则处于已启用状态时，该规则才处于活动状态。
| 目标资源 | 定义适用于警报的特定资源和信号。 目标可以是任何 Azure 资源。<br><br>示例：虚拟机、存储帐户、虚拟机规模集、Log Analytics 工作区和 Application Insights 资源 |
| 信号 | 目标资源发出的数据的源。 支持的信号类型包括指标、活动日志、Application Insights 和日志。 |
| 条件 | 应用于目标资源的信号和逻辑的组合。<br><br>示例：百分比 CPU > 70%、服务器响应时间 > 4 毫秒、日志查询的结果计数 > 100，等等 |
| 逻辑 | 用户定义的逻辑，用于验证信号是否在预期的范围/值内。 |
| 操作 | 触发警报时要执行的操作。 触发警报时，可以执行多个操作。 这些警报支持操作组。<br><br>示例：向电子邮件地址发送邮件、调用 Webhook URL |
| 监视条件 | 指示产生指标警报的条件是否已得到解决。 指标警报规则定期对特定的指标采样。 如果满足警报规则中的条件，则创建条件为“已触发”的新警报。  再次对该指标采样时，如果仍满足条件，则不执行任何操作。  如果不再满足条件，则将警报条件更改为“已解决”。 下次满足条件时，会创建条件为“已触发”的另一个警报。 |


## <a name="alert-pages"></a>警报页
统一警报提供单个位置用于查看和管理所有 Azure 警报。 以下部分介绍统一体验每个页面的功能。

### <a name="alerts-overview-page"></a>“警报概述”页
“警报”概述页显示所有已触发警报的聚合汇总，以及已启用的警报规则总数。 更改订阅或筛选器参数可以更新聚合和已触发警报列表。

 ![警报概述](./media/monitoring-overview-unified-alerts/alerts-preview-overview2.png) 

### <a name="alert-rules-management"></a>警报规则管理
“规则”是单个页面，用于跨 Azure 订阅管理所有警报规则。 此页列出所有警报规则，这些规则可以根据目标资源、资源组、规则名称或状态排序。 还可以在此页中编辑、启用或禁用警报规则。

 ![警报规则](./media/monitoring-overview-unified-alerts/alerts-preview-rules.png)


## <a name="create-an-alert-rule"></a>创建警报规则
可以通过一致的方式创作警报，而不考虑监视服务或信号类型。 单个页面中提供了所有触发的警报和相关详细信息。
 
使用以下三个步骤创作新警报规则：
1. 选取警报的目标。
1. 从目标的可用信号中选择信号。
1. 指定要应用到信号中数据的逻辑。
 
这个创作过程经过了简化，用户在选择 Azure 资源之前，不再需要知道受支持的监视源或信号。 可用信号列表会根据选定的目标资源自动筛选，并引导你定义警报规则的逻辑。

可以在[使用 Azure Monitor 创建、查看和管理警报](monitor-alerts-unified-usage.md)中详细了解如何创建警报规则。

警报可在多个 Azure 监视服务中使用。 有关如何以及何时使用其中每种服务的信息，请参阅[监视 Azure 应用程序和资源](./monitoring-overview.md)。 下表提供了 Azure 中提供的警报规则类型的列表。 其中还列出了统一警报体验目前支持哪些类型。

| **监视器源** | **信号类型**  | **说明** | 
|-------------|----------------|-------------|
| Azure Monitor | 指标  | 也称为[近实时指标警报](monitoring-near-real-time-metric-alerts.md)，这些指标警报支持以一分钟一次的频率对指标条件进行评估，并且允许多指标和多维指标规则。 [Azure 门户中 Azure 服务的新型指标警报](monitoring-near-real-time-metric-alerts.md#metrics-and-dimensions-supported)提供了支持的资源类型列表。<br>新警报体验不支持[经典指标警报](monitoring-overview-alerts.md)。 可以在 Azure 门户中的“警报(经典)”下找到这些警报。 经典警报支持某些尚未移到新版警报的指标类型。 有关完整列表，请参阅[支持的指标](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-supported-metrics)。 |
| Log Analytics | 日志  | 当日志搜索查询满足特定的条件时，会收到通知（此时也可让系统运行自动化操作）。 Log Analytics 中的警报[正在复制到新体验](monitoring-alerts-extend.md)。 可以使用 [*Log Analytics 日志即指标*预览版](monitoring-alerts-extend-tool.md)。 使用预览版可以提取特定类型的日志并将其转换为指标，然后，可以使用新的警报体验基于它们发出警报。 如果想要连同本机 Azure Monitor 指标一起获取非 Azure 日志，则预览版非常有用。 |
| 活动日志 | 活动日志 | 包含通过选定目标创建的所有创建、更新和删除操作的记录。 |
| 服务运行状况 | 活动日志  | 在统一警报中不受支持。 请参阅[创建有关服务通知的活动日志警报](monitoring-activity-log-alerts-on-service-notifications.md)。  |
| Application Insights | 日志  | 包含具有应用程序的性能详细信息的日志。 通过使用分析查询，可以基于应用程序数据定义要执行的操作的条件。 |
| Application Insights | 指标 | 在统一警报中不受支持。 请参阅[指标警报](../application-insights/app-insights-alerts.md)。 |
| Application Insights | Web 可用性测试 | 在统一警报中不受支持。  请参阅 [Web 测试警报](../application-insights/app-insights-monitor-web-app-availability.md)。 适用于任何经检测可将数据发送到 Application Insights 的网站。 网站的可用性或响应度低于预期时，就会收到通知。 |

## <a name="enhanced-unified-alerts-public-preview"></a>增强型统一警报（公共预览版）

2018 年 6 月 1 日，Azure Monitor 公共预览版中已发布增强型统一警报体验。 此体验立足于 2018 年 3 月发布的[统一警报](#overview)的优势，并提供管理和聚合各个警报以及修改警报状态的功能。 本部分介绍新功能，以及如何在 Azure 门户的新警报页面之间导航。

### <a name="enhanced-unified-alerts"></a>增强型统一警报

新体验提供经典统一体验所不能提供的以下功能：

- **跨订阅查看警报**：现在，可以在单个视图中跨多个订阅查看和管理警报的单个实例。
- **管理警报的状态**：现在，警报提供一个状态，用于指示它们是否已确认关闭。
- **使用智能组来组织警报**：智能组自动将相关警报组合在一起，以便将其作为一个集进行管理，而不是单独进行管理。

### <a name="enable-enhanced-unified-alerts"></a>启用增强型统一警报
选择“警报”页顶部的标题即可启用新的统一警报体验。 此过程会创建一个警报存储，用于包含各个受支持服务在过去 30 天已触发的警报。 启用新体验后，可以通过选择标题在新旧体验之间来回切换。

> [!NOTE]
>  首次启用新体验时可能需要几分钟时间。

![标题](media/monitoring-overview-unified-alerts/opt-in-banner.png)

启用新体验时，会登记你有权访问的所有订阅。 尽管已启用整个订阅，但只有选择了新体验的用户才能查看该订阅。 有权访问该订阅的其他用户必须单独启用体验。

启用新警报体验不会影响操作组的配置或警报规则中的通知， 而只会更改在 Azure 门户中查看和管理触发的警报实例的方式。

### <a name="smart-groups"></a>智能组
智能组允许将相关警报作为一个单位进行管理，而无需管理各个警报，从而减少了干扰。 可以查看智能组的详细信息，并像设置警报状态一样设置智能组的状态。 每个警报是一个（且仅限一个）智能组的成员。

智能组是使用机器学习自动创建的，用于将表示单个问题的相关警报组合在一起。 创建某个警报时，算法会根据历史模式、相似属性和相似结构等信息，将其添加到新智能组或现有智能组。 

目前，算法只考虑来自订阅中同一监视服务的警报。 通过这种合并，智能组最大可将警报干扰降低 99%。 可以在智能组详细信息页中查看将警报包含在组中的原因。

智能组的名称是其第一个警报的名称。 无法创建或重命名智能组。


### <a name="alert-states"></a>警报状态
增强型统一警报引入了警报状态的概念。 可以设置警报状态来指定它在解决过程中所处的阶段。 创建警报时，它的状态为“新”。 可以在确认警报和关闭警报时更改状态。 所有状态更改都存储在警报历史记录中。

支持以下警报状态。

| 省/直辖市/自治区 | Description |
|:---|:---|
| 新建 | 只是检测到了问题，但尚未审查问题。 |
| 已确认 | 管理员已审查警报，并已开始进行处理。 |
| 已关闭 | 问题已解决。 关闭某个警报后，可通过将其更改为另一种状态来重新打开它。 |

警报状态不同于监视条件。 不再满足错误条件时，指标警报规则可将警报设置为“已解决”条件。 警报状态由用户设置，与监视条件无关。 尽管系统能将监视条件设置为“已解决”，但在用户更改警报之前，警报状态不会更改。

#### <a name="change-the-state-of-an-alert-or-smart-group"></a>更改警报或智能组的状态
可以更改单个警报的状态，或者通过设置智能组的状态来统一管理多个警报。

通过选择警报详细信息视图中的“更改警报状态”，可以更改警报的状态。 或者通过选择智能组详细信息视图中的“更改智能组状态”来更改智能组的状态。 在列表视图中选择多个项，然后选择页面顶部的“更改状态”，即可一次性更改多个项的状态。 

在这两种情况下，请从下拉菜单中选择新状态。 然后提供注释（可选）。 如果更改单个项，则还可以选择将相同的更改应用到智能组中的所有警报。

![更改状态](media/monitoring-overview-unified-alerts/change-tate.png)

### <a name="alerts-page"></a>“警报”页
默认的“警报”页提供特定时间范围内创建的警报的摘要。 该页显示每种严重性的警报总数，列中会标识处于每种状态的、具有每种严重性的警报总数。 选择任一严重性可打开按该严重性筛选的“[所有警报](#all-alerts-page)”页。

![“警报”页](media/monitoring-overview-unified-alerts/alerts-page.png)

可以通过选择页面顶部的下拉菜单中的值，来对此视图进行筛选。

| 列 | Description |
|:---|:---|
| 订阅 | 最多可选择五个 Azure 订阅。 只有选定订阅中的警报才会包含在视图中。 |
| 资源组 | 选择单个资源组。 只有包含选定资源组中的目标的警报才会包含在视图中。 |
| 时间范围 | 只有在选定时间范围内触发的警报才会包含在该视图中。 支持的值为过去 1 小时、过去 24 小时、过去 7 天和过去 30 天。 |

选择“警报”页面顶部的以下值打开另一个页面。

| 值 | Description |
|:---|:---|
| 警报总数 | 符合选定条件的警报总数。 选择此值会打开未经筛选的“所有警报”视图。 |
| 智能组 | 从符合选定条件的警报创建的智能组总数。 选择此值会在“所有警报”视图中打开智能组列表。
| 警报规则总数 | 选定订阅和资源组中的警报规则总数。 选择此值会打开根据选定订阅和资源组筛选的“规则”视图。


### <a name="all-alerts-page"></a>“所有警报”页 
在“所有警报”页中可以查看在选定时间范围内创建的警报列表。 可以查看各个警报的列表，或包含这些警报的智能组列表。 选择页面顶部的标题可在视图之间进行切换。

![“所有警报”页](media/monitoring-overview-unified-alerts/all-alerts-page.png)

可以通过选择页面顶部的下拉菜单中的以下值，可以对该视图进行筛选。

| 列 | Description |
|:---|:---|
| 订阅 | 最多可选择五个 Azure 订阅。 只有选定订阅中的警报才会包含在视图中。 |
| 资源组 | 选择单个资源组。 只有包含选定资源组中的目标的警报才会包含在视图中。 |
| 资源类型 | 选择一个或多个资源类型。 只有包含选定类型中的目标的警报才会包含在视图中。 仅在指定资源组后，才显示此列。 |
| 资源 | 选择资源。 只有包含该资源（作为目标）的警报才会包含在视图中。 仅在指定资源类型后，才显示此列。 |
| Severity | 选择警报严重性，或选择“所有”以包含所有严重性的警报。 |
| 监视条件 | 选择监视条件，或选择“所有”以包括所有条件的警报。 |
| 警报状态 | 选择警报状态，或选择“所有”以包含所有状态的警报。 |
| 监视服务 | 选择一个服务，或选择“所有”以包含所有服务。 只会包含使用该服务（作为目标）的规则创建的警报。 |
| 时间范围 | 只有在选定时间范围内触发的警报才会包含在该视图中。 支持的值为过去 1 小时、过去 24 小时、过去 7 天和过去 30 天。 |

选择页面顶部的“列”可以选择要显示的列。 

### <a name="alert-detail-page"></a>“警报详细信息”页
选择某个警报时，会显示“警报详细信息”页。 该页提供警报详细信息，并可在其中更改警报的状态。

![警报详细信息](media/monitoring-overview-unified-alerts/alert-detail.png)

“警报详细信息”页包括以下部分。

| 部分 | Description |
|:---|:---|
| 概要 | 显示警报的属性和其他重要信息。 |
| 历史记录 | 列出警报执行的每个操作，以及对警报进行的任何更改。 目前仅限状态更改。 |
| 智能组 | 有关包含警报的智能组的信息。 “警报计数”表示包含在智能组中的警报数量。 这包括过去 30 天内创建的、同一智能组中的其他警报。  此计数不考虑警报列表页中的时间筛选器。 选择某个警报以查看其详细信息。 |
| 更多详细信息 | 显示警报的其他上下文信息，此信息通常特定于创建此警报的源类型。 |


### <a name="smart-group-detail-page"></a>“智能组详细信息”页
选择某个智能组时，会显示“智能组详细信息”页。 该页提供智能组的详细信息（包括创建该组的原因），并可在其中更改智能组的状态。
 
![智能组详细信息](media/monitoring-overview-unified-alerts/smart-group-detail.png)


“智能组详细信息”页包括以下部分。

| 部分 | Description |
|:---|:---|
| 警报 | 列出智能组中包含的各个警报。 选择某个警报会打开它的“警报详细信息”页。 |
| 历史记录 | 列出智能组执行的每个操作，以及对智能组进行的任何更改。 目前仅限状态更改和警报成员身份更改。 |

## <a name="next-steps"></a>后续步骤
- [了解如何使用全新警报体验创建、查看和管理警报](monitor-alerts-unified-usage.md)
- [了解警报体验中的日志警报](monitor-alerts-unified-log.md)
- [了解警报体验中的指标警报](monitoring-near-real-time-metric-alerts.md)
- [了解警报体验中的活动日志警报](monitoring-activity-log-alerts-new-experience.md)
