---
title: Azure 표준 Load Balancer 및 가용성 영역
titleSuffix: Azure Load Balancer
description: 了解此学习途径后，开始 Azure 标准负载均衡器和可用性区域。
services: load-balancer
documentationcenter: na
author: asudbring
ms.custom: seodec18
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/07/2019
ms.author: allensu
ms.openlocfilehash: 0d61ad33b97b97c3a45334704544d72809e56848
ms.sourcegitcommit: f52ce6052c795035763dbba6de0b50ec17d7cd1d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/24/2020
ms.locfileid: "76715275"
---
# <a name="standard-load-balancer-and-availability-zones"></a>표준 Load Balancer 및 가용성 영역

Azure 标准负载均衡器支持[可用性区域](../availability-zones/az-overview.md)方案。 你可以使用标准负载均衡器在端到端方案中优化可用性，方法是将资源与区域对齐并跨区域分布。  查看[可用性区域](../availability-zones/az-overview.md)，获取有关可用性区域的指导、当前支持可用性区域的区域以及其他相关概念和产品。 可用性区域与标准负载均衡器结合在一起，这是一个可创建多种不同方案的大规模而灵活的功能集。  이러한 [개념](#concepts)과 기본 시나리오 [디자인 지침](#design)을 이해하려면 이 문서를 검토하세요.

>[!IMPORTANT]
>查看[可用性区域](../availability-zones/az-overview.md)相关主题，包括任何特定于区域的信息。

## <a name="concepts"></a> Load Balancer에 적용된 가용성 영역 개념

Load Balancer 리소스와 실제 인프라 사이에는 직접적인 관계가 없습니다. 따라서 Load Balancer를 만들어도 인스턴스가 만들어지지 않습니다. Load Balancer 리소스는 만들려는 시나리오를 달성하기 위해 Azure에서 미리 빌드된 다중 테넌트 인프라를 프로그래밍해야 하는 방법을 표현할 수 있는 개체입니다.  这在可用性区域的上下文中非常重要，因为单个负载均衡器资源可以控制多个可用性区域中的基础结构的编程，而区域冗余服务作为从客户的观点显示的一个资源。  

Load Balancer 리소스 자체는 지역이며 영역이 될 수 없습니다.  그리고 VNet과 서브넷은 항상 지역이며 영역이 될 수 없습니다. 你可以配置的内容的粒度受前端、规则和后端池定义的每个配置约束。

在可用性区域的上下文中，负载均衡器规则的行为和属性被描述为区域冗余或区域。  영역 중복 및 구역은 속성의 영역 조건(zonality)을 나타냅니다.  在负载均衡器的上下文中，区域冗余始终表示*多个区域*，而区域是指将服务隔离到一个*区域*。

공용 및 내부 Load Balancer 모두는 영역 중복 시나리오 및 영역 시나리오를 지원하며, 필요에 따라 둘 다 영역을 통해 트래픽을 보낼 수 있습니다(*영역 간 부하 분산*). 

### <a name="frontend"></a>프런트 엔드

负载均衡器前端是指引用虚拟网络资源子网中的公共 IP 地址资源或专用 IP 地址的前端 IP 配置。  서비스가 노출되는 부하 분산된 엔드포인트를 형성합니다.

负载均衡器资源可以同时包含带有区域和区域冗余前端的规则。 

当向某个区域保证了公共 IP 资源或专用 IP 地址时，局域性（或缺少其情况）不是可变的。  如果要更改或省略公共 IP 或专用 IP 地址前端的局域性，则需要在相应的区域中重新创建公共 IP。  可用性区域不会更改多个前端的约束，请查看[多个前端的负载均衡器](load-balancer-multivip-overview.md)，了解此功能的详细信息。

#### <a name="zone-redundant-by-default"></a>기본으로서의 중복 영역

在具有可用性区域的区域中，默认情况下，标准负载均衡器前端是区域冗余的。  区域冗余指区域中的多个可用性区域同时使用单个 IP 地址提供所有入站或出站流。 DNS 중복 구성표는 필요하지 않습니다. 单个前端 IP 地址可以在区域故障后出现，并且可用于访问所有（不受影响）的后端池成员，而不考虑区域。 一个或多个可用性区域可能会失败，并且数据路径置，只要区域中的一个区域仍处于正常状态。 前端的单个 IP 地址由多个可用性区域中的多个独立基础结构部署同时提供服务。  这并不意味着意味着数据路径，但任何重试或重新建立都将在不受区域故障影响的其他区域成功。   

以下摘录说明了如何定义公共 IP，以用于公用标准负载均衡器的区域冗余的公共 IP 地址。 구성에서 기존 Resource Manager 템플릿을 사용하는 경우 이러한 템플릿에 **sku** 섹션을 추가합니다.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "public_ip_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
```

以下摘录说明了如何为内部标准负载均衡器定义区域冗余的前端 IP 地址。 구성에서 기존 Resource Manager 템플릿을 사용하는 경우 이러한 템플릿에 **sku** 섹션을 추가합니다.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/loadBalancers",
            "name": "load_balancer_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
            "properties": {
                "frontendIPConfigurations": [
                    {
                        "name": "zone_redundant_frontend",
                        "properties": {
                            "subnet": {
                                "Id": "[variables('subnetRef')]"
                            },
                            "privateIPAddress": "10.0.0.6",
                            "privateIPAllocationMethod": "Static"
                        }
                    },
                ],
```

前面的摘录不是完整的模板，但旨在说明如何表达可用性区域属性。  需要将这些语句合并到模板中。

#### <a name="optional-zone-isolation"></a>可选区域隔离

*영역 프런트 엔드*라고 하는 단일 영역에 대한 프런트 엔드를 보장하도록 선택할 수 있습니다.  즉, 모든 인바운드 또는 아웃바운드 흐름이 한 지역의 단일 영역에서 처리됩니다.  프런트 엔드는 영역의 상태와 수명을 공유합니다.  데이터 경로는 보장된 영역 이외의 영역에서 오류가 발생해도 영향을 받지 않습니다. 영역 프런트 엔드를 사용하여 가용성 영역별 IP 주소를 공개할 수 있습니다.  

此外，可以直接对每个区域中的负载均衡终结点使用区域前端。 또한 이를 통해 부하 분산된 영역별 엔드포인트를 공개하여 각 영역을 개별적으로 모니터링할 수도 있습니다.  对于公用终结点，你可以将它们与[流量管理器](../traffic-manager/traffic-manager-overview.md)等 dns 负载平衡产品集成，并使用单个 DNS 名称。 然后，客户端会将此 DNS 名称解析为多个区域性 IP 地址。  

이러한 개념(동일한 백 엔드에 대한 영역 중복 및 영역)을 혼합하려면 [Azure Load Balancer의 다중 프런트 엔드](load-balancer-multivip-overview.md)를 검토하세요.

对于公共负载均衡器前端，请将*区域*参数添加到由各自规则使用的前端 IP 配置所引用的公共 ip 资源。

내부 Load Balancer 프런트 엔드의 경우 내부 Load Balancer 프런트 엔드 IP 구성에 *zones* 매개 변수를 추가합니다. 영역 프런트 엔드는 Load Balancer에서 특정 영역에 대한 서브넷의 IP 주소를 보장하도록 합니다.

以下摘录说明了如何在可用性区域1中定义区域性标准公共 IP 地址。 구성에서 기존 Resource Manager 템플릿을 사용하는 경우 이러한 템플릿에 **sku** 섹션을 추가합니다.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "public_ip_standard",
            "location": "region",
            "zones": [ "1" ],
            "sku":
            {
                "name": "Standard"
            },
```

以下摘录说明了如何在可用性区域1中定义内部标准负载均衡器前端。 구성에서 기존 Resource Manager 템플릿을 사용하는 경우 이러한 템플릿에 **sku** 섹션을 추가합니다. 또한 자식 리소스에 대한 프런트 엔드 IP 구성에 **zones** 속성을 정의합니다.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/loadBalancers",
            "name": "load_balancer_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
            "properties": {
                "frontendIPConfigurations": [
                    {
                        "name": "zonal_frontend_in_az1",
                        "zones": [ "1" ],
                        "properties": {
                            "subnet": {
                                "Id": "[variables('subnetRef')]"
                            },
                            "privateIPAddress": "10.0.0.6",
                            "privateIPAllocationMethod": "Static"
                        }
                    },
                ],
```

前面的摘录不是完整的模板，但旨在说明如何表达可用性区域属性。  需要将这些语句合并到模板中。

### <a name="cross-zone-load-balancing"></a>영역 간 부하 분산

영역 간 부하 분산은 Load Balancer에서 모든 영역의 백 엔드 엔드포인트에 연결하는 기능이며 프런트 엔드 및 해당 영역 조건과는 별개입니다.  任何负载均衡规则均可针对任何可用性区域或区域实例中的后端实例。

你需要小心地以表示可用性区域概念的方式构造方案。 例如，你需要保证你的虚拟机部署在一个或多个区域内，并将区域前端和区域性后端资源对齐到相同区域。  如果仅使用区域资源来交叉可用性区域，则该方案将正常工作，但对于可用性区域可能不具有明确的故障模式。 

### <a name="backend"></a>백 엔드

负载均衡器适用于虚拟机实例。  它们可以是独立的、可用性集或虚拟机规模集。  单个虚拟网络中的任何虚拟机实例都可以是后端池的一部分，而不管该虚拟机是否可保证某个区域或保证哪个区域。

如果希望使用单个区域对齐和保证前端和后端，只需将同一区域中的虚拟机放入相应的后端池。

如果要跨多个区域对虚拟机进行寻址，只需将多个区域中的虚拟机放入同一后端池。  가상 머신 확장 집합을 사용할 때 하나 이상의 가상 머신 확장 집합을 동일한 백 엔드 풀에 배치할 수 있습니다.  또한 각 가상 머신 확장 집합은 하나 또는 여러 영역에 있을 수 있습니다.

### <a name="outbound-connections"></a>아웃바운드 연결

对于[出站连接](load-balancer-outbound-connections.md)，将使用相同的区域冗余和区域性属性。  用于出站连接的区域冗余公共 IP 地址由所有区域提供。 区域性公共 IP 地址仅由其保证的区域提供服务。  发生区域故障时，出站连接 SNAT 端口分配将继续提供出站 SNAT 连接，如果不受区域故障的影响。  如果流由受影响的区域提供，则这可能需要传输或为区域冗余方案重新建立连接。  不受影响的区域之外的区域中的流不受影响。

SNAT 端口预先分配算法与或没有可用性区域相同。

### <a name="health-probes"></a>상태 프로브

现有的运行状况探测定义保持不变，因为它们没有可用性区域。  但是，我们在基础结构级别展开了运行状况模型。 

使用区域冗余的前端时，负载均衡器会扩展其内部运行状况模型，以便从每个可用性区域单独探测虚拟机的可访问性，并跨区域关闭路径，而无需客户介入。  如果给定路径不可从一个区域的负载均衡器基础结构中访问另一个区域中的虚拟机，则负载均衡器可以检测并避免此故障。 이 VM에 연결할 수 있는 다른 영역은 해당 프런트 엔드에서 VM을 계속 처리할 수 있습니다.  因此，在发生故障的情况下，每个区域可能会略微不同地分布新流，同时保护端到端服务的总体运行状况。

## <a name="design"></a> 디자인 고려 사항

负载均衡器在可用性区域的上下文中特意灵活。 您可以选择对齐区域，也可以为每个规则选择 "区域冗余"。  가용성이 증가하면 복잡성이 증가할 수 있으며, 최적의 성능에 맞게 가용성을 설계해야 합니다.  몇 가지 중요한 디자인 고려 사항에 대해 살펴보겠습니다.

### <a name="automatic-zone-redundancy"></a>자동 영역 중복

Load Balancer를 사용하면 단일 IP를 영역 중복 프런트 엔드로 간단하게 만들 수 있습니다. 영역 중복 IP 주소는 모든 영역에서 영역 리소스를 안전하게 처리할 수 있으며, 지역 내에서 하나의 영역이 정상 상태로 유지되는 동안 하나 이상의 영역 오류에서 존속할 수 있습니다. 반대로, 영역 프런트 엔드는 서비스를 단일 영역으로 축소하고 각 영역과 수명을 공유합니다.

영역 중복은 명시적으로 데이터 평면이며, 비충돌 데이터 경로 또는 제어 평면을 의미하지 않습니다. 영역 중복 흐름은 모든 영역을 사용할 수 있으며, 고객의 흐름에서는 한 지역의 모든 정상 영역을 사용합니다. 영역 오류가 발생하는 경우 해당 시점에서 정상 영역을 사용하는 트래픽 흐름은 영향을 받지 않습니다.  区域发生故障时使用区域的流量可能会受到影响，但应用程序可以恢复。 一旦 Azure 围绕区域发生故障，则在重新传输或重新建立时，这些流可在区域内的剩余正常区域中继续进行。

### <a name="xzonedesign"></a> 영역 간 경계

엔드투엔드 서비스가 영역을 교차할 때마다 하나의 영역이 아니라 잠재적으로 여러 영역과 수명을 공유한다는 것을 이해하는 것이 중요합니다.  결과적으로 엔드투엔드 서비스에서 비영역 배포를 통해 가용성을 얻지 못할 수 있습니다.

避免引入不需要的跨区域依赖项，这将在使用可用性区域时废除可用性提升。  애플리케이션이 여러 구성 요소로 구성되어 있고 영역 오류에 대한 복원력을 유지하려는 경우 영역 오류 발생 시 충분한 주요 구성 요소가 존속되도록 주의해야 합니다.  예를 들어 애플리케이션의 중요한 단일 구성 요소가 존속된 영역이 아닌 다른 영역에만 있는 경우 전체 애플리케이션에 영향을 줄 수 있습니다.  또한 영역 복원 및 애플리케이션에서 수렴하는 방법도 고려해야 합니다. 你需要了解应用程序对其部分故障的原因。 몇 가지 핵심 요점을 검토하고 질문에 대한 영감으로 사용하여 특정 시나리오에 대해 충분히 생각해 보겠습니다.

- 如果你的应用程序具有两个组件（例如 IP 地址）和一个具有托管磁盘的虚拟机，并且在区域1和区域2中得到了保证，则当区域1发生故障时，端到端服务将不会保留下来。  不要跨区域使用区域性方案，除非你完全了解你要创建潜在的危险故障模式。  此方案允许提供灵活性。

- 如果你的应用程序包含两个组件（例如 IP 地址）和一个具有托管磁盘的虚拟机，并且这些组件分别保证为区域冗余和区域1，则你的端到端服务将在区域2、区域3的区域故障后仍然存在，如果区域1已失败，则不会出现。  그러나 프런트 엔드의 연결을 관찰하는 경우 서비스의 상태에 대한 이유를 추론할 수 있는 일부 기능이 손실됩니다.  더 광범위한 상태 및 용량 모델을 개발하는 것이 좋습니다.  영역 중복 및 영역 개념을 함께 사용하여 통찰력과 관리 효율성을 확장할 수 있습니다.

- 애플리케이션에 두 가지 구성 요소(예: 영역 중복 Load Balancer 프런트 엔드 및 세 개 영역에 있는 영역 간 가상 머신 확장 집합)가 있는 경우, 오류의 영향을 받지 않는 영역의 리소스를 사용할 수 있지만 영역 오류 발생 시 엔드투엔드 서비스 용량은 감소할 수 있습니다. 인프라 관점에서 볼 때 배포는 하나 이상의 영역 오류에서 존속될 수 있으며, 다음과 같은 질문이 제기됩니다.
  - 애플리케이션에서 이러한 오류 및 용량 저하에 대한 이유를 추론하는 방법을 이해하고 있습니까?
  - 필요한 경우 지역 쌍에 장애 조치를 강제로 적용하기 위해 서비스에 세이프가드가 필요합니까?
  - 이러한 시나리오는 어떻게 모니터링, 검색 및 완화합니까? 표준 Load Balancer 진단을 사용하여 엔드투엔드 서비스 성능의 모니터링을 보강할 수 있습니다. 전체적인 그림에서 사용 가능한 항목과 보강해야 하는 항목을 고려하세요.

- 영역은 오류를 더 쉽게 이해하고 포함하도록 만들 수 있습니다.  그러나 시간 제한, 재시도 및 백오프 알고리즘과 같은 개념에 있어 영역 오류는 다른 오류와 차이가 없습니다. Azure Load Balancer는 영역 중복 경로를 제공하고 패킷 수준에서 실시간으로 신속하게 복구하려고 하지만, 오류가 발생하는 동안 재전송 또는 재설정이 발생할 수 있으며 애플리케이션에서 이 오류에 대응하는 방법을 이해해야 합니다. 부하 분산 체계는 유지되지만 다음 질문에 대한 계획이 필요합니다.
  - 영역에 오류가 발생하면 엔드투엔드 서비스에서 이를 이해하고, 상태가 손실되면 어떻게 복구하나요?
  - 영역이 반환되면 애플리케이션에서 안전하게 수렴하는 방법을 이해하고 있습니까?

查看[Azure 云设计模式](https://docs.microsoft.com/azure/architecture/patterns/)，以提高应用程序在故障情况下的复原能力。

### <a name="zonalityguidance"></a> 영역 중복 및 영역

区域冗余可以通过区域不可知的选项，并且可以在具有服务的单个 IP 地址的同一时间弹性选项上简化。  이에 따라 복잡성을 줄일 수 있습니다.  영역 중복은 영역 간 이동성을 가지고 있으며 모든 영역의 리소스에서 안전하게 사용할 수도 있습니다.  此外，还将在不包含可用性区域的区域中进行身份验证，这可以限制在某个区域获取可用性区域后所需的更改。  区域冗余 IP 地址或前端的配置语法在任何区域（包括没有可用性区域的区域）都成功：资源的区域：属性内未指定区域。

区域性可以向区域提供显式保证，并与区域的运行状况明确共享命运。 如果附加资源是同一区域中的区域虚拟机，则创建具有区域性 IP 地址前端或区域性内部负载均衡器前端的负载均衡器规则是理想的做法。  或者，您的应用程序可能需要明确了解资源在哪个区域中的位置，并且您希望在单独的区域中显式了解可用性。  영역 전체에서 분산된 엔드투엔드 서비스에 대해 여러 영역 프런트 엔드를 공개하도록 선택할 수 있습니다(즉, 여러 영역 가상 머신 확장 집합에 대해 영역 프런트 엔드별).  그리고 영역 프런트 엔드가 공용 IP 주소인 경우, [Traffic Manager](../traffic-manager/traffic-manager-overview.md)를 사용하여 서비스를 공개하는 데 이러한 여러 영역 프런트 엔드를 사용할 수 있습니다.  또는 여러 영역 프런트 엔드를 사용하여 타사 모니터링 솔루션을 통해 영역별 상태 및 성능 정보를 얻고, 영역 중복 프런트 엔드를 사용하여 전체 서비스를 공개할 수 있습니다. 동일한 영역에 맞게 조정된 영역 프런트 엔드가 있는 영역 리소스만 처리하고, 영역 리소스에 잠재적으로 위험한 영역 간 시나리오는 방지해야 합니다.  仅存在可用性区域的区域中存在区域性资源。

서비스 아키텍처를 알지 못하면 다른 서비스보다 더 나은 선택이라는 일반적인 지침이 없습니다.  查看[Azure 云设计模式](https://docs.microsoft.com/azure/architecture/patterns/)，以提高应用程序在故障情况下的复原能力。

## <a name="next-steps"></a>다음 단계
- [가용성 영역](../availability-zones/az-overview.md)에 대해 자세히 알아보기
- [표준 Load Balancer](load-balancer-standard-overview.md)에 대해 자세히 알아봅니다.
- [영역 프런트 엔드를 통해 표준 Load Balancer를 사용하여 영역 내에 VM을 부하 분산](load-balancer-standard-public-zonal-cli.md)하는 방법에 대해 알아보기
- [영역 중복 프런트 엔드를 통해 표준 Load Balancer를 사용하여 영역에서 VM을 부하 분산](load-balancer-standard-public-zone-redundant-cli.md)하는 방법에 대해 알아보기
- 了解[Azure 云设计模式](https://docs.microsoft.com/azure/architecture/patterns/)，以提高应用程序在故障情况下的复原能力。
