---
title: Azure 标准负载均衡器和可用性区域
titleSuffix: Azure Load Balancer
description: 了解此学习途径后，开始 Azure 标准负载均衡器和可用性区域。
services: load-balancer
documentationcenter: na
author: asudbring
ms.custom: seodec18
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/30/2020
ms.author: allensu
ms.openlocfilehash: 5ecfbc610bfa62f723e0a02b8cdeb52cd33fb5cd
ms.sourcegitcommit: c535228f0b77eb7592697556b23c4e436ec29f96
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/06/2020
ms.locfileid: "82853442"
---
# <a name="standard-load-balancer-and-availability-zones"></a>标准负载均衡器和可用性区域

Azure 标准负载均衡器支持[可用性区域](../availability-zones/az-overview.md)方案。 你可以使用标准负载均衡器在端到端方案中优化可用性，方法是将资源与区域对齐并跨区域分布。  查看[可用性区域](../availability-zones/az-overview.md)，获取有关可用性区域的指导、当前支持可用性区域的区域以及其他相关概念和产品。 可用性区域与标准负载均衡器结合在一起，这是一个可创建多种不同方案的大规模而灵活的功能集。  请查看本文档了解这些[概念](#concepts)和基本场景的[设计指南](#design)。

## <a name="availability-zones-concepts-applied-to-load-balancer"></a><a name="concepts"></a> 适用于负载均衡器的可用性区域概念

负载均衡器资源本身从其组件继承了区域配置：前端、规则和后端池定义。
在可用性区域的上下文中，负载均衡器规则的行为和属性被描述为区域冗余或区域。  在负载均衡器的上下文中，区域冗余始终表示*多个区域*，而区域是指将服务隔离到一个*区域*。
两种类型（公共、内部）负载均衡器都支持区域冗余和区域性方案，并且两者都可以根据需要将流量定向到各个区域。

## <a name="frontend"></a>前端

负载均衡器前端是指引用虚拟网络资源子网中的公共 IP 地址资源或专用 IP 地址的前端 IP 配置。  它构成了公开服务的负载均衡终结点。
负载均衡器资源可以同时包含带有区域和区域冗余前端的规则。 当向某个区域保证了公共 IP 资源或专用 IP 地址时，局域性（或缺少其情况）不是可变的。  如果要更改或省略公共 IP 或专用 IP 地址前端的局域性，则需要在相应的区域中重新创建公共 IP。  可用性区域不会更改多个前端的约束，请查看[多个前端的负载均衡器](load-balancer-multivip-overview.md)，了解此功能的详细信息。

### <a name="zone-redundant"></a>区域冗余 

在具有可用性区域的区域中，标准负载均衡器前端可以是区域冗余的。  区域冗余指区域中的多个可用性区域同时使用单个 IP 地址提供所有入站或出站流。 不需要 DNS 冗余方案。 单个前端 IP 地址可以在区域故障后出现，并且可用于访问所有（不受影响）的后端池成员，而不考虑区域。 一个或多个可用性区域可能会失败，并且数据路径置，只要区域中的一个区域仍处于正常状态。 前端的单个 IP 地址由多个可用性区域中的多个独立基础结构部署同时提供服务。  这并不意味着意味着数据路径，但任何重试或重新建立都将在不受区域故障影响的其他区域成功。   

### <a name="zonal"></a>剖面

可以选择将某个前端指定为保证位于单个区域，这称为局域性前端。**  这意味着，任何入站或出站流将由某个区域中的单个局部区域提供。  前端的运行状态取决于该局部区域。  区域（保证前端所在的区域除外）中发生故障不会影响数据路径。 可以使用局域性前端来按可用性区域公开 IP 地址。  

此外，可以直接对每个区域中的负载均衡终结点使用区域前端。 还可以使用此前端来按区域负载均衡终结点公开 IP 地址，以单独监视每个区域。  对于公用终结点，你可以将它们与[流量管理器](../traffic-manager/traffic-manager-overview.md)等 dns 负载平衡产品集成，并使用单个 DNS 名称。 然后，客户端会将此 DNS 名称解析为多个区域性 IP 地址。  

如果想要混合使用这些概念（对同一个后端使用区域冗余和局域性配置），请查看 [Azure 负载均衡器的多个前端](load-balancer-multivip-overview.md)。

对于公共负载均衡器前端，请将*区域*参数添加到由各自规则使用的前端 IP 配置所引用的公共 ip 资源。

对于内部负载均衡器前端，需将 *zones* 参数添加到内部负载均衡器前端 IP 配置。 局域性前端能使负载均衡器保证某个子网中的 IP 地址位于特定的区域。

## <a name="backend"></a>后端

负载均衡器适用于虚拟机实例。  它们可以是独立的、可用性集或虚拟机规模集。  单个虚拟网络中的任何虚拟机实例都可以是后端池的一部分，而不管该虚拟机是否可保证某个区域或保证哪个区域。

如果希望使用单个区域对齐和保证前端和后端，只需将同一区域中的虚拟机放入相应的后端池。

如果要跨多个区域对虚拟机进行寻址，只需将多个区域中的虚拟机放入同一后端池。  使用虚拟机规模集时，可将一个或多个虚拟机规模集放入同一后端池。  其中的每个虚拟机规模集可以位于一个或多个区域。

## <a name="outbound-connections"></a>出站连接

对于[出站连接](load-balancer-outbound-connections.md)，将使用相同的区域冗余和区域性属性。  用于出站连接的区域冗余公共 IP 地址由所有区域提供。 区域性公共 IP 地址仅由其保证的区域提供服务。  发生区域故障时，出站连接 SNAT 端口分配将继续提供出站 SNAT 连接，如果不受区域故障的影响。  如果流由受影响的区域提供，则这可能需要传输或为区域冗余方案重新建立连接。  不受影响的区域之外的区域中的流不受影响。

SNAT 端口预先分配算法与或没有可用性区域相同。

## <a name="health-probes"></a>运行状况探测

现有的运行状况探测定义保持不变，因为它们没有可用性区域。  但是，我们在基础结构级别展开了运行状况模型。 

使用区域冗余的前端时，负载均衡器会扩展其内部运行状况模型，以便从每个可用性区域单独探测虚拟机的可访问性，并跨区域关闭路径，而无需客户介入。  如果给定路径不可从一个区域的负载均衡器基础结构中访问另一个区域中的虚拟机，则负载均衡器可以检测并避免此故障。 可以访问此 VM 的其他区域可继续从其各自的前端为此 VM 提供服务。  因此，在发生故障的情况下，每个区域可能会略微不同地分布新流，同时保护端到端服务的总体运行状况。

## <a name="design-considerations"></a><a name="design"></a>设计注意事项

负载均衡器在可用性区域的上下文中特意灵活。 您可以选择对齐区域，也可以为每个规则选择 "区域冗余"。  提高可用性的代价可能是增大复杂性，必须经过精心设计才能获得最佳性能。  让我们了解一些重要的设计注意事项。

### <a name="automatic-zone-redundancy"></a>自动区域冗余

使用负载均衡器可以轻松地将一个 IP 用作区域冗余的前端。 区域冗余的 IP 地址能够安全地为任何区域中的局域性资源提供服务，并且可以承受一个或多个区域的故障，前提是区域中有一个局部区域保持正常。 相反，局域性前端是在单个区域中部署服务的简化设计，其命运与相应的区域相同。

区域冗余并不意味着数据路径或控制平面不可访问；它是明确的数据平面。 区域冗余流可以使用任何局部区域，客户流使用区域中所有正常的局部区域。 出现区域故障时，在该时间点使用正常区域的流量流不受影响。  区域发生故障时使用区域的流量可能会受到影响，但应用程序可以恢复。 一旦 Azure 围绕区域发生故障，则在重新传输或重新建立时，这些流可在区域内的剩余正常区域中继续进行。

### <a name="cross-zone-boundaries"></a><a name="xzonedesign"></a>跨区域边界

请务必了解，每当端到端服务跨区域时，运行状况并不是取决于一个区域，而可能是多个区域。  因此，端到端服务可能无法通过非局域性部署获得任何可用性。

避免引入不需要的跨区域依赖项，这将在使用可用性区域时废除可用性提升。  如果应用程序由多个组件构成，而你希望能够从区域故障中恢复，则必须慎重确保在发生区域故障时，有足够的关键组件能够幸存。  例如，如果应用程序的单个关键组件只位于除幸存区域以外的其他某个区域，则该组件可能会影响整个应用程序。  另外，请考虑区域还原和应用程序的聚合方式。 你需要了解应用程序对其部分故障的原因。 让我们探讨几个要点，并在研究特定的场景时，将其用作解答问题的灵感。

- 如果你的应用程序具有两个组件（例如 IP 地址）和一个具有托管磁盘的虚拟机，并且在区域1和区域2中得到了保证，则当区域1发生故障时，端到端服务将不会保留下来。  不要跨区域使用区域性方案，除非你完全了解你要创建潜在的危险故障模式。  此方案允许提供灵活性。

- 如果你的应用程序包含两个组件（例如 IP 地址）和一个具有托管磁盘的虚拟机，并且这些组件分别保证为区域冗余和区域1，则你的端到端服务将在区域2、区域3的区域故障后仍然存在，如果区域1已失败，则不会出现。  但是，如果要观察的功能只是前端的可访问性，则在一定程度上无法推测服务的运行状况。  请考虑开发一个涵盖范围更广泛的运行状况和容量模型。  可以结合使用区域冗余和局域性的概念来拓宽见解和可管理性。

- 如果应用程序在三个区域中包含两个组件（例如区域冗余的负载均衡器前端和跨区域的虚拟机规模集），则区域中不受故障影响的资源将保持可用，但在发生区域故障期间，端到端服务的容量可能会下降。 从基础结构的角度看，部署可以在一个或多个区域发生故障时幸存。这就引出了以下问题：
  - 是否了解应用程序如何推测此类故障和容量下降的原因？
  - 是否需要在服务中采取防护措施，以便在必要时强制故障转移到某个区域对？
  - 如何监视、检测和缓解此类场景？ 有时可以使用标准负载均衡器诊断功能来增强端到端服务性能的监视。 全方位地考虑哪个服务会保持可用，哪个服务可能需要增强的监视。

- 使用区域可以更轻松地识别和遏制故障。  但是，在涉及到超时、重试和退让算法等概念时，区域故障与其他故障没有不同。 即使 Azure 负载均衡器提供区域冗余的路径并且会快速尝试恢复，但在实时数据包级别看，重新传输或重新建立可能在故障初期发生，因此，必须了解应用程序应对故障的方式。 负载均衡方案将会幸存，但需要规划好以下方面：
  - 发生区域故障时，端到端服务是否能够识别此故障；如果状态丢失，应如何恢复？
  - 当区域恢复正常时，应用程序是否知道如何安全聚合？

查看[Azure 云设计模式](https://docs.microsoft.com/azure/architecture/patterns/)，以提高应用程序在故障情况下的复原能力。

## <a name="next-steps"></a>后续步骤
- 详细了解[可用性区域](../availability-zones/az-overview.md)
- 详细了解[标准负载均衡器](load-balancer-standard-overview.md)
- 了解如何[使用具有区域性前端的标准负载均衡器在区域内对 VM 进行负载均衡](load-balancer-standard-public-zonal-cli.md)
- 了解如何[使用具有区域冗余前端的标准负载均衡器跨区域对 VM 进行负载均衡](load-balancer-standard-public-zone-redundant-cli.md)
- 了解[Azure 云设计模式](https://docs.microsoft.com/azure/architecture/patterns/)，以提高应用程序在故障情况下的复原能力。
