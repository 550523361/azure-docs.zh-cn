---
title: 映射数据流
description: Azure 数据工厂中的映射数据流的概述
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 12/19/2019
ms.openlocfilehash: 210c1814325e689dd70af9caa7fad08deed933e1
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/28/2020
ms.locfileid: "79243791"
---
# <a name="what-are-mapping-data-flows"></a>映射数据流是什么？

映射数据流是在 Azure 数据工厂中直观地设计的数据转换。 数据流允许数据工程师无需编写代码即可开发图形数据转换逻辑。 生成的数据流在 Azure 数据工厂管道中执行，这些活动使用横向扩展的 Spark 群集。 数据流活动可以通过现有的数据工厂调度、控制、流和监视功能进行操作。

映射数据流可提供完全可视的体验，无需编码。 您的数据流将在您自己的执行群集上运行，用于扩展的数据处理。 Azure 数据工厂处理所有代码转换、路径优化和数据流作业的执行。

## <a name="getting-started"></a>入门

要创建数据流，请在 **"工厂资源**"下选择加号，然后选择 **"数据流**"。 

![新数据流](media/data-flow/newdataflow2.png "新的数据流")

这将带您到数据流画布，您可以在其中创建转换逻辑。 选择 **"添加源**"以开始配置源转换。 有关详细信息，请参阅[源转换](data-flow-source.md)。

## <a name="data-flow-canvas"></a>数据流画布

数据流画布分为三个部分：顶部条形图、图形和配置面板。 

![Canvas](media/data-flow/canvas1.png "Canvas")

### <a name="graph"></a>图形

该图显示转换流。 它显示源数据的沿线，因为它流入一个或多个接收器。 要添加新源，请选择"**添加源**"。 要添加新转换，请选择现有转换右下角的加号。

![Canvas](media/data-flow/canvas2.png "Canvas")

### <a name="azure-integration-runtime-data-flow-properties"></a>Azure 集成运行时数据流属性

![“调试”按钮](media/data-flow/debugbutton.png "“调试”按钮")

当您开始在 ADF 中处理数据流时，您需要打开浏览器 UI 顶部的数据流的"调试"开关。 这将启动 Azure 数据砖块群集，用于交互式调试、数据预览和管道调试执行。 您可以通过选择自定义[Azure 集成运行时](concepts-integration-runtime.md)来设置正在使用的群集的大小。 上次数据预览或上次调试管道执行后，调试会话将保持生存状态长达 60 分钟。

使用数据流活动操作管道时，ADF 将使用与"运行打开"属性中[的活动](control-flow-execute-data-flow-activity.md)关联的 Azure 集成运行时。

默认 Azure 集成运行时是一个小型的 4 核单辅助节点群集，旨在允许您预览数据并以最低的成本快速执行调试管道。 如果要对大型数据集执行操作，则设置较大的 Azure IR 配置。

通过在 Azure IR 数据流属性中设置 TTL，可以指示 ADF 维护群集资源 （VM） 池。 这将导致后续活动的作业执行速度更快。

#### <a name="azure-integration-runtime-and-data-flow-strategies"></a>Azure 集成运行时和数据流策略

##### <a name="execute-data-flows-in-parallel"></a>并行执行数据流

如果在管道中并行执行数据流，ADF 将根据附加到每个活动的 Azure 集成运行时中的设置为每个活动启动单独的 Azure 数据砖块群集。 要在 ADF 管道中设计并行执行，请添加数据流活动，而 UI 中没有优先级约束。

在这三个选项中，此选项可能在最短的时间内执行。 但是，每个并行数据流将同时在单独的群集上执行，因此事件的顺序是非确定性的。

如果要在管道内并行执行数据流活动，建议不要使用 TTL。 这是因为同时使用相同的 Azure 集成运行时并行执行数据流将导致数据工厂的多个暖池实例。

##### <a name="overload-single-data-flow"></a>过载单数据流

如果将所有逻辑放在单个数据流中，ADF 都将在同一作业执行上下文中执行单个 Spark 群集实例。

此选项可能更难遵循和排除故障，因为您的业务规则和业务逻辑将混杂在一起。 此选项也无法提供多少可重用性。

##### <a name="execute-data-flows-serially"></a>串行执行数据流

如果在管道中串行执行数据流活动，并且在 Azure IR 配置上设置了 TTL，则 ADF 将重用计算资源 （VM），从而加快后续执行时间。 您仍然会为每个执行接收新的 Spark 上下文。

在这三个选项中，执行端到端可能需要最长的时间。 但它确实提供了每个数据流步骤中逻辑操作的完全分离。

### <a name="configuration-panel"></a>配置面板

配置面板显示特定于当前所选转换的设置。 如果未选择转换，则显示数据流。 在总体数据流配置中，您可以在 **"常规**"选项卡下编辑名称和说明，或通过 **"参数"** 选项卡添加参数。有关详细信息，请参阅[映射数据流参数](parameters-data-flow.md)。

每个转换至少有四个配置选项卡。

#### <a name="transformation-settings"></a>转换设置

每个转换的配置窗格中的第一个选项卡包含特定于该转换的设置。 有关详细信息，请参阅该转换的文档页。

![源设置选项卡](media/data-flow/source1.png "源设置选项卡")

#### <a name="optimize"></a>优化

"**优化**"选项卡包含用于配置分区方案的设置。

![优化](media/data-flow/optimize1.png "优化")

默认设置是 **"使用当前分区**"，它指示 Azure 数据工厂使用在 Spark 上运行的数据流本机的分区方案。 在大多数情况下，我们建议此设置。

在某些情况下，您可能需要调整分区。 例如，如果要将转换输出到湖中的单个文件，请在接收器转换中选择 **"单个分区**"。

可能想要控制分区方案的另一个案例是优化性能。 调整分区可控制数据跨计算节点的分布和数据局部优化，这些优化会对总体数据流性能产生正和负面影响。 有关详细信息，请参阅[数据流性能指南](concepts-data-flow-performance.md)。

要更改任何转换上的分区，请选择 **"优化**"选项卡并选择"**设置分区**单选"按钮。 然后，您将看到一系列分区选项。 最佳分区方法将因数据卷、候选键、空值和基数而异。 

最佳做法是从默认分区开始，然后尝试不同的分区选项。 您可以使用管道调试运行进行测试，并从监视视图查看每个转换分组中的执行时间和分区使用情况。 有关详细信息，请参阅[监视数据流](concepts-data-flow-monitoring.md)。

以下分区选项可用。

##### <a name="round-robin"></a>循环 

循环是一个简单的分区，可在分区之间自动平均分配数据。 当您没有良好的关键候选项时，请使用循环，以实现可靠的智能分区策略。 可以设置物理分区数目。

##### <a name="hash"></a>哈希

Azure 数据工厂将生成列的哈希来生成统一的分区，使包含类似值的行划归到同一分区。 使用哈希选项时，测试可能的分区偏斜。 可以设置物理分区数目。

##### <a name="dynamic-range"></a>动态范围

动态范围将使用基于您提供的列或表达式的 Spark 动态范围。 可以设置物理分区数目。 

##### <a name="fixed-range"></a>固定范围

生成为分区数据列中的值提供固定范围的表达式。 为了避免分区偏斜，在使用此选项之前，应充分了解数据。 为表达式输入的值将用作分区函数的一部分。 可以设置物理分区数目。

##### <a name="key"></a>键

如果您对数据基数有很好的了解，则密钥分区可能是一个不错的策略。 键分区将为列中的每个唯一值创建分区。 无法设置分区数，因为该编号将基于数据中的唯一值。

#### <a name="inspect"></a>检查

"**检查"** 选项卡提供要转换的数据流的元数据的视图。 您可以看到列计数、列更改、添加列、数据类型、列排序和列引用。 **检查**是元数据的只读视图。 无需启用调试模式即可在 **"检查"** 窗格中查看元数据。

![检查](media/data-flow/inspect1.png "检查")

通过转换更改数据形状时，您将在 **"检查"** 窗格中看到元数据更改流。 如果源转换中没有定义的架构，则元数据在 **"检查"** 窗格中不可见。 在架构漂移方案中，缺少元数据很常见。

#### <a name="data-preview"></a>数据预览

如果调试模式处于打开状态，"**数据预览"** 选项卡将为您提供每个转换时数据的交互式快照。 有关详细信息，请参阅[调试模式下的数据预览](concepts-data-flow-debug-mode.md#data-preview)。

### <a name="top-bar"></a>上栏

顶部栏包含影响整个数据流的操作，如保存和验证。 您还可以使用 **"显示图形**"和"**隐藏图形**"按钮在图形和配置模式之间切换。

![隐藏图形](media/data-flow/hideg.png "隐藏图形")

如果隐藏图形，则可以通过 **"上一步**"和 **"下一步**"按钮横向浏览转换节点。

![上一个和下一个按钮](media/data-flow/showhide.png "上一个和下一个按钮")

## <a name="next-steps"></a>后续步骤

* 了解如何创建[源转换](data-flow-source.md)。
* 了解如何在[调试模式下](concepts-data-flow-debug-mode.md)构建数据流。
