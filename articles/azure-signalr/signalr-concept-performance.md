---
title: Azure SignalR 服务的性能指南
description: Azure SignalR 服务性能的概述。
author: sffamily
ms.service: signalr
ms.topic: conceptual
ms.date: 04/08/2019
ms.author: zhshang
ms.openlocfilehash: 53139dd253c491ea6578fd0b9cbada4e7b331c7d
ms.sourcegitcommit: 1a19a5845ae5d9f5752b4c905a43bf959a60eb9d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/11/2019
ms.locfileid: "59502033"
---
# <a name="performance-guide-for-azure-signalr-service"></a>Azure SignalR 服务的性能指南

有关使用 Azure SignalR 服务的关键优势之一是扩展 SignalR 应用程序的易用性。 在大规模方案中，性能会变得重要因素。 本指南中我们将介绍对 SignalR 应用程序性能，并在不同用例场景，什么是典型的性能有影响的因素？ 最后，我们将介绍环境，并用于生成性能报告工具。

## <a name="terms-definition"></a>术语定义

*ASRS*:Azure SignalR 服务

*入站*： 将传入消息与 Azure SignalR 服务

*出站*: Azure SignalR 服务的传出消息

*带宽*: 1 秒的总大小的所有消息

*默认模式*:ASRS 预期要建立与其的连接之前接受任何客户端连接的应用程序服务器。 创建 ASRS 时，它是默认的工作模式。

*无服务器模式*:ASRS 仅接受客户端连接。 允许无服务器连接。

## <a name="overview"></a>概述

ASRS 定义七个不同的性能容量标准层和本指南旨在回答以下问题：

-   什么是每个层的典型 ASRS 性能？

-   并不 ASRS 满足消息吞吐量，例如，我要求发送每秒 100,000 的消息？

-   对于我特定方案，哪个层适合我？ 或者，如何选择适当的层？

-   适用于我是哪种应用程序服务器 （VM 大小） 且其不会部署？

若要回答这些问题，此性能指南首先提供了有关对性能产生影响的因素的高级别说明然后说明了每个层的典型用例的最大入站和出站消息： **echo**，**广播**，**发送组**，并且**发送到连接**（对等聊天）。

它是不可能涵盖所有方案 （和不同的用例、 不同的消息大小或消息发送模式等。） 此文档。 但是，它提供了一些评估方法，以帮助用户大约评估其要求的入站或出站消息，然后通过检查性能表查找适当的层。

## <a name="performance-insight"></a>性能见解

本部分介绍了性能评估方法，然后列出所有会对性能产生影响的因素。 在结束时，它提供方法来帮助评估性能要求。

### <a name="methodology"></a>方法

**吞吐量**并**延迟**两个典型的方面的性能检查。 对于 ASRS，不同的 SKU 层具有不同的吞吐量限制策略。 本文档定义了**允许的最大的吞吐量 （入站和出站带宽）** 如最大值实现的吞吐量时 99%的消息具有延迟少于 1 秒。

滞后时间是从连接将消息发送到从 ASRS 接收响应消息的时间跨度。 让我们看**echo**作为示例，每个客户端连接所添加的消息中的时间戳。 应用程序服务器的中心将原始消息发送回客户端。 因此传播延迟是轻松地通过每个客户端连接。 中的每个消息附加时间戳**广播**，**发送到组**，并**发送到连接**。

为了模拟数千个并发客户端连接，请在 Azure 中的虚拟专用网络中创建了多个 Vm。 所有这些 Vm 连接到同一个 ASRS 实例。

在 ASRS 默认模式下，应用服务器 Vm 也部署在作为客户端 Vm 相同的虚拟专用网络中。

所有客户端虚拟机和应用服务器 Vm 部署在同一网络中的同一区域，以避免跨区域的延迟。

### <a name="performance-factors"></a>性能因素

理论上讲，ASRS 容量受计算资源的限制：CPU、 内存和网络。 例如，到 ASRS 的更多连接，更多的内存 ASRS 占用。 对于较大的消息流量，例如，每个消息大于 2048 个字节，它需要 ASRS 花费更多的 CPU 周期，以及处理。 同时，Azure 网络带宽还强加了最大流量的限制。

传输类型， [WebSocket](https://en.wikipedia.org/wiki/WebSocket)，[服务器发送事件](https://en.wikipedia.org/wiki/Server-sent_events)，或[长时间轮询](https://en.wikipedia.org/wiki/Push_technology)，是另一个因素会影响性能。 WebSocket 是一种双向和全双工通信协议通过单个 TCP 连接。 但是，服务器发送事件是单向协议推送消息从服务器到客户端。 长时间轮询要求客户端定期轮询服务器通过 HTTP 请求的信息。 有关在相同的情况下，相同的 API，WebSocket 具有最佳性能，服务器发送事件是速度较慢，长时间轮询是最慢。 默认情况下，ASRS 建议 WebSocket。

此外，消息路由成本还限制的性能。 ASRS 作用为消息路由器，后者会路由到其他客户端或服务器从客户端或服务器的一组消息。 不同的方案或 API 需要不同的路由策略。 有关**echo**、 客户端将消息发送到其自身，和路由目标也是本身。 此模式具有最低的路由的成本。 但对于**广播**，**发送到组**，**发送到连接**，ASRS 需要查找目标连接通过内部分布式的数据结构，其中使用更多 CPU、 内存和甚至网络带宽。 因此，性能低于**echo**。

在默认模式下，应用服务器还可能会成为某些情况下，瓶颈，因为 Azure SignalR SDK 具有要调用的中心，同时维护与每个客户端通过检测信号的信号的实时连接。

在无服务器模式下，客户端的 HTTP post，那么有效 WebSocket 发送消息。

另一个因素是协议：JSON 和[MessagePack](https://msgpack.org/index.html)。 MessagePack 比 JSON 更快地为较小的大小并传送。 直观地说，MessagePack 受益的性能，但 ASRS 性能不敏感的协议，因为它无法解码期间从客户端到服务器或执行相反的消息转发的消息有效负载。

总之，以下因素影响对入站和出站容量：

-   SKU 层 （CPU/内存）

-   连接数

-   消息大小

-   消息发送速率

-   传输类型 （WebSocket/服务器-发送-事件/长轮询）

-   用例场景 （路由成本）

-   （在服务器模式下） 的应用程序服务器和服务连接


### <a name="find-a-proper-sku"></a>查找正确的 SKU

如何评估入站/出站容量或如何查找哪个层是适用于特定的用例？

我们假定应用程序服务器足够强大，并且不是性能瓶颈。 然后我们可以检查每个层的最大入站和出站带宽。

#### <a name="quick-evaluation"></a>快速评估

让我们来简化计算第一次通过假定某些默认设置：使用 WebSocket，消息大小为 2048 个字节，将消息发送每隔一秒，而且它处于默认模式。

每个层都有其自己的最大入站的带宽和出站带宽。 一旦入站或出站超出了限制，不能保证流畅的用户体验。

**Echo**提供了最大入站的带宽，因为它具有最低的路由的成本。 **广播**定义最大出站消息带宽。

不要**不**超过以下两个表中突出显示的值。

|       echo                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| **入站的带宽 （字节/秒）** | **2M**    | **4M**    | **10M**   | **20M**    | **40M**    | **100M**   | **200M**    |
| 出站带宽 （字节/秒） | 2M    | 4M    | 10M   | 20M    | 40M    | 100M   | 200M    |


|     广播             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 入站的带宽 （字节/秒）  | 4K    | 4K    | 4K     | 4K     | 4K     | 4K      | 4K     |
| **出站带宽 （字节/秒）** | **4M**    | **8M**    | **20M**    | **40M**    | **80M**    | **200M**    | **400M**   |

入站的带宽和出站带宽公式：
```
  inboundBandwidth = inboundConnections * messageSize / sendInterval
  outboundBandwidth = outboundConnections * messageSize / sendInterval
```

*inboundConnections*： 发送消息的连接数

*outboundConnections*： 接收消息的连接数

*messageSize*： 一条消息 （平均值） 的大小。 对于其大小为不超过 1024 个字节的小消息，它将具有类似的性能影响为 1024年字节的消息。

*sendInterval*： 发送一条消息的时间通常它是每个消息，这意味着每秒发送一条消息的 1 秒。 较小 sendInterval 意味着发送多个消息给定时间段。 例如，每条消息 0.5 秒表示每秒发送两条消息。

*连接*是 ASRS 已提交的最大阈值的每个层。 如果进一步增加连接数，它就会遇到连接限制。

*入站带宽*并*出站带宽*是每秒的总消息大小。 下面是意味着为简单起见，兆字节。

#### <a name="evaluation-for-complex-use-cases"></a>对于复杂的用例的评估

##### <a name="bigger-message-size-or-different-sending-rate"></a>更大消息大小或不同的发送速率

实际用例是更复杂。 它可能会发送消息大小超过 2048 个字节，或发送消息速率是每秒未一个消息。 让我们看 unit100 的广播作为示例，介绍了如何评估其性能。

下表显示了的真实案例**广播**，但不同于我们在上一节中假定消息大小、 连接数和消息发送速率。 问题是如何我们就可以推断出任何这些项 （消息大小、 连接数或消息发送速率） 如果我们只知道 2 项。

| 广播  | 消息大小 （字节） | 入站 （消息/秒） | 连接 | 发送的时间间隔 （秒） |
|---|---------------------|--------------------------|-------------|-------------------------|
| 1 | 20 K                 | 1                        | 100,000     | 5                       |
| 2 | 256 K                | 1                        | 8,000       | 5                       |

下面的公式是轻松地基于前面的现有公式推断：

```
outboundConnections = outboundBandwidth * sendInterval / messageSize
```

为 unit100，我们知道的最大出站带宽为 400 M 从上表中，则为 20-K 消息大小最大出站连接应为 400 M \* 5 / 20 K = 100000，这与实际值匹配。

##### <a name="mixed-use-cases"></a>混合的用例

实际用例通常混合使用四种基本使用情况在一起： **echo**，**广播**，**发送到组**，或者**将发送到连接**。 用于计算容量的方法是将混合的用例划分为四个基本用例**计算的最大入站和出站消息带宽**分别使用上述公式和计算它们获取总和的总和最大入站/出站带宽。 选取最大入站/出站带宽表中的适当层。

同时，用于将消息发送到数百或数千个小的组或数千个客户端将消息发送到彼此，路由的成本将成为主流。 这种影响应该考虑在内。 以下"案例研究"部分中介绍了更多详细信息。

将消息发送到客户端的用例，请确保应用程序服务器是**不**瓶颈。 "案例研究"部分提供了指导原则，有关多少个应用程序服务器所需，且应配置服务器连接数。

## <a name="case-study"></a>案例研究

以下各节介绍了四个 WebSocket 传输的典型用例： **echo**，**广播**，**发送组**，和**发送到连接**. 对于每个方案，它列出当前 ASRS 入站和出站容量，同时介绍什么是对性能的主要因素。

在默认模式下，通过默认情况下，Azure SignalR 服务 SDK 的应用程序服务器使用 ASRS 创建五个服务器连接。 在性能测试结果，连接会增加到 15 （或更高，面向广播和将消息发送到大的组） 的服务器。

不同的用例应用服务器上有不同的要求。 **广播**需要较小数目的应用程序服务器。 **Echo**或**发送到连接**需要很多应用程序服务器。

在所有用例、 默认消息大小为 2048 个字节，和消息发送间隔为 1 秒。

## <a name="default-mode"></a>默认模式

客户端、 web 应用程序服务器和 ASRS 将参与此模式。 每个客户端代表单个连接。

### <a name="echo"></a>echo

首先，web 应用连接到 ASRS。 其次，许多客户端连接到 web 应用，该客户端重定向到 ASRS 使用访问令牌和终结点。 然后，客户端会建立与 ASRS 的 WebSocket 连接。

所有客户端建立连接后，他们开始发送消息，其中包含每秒的时间戳到特定的中心。 在中心回显回其原始客户端的消息。 每个客户端收到回复回送消息时计算延迟。

步骤 5\~8 （红色突出显示的流量） 是在循环中，这将运行默认持续时间 （5 分钟） 并获取所有消息延迟的统计信息。
性能指南显示了最大客户端连接数。

![echo](./media/signalr-concept-performance/echo.png)

**Echo**的行为确定的最大入站的带宽等于最大出站带宽。 请参阅下表。

|       echo                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 入站/出站 （消息/秒） | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 入站/出站带宽 （字节/秒） | 2M    | 4M    | 10M   | 20M    | 40M    | 100M   | 200M    |

在此用例，每个客户端调用应用程序服务器中定义的中心。 在中心只需调用原始客户端中定义的方法。 此中心是最浅加权的中心**echo**。

```
        public void Echo(IDictionary<string, object> data)
        {
            Clients.Client(Context.ConnectionId).SendAsync("RecordLatency", data);
        }
```

即使对于此简单的中心，应用程序服务器上的流量压力也是作为重要**echo**入站消息会增加。 因此，它需要很多应用程序服务器的大型 SKU 层。 下表列出了每个层的应用程序服务器计数。


|    echo          | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
>
> 客户端连接数，消息大小，消息发送速率、 SKU 层和应用程序服务器的 CPU/内存对性能产生影响总体的**echo**。

### <a name="broadcast"></a>广播

有关**广播**，当 web 应用接收消息，它将广播到所有客户端。 广播到所有客户端更多的消息流量更多客户端。 请参阅下面的关系图。

![广播](./media/signalr-concept-performance/broadcast.png)

广播的特征是，有少量的客户端广播，这意味着入站的消息带宽很小，但回报是巨大的出站带宽。 随着客户端连接的增加，出站消息带宽或广播的率会增加。

下表总结了最大客户端连接、 入站/出站消息计数和带宽。

|     广播             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 入站 （消息/秒）  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 出站 （消息/秒） | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 入站的带宽 （字节/秒）  | 4K    | 4K    | 4K     | 4K     | 4K     | 4K      | 4K      |
| 出站带宽 （字节/秒） | 4M    | 8M    | 20M    | 40M    | 80M    | 200M    | 400M    |

将消息发布的广播客户端不能超过 4，因此需要较少的应用程序服务器与相比**echo**由于入站的消息量很小。 两个应用程序服务器是不够的 SLA 和性能注意事项。 但应增加默认服务器连接，以避免出现不平衡的问题，尤其是对于 Unit50 和 Unit100。

|   广播      | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
>
> 增加从 5 到 40 以避免与 ASRS 可能不平衡的服务器连接的每个应用程序服务器上的默认服务器连接。
>
> 客户端连接数、 消息大小、 消息发送速率和 SKU 层对整体性能产生影响**广播**

### <a name="send-to-group"></a>发送到组

**发送到组**具有类似的流量模式，只是在建立与 ASRS WebSocket 连接的客户端后，他们必须加入组之前他们可以将消息发送到特定的组。 下图说明了流量流。

![将发送到组](./media/signalr-concept-performance/sendtogroup.png)

组成员和组计数是两个因素对性能产生影响。 若要简化分析，我们定义了两种类型的组： 小组和大的组。

- `small group`:每个组中的 10 个连接。 组数等于 （最大连接数） / 10。 例如，单元 1，如果有 1000年连接计数，然后我们有 1000年 / 10 = 100 组。

- `Big group`:组号始终为 10。 组成员计数是否等于 （最大连接数） / 10。 例如，对于单元 1，如果有 1000年连接计数，然后每个组有 1000年 / 10 = 100 个成员。

**发送到组**赋予 ASRS 的路由的成本，因为它必须找到目标连接通过分布式的数据结构。 增加时发送的连接，也会增加成本。

#### <a name="small-group"></a>小的组

路由成本非常重要将消息发送到多个较小的组。 目前，ASRS 实现命中在 unit50 路由成本限制。 添加更多 CPU 和内存不帮助，因此不能提高 unit100 进一步设计。 如果需要更多的入站带宽，请与客户支持联系进行自定义。

|   将发送到小的组     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50 | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|--------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000 | 100,000
| 组成员计数        | 10    | 10    | 10     | 10     | 10     | 10     | 10 
| 组计数               | 100   | 200   | 500    | 1,000  | 2,000  | 5,000  | 10,000 
| 入站 （消息/秒）  | 200   | 400   | 1,000  | 2,500  | 4,000  | 7,000  | 7,000   |
| 入站的带宽 （字节/秒）  | 400 K  | 800 K  | 2M     | 5M     | 8M     | 14M    | 14M     |
| 出站 （消息/秒） | 2,000 | 4,000 | 10,000 | 25,000 | 40,000 | 70,000 | 70,000  |
| 出站带宽 （字节/秒） | 4M    | 8M    | 20M    | 50M     | 80M    | 140M   | 140M    |

有多个调用该集线器的客户端连接，因此，应用程序服务器数目也是关键的性能。 下表中列出的建议应用程序服务器计数。

|  将发送到小的组   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
>
> 客户端连接数、 消息大小、 消息发送速率，路由的成本、 SKU 层和应用程序服务器的 CPU/内存的总体性能产生影响**发送到小型组**。

#### <a name="big-group"></a>大组

有关**发送到大的组**之前达到路由成本限制,，出站带宽成为瓶颈。 下表列出了几乎相同的最大出站带宽作为**广播**。

|    将发送到大的组      | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000
| 组成员计数        | 100   | 200   | 500    | 1,000  | 2,000  | 5,000   | 10,000 
| 组计数               | 10    | 10    | 10     | 10     | 10     | 10      | 10
| 入站 （消息/秒）  | 20    | 20    | 20     | 20     | 20     | 20      | 20      |
| 入站的带宽 （字节/秒）  | 80 K   | 40 K   | 40 K    | 20 K    | 40 K    | 40 K     | 40 K     |
| 出站 （消息/秒） | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 出站带宽 （字节/秒） | 8M    | 8M    | 20M    | 40M    | 80M    | 200M    | 400M    |

发送的连接数为不超过 40、 应用程序服务器的负担很小，因此建议的 web 应用程序数目也是较小。

|  将发送到大的组  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
>
> 增加从 5 到 40 以避免与 ASRS 可能不平衡的服务器连接的每个应用程序服务器上的默认服务器连接。
> 
> 客户端连接数、 消息大小、 消息发送速率，路由的成本和 SKU 层对整体性能产生影响**发送到大的组**。

### <a name="send-to-connection"></a>将发送到连接

在此用例，当客户端建立与 ASRS，每个客户端调用一个特殊的中心来获取其自己的连接 id。 性能基准负责收集所有的连接 Id、 无序播放它们和作为发送目标重新分配给所有客户端。 性能测试完成之前，客户端保留到目标连接发送消息。

![将发送到客户端](./media/signalr-concept-performance/sendtoclient.png)

路由成本**发送到连接**作为类似**发送到小型组**。

随着连接数的增加，受路由成本限制的整体性能。 单元 50 已达到的限制。 因此，不能进一步改进单元 100。

下表是摘要统计信息之后运行的多轮**发送到连接**基准

|   将发送到连接   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50          | Unit100         |
|------------------------------------|-------|-------|-------|--------|--------|-----------------|-----------------|
| 连接                        | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000          | 100,000         |
| 入站 / 出站 （消息/秒） | 1,000 | 2,000 | 5,000 | 8,000  | 9,000  | 20,000 | 20,000 |
| 入站 / 出站带宽 （字节/秒） | 2M    | 4M    | 10M   | 16M    | 18 分钟    | 40M       | 40M       |

此用例要求应用程序服务器端的高负载。 请参阅建议的应用程序服务器下表中的数。

|  将发送到连接  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
>
> 客户端连接数、 消息大小、 消息发送速率，路由的成本、 SKU 层和应用程序服务器的 CPU/内存的总体性能产生影响**发送到连接**。

### <a name="aspnet-signalr-echobroadcastsend-to-connection"></a>ASP.NET SignalR echo/广播/发送与连接

ASRS 提供 ASP.NET SignalR 的相同的性能容量。 本部分提供 ASP.NET SignalR 的建议的 web 应用计数**echo**，**广播**，并**发送到小型组**。

性能测试使用的 Azure Web 应用[标准服务计划 S3](https://azure.microsoft.com/pricing/details/app-service/windows/) ASP.NET SignalR 的。

- `echo`

|   echo           | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

- `broadcast`

|  广播       | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

- `Send-to-small-group`

|  将发送到小的组     | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

## <a name="serverless-mode"></a>无服务器模式

客户端和 ASRS 将参与此模式。 每个客户端代表单个连接。 客户端将通过 REST API 的消息发送到另一个客户端或广播到所有的消息。

因为它需要生成新的 HTTP 连接每次的额外费用在无服务器模式下，发送高密度消息通过 REST API 不 WebSocket，尽可能高效。

### <a name="broadcast-through-rest-api"></a>广播通过 REST API
所有客户端与建立与 ASRS WebSocket 连接。 然后，某些客户端启动广播通过 REST API。 消息发送 （入站） 是作为 HTTP Post，不是有效与 WebSocket 后盾。

|   广播通过 REST API     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 入站 （消息/秒）  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 出站 （消息/秒） | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 入站的带宽 （字节/秒）  | 4K    | 4K    | 4K     | 4K     | 4K     | 4K      | 4K      |
| 出站带宽 （字节/秒） | 4M    | 8M    | 20M    | 40M    | 80M    | 200M    | 400M    |

### <a name="send-to-user-through-rest-api"></a>发送到通过 REST API 的用户
基准检验将用户名称分配给所有客户端，可以先连接到 ASRS。 客户端在建立与 ASRS 的 WebSocket 连接后，它们开始通过 HTTP Post 发送给其他人的消息。

|   发送到通过 REST API 的用户 | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 入站 （消息/秒）  | 300   | 600   | 900    | 1,300  | 2,000  | 10,000  | 18,000  |
| 出站 （消息/秒） | 300   | 600   | 900    | 1,300  | 2,000  | 10,000  | 18,000 |
| 入站的带宽 （字节/秒）  | 600 K  | 1.2M  | 1.8M   | 2.6M   | 4M     | 10M     | 36M    |
| 出站带宽 （字节/秒） | 600 K  | 1.2M  | 1.8M   | 2.6M   | 4M     | 10M     | 36M    |

## <a name="performance-test-environments"></a>性能测试环境

在 Azure 环境执行上面列出的所有用例的性能测试。 在大多数 50 的客户端 Vm 和 20 应用服务器 Vm 使用。

客户端 VM 大小：StandardDS2V2 （2 个 vCPU，7 G 内存）

应用服务器 VM 大小：StandardF4sV2 （4 个 vCPU，8 G 内存）

Azure SignalR SDK 服务器连接：15

## <a name="performance-tools"></a>性能工具

https://github.com/Azure/azure-signalr-bench/tree/master/SignalRServiceBenchmarkPlugin

## <a name="next-steps"></a>后续步骤

在本文中，你可以获取典型用例场景中的 SignalR 服务性能的概述。

若要获取上的 SignalR 服务和缩放以便 SignalR 服务内部的更多详细信息，请阅读以下指南。

* [Azure SignalR 服务内部机制](signalr-concept-internals.md)
* [Azure SignalR 服务缩放](signalr-howto-scale-multi-instances.md)