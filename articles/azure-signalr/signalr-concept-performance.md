---
title: Azure SignalR 服务的性能指南
description: 概述 Azure SignalR 服务的性能。
author: sffamily
ms.service: signalr
ms.topic: conceptual
ms.date: 04/08/2019
ms.author: zhshang
ms.openlocfilehash: f7cc05c8c2a299d809c4386d119fef58fa2548d5
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/23/2019
ms.locfileid: "61269400"
---
# <a name="performance-guide-for-azure-signalr-service"></a>Azure SignalR 服务的性能指南

使用 Azure SignalR 服务的主要优点之一是能轻松扩展 SignalR 应用程序。 在大规模方案中，性能是一个重要因素。 

在本指南中，我们将介绍影响 SignalR 应用程序性能的因素。 我们将介绍不同的用例方案中的典型性能。 最后，我们将介绍的环境和工具，可以使用用于生成性能报告。

## <a name="term-definitions"></a>术语定义

*入站*:Azure SignalR 服务对传入的消息。

*出站*:Azure SignalR 服务的传出消息。

*带宽*:1 秒中的所有消息的总大小。

*默认模式*:创建 Azure SignalR 服务实例时，默认使用的模式。 Azure SignalR 服务需要建立与其的连接之前接受任何客户端连接的应用程序服务器。

*无服务器模式*:在其中 Azure SignalR 服务只接受客户端的连接模式。 允许无服务器连接。

## <a name="overview"></a>概述

Azure SignalR 服务定义为不同的性能容量的七个标准层。 本指南回答以下问题：

-   什么是每个层的典型 Azure SignalR 服务性能？

-   Azure SignalR 服务是否满足我的消息吞吐量 （例如，发送 100,000 消息数 / 秒） 的要求？

-   对于我特定方案，哪个层适合我？ 或者，如何选择适当的层？

-   哪种应用程序服务器 （VM 大小） 是适用于我？ 预订数应该我部署？

若要回答这些问题，本指南首先提供影响性能的因素的高级说明。 它还将介绍每个层的典型用例的最大入站和出站消息： **echo**，**广播**，**发送给组**，和**将发送到连接**（对等-对等聊天）。

本指南不能涵盖所有方案 （和不同的使用情况下，消息的大小，消息发送的模式，等等）。 但它提供了一些方法，以帮助你：

- 评估你的入站或出站消息的大致要求。
- 通过检查性能表查找适当的层。

## <a name="performance-insight"></a>性能见解

本部分介绍性能评估方法，然后列出所有因素会影响性能。 在结束时，它提供方法来帮助你评估性能要求。

### <a name="methodology"></a>方法

*吞吐量*并*延迟*两个典型的方面的性能检查。 Azure SignalR 服务，每个 SKU 层都有其自己的吞吐量限制策略。 策略定义*允许的最大的吞吐量 （入站和出站带宽）* 如最大值时为小于 1 秒的延迟，遇到的 99%的消息实现的吞吐量。

滞后时间是从连接将消息发送到用于从 Azure SignalR 服务接收响应消息的时间跨度。 让我们看**echo**作为示例。 每个客户端连接将消息中添加时间戳。 应用程序服务器的中心将原始消息发送回客户端。 因此传播延迟是轻松地通过每个客户端连接。 中的每个消息附加时间戳**广播**，**发送到组**，并**将发送到连接**。

为了模拟数千个并发客户端连接，请在 Azure 中的虚拟专用网络中创建了多个 Vm。 所有这些 Vm 连接到同一个 Azure SignalR 服务实例。

Azure SignalR 服务的默认模式，在应用服务器 Vm 部署在作为客户端 Vm 相同的虚拟专用网络。 所有客户端虚拟机和应用服务器 Vm 部署在同一网络中的同一区域，以避免跨区域的延迟。

### <a name="performance-factors"></a>性能因素

理论上讲，Azure SignalR 服务容量限制由计算资源：CPU、 内存和网络。 例如，更多连接到 Azure SignalR 服务会导致服务以使用更多的内存。 为更大的消息流量 （例如，每个消息值大于 2,048 个字节），Azure SignalR 服务需要花费更多的 CPU 周期来处理流量。 同时，Azure 网络带宽还强加了最大流量的限制。

传输类型是会影响性能的另一个因素。 三种类型是[WebSocket](https://en.wikipedia.org/wiki/WebSocket)，[服务器发送事件](https://en.wikipedia.org/wiki/Server-sent_events)，并[长时间轮询](https://en.wikipedia.org/wiki/Push_technology)。 

WebSocket 是一个双向和全双工通信协议通过单个 TCP 连接。 服务器到客户端从服务器发送事件是推送消息的单向协议。 长时间轮询要求客户端定期轮询通过 HTTP 请求服务器中的信息。 在相同情况下的同一 api，WebSocket 具有最佳性能，服务器发送事件是速度较慢，长时间轮询是最慢。 Azure SignalR 服务默认情况下建议 WebSocket。

消息路由成本也限制了其性能。 Azure SignalR 服务作用为消息路由器，后者会路由到其他客户端或服务器从客户端或服务器的一组消息。 不同的方案或 API 需要不同的路由策略。 

有关**echo**、 客户端将消息发送到其自身，和路由目标也是本身。 此模式具有最低的路由的成本。 但对于**广播**，**发送到组**，并**将发送到连接**，Azure SignalR 服务需要查找通过内部的分布式数据的目标连接结构。 这一额外处理使用更多 CPU、 内存和网络带宽。 因此，性能会降低。

在默认模式下，应用程序服务器还可能会成为某些情况下的瓶颈。 Azure SignalR SDK 必须调用中心，同时维护与每个客户端通过检测信号信号的实时连接。

在无服务器模式下，客户端的 HTTP post，那么有效 WebSocket 发送消息。

另一个因素是协议：JSON 和[MessagePack](https://msgpack.org/index.html)。 MessagePack 比 JSON 更快地为较小的大小并传送。 MessagePack 可能不但是提高性能。 Azure SignalR 服务的性能不敏感到协议，因为它不会在从客户端到服务器或执行相反的消息转发过程解码消息有效负载。

总之，以下因素影响入站和出站容量：

-   SKU 层 （CPU/内存）

-   连接数

-   消息大小

-   消息发送速率

-   传输类型 (WebSocket，服务器发送的事件或长轮询)

-   用例场景 （路由成本）

-   （在服务器模式下） 的应用程序服务器和服务连接


### <a name="finding-a-proper-sku"></a>查找正确的 SKU

如何可以评估入站/出站容量或查找哪个层是适用于特定的用例？

假定应用程序服务器是功能强大，足以并不是性能瓶颈。 然后，检查每个层的最大入站和出站带宽。

#### <a name="quick-evaluation"></a>快速评估

让我们来简化计算第一次通过假定某些默认设置： 

- 传输类型为 WebSocket。
- 消息大小为 2,048 个字节。
- 每隔一秒发送一条消息。
- Azure SignalR 服务是默认模式下。

每个层都有其自己的最大入站的带宽和出站带宽。 不能保证流畅的用户体验后的入站或出站连接超过了限制。

**Echo**提供了最大入站的带宽，因为它具有最低的路由的成本。 **广播**定义最大出站消息带宽。

不要*不*超过以下两个表中突出显示的值。

|       echo                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| **入站的带宽** | **2 MBps**    | **4 MBps**    | **10 MBps**   | **20 MBps**    | **40 MBps**    | **100 MBps**   | **200 MBps**    |
| 出站带宽 | 2 MBps   | 4 MBps   | 10 MBps  | 20 MBps   | 40 MBps   | 100 MBps  | 200 MBps   |


|     广播             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 入站的带宽  | 4 KBps   | 4 KBps   | 4 KBps    | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps    |
| **出站带宽** | **4 MBps**    | **8 MBps**    | **20 MBps**    | **40 MBps**    | **80 MBps**    | **200 MBps**    | **400 MBps**   |

*入站带宽*并*出站带宽*是每秒的总消息大小。  以下是其公式：
```
  inboundBandwidth = inboundConnections * messageSize / sendInterval
  outboundBandwidth = outboundConnections * messageSize / sendInterval
```

- *inboundConnections*:发送消息的连接数。

- *outboundConnections*:接收消息的连接数。

- *messageSize*:一条消息 （平均值） 的大小。 小于 1024 个字节的性能的影响类似于 1,024 字节的消息的一个小的消息。

- *SendInterval*:发送一条消息的时间。 通常它是每个消息，这意味着每秒发送一条消息的 1 秒。 间隔越小意味着在时间段内发送多个消息。 例如，每条消息 0.5 秒表示每秒发送两条消息。

- *连接*：已提交的最大阈值 Azure SignalR 服务的每个层。 如果进一步增加连接数，它就会遇到连接限制。

#### <a name="evaluation-for-complex-use-cases"></a>对于复杂的用例的评估

##### <a name="bigger-message-size-or-different-sending-rate"></a>更大消息大小或不同的发送速率

实际用例是更复杂。 它可能会发送一条消息大小超过 2,048 个字节，或发送的消息速率是每秒未一个消息。 让我们看 Unit100 的广播作为示例，介绍了如何评估其性能。

下表显示的一种真实的使用情况**广播**。 但消息大小、 连接数和消息发送速率是不同于我们在上一节中假定。 问题是如何我们就可以推断出任何这些项 （消息大小、 连接数或消息发送速率） 如果我们知道其中只有两个。

| 广播  | 消息大小 | 每秒入站的消息 | 连接 | 发送的时间间隔 |
|---|---------------------|--------------------------|-------------|-------------------------|
| 1 | 20 KB                | 第                        | 100,000     | 5 秒                      |
| 2 | 256 KB               | 第                        | 8,000       | 5 秒                      |

下面的公式是可以轻松推断出基于前面的公式：

```
outboundConnections = outboundBandwidth * sendInterval / messageSize
```

对于 Unit100，最大出站带宽从上表是 400 MB。 对于 20 KB 的消息大小最大出站连接数应为 400 MB \* 5 / 20 KB = 100000，这与实际值匹配。

##### <a name="mixed-use-cases"></a>混合的用例

实际用例通常混合使用四种基本使用情况在一起： **echo**，**广播**，**发送到组**，以及**将发送到连接**。 用于计算容量的方法是：

1. 将混合的用例划分为四个基本用例。
1. 单独使用前面的公式计算的最大入站和出站消息带宽。
1. 若要获取的总的最大入站/出站带宽的带宽计算的总和。 

选取最大入站/出站带宽表中的适当层。

> [!NOTE]
> 用于将消息发送到数百或数千个小的组，或数千个客户端向彼此发送一条消息，路由的成本将会变得基准。 需要考虑这种影响。

对于向客户端发送一条消息的用例，请确保该应用程序服务器是否*不*瓶颈。 以下的"案例研究"部分提供了指导原则需要有关应用的服务器数量和服务器连接的数量应配置。

## <a name="case-study"></a>案例研究

以下各节介绍了四个 WebSocket 传输的典型用例： **echo**，**广播**，**发送给组**，和**将发送到连接**. 对于每个方案中，部分列出了 Azure SignalR 服务的当前入站和出站容量。 它还说明了会影响性能的主要因素。

在默认模式下，应用程序服务器与 Azure SignalR 服务会创建五个服务器连接。 默认情况下，应用程序服务器使用 Azure SignalR 服务 SDK。 在以下性能测试结果中，服务器的连接会增加到 15 （或更高，面向广播和将消息发送到大型组）。

不同的用例具有不同应用程序服务器的要求。 **广播**需要较小数目的应用程序服务器。 **Echo**或**将发送到连接**需要很多应用程序服务器。

在所有用例、 默认消息大小为 2048 个字节，和消息发送间隔为 1 秒。

### <a name="default-mode"></a>默认模式

在默认模式，包括客户端、 web 应用程序服务器和 Azure SignalR 服务。 每个客户端代表单个连接。

#### <a name="echo"></a>echo

首先，web 应用连接到 Azure SignalR 服务。 其次，许多客户端连接到 web 应用，其中客户端重定向到 Azure SignalR 服务使用访问令牌和终结点。 然后，客户端会建立与 Azure SignalR 服务的 WebSocket 连接。

所有客户端建立连接后，他们开始发送包含时间戳到特定中心每秒的消息。 在中心回显回其原始客户端的消息。 每个客户端收到回复回送消息时计算延迟。

下图中，在 5 到 8 （红色突出显示的流量） 是在循环中。 循环运行了默认持续时间 （5 分钟），获取所有消息延迟的统计信息。

![Echo 用例的流量](./media/signalr-concept-performance/echo.png)

行为**echo**确定的最大入站的带宽等于最大出站带宽。 有关详细信息，请参阅下表。

|       echo                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 每秒入站/出站消息 | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 入站/出站带宽 | 2 MBps   | 4 MBps   | 10 MBps  | 20 MBps   | 40 MBps   | 100 MBps  | 200 MBps   |

在此用例，每个客户端调用应用程序服务器中定义的中心。 在中心只需调用原始客户端中定义的方法。 此中心是最轻量中心**echo**。

```
        public void Echo(IDictionary<string, object> data)
        {
            Clients.Client(Context.ConnectionId).SendAsync("RecordLatency", data);
        }
```

即使对于此简单的中心，应用程序服务器上的流量压力是作为重要**echo**入站消息负载的增加。 此流量压力较大的 SKU 层需要很多应用程序服务器。 下表列出了每个层的应用程序服务器计数。


|    echo          | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 客户端连接数，消息大小，消息发送速率、 SKU 层和应用程序服务器的 CPU/内存影响的整体性能**echo**。

#### <a name="broadcast"></a>广播

有关**广播**，当 web 应用接收消息，它将广播到所有客户端。 有更多的客户端是广播到所有客户端没有更多消息流量。 请参阅下面的关系图。

![广播的用例的流量](./media/signalr-concept-performance/broadcast.png)

少量的客户端进行广播。 入站的消息带宽较小，但回报是巨大的出站带宽。 随着客户端连接的增加，出站消息带宽或广播的率会增加。

下表总结了最大客户端连接、 入站/出站消息计数和带宽。

|     广播             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒入站的消息  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 每秒出站消息 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 入站的带宽  | 4 KBps   | 4 KBps   | 4 KBps    | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps     |
| 出站带宽 | 4 MBps   | 8 MBps   | 20 MBps   | 40 MBps   | 80 MBps   | 200 MBps   | 400 MBps   |

将消息发布广播客户端是不超过四个。 他们需要更少的应用程序服务器与相比**echo**由于入站的消息量很小。 两个应用程序服务器是不够的 SLA 和性能注意事项。 但应增加默认服务器连接，以避免这种不平衡，尤其是对于 Unit50 和 Unit100。

|   广播      | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> 增加从 5 到 40 要避免可能不平衡的服务器连接到 Azure SignalR 服务的每个应用程序服务器上的默认服务器连接。
>
> 客户端连接数、 消息大小、 消息发送速率和 SKU 层会影响的整体性能**广播**。

#### <a name="send-to-group"></a>发送到组

**发送到组**用例具有到类似的流量模式**广播**。 不同之处在于，客户端建立与 Azure SignalR 服务的 WebSocket 连接后，他们必须加入组，它们可以将一条消息发送到特定组之前。 下图说明了流量流。

![流量发送到组用例](./media/signalr-concept-performance/sendtogroup.png)

组成员和组计数是两个因素会影响性能。 若要简化分析，我们定义两种类型的组：

- **小组**:每个组有 10 个连接。 组数等于 （最大连接数） / 10。 例如，Unit1，如果不存在 1,000 连接计数，然后我们使用 1000年 / 10 = 100 组。

- **大组**:组号始终为 10。 组成员计数是否等于 （最大连接数） / 10。 例如，对于 Unit1，如果不存在 1,000 连接计数，然后每个组具有 1000年 / 10 = 100 个成员。

**发送到组**将路由到 Azure SignalR 服务的成本，因为它必须找到目标连接通过分布式的数据结构。 发送连接增加时，会增加成本。

##### <a name="small-group"></a>小的组

路由成本非常重要将消息发送到多个较小的组。 目前，Azure SignalR 服务实现命中在 Unit50 路由的成本限制。 添加更多 CPU 和内存不会帮助，因此不能提高 Unit100 进一步设计。 如果需要更多的入站带宽，请与客户支持联系。

|   将发送到小的组     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50 | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|--------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000 | 100,000
| 组成员计数        | 10    | 10    | 10     | 10     | 10     | 10     | 10 
| 组计数               | 100   | 200   | 500    | 1,000  | 2,000  | 5,000  | 10,000 
| 每秒入站的消息  | 200   | 400   | 1,000  | 2,500  | 4,000  | 7,000  | 7,000   |
| 入站的带宽  | 400 KBps  | 800 KBps  | 2 MBps     | 5 MBps     | 8 MBps     | 14 MBps    | 14 MBps     |
| 每秒出站消息 | 2,000 | 4,000 | 10,000 | 25,000 | 40,000 | 70,000 | 70,000  |
| 出站带宽 | 4 MBps    | 8 MBps    | 20 MBps    | 50 MBps     | 80 MBps    | 140 MBps   | 140 MBps    |

许多客户端连接调用中心，因此应用程序服务器数目也是关键的性能。 下表列出了建议的应用程序服务器计数。

|  将发送到小的组   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 客户端连接数，消息大小，消息发送速率、 路由成本、 SKU 层和应用程序服务器的 CPU/内存影响的整体性能**将发送到小组**。

##### <a name="big-group"></a>大组

有关**发送到大型组**之前达到路由成本限制,，出站带宽成为瓶颈。 下表列出了几乎相同的最大出站带宽为，对于**广播**。

|    将发送到大的组      | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000
| 组成员计数        | 100   | 200   | 500    | 1,000  | 2,000  | 5,000   | 10,000 
| 组计数               | 10    | 10    | 10     | 10     | 10     | 10      | 10
| 每秒入站的消息  | 20    | 20    | 20     | 20     | 20     | 20      | 20      |
| 入站的带宽  | 80 KBps   | 40 KBps   | 40 KBps    | 20 KBps    | 40 KBps    | 40 KBps     | 40 KBps     |
| 每秒出站消息 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 出站带宽 | 8 MBps    | 8 MBps    | 20 MBps    | 40 MBps    | 80 MBps    | 200 MBps    | 400 MBps    |

发送的连接数为不超过 40。 应用程序服务器的负担很小，所以建议的 web 应用程序很小。

|  将发送到大的组  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> 增加从 5 到 40 要避免可能不平衡的服务器连接到 Azure SignalR 服务的每个应用程序服务器上的默认服务器连接。
> 
> 客户端连接数、 消息大小、 消息发送速率，路由的成本和 SKU 层会影响整体性能**发送到大型组**。

#### <a name="send-to-connection"></a>将发送到连接

在中**发送到连接**用例中，当客户端建立到 Azure SignalR 服务，每个客户端连接时调用一个特殊的中心来获取其自己的连接 id。 性能基准收集所有连接 Id、 排列它们，并将它们向所有客户端重新分配作为发送目标。 性能测试完成之前，客户端保留目标连接到发送消息。

![流量发送到客户端用例](./media/signalr-concept-performance/sendtoclient.png)

路由成本**发送到连接**类似于的成本**将发送到小组**。

随着连接数的增加，路由的成本限制了其总体性能。 Unit50 已达到的限制。 因此，Unit100 不能进一步改进。

下表是经多轮运行后的统计摘要**发送到连接**基准。

|   将发送到连接   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50          | Unit100         |
|------------------------------------|-------|-------|-------|--------|--------|-----------------|-----------------|
| 连接                        | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000          | 100,000         |
| 每秒入站/出站消息 | 1,000 | 2,000 | 5,000 | 8,000  | 9,000  | 20,000 | 20,000 |
| 入站/出站带宽 | 2 MBps    | 4 MBps    | 10 MBps   | 16 MBps    | 18 MBps    | 40 MBps       | 40 MBps       |

此用例需要在应用服务器端的高负载。 请参阅建议的应用程序服务器下表中的数。

|  将发送到连接  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 客户端连接数，消息大小，消息用于应用服务器发送速率、 路由成本、 SKU 层和 CPU/内存影响的整体性能**发送到连接**。

#### <a name="aspnet-signalr-echo-broadcast-and-send-to-small-group"></a>ASP.NET SignalR echo，广播，并发送给小组

Azure SignalR 服务提供了 ASP.NET SignalR 的相同的性能容量。 

性能测试使用从 Azure Web 应用[标准服务计划 S3](https://azure.microsoft.com/pricing/details/app-service/windows/) ASP.NET SignalR 的。

下表提供建议的 web 应用计数了 ASP.NET signalr **echo**。

|   echo           | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

下表提供建议的 web 应用计数了 ASP.NET signalr**广播**。

|  广播       | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

下表提供建议的 web 应用计数了 ASP.NET signalr**将发送到小组**。

|  将发送到小的组     | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用程序服务器计数 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

### <a name="serverless-mode"></a>无服务器模式

在无服务器模式，包括客户端和 Azure SignalR 服务。 每个客户端代表单个连接。 客户端将通过 REST API 的消息发送到另一个客户端或广播到所有的消息。

不不如使用 WebSocket 发送高密度消息通过 REST API。 它要求您生成新的 HTTP 连接每次，而这额外费用在无服务器模式下。

#### <a name="broadcast-through-rest-api"></a>广播通过 REST API
所有客户端与建立与 Azure SignalR 服务的 WebSocket 连接。 然后，某些客户端启动广播通过 REST API。 发送 （入站） 的消息是作为 HTTP Post，不是有效与 WebSocket 后盾。

|   广播通过 REST API     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒入站的消息  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 每秒出站消息 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 入站的带宽  | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps     | 4 KBps     | 4 KBps      | 4 KBps      |
| 出站带宽 | 4 MBps    | 8 MBps    | 20 MBps    | 40 MBps    | 80 MBps    | 200 MBps    | 400 MBps    |

#### <a name="send-to-user-through-rest-api"></a>发送到通过 REST API 的用户
基准检验将用户名分配给所有客户端，可以先连接到 Azure SignalR 服务。 客户端建立与 Azure SignalR 服务的 WebSocket 连接后，他们开始将消息发送到其他人通过 HTTP Post。

|   发送到通过 REST API 的用户 | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒入站的消息  | 300   | 600   | 900    | 1,300  | 2,000  | 10,000  | 18,000  |
| 每秒出站消息 | 300   | 600   | 900    | 1,300  | 2,000  | 10,000  | 18,000 |
| 入站的带宽  | 600 KBps  | 1.2 MBps  | 1.8 MBps   | 2.6 MBps   | 4 MBps     | 10 MBps     | 36 MBps    |
| 出站带宽 | 600 KBps  | 1.2 MBps  | 1.8 MBps   | 2.6 MBps   | 4 MBps     | 10 MBps     | 36 MBps    |

## <a name="performance-test-environments"></a>性能测试环境

对于所有使用前面列出的情况下，在 Azure 环境中的性能测试，我们将展开。 最多，我们使用 Vm 50 个客户端和 20 应用服务器 Vm。 下面是一些详细信息：

- 客户端 VM 大小：StandardDS2V2 （2 个 vCPU，7 G 内存）

- 应用服务器 VM 大小：StandardF4sV2 （4 个 vCPU，8 G 内存）

- Azure SignalR SDK 服务器连接：15

## <a name="performance-tools"></a>性能工具

您可以在找到 Azure SignalR 服务的性能工具[GitHub](https://github.com/Azure/azure-signalr-bench/tree/master/SignalRServiceBenchmarkPlugin)。

## <a name="next-steps"></a>后续步骤

在本文中，您将获得典型用例方案中的 Azure SignalR 服务性能的概述。

若要获取有关的服务和缩放以便其内部结构的详细信息，请阅读以下指南：

* [Azure SignalR 服务内部机制](signalr-concept-internals.md)
* [Azure SignalR 服务缩放](signalr-howto-scale-multi-instances.md)
