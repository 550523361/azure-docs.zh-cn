---
title: HTTP APIs in Durable Functions - Azure Functions
description: 了解如何实现 Azure Functions 的 Durable Functions 扩展中的 HTTP API。
author: cgillum
ms.topic: conceptual
ms.date: 09/07/2019
ms.author: azfuncdf
ms.openlocfilehash: 0390211e6fc42bd7183a770cac409b880310d317
ms.sourcegitcommit: d6b68b907e5158b451239e4c09bb55eccb5fef89
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/20/2019
ms.locfileid: "74231387"
---
# <a name="http-api-reference"></a>HTTP API 引用

The Durable Functions extension exposes a set of built-in HTTP APIs that can be used to perform management tasks on [orchestrations](durable-functions-types-features-overview.md#orchestrator-functions), [entities](durable-functions-types-features-overview.md#entity-functions), and [task hubs](durable-functions-task-hubs.md). These HTTP APIs are extensibility webhooks that are authorized by the Azure Functions host but handled directly by the Durable Functions extension.

All HTTP APIs implemented by the extension require the following parameters. 所有参数的数据类型均为 `string`。

| 参数        | 参数类型  | 描述 |
|------------------|-----------------|-------------|
| **`taskHub`**    | 查询字符串    | [任务中心](durable-functions-task-hubs.md)的名称。 如果未指定，则使用当前函数应用的任务中心名称。 |
| **`connection`** | 查询字符串    | 用于存储帐户的连接字符串的名称。 如果未指定，则使用函数应用的默认连接字符串。 |
| **`systemKey`**  | 查询字符串    | 需要授权密钥才可调用 API。 |

`systemKey` is an authorization key autogenerated by the Azure Functions host. 它可专门向 Durable Task 扩展 API 授予访问权限，且可通过与管理[其他授权密钥](https://github.com/Azure/azure-webjobs-sdk-script/wiki/Key-management-API)相同的方式进行管理。 You can generate URLs that contain the correct `taskHub`, `connection`, and `systemKey` query string values using [orchestration client binding](durable-functions-bindings.md#orchestration-client) APIs, such as the `CreateCheckStatusResponse` and `CreateHttpManagementPayload` APIs in .NET, or the `createCheckStatusResponse` and `createHttpManagementPayload` APIs in JavaScript.

后面几节介绍扩展支持的特殊 HTTP API，并提供有关其用法的示例。

## <a name="start-orchestration"></a>Start orchestration

Starts executing a new instance of the specified orchestrator function.

### <a name="request"></a>请求

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
POST /admin/extensions/DurableTaskExtension/orchestrators/{functionName}/{instanceId?}
     ?taskHub={taskHub}
     &connection={connectionName}
     &code={systemKey}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
POST /runtime/webhooks/durabletask/orchestrators/{functionName}/{instanceId?}
     ?taskHub={taskHub}
     &connection={connectionName}
     &code={systemKey}
```

此 API 的请求参数包括前面提及的默认集及以下唯一参数：

| 字段              | 参数类型  | 描述 |
|--------------------|-----------------|-------------|
| **`functionName`** | URL             | The name of the orchestrator function to start. |
| **`instanceId`**   | URL             | 可选参数。 业务流程实例的 ID。 If not specified, the orchestrator function will start with a random instance ID. |
| **`{content}`**    | 请求内容 | 可选。 The JSON-formatted orchestrator function input. |

### <a name="response"></a>响应

可返回若干可能的状态代码值。

* **HTTP 202 (Accepted)** : The specified orchestrator function was scheduled to start running. The `Location` response header contains a URL for polling the orchestration status.
* **HTTP 400 (Bad request)** : The specified orchestrator function doesn't exist, the specified instance ID was not valid, or request content was not valid JSON.

The following is an example request that starts a `RestartVMs` orchestrator function and includes  JSON object payload:

```http
POST /runtime/webhooks/durabletask/orchestrators/RestartVMs?code=XXX
Content-Type: application/json
Content-Length: 83

{
    "resourceGroup": "myRG",
    "subscriptionId": "111deb5d-09df-4604-992e-a968345530a9"
}
```

The response payload for the **HTTP 202** cases is a JSON object with the following fields:

| 字段                       | 描述                          |
|-----------------------------|--------------------------------------|
| **`id`**                    |业务流程实例的 ID。 |
| **`statusQueryGetUri`**     |业务流程实例的状态 URL。 |
| **`sendEventPostUri`**      |业务流程实例的“引发事件”URL。 |
| **`terminatePostUri`**      |业务流程实例的“终止”URL。 |
| **`purgeHistoryDeleteUri`** |The "purge history" URL of the orchestration instance. |
| **`rewindPostUri`**         |(preview) The "rewind" URL of the orchestration instance. |

所有字段的数据类型均为 `string`。

Here is an example response payload for an orchestration instance with `abc123` as its ID (formatted for readability):

```http
{
    "id": "abc123",
    "purgeHistoryDeleteUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123?code=XXX",
    "sendEventPostUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123/raiseEvent/{eventName}?code=XXX",
    "statusQueryGetUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123?code=XXX",
    "terminatePostUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123/terminate?reason={text}&code=XXX"
}
```

The http response is intended to be compatible with the *Polling Consumer Pattern*. It also includes the following notable response headers:

* **Location**: The URL of the status endpoint. This URL contains the same value as the `statusQueryGetUri` field.
* **Retry-After**: The number of seconds to wait between polling operations. 默认值为 `10`。

For more information on the asynchronous HTTP polling pattern, see the [HTTP async operation tracking](durable-functions-http-features.md#async-operation-tracking) documentation.

## <a name="get-instance-status"></a>获取实例状态

获取指定业务流程实例的状态。

### <a name="request"></a>请求

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
GET /admin/extensions/DurableTaskExtension/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &showHistory=[true|false]
    &showHistoryOutput=[true|false]
    &showInput=[true|false]
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
GET /runtime/webhooks/durabletask/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &showHistory=[true|false]
    &showHistoryOutput=[true|false]
    &showInput=[true|false]
```

此 API 的请求参数包括前面提及的默认集及以下唯一参数：

| 字段                   | 参数类型  | 描述 |
|-------------------------|-----------------|-------------|
| **`instanceId`**        | URL             | 业务流程实例的 ID。 |
| **`showInput`**         | 查询字符串    | 可选参数。 If set to `false`, the function input will not be included in the response payload.|
| **`showHistory`**       | 查询字符串    | 可选参数。 如果设置为 `true`，业务流程执行历史记录将包含在响应有效负载中。|
| **`showHistoryOutput`** | 查询字符串    | 可选参数。 If set to `true`, the function outputs will be included in the orchestration execution history.|
| **`createdTimeFrom`**   | 查询字符串    | 可选参数。 When specified, filters the list of returned instances that were created at or after the given ISO8601 timestamp.|
| **`createdTimeTo`**     | 查询字符串    | 可选参数。 When specified, filters the list of returned instances that were created at or before the given ISO8601 timestamp.|
| **`runtimeStatus`**     | 查询字符串    | 可选参数。 指定后，根据其运行时状态筛选返回实例列表。 To see the list of possible runtime status values, see the [Querying instances](durable-functions-instance-management.md) article. |

### <a name="response"></a>响应

可返回若干可能的状态代码值。

* HTTP 200 (正常)：指定实例的状态为已完成。
* HTTP 202 (已接受)：指定实例正在进行中。
* HTTP 400 (错误请求)：指定实例失败或已终止。
* HTTP 404 (找不到)：指定实例不存在或未开始运行。
* **HTTP 500 (内部服务器错误)** ：指定实例因未处理的异常而失败。

值为 HTTP 200 和 HTTP 202 时的响应负载是包含以下字段的 JSON 对象：

| 字段                 | 数据类型 | 描述 |
|-----------------------|-----------|-------------|
| **`runtimeStatus`**   | 字符串    | 实例的运行时状态。 相关的值为：正在运行、挂起、失败、已取消、已终止和已完成。 |
| **`input`**           | JSON      | 用于初始化实例的 JSON 数据。 如果 `showInput` 查询字符串参数设置为 `false`，则此字段为 `null`。|
| **`customStatus`**    | JSON      | 用于自定义业务流程状态的 JSON 数据。 如果未设置，此字段为 `null`。 |
| **`output`**          | JSON      | 实例的 JSON 输出。 如果实例不是已完成状态，则该字段为 `null`。 |
| **`createdTime`**     | 字符串    | 创建实例的时间。 使用 ISO 8601 扩展表示法。 |
| **`lastUpdatedTime`** | 字符串    | 实例持续的时间。 使用 ISO 8601 扩展表示法。 |
| **`historyEvents`**   | JSON      | 包含业务流程执行历史记录的 JSON 数组。 除非 `showHistory` 查询字符串参数设置为 `true`，否则此字段为 `null`。 |

下面是包括业务流程执行历史记录和活动输出的示例响应有效负载（为提高可读性已设置格式）：

```json
{
  "createdTime": "2018-02-28T05:18:49Z",
  "historyEvents": [
      {
          "EventType": "ExecutionStarted",
          "FunctionName": "E1_HelloSequence",
          "Timestamp": "2018-02-28T05:18:49.3452372Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello Tokyo!",
          "ScheduledTime": "2018-02-28T05:18:51.3939873Z",
          "Timestamp": "2018-02-28T05:18:52.2895622Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello Seattle!",
          "ScheduledTime": "2018-02-28T05:18:52.8755705Z",
          "Timestamp": "2018-02-28T05:18:53.1765771Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello London!",
          "ScheduledTime": "2018-02-28T05:18:53.5170791Z",
          "Timestamp": "2018-02-28T05:18:53.891081Z"
      },
      {
          "EventType": "ExecutionCompleted",
          "OrchestrationStatus": "Completed",
          "Result": [
              "Hello Tokyo!",
              "Hello Seattle!",
              "Hello London!"
          ],
          "Timestamp": "2018-02-28T05:18:54.3660895Z"
      }
  ],
  "input": null,
  "customStatus": { "nextActions": ["A", "B", "C"], "foo": 2 },
  "lastUpdatedTime": "2018-02-28T05:18:54Z",
  "output": [
      "Hello Tokyo!",
      "Hello Seattle!",
      "Hello London!"
  ],
  "runtimeStatus": "Completed"
}
```

HTTP 202 响应还包括 Location 响应标头，该标头引用了与上文提及的 `statusQueryGetUri` 字段相同的 URL。

## <a name="get-all-instances-status"></a>获取所有实例状态

You can also query the status of all instances by removing the `instanceId` from the 'Get instance status' request. In this case, the basic parameters are the same as the 'Get instance status'. Query string parameters for filtering are also supported.

请务必牢记 `connection` 和 `code` 可选。 If you have anonymous auth on the function, then `code` isn't required.
If you don't want to use a different storage connection string other than defined in the AzureWebJobsStorage app setting, then you can safely ignore the connection query string parameter.

### <a name="request"></a>请求

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
GET /admin/extensions/DurableTaskExtension/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
    &showInput=[true|false]
    &top={integer}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
GET /runtime/webhooks/durableTask/instances?
    taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
    &showInput=[true|false]
    &top={integer}
```

此 API 的请求参数包括前面提及的默认集及以下唯一参数：

| 字段                   | 参数类型  | 描述 |
|-------------------------|-----------------|-------------|
| **`instanceId`**        | URL             | 业务流程实例的 ID。 |
| **`showInput`**         | 查询字符串    | 可选参数。 If set to `false`, the function input will not be included in the response payload.|
| **`showHistory`**       | 查询字符串    | 可选参数。 如果设置为 `true`，业务流程执行历史记录将包含在响应有效负载中。|
| **`showHistoryOutput`** | 查询字符串    | 可选参数。 If set to `true`, the function outputs will be included in the orchestration execution history.|
| **`createdTimeFrom`**   | 查询字符串    | 可选参数。 When specified, filters the list of returned instances that were created at or after the given ISO8601 timestamp.|
| **`createdTimeTo`**     | 查询字符串    | 可选参数。 When specified, filters the list of returned instances that were created at or before the given ISO8601 timestamp.|
| **`runtimeStatus`**     | 查询字符串    | 可选参数。 指定后，根据其运行时状态筛选返回实例列表。 To see the list of possible runtime status values, see the [Querying instances](durable-functions-instance-management.md) article. |
| **`top`**               | 查询字符串    | 可选参数。 When specified, limits the number of instances returned by the query. |

### <a name="response"></a>响应

以下是包含业务流程状态的响应有效负载的示例（为可读性而设置了格式）：

```json
[
    {
        "instanceId": "7af46ff000564c65aafbfe99d07c32a5",
        "runtimeStatus": "Completed",
        "input": null,
        "customStatus": null,
        "output": [
            "Hello Tokyo!",
            "Hello Seattle!",
            "Hello London!"
        ],
        "createdTime": "2018-06-04T10:46:39Z",
        "lastUpdatedTime": "2018-06-04T10:46:47Z"
    },
    {
        "instanceId": "80eb7dd5c22f4eeba9f42b062794321e",
        "runtimeStatus": "Running",
        "input": null,
        "customStatus": null,
        "output": null,
        "createdTime": "2018-06-04T15:18:28Z",
        "lastUpdatedTime": "2018-06-04T15:18:38Z"
    },
    {
        "instanceId": "9124518926db408ab8dfe84822aba2b1",
        "runtimeStatus": "Completed",
        "input": null,
        "customStatus": null,
        "output": [
            "Hello Tokyo!",
            "Hello Seattle!",
            "Hello London!"
        ],
        "createdTime": "2018-06-04T10:46:54Z",
        "lastUpdatedTime": "2018-06-04T10:47:03Z"
    },
    {
        "instanceId": "d100b90b903c4009ba1a90868331b11b",
        "runtimeStatus": "Pending",
        "input": null,
        "customStatus": null,
        "output": null,
        "createdTime": "2018-06-04T15:18:39Z",
        "lastUpdatedTime": "2018-06-04T15:18:39Z"
    }
]
```

> [!NOTE]
> 如果实例表中有很多行，则此操作在 Azure存储 I/O 方面可能代价非常高昂。 有关实例表的更多详细信息，请参阅 [Durable Functions (Azure Functions) 中的性能和缩放](durable-functions-perf-and-scale.md#instances-table)文档。
>

If more results exist, a continuation token is returned in the response header.  标头的名称为 `x-ms-continuation-token`。

If you set continuation token value in the next request header, you can get the next page of results. This name of the request header is also `x-ms-continuation-token`.

## <a name="purge-single-instance-history"></a>Purge single instance history

Deletes the history and related artifacts for a specified orchestration instance.

### <a name="request"></a>请求

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
DELETE /admin/extensions/DurableTaskExtension/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connection}
    &code={systemKey}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
DELETE /runtime/webhooks/durabletask/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connection}
    &code={systemKey}
```

此 API 的请求参数包括前面提及的默认集及以下唯一参数：

| 字段             | 参数类型  | 描述 |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL             | 业务流程实例的 ID。 |

### <a name="response"></a>响应

The following HTTP status code values can be returned.

* **HTTP 200 (OK)** : The instance history has been purged successfully.
* **HTTP 404 (Not Found)** : The specified instance doesn't exist.

The response payload for the **HTTP 200** case is a JSON object with the following field:

| 字段                  | 数据类型 | 描述 |
|------------------------|-----------|-------------|
| **`instancesDeleted`** | integer   | The number of instances deleted. For the single instance case, this value should always be `1`. |

以下是响应负载的示例（为提高可读性设置了格式）：

```json
{
    "instancesDeleted": 1
}
```

## <a name="purge-multiple-instance-histories"></a>Purge multiple instance histories

You can also delete the history and related artifacts for multiple instances within a task hub by removing the `{instanceId}` from the 'Purge single instance history' request. To selectively purge instance history, use the same filters described in the 'Get all instances status' request.

### <a name="request"></a>请求

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
DELETE /admin/extensions/DurableTaskExtension/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
DELETE /runtime/webhooks/durabletask/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
```

此 API 的请求参数包括前面提及的默认集及以下唯一参数：

| 字段                 | 参数类型  | 描述 |
|-----------------------|-----------------|-------------|
| **`createdTimeFrom`** | 查询字符串    | Filters the list of purged instances that were created at or after the given ISO8601 timestamp.|
| **`createdTimeTo`**   | 查询字符串    | 可选参数。 When specified, filters the list of purged instances that were created at or before the given ISO8601 timestamp.|
| **`runtimeStatus`**   | 查询字符串    | 可选参数。 When specified, filters the list of purged instances based on their runtime status. To see the list of possible runtime status values, see the [Querying instances](durable-functions-instance-management.md) article. |

> [!NOTE]
> This operation can be very expensive in terms of Azure Storage I/O if there are a lot of rows in the Instances and/or History tables. More details on these tables can be found in the [Performance and scale in Durable Functions (Azure Functions)](durable-functions-perf-and-scale.md#instances-table) documentation.

### <a name="response"></a>响应

The following HTTP status code values can be returned.

* **HTTP 200 (OK)** : The instance history has been purged successfully.
* **HTTP 404 (Not Found)** : No instances were found that match the filter expression.

The response payload for the **HTTP 200** case is a JSON object with the following field:

| 字段                   | 数据类型 | 描述 |
|-------------------------|-----------|-------------|
| **`instancesDeleted`**  | integer   | The number of instances deleted. |

以下是响应负载的示例（为提高可读性设置了格式）：

```json
{
    "instancesDeleted": 250
}
```

## <a name="raise-event"></a>引发事件

向正在运行的业务流程实例发送事件通知消息。

### <a name="request"></a>请求

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/raiseEvent/{eventName}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/raiseEvent/{eventName}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

此 API 的请求参数包括前面提及的默认集及以下唯一参数：

| 字段             | 参数类型  | 描述 |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL             | 业务流程实例的 ID。 |
| **`eventName`**   | URL             | 目标业务流程正在等待的事件的名称。 |
| **`{content}`**   | 请求内容 | JSON 格式的事件负载。 |

### <a name="response"></a>响应

可返回若干可能的状态代码值。

* HTTP 202 (已接受)：已接受引发的事件，正在处理。
* HTTP 400 (错误请求)：请求内容不属于 `application/json` 类型或不是有效的 JSON。
* HTTP 404 (找不到)：找不到指定的实例。
* HTTP 410 (消失)：指定的实例已完成或失败，且无法处理任何引发的事件。

下面的请求示例向等待名为 operation 的事件的实例发送 JSON 字符串 `"incr"`：

```http
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/raiseEvent/operation?taskHub=DurableFunctionsHub&connection=Storage&code=XXX
Content-Type: application/json
Content-Length: 6

"incr"
```

此 API 的响应不包含任何内容。

## <a name="terminate-instance"></a>终止实例

终止正在运行的业务流程实例。

### <a name="request"></a>请求

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/terminate
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/terminate
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

此 API 的请求参数包括前面提及的默认集及以下唯一参数。

| 字段             | 参数类型  | 描述 |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL             | 业务流程实例的 ID。 |
| **`reason`**      | 查询字符串    | 可选。 终止业务流程实例的原因。 |

### <a name="response"></a>响应

可返回若干可能的状态代码值。

* HTTP 202 (已接受)：已接受终止请求，正在处理。
* HTTP 404 (找不到)：找不到指定的实例。
* HTTP 410 (消失)：指定的实例已完成或失败。

下面的示例请求终止正在运行的实例，并将原因指定为 buggy：

```
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/terminate?reason=buggy&taskHub=DurableFunctionsHub&connection=Storage&code=XXX
```

此 API 的响应不包含任何内容。

## <a name="rewind-instance-preview"></a>回退实例（预览版）

通过重播最近的失败操作，将失败的业务流程实例还原为运行状态。

### <a name="request"></a>请求

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/rewind
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/rewind
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

此 API 的请求参数包括前面提及的默认集及以下唯一参数。

| 字段             | 参数类型  | 描述 |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL             | 业务流程实例的 ID。 |
| **`reason`**      | 查询字符串    | 可选。 回退业务流程实例的原因。 |

### <a name="response"></a>响应

可返回若干可能的状态代码值。

* **HTTP 202 (已接受)** ：已接受回退请求，正在处理。
* HTTP 404 (找不到)：找不到指定的实例。
* **HTTP 410 (消失)** ：指定的实例已完成或已终止。

下面的示例请求回退失败的实例，并将原因指定为**已修复**：

```http
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/rewind?reason=fixed&taskHub=DurableFunctionsHub&connection=Storage&code=XXX
```

此 API 的响应不包含任何内容。

## <a name="signal-entity"></a>Signal entity

Sends a one-way operation message to a [Durable Entity](durable-functions-types-features-overview.md#entity-functions). If the entity doesn't exist, it will be created automatically.

> [!NOTE]
> Durable entities are available starting in Durable Functions 2.0.

### <a name="request"></a>请求

The HTTP request is formatted as follows (multiple lines are shown for clarity):

```http
POST /runtime/webhooks/durabletask/entities/{entityType}/{entityKey}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &op={operationName}
```

此 API 的请求参数包括前面提及的默认集及以下唯一参数：

| 字段             | 参数类型  | 描述 |
|-------------------|-----------------|-------------|
| **`entityType`**  | URL             | The type of the entity. |
| **`entityKey`**   | URL             | The unique name of the entity. |
| **`op`**          | 查询字符串    | 可选。 The name of the user-defined operation to invoke. |
| **`{content}`**   | 请求内容 | JSON 格式的事件负载。 |

Here is an example request that sends a user-defined "Add" message to a `Counter` entity named `steps`. The content of the message is the value `5`. If the entity does not already exist, it will be created by this request:

```http
POST /runtime/webhooks/durabletask/entities/Counter/steps?op=Add
Content-Type: application/json

5
```

### <a name="response"></a>响应

This operation has several possible responses:

* **HTTP 202 (Accepted)** : The signal operation was accepted for asynchronous processing.
* **HTTP 400 (Bad request)** : The request content was not of type `application/json`, was not valid JSON, or had an invalid `entityKey` value.
* **HTTP 404 (Not Found)** : The specified `entityType` was not found.

A successful HTTP request does not contain any content in the response. A failed HTTP request may contain JSON-formatted error information in the response content.

## <a name="query-entity"></a>Query entity

Gets the state of the specified entity.

### <a name="request"></a>请求

The HTTP request is formatted as follows (multiple lines are shown for clarity):

```http
GET /runtime/webhooks/durabletask/entities/{entityType}/{entityKey}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

### <a name="response"></a>响应

This operation has two possible responses:

* **HTTP 200 (OK)** : The specified entity exists.
* **HTTP 404 (Not Found)** : The specified entity was not found.

A successful response contains the JSON-serialized state of the entity as its content.

### <a name="example"></a>示例
The following example HTTP request gets the state of an existing `Counter` entity named `steps`:

```http
GET /runtime/webhooks/durabletask/entities/Counter/steps
```

If the `Counter` entity simply contained a number of steps saved in a `currentValue` field, the response content might look like the following (formatted for readability):

```json
{
    "currentValue": 5
}
```

## <a name="next-steps"></a>后续步骤

> [!div class="nextstepaction"]
> [Learn how to use Application Insights to monitor your durable functions](durable-functions-diagnostics.md)