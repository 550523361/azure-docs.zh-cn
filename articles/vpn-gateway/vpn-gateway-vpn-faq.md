<properties 
   pageTitle="虚拟网络 VPN 网关常见问题 | Windows Azure"
   description="VPN 网关常见问题。Windows Azure 虚拟网络跨界连接、混合配置连接和 VPN 网关的常见问题"
   services="vpn-gateway"
   documentationCenter="na"
   authors="cherylmc"
   manager="jdial"
   editor="tysonn" />
<tags 
   ms.service="vpn-gateway"
   ms.date="07/16/2015"
   wacn.date="" />

# VPN 网关常见问题

## 连接到虚拟网络

### 是否可以连接不同 Azure 区域中的虚拟网络？

是的。实际上，没有任何区域限制。一个虚拟网络既可以连接到同一区域中的另一个虚拟网络，也可以连接到不同 Azure 区域中的另一个虚拟网络。
### 是否可以连接不同订阅中的虚拟网络？

是的。
### 是否可以从一个虚拟网络连接到多个站点？

可以使用 Windows PowerShell 和 Azure REST API 连接到多个站点。请参阅[多站点和 VNet 到 VNet 连接](#multi-site-and-vnet-to-vnet-connectivity)常见问题部分。
## 我有哪些跨界连接选项？

虚拟网络支持以下跨界连接：

- [站点到站点](/documentation/articles/vpn-gateway-site-to-site-create)– 基于 IPsec（IKE v1 和 IKE v2）的 VPN 连接。这种类型连接需要 VPN 设备或 RRAS。

- [点到站点](/documentation/articles/vpn-gateway-point-to-site-create) – 基于 SSTP（安全套接字隧道协议）的 VPN 连接。此连接不需要 VPN 设备。

- [VNet 到 VNet](/documentation/articles/virtual-networks-vnet-to-vnet-connection) – 这种连接类型与站点到站点配置相同。VNet 到 VNet 是一种基于 IPsec（IKE v1 和 IKE v2）的 VPN 连接。它不需要 VPN 设备。

- [多站点](/documentation/articles/vpn-gateway-multi-site) – 这是站点到站点配置的一种变体，允许您将多个本地站点连接到一个虚拟网络。

### 站点到站点连接与点到站点连接之间有什么区别？

**站点到站点**连接依据您选择配置路由的方式，允许您将本地的任何计算机连接到虚拟网络中的任何虚拟机或角色实例。它是始终可用跨界连接的一个极佳选择，并且非常适合于混合配置。这种类型连接依赖于 IPsec VPN 装置（硬件或软设备），该装置必须部署在网络的边缘。若要创建这种类型连接，您必须具有所需的 VPN 硬件和一个面向外部的 IPv4 地址。

**点到站点**连接允许您从任意位置通过一台计算机连接到位于虚拟网络中的任何内容。它使用 Windows 内置 VPN 客户端。作为点到站点配置的一部分，您安装一个证书和 VPN 客户端配置程序包，其中包含允许您的计算机连接到虚拟网络中任何虚拟机或角色实例的设置。当需要连接到一个非本地虚拟网络时，这是一个极佳的方式。当您无权访问站点到站点连接所需的 VPN 硬件或面向外部的 IPv4 地址时，它也是一个不错的选择。

注意：可以将您的虚拟网络配置为同时使用站点到站点连接和点到站点连接，前提是您使用动态路由网关创建站点到站点连接。有关详细信息，请参阅[关于虚拟网络安全跨界连接](/documentation/articles/vpn-gateway-cross-premises-options)。

## VPN 设备和站点到站点连接

### 选择 VPN 设备时应考虑什么？

我们与设备供应商合作，验证了一套标准站点到站点 VPN 设备。可以在[此处](/documentation/articles/vpn-gateway-configure-vpn-gateway-mp/#how-to-view-gateway-traffic)找到已知的兼容 VPN 设备、相应配置说明或示例以及设备规格的列表。列为已知兼容设备系列中的所有设备都应适用于虚拟网络。要获得有关配置 VPN 设备的帮助，请参阅设备配置示例或与相应设备系列相对应的链接。

### 如果我有不在已知兼容设备列表中的 VPN 设备，我该怎么办？

如果没有看到您的设备作为已知兼容 VPN 设备列出，并且要将其用于 VPN 连接，则您需要验证它是否满足[此处](/documentation/articles/vpn-gateway-about-vpn-devices)列出的支持的 IPsec/IKE 配置选项和参数。满足最低要求的设备都应适用于虚拟网络。请与您的设备制造商联系以获得额外的支持和配置说明。

### 是否可以使用软件 VPN 连接到 Azure？

对于站点到站点跨界配置，我们支持 Windows Server 2012 路由和远程访问 (RRAS) 服务器。

其他软件 VPN 解决方案只要符合行业标准 IPsec 实施，就应该适用于我们的网关。请与软件供应商联系以获得配置和支持说明。

## 点到站点连接

### 哪些操作系统可以与点到站点连接配合使用？

支持以下操作系统：

- Windows 7（仅限 64 位版本）

- Windows Server 2008 R2

- Windows 8（仅限 64 位版本）

- Windows Server 2012

### 是否可以将任何软件 VPN 客户端与支持 SSTP 的点到站点连接配合使用？

否。支持仅限于上面列出的 Windows 操作系统版本。

### 在我的点到站点配置中可以有多少个 VPN 客户端终结点?

我们支持最多 128 个 VPN 客户端能够同时连接到虚拟网络。

### 是否可以将我自己的内部 PKI 根 CA 用于点到站点连接？

目前仅支持自签名根证书。

### 是否可以使用点到站点功能穿过代理和防火墙？

是的。我们使用 SSTP（安全套接字隧道协议）以隧道方式通过防火墙。此隧道以 HTTPs 连接形式出现。

### 如果重新启动配置为点到站点连接的客户端计算机，VPN 是否会自动重新连接？

默认情况下，客户端计算机不会自动重新建立 VPN 连接。

### 点到站点配置是否在 VPN 客户端上支持自动重新连接和 DDNS？

点到站点 VPN 目前不支持自动重新连接和 DDNS。

### 站点到站点配置和点到站点配置是否可以针对同一虚拟网络共存？

是的。如果虚拟网络有动态路由 VPN 网关，则这些解决方案都适用。我们在静态路由 VPN 网关中不支持点到站点配置。

### 是否可以将点到站点客户端配置为同时连接到多个虚拟网络？

是的，这是可以的。但是虚拟网络不能有重叠的 IP 前缀，并且虚拟网络之间不得有重叠的点到站点地址空间。

### 可以预计通过站点到站点或点到站点连接有多少吞吐量？

很难保持 VPN 隧道的确切吞吐量。IPsec 和 SSTP 是强加密 VPN 协议。您的本地网络和 Internet 之间的延迟和带宽也限制了吞吐量。

## 网关

### 什么是静态路由网关？

静态路由网关实施基于策略的 VPN。基于策略的 VPN 依据您的本地网络和 Azure VNet 之间的地址前缀组合对数据包进行加密，并引导数据包通过 IPsec 隧道。在 VPN 配置中，策略（或流量选择器）通常定义为一个访问列表。

### 什么是动态路由网关？

动态路由网关实施基于路由的 VPN。基于路由的 VPN 在 IP 转发或路由表中使用“路由”将数据包引导到相应的隧道接口。然后，隧道接口对进出隧道的数据包进行解密或解密。基于路由的 VPN 的策略或流量选择器配置为任意到任意（或通配符）。

### 在创建 VPN 网关之前是否可获得其 IP 地址？

否。必须首先创建网关之后才能获得其 IP地址。如果删除并重新创建 VPN 网关，则其 IP 地址将会改变。

### VPN 隧道如何通过身份验证？

Azure VPN 使用 PSK（预共享密钥）身份验证。我们在创建 VPN 隧道时生成一个预共享密钥 (PSK)。您可以使用 Set Pre-Shared Key PowerShell cmdlet 或 REST API 将自动生成的 PSK 更改为您自己的 PSK。

### 是否可以使用 Set Pre-Shared Key API 来配置我的静态路由网关 VPN？

是的，可以使用 Set Pre-Shared Key API 和 PowerShell cmdlet 来配置 Azure 静态路由 VPN 和动态路由 VPN。

### 是否可以使用其他身份验证选项？

我们限制为使用预共享密钥 (PSK) 进行身份验证。

### 什么是“网关子网”，为什么需要它？

我们运行用于启用跨界连接的网关服务。我们需要 2 个来自您路由域的 IP 地址，以便我们启用您的本地网络和云之间的路由。我们要求您指定至少一个 /29 子网，从中我们可以选取 IP 地址以设置路由。

请注意，不得在网关子网中部署虚拟机或角色实例。

### 如何指定哪些流量通过 VPN 网关？

在“本地网络”下的“网络”页面中为您的虚拟网络添加要通过网关发送的各个范围。

### 是否可以配置强制隧道？

是的。请参阅[关于强制隧道](/documentation/articles/vpn-gateway-about-forced-tunneling)。

### 是否可以在 Azure 中配置我自己的 VPN 服务器并且用其连接到我的本地网络？

是的，您可以从 Azure Marketplace 在 Azure 中部署您自己的 VPN 网关或服务器，或者创建您自己的 VPN 路由器。您需要在虚拟网络中配置用户定义路由，以确保在您的本地网络和虚拟网络子网之间正确路由流量。

### 有关网关类型、要求和吞吐量的更多信息

有关详细信息，请参阅[关于 VPN 网关](/documentation/articles/vpn-gateway-about-vpngateways)。

## 多站点和 VNet 到 VNet 连接

### 何种类型网关可以支持多站点和 VNet 到 VNet 连接？

仅动态路由 VPN。

### 是否可以将具有动态路由 VPN 的虚拟网络连接到具有静态路由 VPN 的虚拟网络？

否，这两个虚拟网络都必须使用动态路由 VPN。

### VNet 到 VNet 流量是否安全？

是的，它有 IPsec/IKE 加密保护。

### 一个虚拟网络可以连接到多少个本地站点和其他虚拟网络？

对于基本和标准动态路由网关，最多 10 个；对于高性能 VPN 网关，最多 30 个。

### 是否可以将点到站点 VPN 与我的具有多个 VPN 隧道的虚拟网络配合使用？

是的，点到站点 (P2S) VPN 可以与连接到多个本地站点和其他虚拟网络的 VPN 网关配合使用。

### 是否可以使用多站点 VPN 在我的虚拟网络和本地站点之间配置多个隧道？

否，不支持 Azure 虚拟网络与本地站点之间存在冗余隧道。

### 在连接的虚拟网络和本地站点之间是否能有重叠的地址空间？

否。重叠地址空间会导致 NETCFG 上传或创建虚拟网络失败。

### 通过站点到站点 VPN 获得的带宽是否比单个虚拟网络的多？

否，所有 VPN 隧道，包括点到站点 VPN，都共享同一 Azure VPN 网关和可用带宽。

### 是否可以使用 Azure VPN 网关在我的本地站点之间传输流量，或者向另一虚拟网络传输流量？

通过 Azure VPN 网关传输流量是可能的，但依赖于在 NETCFG 配置文件中静态定义的地址空间。Azure 虚拟网络和 VPN 网关尚不支持 BGP。没有 BGP，在 NETCFG 中手动定义传输地址空间非常容易出错，因此并不推荐。

### 对于同一虚拟网络，Azure 是否为我的所有 VPN 连接生成相同的 IPsec/IKE 预共享密钥？

否，默认情况下，Azure 为不同的 VPN 连接生成不同的预共享密钥。但是，您可以使用 Set VPN Gateway Key REST API 或 PowerShell cmdlet 来设置您需要的密钥值。密钥必须是长度介于 1 到 128 个字符之间的字母数字字符串。

### Azure 是否为虚拟网络之间的流量收费？

对于不同 Azure 虚拟网络之间的流量，Azure 仅收取从一个 Azure 区域到另一个区域的流量费用。费率列出在 Azure VPN 网关[定价](https://azure.microsoft.com/pricing/details/vpn-gateway/)页中。

### 是否可以将具有 IPsec VPN 的虚拟网络连接到我的 ExpressRoute 回路？

否，不支持。

## 连接和虚拟机

### 如果我的虚拟机在一个虚拟网络中，并且我有一个跨界连接，我应如何连接到虚拟机？

您有几个选项。如果启用了 RDP 并且已经创建了一个终结点，则可以通过使用 VIP 来连接到您的虚拟机。在这种情况下，您将指定 VIP 以及要连接到的端口。您需要针对流量配置虚拟机上的端口。通常情况下，您将转到管理门户并将 RDP 连接的设置保存到您的计算机。这些设置将包含必要的连接信息。

如果您的虚拟网络配置了跨界连接，则可以通过使用内部 DIP 或专用 IP 地址连接到您的虚拟机。您还可以从位于同一虚拟网络的另一台虚拟机通过内部 DIP 连接到您的虚拟机。如果要从虚拟网络以外的位置连接，则不能通过使用 DIP，以 RDP 连接到您的虚拟机。例如，如果您有一个配置为点到站点的虚拟网络，并且没有从您的计算机建立一个连接，则不能通过 DIP 连接到虚拟机。

### 如果我的虚拟机位于一个具有跨界连接的虚拟网络中，来自我的虚拟机的所有流量是否都经过该连接？

否。只有目标 IP 包含在您指定的虚拟网络本地网络 IP 地址范围内的流量才经过虚拟网络网关。目标 IP 位于虚拟网络内的流量将留在虚拟网络内。其他流量通过负载平衡器发送到公共网络，或者如果使用了强制隧道，则通过 Azure VPN 网关发送。如果正在进行故障排除，确保您在“本地网络”中列出了要通过网关发送的所有范围非常重要。验证“本地网络”地址范围没有与虚拟网络中的任何地址范围重叠。此外，您还需要验证正在使用的 DNS 服务器将名称解析到正确的 IP 地址。

## 后续步骤

查看更多网络常见问题以获得额外的信息：

- [虚拟网络常见问题](/documentation/articles/virtual-networks-faq)



 

<!---HONumber=67-->