---
title: 为 IoT 代理配置 Azure 安全中心*微软文档
description: 了解如何为 IoT 安全代理配置 Azure 安全中心，以便与 IoT 安全服务的 Azure 安全中心一起使用。
services: asc-for-iot
ms.service: asc-for-iot
documentationcenter: na
author: mlottner
manager: rkarlin
editor: ''
ms.assetid: f95c445a-4f0d-4198-9c6c-d01446473bd0
ms.subservice: asc-for-iot
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 02/18/2020
ms.author: mlottner
ms.openlocfilehash: 70396cdcaf8b6e2ac66619290eea35a7b260cd9a
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/27/2020
ms.locfileid: "77461243"
---
# <a name="tutorial-configure-security-agents"></a>教程：配置安全代理

本文介绍了 IoT 安全代理的 Azure 安全中心，并详细介绍了如何更改和配置它们。 

> [!div class="checklist"]
> * 配置安全代理
> * 通过编辑孪生属性更改代理行为
> * 发现默认配置

## <a name="agents"></a>代理

IoT 安全代理 Azure 安全中心从 IoT 设备收集数据，并执行安全操作以减轻检测到的漏洞。 使用一组可以自定义的模块孪生属性，安全代理配置是可控的。 通常，对这些属性的辅助更新并不常见。  

IoT 安全代理孪生配置对象的 Azure 安全中心是 JSON 格式对象。 配置对象是一组可控制的属性，您可以定义这些属性来控制代理的行为。 

这些配置可帮助您针对所需的每个方案自定义代理。 例如，通过配置这些属性，可以自动排除某些事件，或将功耗保持在最低水平。  

使用 Azure 安全中心进行 IoT 安全代理配置[架构](https://aka.ms/iot-security-github-module-schema)进行更改。  

## <a name="configuration-objects"></a>配置对象 

与每个 IoT 安全代理的 Azure 安全中心相关的属性位于**Azureiot 安全**模块的代理配置对象（所需属性部分）中。 

要修改配置，请创建和修改**Azureiot 模块**孪体标识内的此对象。 

如果**Azureiotsecurity**模块孪生中不存在代理配置对象，则所有安全代理属性值都设置为默认值。 

```json
"desired": {
  "ms_iotn:urn_azureiot_Security_SecurityAgentConfiguration": {
  } 
}
```

## <a name="configuration-schema-and-validation"></a>配置架构和验证 

请确保根据此[架构](https://aka.ms/iot-security-github-module-schema)验证代理配置。 如果配置对象与架构不匹配，代理将不会启动。

 
如果在代理运行时，配置对象更改为无效配置（配置与架构不匹配），则代理将忽略无效配置，并继续使用当前配置。 

### <a name="configuration-validation"></a>配置验证

IoT 安全代理 Azure 安全中心在**Azureiot 安全**模块孪生标识的报告属性部分内报告其当前配置。
如果用户未设置属性，代理将报告所有可用属性，则代理报告默认配置。

为了验证配置，请将所需节上设置的值与报告节中报告的值进行比较。

如果所需属性和报告属性不匹配，则代理无法分析配置。

根据[架构](https://aka.ms/iot-security-github-module-schema)验证所需的属性，修复错误，并再次设置所需的属性！

> [!NOTE]
> 如果代理无法解析所需的配置，将从代理触发配置错误警报。
> 比较报告和所需部分以了解警报是否仍然适用

## <a name="editing-a-property"></a>编辑属性 

所有自定义属性都必须设置在**Azureiot 安全**模块孪生的代理配置对象内。
要使用默认属性值，请从配置对象中删除该属性。

### <a name="setting-a-property"></a>设置属性

1. 在 IoT 中心中，找到并选择要更改的设备。

1. 单击您的设备，然后单击**Azureiot 安全**模块。

1. 单击**模块标识孪生**。

1. 编辑要在安全模块中更改的属性。
   
   例如，要将连接事件配置为高优先级并每 7 分钟收集一次高优先级事件，请使用以下配置。
   
    ```json
    "desired": {
        "ms_iotn:urn_azureiot_Security_SecurityAgentConfiguration": {
            "highPriorityMessageFrequency": {
                "value": "PT7M"
            },
            "eventPriorityConnectionCreate": {
                "value": "High"
            }
        }
    }
    ```

1. 单击“保存”。****

### <a name="using-a-default-value"></a>使用默认值

要使用默认属性值，请从配置对象中删除该属性。

## <a name="default-properties"></a>默认属性 

下表包含 IoT 安全代理 Azure 安全中心的可控制属性。

默认值在[GitHub](https\://aka.ms/iot-security-module-default)中的正确架构中可用。

| “属性”| 状态 | 有效值| 默认值| 描述 |
|----------|------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|---------------|
|高优先级消息频率|必需：假 |有效值：ISO 8601 格式的持续时间 |默认值： PT7M |发送高优先级消息之前的最大时间间隔。|
|低优先级消息频率 |必需：假|有效值：ISO 8601 格式的持续时间 |默认值： PT5H |发送低优先级消息之前的最大时间。| 
|快照频率 |要求： 假|有效值：ISO 8601 格式的持续时间 |默认值 PT13H |创建设备状态快照的时间间隔。| 
|最大本地缓存大小字节 |必需：假 |有效值： |默认值： 2560000， 大于 8192 | 允许代理的消息缓存的最大存储（以字节为单位）。 在发送消息之前，允许在设备上存储消息的最大空间量。| 
|最大消息大小字节 |必需：假 |有效值：大于 8192 的正数，小于 262144 |默认值： 204800 |对云消息的代理的最大允许大小。 此设置控制每条消息中发送的最大数据量。 |
|事件优先级$[事件名称] |必需：假 |有效值：高、低、关 |默认值： |每个代理生成的事件的优先级 | 

### <a name="supported-security-events"></a>支持的安全事件

|事件名称| PropertyName | 默认值| 快照事件| 详细信息状态  |
|----------|------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|---------------|
|诊断事件|事件优先级诊断| 关闭| False| 代理相关诊断事件。 使用此事件进行详细日志记录。| 
|配置错误 |事件优先级配置错误 |低 |False |代理未能分析配置。 根据架构验证配置。| 
|丢弃的事件统计信息 |事件优先级放弃事件统计信息 |低 |True|代理相关事件统计信息。 |
|连接的硬件|事件优先级连接硬件 |低 |True |连接到设备的所有硬件的快照。|
|侦听端口|事件优先级侦听端口 |高 |True |设备上所有打开的侦听端口的快照。|
|流程创建 |事件优先级进程创建 |低 |False |审核设备上的流程创建。|
|进程终止|事件优先级进程终止 |低 |False |审核设备上的进程终止。| 
|系统信息 |事件优先级系统信息 |低 |True |系统信息的快照（例如：操作系统或 CPU）。| 
|本地用户| 事件优先级本地用户 |高 |True|系统中已注册的本地用户的快照。 |
|登录|  事件优先级登录 |高|False|审核设备的登录事件（本地和远程登录）。|
|连接创建 |事件优先级连接创建|低|False|审核在设备创建和从设备创建的 TCP 连接。 |
|防火墙配置| 事件优先级防火墙配置|低|True|设备防火墙配置的快照（防火墙规则）。 |
|操作系统基线| 事件优先级OS基线| 低|True|设备操作系统基线检查的快照。|
|
 

## <a name="next-steps"></a>后续步骤

- [了解 Azure 安全中心，了解 IoT 建议](concept-recommendations.md)
- [探索适用于 IoT 警报的 Azure 安全中心](concept-security-alerts.md)
- [访问原始安全数据](how-to-security-data-access.md)
