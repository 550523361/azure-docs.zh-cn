---
title: "从 Azure 堆栈使用基础结构备份服务中的灾难性数据丢失中恢复 |Microsoft 文档"
description: "当灾难性故障导致 Azure 堆栈失败，则可以还原基础结构数据时重新建立你 Azure 堆栈的部署。"
services: azure-stack
documentationcenter: 
author: mattbriggs
manager: femila
editor: 
ms.assetid: 2ECE8580-0BDE-4D4A-9120-1F6771F2E815
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2017
ms.author: mabrigg
ms.openlocfilehash: 859d31b554fcd1936ce555f6afb0f4631a3af7aa
ms.sourcegitcommit: 85012dbead7879f1f6c2965daa61302eb78bd366
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/02/2018
---
# <a name="recover-from-catastrophic-data-loss"></a>从灾难性数据丢失中恢复

*适用范围： Azure 堆栈集成系统。*

Azure 堆栈在你的数据中心中运行 Azure 服务。 Azure 堆栈可以在环境越小越在单个机架中安装的四个节点上运行。 与此相反，Azure 在多个数据中心和每个区域中的多个区域中的 40 多个区域中运行。 用户资源可以跨多个服务器、 机架、 数据中心和区域。 具有 Azure 堆栈，当前仅可以选择将整个云部署到单个机架。 这会公开你的云数据中心或主要产品 bug 导致的故障的灾难性事件的风险。 灾难发生时，Azure 堆栈实例处于脱机状态。 可能无法恢复的所有数据。

根据数据丢失的根本原因，你可能需要修复单个基础结构服务或还原整个 Azure 堆栈实例。 你甚至可能需要还原到不同的硬件位于相同位置或在其他位置。

恢复出现故障时的设备和私有云的重新部署整个安装此方案地址。

| 方案                                                           | 数据丢失                            | 注意事项                                                             |
|--------------------------------------------------------------------|--------------------------------------|----------------------------------------------------------------------------|
| 从灾难或产品 bug 导致的灾难性数据丢失中恢复 | 所有基础结构以及用户和应用数据 | 用户应用程序和数据免于单独基础结构数据 |

## <a name="workflows"></a>工作流

保护 Azure 启动旅程开头，单独备份的基础结构和应用程序/租户数据。 本文档介绍如何保护基础结构。 

![Azure 堆栈的初始部署](media\azure-stack-backup\azure-stack-backup-workflow1.png)

在所有数据都都会丢失的最坏情况，恢复 Azure 堆栈都是唯一的基础结构数据还原到该部署的 Azure 堆栈和所有用户数据的过程。 

![重新部署 Azure 堆栈](media\azure-stack-backup\azure-stack-backup-workflow2.png)

## <a name="restore"></a>还原

如果没有灾难性数据丢失，但仍然可以使用硬件，则需要重新部署 Azure 堆栈。 在重新部署，可以指定的存储位置和访问备份所需的凭据。 在此模式下，没有无需指定需要还原的服务。 基础结构备份控制器插入控件平面状态作为部署工作流的一部分。

如果没有呈现硬件不可用的灾难，则只有可能在新硬件上重新部署。 更换硬件进行排序和抵达数据中心时，重新部署可能需要几周。 在任何时候是可能的控制平面数据的还原。 但是，如果重新部署的实例的版本是多个版本大于最后一个备份中使用的版本不支持还原。 

| 部署模式 | 起始点 | 终结点                                                                                                                                                                                                     |
|-----------------|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 全新安装   | 基线生成 | OEM 部署 Azure 堆栈，并更新到最新的受支持版本。                                                                                                                                          |
| 恢复模式   | 基线生成 | OEM 在恢复模式下部署 Azure 堆栈，并处理匹配基于最新的可用备份的要求的版本。 OEM 完成由于更新至最新受支持版本的部署。 |

## <a name="data-in-backups"></a>备份中的数据

Azure 堆栈支持部署称为云恢复模式的类型。 仅当你选择在灾难后恢复 Azure 堆栈或产品 bug 呈现解决方案不可恢复时，才使用此模式。 此部署模式下时未恢复的任何用户数据存储在解决方案中。 此部署模式中的作用域仅限于还原以下数据：

 - 部署输入
 - 内部标识系统
 - 联合标识配置 （断开连接部署）
 - 使用的内部证书颁发机构的根证书
 - Azure 资源管理器的配置用户数据，例如订阅、 计划、 服务和存储，配额网络，然后计算资源
 - KeyVault 机密和保管库
 - RBAC 策略分配和角色分配 

无用户基础结构即服务 (IaaS) 或平台作为服务 (PaaS) 资源会在部署过程中恢复。 它是 IaaS Vm、 存储帐户、 blob、 表、 网络配置和等等，都将丢失。 云恢复的目的是确保您的操作人员和用户可以重新登录到门户部署完成后。 重新登录的用户看不到任何其资源。 用户拥有还原其订阅并且以及，原始计划，并提供由管理员定义的策略。 重新插入系统日志记录的用户将在相同的约束施加在灾难发生之前的原始解决方案的操作。 云恢复完成后，可以手动还原运算符将值添加和第三方 RPs 和关联的数据。

## <a name="next-steps"></a>后续步骤

 - 了解有关最佳实践[使用基础结构备份服务](azure-stack-backup-best-practices.md)。
