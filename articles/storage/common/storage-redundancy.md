---
title: 数据冗余
titleSuffix: Azure Storage
description: 复制 Microsoft Azure 存储帐户中的数据以实现持久性和高可用性。 冗余配置包括本地冗余存储 （LRS）、区域冗余存储 （ZRS）、异地冗余存储 （GRS）、读取访问异地冗余存储 （RA-GRS）、地理区域冗余存储 （GZRS） （预览）和读取访问地理区域冗余存储 （RA-GZRS）（预览）。
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 02/25/2020
ms.author: tamram
ms.reviewer: artek
ms.subservice: common
ms.openlocfilehash: 1961797f37a760fe3a31dc8aa3830889965b69b5
ms.sourcegitcommit: ea006cd8e62888271b2601d5ed4ec78fb40e8427
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/14/2020
ms.locfileid: "81379937"
---
# <a name="azure-storage-redundancy"></a>Azure 存储冗余

Azure 存储始终存储数据的多个副本，以便防止其免受计划内和计划外事件的影响，包括瞬时硬件故障、网络或断电以及大规模自然灾害。 冗余可确保存储帐户符合 Azure[存储的服务级别协议 （SLA），](https://azure.microsoft.com/support/legal/sla/storage/)即使在发生故障时也是如此。

在决定哪种冗余选项最适合您的方案时，请考虑降低成本和更高的可用性和耐用性之间的权衡。 帮助确定应选择哪些冗余选项的因素包括：  

- 如何在主区域中复制数据
- 您的数据是否复制到地理位置与主要区域距离的第二个位置，以防止区域灾难
- 如果主区域因任何原因不可用，应用程序是否需要对辅助区域中的复制数据的读取访问

## <a name="redundancy-in-the-primary-region"></a>主区域中的冗余

Azure 存储帐户中的数据始终在主区域中复制三次。 Azure 存储提供了两个选项，用于在主区域中复制数据的方式：

- **本地冗余存储 （LRS）** 在主区域的单个物理位置同步复制数据三次。 LRS 是最便宜的复制选项，但不建议对于需要高可用性的应用程序。
- **区域冗余存储 （ZRS）** 在主区域中的三个 Azure 可用性区域同步复制数据。 对于需要高可用性的应用程序，Microsoft 建议在主区域中使用 ZRS，并复制到辅助区域。

### <a name="locally-redundant-storage"></a>本地冗余存储

本地冗余存储 （LRS） 在主区域的单个物理位置内复制数据三次。 LRS 在给定的一年内提供至少 99.999999999%（11 个 9）的对象持久性。

LRS 是成本最低的冗余选项，与其他选项相比，其耐用性最低。 LRS 可保护您的数据免受服务器机架和驱动器故障的影响。 但是，如果数据中心内发生火灾或洪水等灾难，则使用 LRS 的存储帐户的所有副本可能丢失或无法恢复。 为了降低此风险，Microsoft 建议使用[区域冗余存储](#zone-redundant-storage)（ZRS）、[异地冗余存储](#geo-redundant-storage)（GRS） 或[地理区域冗余存储 （预览）（GZRS）。](#geo-zone-redundant-storage-preview)

对使用 LRS 的存储帐户的写入请求同步发生。 写入操作仅在将数据写入所有三个副本后才能成功返回。

LRS 是以下方案的最佳选择：

- 如果应用程序存储着在发生数据丢失时可轻松重构的数据，则可以选择 LRS。
- 如果应用程序由于数据治理要求而仅限于在国家或地区复制数据，则可以选择 LRS。 在某些情况下，数据进行地理复制的配对区域可能位于另一个国家或地区。 有关配对区域的详细信息，请参阅 [Azure 区域](https://azure.microsoft.com/regions/)。

### <a name="zone-redundant-storage"></a>区域冗余存储

区域冗余存储 （ZRS） 在主区域中的三个 Azure 可用性区域同步复制 Azure 存储数据。 每个可用性区域都是一个独立的物理位置，具有独立的电源、冷却和网络。 ZRS 为 Azure 存储数据对象提供的持久性在给定年份中至少为 99.999999999%（12 9）。

使用 ZRS，即使区域不可用，读取和写入操作仍可访问您的数据。 如果区域不可用，Azure 将进行网络更新，如 DNS 重新指向。 如果在更新完成之前访问数据，这些更新可能会影响应用程序。 在为 ZRS 设计应用程序时，请遵循瞬态故障处理实践，包括使用指数回退实现重试策略。

对使用 ZRS 的存储帐户的写入请求同步发生。 写入操作仅在将数据写入三个可用性区域中的所有副本后才能成功返回。

Microsoft 建议在主区域中使用 ZRS，以便进行需要一致性、耐用性和高可用性的方案。 如果数据暂时不可用，ZRS 可为数据提供出色的性能、低延迟和弹性。 但是，ZRS 本身可能无法保护数据免受区域灾难的影响，因为区域区域受到永久影响。 为了防御区域灾难，Microsoft 建议使用[地理区域冗余存储](#geo-zone-redundant-storage-preview)（GZRS），该存储在主区域中使用 ZRS，并将数据异地复制到辅助区域。

下表显示了哪些类型的存储帐户支持 ZRS，其中区域：

|    存储帐户类型    |    支持的区域    |    支持的服务    |
|----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
|    通用 v2<sup>1</sup>    | 亚洲东南部<br /> 澳大利亚东部<br /> 北欧<br />  西欧<br /> 法国中部<br /> 日本东部<br /> 南非北部<br /> 英国南部<br /> 美国中部<br /> 美国东部<br /> 美国东部 2<br /> 美国西部 2    |    块 Blob<br /> 页面 blob<sup>2</sup><br /> 文件共享（标准）<br /> 表<br /> 队列<br /> |
|    块 Blob 存储<sup>1</sup>    | 西欧<br /> 美国东部    |    仅块 Blob    |
|    文件存储    | 西欧<br /> 美国东部    |    仅 Azure 文件    |

<sup>1</sup> ZRS 帐户当前不支持存档层。<br />
<sup>2</sup>包含虚拟机 Azure 托管磁盘的存储帐户始终使用 LRS。 Azure 非托管磁盘也应使用 LRS。 可以为使用 GRS 的 Azure 非托管磁盘创建存储帐户，但由于异步异地复制可能存在一致性问题，因此不建议这样做。 托管磁盘和非托管磁盘都不支持 ZRS 或 GZRS。 有关托管磁盘的详细信息，请参阅 Azure[托管磁盘的定价](https://azure.microsoft.com/pricing/details/managed-disks/)。

有关哪些区域支持 ZRS 的信息，请参阅[Azure 可用性区域中的](../../availability-zones/az-overview.md)**按区域提供的服务支持**？

## <a name="redundancy-in-a-secondary-region"></a>辅助区域中的冗余

对于需要高可用性的应用程序，您可以选择将存储帐户中的数据另一步复制到距离主区域数百英里的辅助区域。 如果存储帐户被复制到辅助区域，则即使出现完全的区域中断或主区域无法恢复的灾难，您的数据也是持久的。

创建存储帐户时，可以为帐户选择主要区域。 配对的次要区域是根据主要区域确定的且无法更改。 有关 Azure 支持的区域的详细信息，请参阅[Azure 区域](https://azure.microsoft.com/global-infrastructure/regions/)。

Azure 存储提供了两种将数据复制到辅助区域的选项：

- 使用 LRS 在主区域的单个物理位置同步复制数据三次的**异地冗余存储 （GRS）。** 然后，它会异步将数据复制到辅助区域中的单个物理位置。
- 使用 ZRS 在主区域的三个 Azure 可用性区域同步复制数据地理**区域冗余存储 （GZRS）** （预览）。 然后，它会异步将数据复制到辅助区域中的单个物理位置。

GRS 和 GZRS 之间的主要区别是如何在主区域中复制数据。 在辅助位置内，数据始终使用 LRS 同步复制三次。

使用 GRS 或 GZRS 时，辅助位置中的数据不能用于读取或写入访问，除非对辅助区域进行故障转移。 对于对辅助位置的读取访问，请将存储帐户配置为使用读取访问异地冗余存储 （RA-GRS） 或读取访问地理区域冗余存储 （RA-GZRS）。 有关详细信息，请参阅[读取对辅助区域中的数据的访问](#read-access-to-data-in-the-secondary-region)。

如果主区域不可用，您可以选择故障转移到辅助区域（预览）。 故障转移完成后，辅助区域将成为主区域，您可以再次读取和写入数据。 有关灾难恢复的详细信息以及如何故障转移到辅助区域，请参阅[灾难恢复和帐户故障转移（预览）。](storage-disaster-recovery-guidance.md)

> [!IMPORTANT]
> 由于数据以异步方式复制到辅助区域，因此如果无法恢复主区域，则影响主区域的故障可能会导致数据丢失。 最近写入主区域与最后写入辅助区域之间的间隔称为恢复点目标 （RPO）。 RPO 指示可以将数据恢复到的时间点。 Azure 存储的 RPO 通常少于 15 分钟，尽管当前没有 SLA 用于将数据复制到辅助区域所需的时间。

### <a name="geo-redundant-storage"></a>异地冗余存储

使用 LRS 在主区域的单个物理位置同步复制数据三次的异地冗余存储 （GRS）。 然后，它会异步将数据复制到距离主区域数百英里的辅助区域中的单个物理位置。 GRS 为 Azure 存储数据对象提供的持久性至少为 99.99999999999999999999%的给定年份。

写入操作首先提交到主位置并使用 LRS 进行复制。 然后，更新异步复制到辅助区域。 将数据写入次要位置后，还会使用 LRS 在该位置复制数据。

### <a name="geo-zone-redundant-storage-preview"></a>地理区域冗余存储（预览）

地理区域冗余存储 （GZRS） （预览）将跨可用性区域的冗余提供的高可用性与异地复制提供的区域中断保护相结合。 GZRS 存储帐户中的数据在主区域的三个[Azure 可用性区域](../../availability-zones/az-overview.md)中复制，并且也会复制到辅助地理区域，以防止区域灾难。 Microsoft 建议对需要最大一致性、耐用性和可用性、卓越性能和灾难恢复恢复能力的应用程序使用 GZRS。

使用 GZRS 存储帐户，如果可用性区域不可用或无法恢复，则可以继续读取和写入数据。 此外，如果出现完全的区域中断或主区域无法恢复的灾难，您的数据也是持久的。 GZRS 旨在提供至少 99.999999999999999%的物体在给定年份的耐久性。

只有通用 v2 存储帐户支持 GZRS 和 RA-GZRS。 有关存储帐户类型的详细信息，请参阅 [Azure 存储帐户概述](storage-account-overview.md)。 GZRS 和 RA-GZRS 支持块 blob、页面 blob（VHD 磁盘除外）、文件、表和队列。

GZRS 和 RA-GZRS 目前可用于以下区域的预览：

- 亚洲东南部
- 北欧
- 西欧
- 日本东部
- 英国南部
- 美国东部
- 美国东部 2
- 美国中部
- 美国西部 2

Microsoft 继续在其他 Azure 区域中启用 GZRS 和 RA-GZRS。 定期查看[Azure 服务更新](https://azure.microsoft.com/updates/)页，了解有关受支持区域的信息。

有关预览定价的信息，请参阅[Blob、](https://azure.microsoft.com/pricing/details/storage/blobs)[文件](https://azure.microsoft.com/pricing/details/storage/files/)、[队列](https://azure.microsoft.com/pricing/details/storage/queues/)和[表](https://azure.microsoft.com/pricing/details/storage/tables/)的 GZRS 预览定价。

> [!IMPORTANT]
> Microsoft 建议不要对生产工作负载使用预览功能。

## <a name="read-access-to-data-in-the-secondary-region"></a>读取对辅助区域中的数据的访问

异地冗余存储（使用 GRS 或 GZRS）将数据复制到辅助区域中的另一个物理位置，以防止区域中断。 但是，仅当客户或 Microsoft 从主区域启动故障转移时，才能读取该数据。 启用对辅助区域的读取访问时，如果主区域不可用，您的数据可供读取。 对于对辅助区域的读取访问，启用读取访问异地冗余存储 （RA-GRS） 或读取访问地理区域冗余存储 （RA-GZRS）。

### <a name="design-your-applications-for-read-access-to-the-secondary"></a>设计应用程序以读取对辅助数据库的访问

如果您的存储帐户配置为对辅助区域的读取访问，则可以设计应用程序，以无缝地切换到从辅助区域读取数据（如果主区域因任何原因不可用）。 辅助区域始终可用于读取访问，因此您可以测试应用程序，以确保在发生故障时从辅助区域读取该应用程序。 有关如何为高可用性设计应用程序的详细信息，请参阅[使用读取访问异地冗余存储设计高可用性应用程序](storage-designing-ha-apps-with-ragrs.md)。

启用对辅助端的读取访问后，可以从辅助终结点以及存储帐户的主终结点读取数据。 辅助终结点将后缀 *— 辅助*终结点追加到帐户名称。 例如，如果 Blob 存储的主终结点为`myaccount.blob.core.windows.net`，则辅助终结点为`myaccount-secondary.blob.core.windows.net`。 对于主终结点和辅助终结点，存储帐户的帐户访问密钥相同。

### <a name="check-the-last-sync-time-property"></a>检查“上次同步时间”属性

由于数据以异步方式复制到辅助区域，因此辅助区域通常位于主区域后面。 如果主区域发生故障，则很可能尚未将所有写入主项的写入都复制到辅助区域。

要确定哪些写入操作已复制到辅助区域，应用程序可以检查存储帐户**的"上次同步时间"** 属性。 在上次同步时间之前写入主区域的所有写入操作已成功复制到辅助区域，这意味着可从辅助区域读取它们。 在上次同步时间之后写入主区域的任何写入操作可能已复制到辅助区域，也可能未复制到辅助区域，这意味着它们可能不适用于读取操作。

可以使用 Azure PowerShell、Azure CLI 或其中一个 Azure 存储客户端库查询 **"上次同步时间"** 属性的值。 **"上次同步时间"** 属性是 GMT 日期/时间值。 有关详细信息，请参阅[查看存储帐户的最后同步时间属性](last-sync-time-get.md)。

## <a name="summary-of-redundancy-options"></a>冗余选项摘要

下表显示了数据在给定方案中的持久性和可用程度，具体取决于存储帐户有效的冗余类型：

| 场景                                                                                                 | LRS                             | ZRS                              | GRS/RA-GRS                                  | GZRS/RA-GZRS（预览版）                              |
| :------------------------------------------------------------------------------------------------------- | :------------------------------ | :------------------------------- | :----------------------------------- | :----------------------------------- |
| 数据中心内的节点不可用                                                                 | 是                             | 是                              | 是                                  | 是                                  |
| 整个数据中心（区域性或非区域性）不可用                                           | 否                              | 是                              | 是                                  | 是                                  |
| 发生区域范围的中断                                                                                     | 否                              | 否                               | 是                                  | 是                                  |
| 如果主区域不可用，则读取对辅助区域中的数据的访问 | 否                              | 否                               | 是（通过 RA-GRS）                                   | 是（使用 RA-GZRS）                                 |
| 给定年份<sup>1</sup>中对象的持久性百分比                                          | 至少为 99.999999999% (11 9's) | 至少为 99.9999999999% (12 9's) | 至少为 99.99999999999999% (16 9's) | 至少为 99.99999999999999% (16 9's) |
| 受支持的存储帐户类型<sup>2</sup>                                                                   | GPv2， GPv1， 块 Blob 存储， Blob 存储， 文件存储                | GPv2，块Blob存储，文件存储                             | GPv2，GPv1，Blob 存储                     | GPv2                     |
| 读取请求的可用性 SLA<sup>1</sup>  | 至少为 99.9%（冷访问层为 99%） | 至少为 99.9%（冷访问层为 99%） | GRS 至少为 99.9%（冷访问层为 99%）<br /><br />RA-GRS 至少为 99.99%（冷访问层为 99.9%） | GZRS 至少 99.9% （99% 表示冷访问层）<br /><br />RA-GZRS 至少 99.99%（冷访问层为 99.9%） |
| 写入请求的可用性 SLA<sup>1</sup>  | 至少为 99.9%（冷访问层为 99%） | 至少为 99.9%（冷访问层为 99%） | 至少为 99.9%（冷访问层为 99%） | 至少为 99.9%（冷访问层为 99%） |

<sup>1</sup>有关 Azure 存储保证的持久性和可用性的信息，请参阅[Azure 存储 SLA](https://azure.microsoft.com/support/legal/sla/storage/)。

<sup>2</sup>有关存储帐户类型的信息，请参阅[存储帐户概述](storage-account-overview.md)。

根据存储帐户的冗余选项复制所有类型的存储帐户的所有数据。 将复制对象，包括块 Blob、追加 Blob、页面 Blob、队列、表和文件。

有关每个冗余选项的定价信息，请参阅[Azure 存储定价](https://azure.microsoft.com/pricing/details/storage/)。

> [!NOTE]
> Azure 高级磁盘存储目前仅支持本地冗余存储 （LRS）。 块 Blob 存储帐户支持特定区域的本地冗余存储 （LRS） 和区域冗余存储 （ZRS）。

## <a name="data-integrity"></a>数据完整性

Azure 存储使用循环冗余检验 (CRC) 定期验证存储的数据的完整性。 如果检测到数据损坏，则使用冗余数据进行修复。 Azure 存储还计算所有网络流量的校验和，以检测存储或检索数据时数据包的损坏。

## <a name="see-also"></a>请参阅

- [检查存储帐户的"上次同步时间"属性](last-sync-time-get.md)
- [更改存储帐户的冗余选项](redundancy-migration.md)
- [使用 RA-GRS 存储设计高可用应用程序](../storage-designing-ha-apps-with-ragrs.md)
- [灾难恢复和帐户故障转移（预览）](storage-disaster-recovery-guidance.md)
