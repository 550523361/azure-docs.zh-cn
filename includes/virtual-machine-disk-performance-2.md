---
title: include 文件
description: include 文件
services: virtual-machines
author: albecker1
ms.service: virtual-machines
ms.topic: include
ms.date: 07/07/2020
ms.author: albecker1
ms.custom: include file
ms.openlocfilehash: 65f6c239f34775efff6a2ea2e399064a7702606a
ms.sourcegitcommit: f8d2ae6f91be1ab0bc91ee45c379811905185d07
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/10/2020
ms.locfileid: "89663734"
---
![Dsv3 文档](media/vm-disk-performance/dsv3-documentation.jpg)

最大非 **缓存** 磁盘吞吐量是虚拟机能够处理的默认存储最大限制。 启用主机缓存后，最大 **缓存** 存储吞吐量限制是单独的限制。 创建虚拟机并附加磁盘时，可以启用主机缓存。 你还可以调整以打开和关闭在现有 VM 上缓存磁盘的主机：

![主机缓存](media/vm-disk-performance/host-caching.jpg)

可以调整主机缓存以满足每个磁盘的工作负荷要求。 可以将主机缓存设置为只读，以便仅对执行读取和写入操作均衡的工作负荷执行读取操作和读/写操作。 如果工作负荷不遵循上述任一模式，很遗憾就无法使用主机缓存。 

接下来，我们 Standard_D8s_v3 的虚拟机。 除非这一次，我们将在磁盘上启用主机缓存，此时 VM 的 IOPS 限制为 16000 IOPS。 附加到 VM 的三个基础 P30 磁盘可处理 5000 IOPS。

设置：
- Standard_D8s_v3 
    - 缓存的 IOPS：16000
    - 未缓存 IOPS：12800
- P30 OS 磁盘 
    - IOPS：5000
    - 已启用主机缓存 
- 2 P30 数据磁盘
    - IOPS：5000
    - 已启用主机缓存

![主机缓存示例](media/vm-disk-performance/host-caching-example-without-remote.jpg)

现在，使用此 Standard_D8s_v3 已启用缓存的虚拟机的应用程序会请求 15000 IOPS。 对于每个连接的基础磁盘，这些请求将细分为 5000 IOPS，并且不会发生性能上限。

## <a name="combined-uncached-and-cached-limits"></a>合并缓存和缓存限制

虚拟机的缓存限制与缓存限制不同。 这意味着，可以在附加到 vm 的磁盘上启用主机缓存，同时也不会在其他磁盘上启用主机缓存，以允许虚拟机获取缓存的限制的总存储 IO 以及非缓存限制。 让我们通过一个示例来完成此操作，以帮助巩固这些限制如何协同工作，我们将继续 Standard_D8s_v3 虚拟机和高级磁盘附加配置。

设置：
- Standard_D8s_v3 
    - 缓存的 IOPS：16000
    - 未缓存 IOPS：12800
- P30 OS 磁盘 
    - IOPS：5000
    - 已启用主机缓存 
- 2 P30 数据磁盘 X 2
    - IOPS：5000
    - 已启用主机缓存
- 2 P30 数据磁盘 X 2
    - IOPS：5000
    - 主机缓存已禁用

![具有远程存储的主机缓存示例](media/vm-disk-performance/host-caching-example-with-remote.jpg)

现在，在 Standard_D8s_v3 虚拟机上运行的应用程序会发出 25000 IOPS 的请求。 此请求被分解为每个基础磁盘的 5000 IOPS，其中3个磁盘使用的是主机缓存，2个磁盘不是。 由于3使用主机缓存的缓存限制为16000，因此这些请求已成功完成，且不会发生存储性能限制。 此外，由于未使用主机缓存的2个磁盘处于未缓存的12800限制内，这些请求也已成功完成，且不会发生任何限制。

## <a name="metrics-for-disk-performance"></a>磁盘性能指标
我们在 Azure 上有一些指标，可提供有关虚拟机和磁盘的执行方式的见解。 可以通过 Azure 门户直观地查看这些指标，也可以通过 API 调用来检索这些指标。 指标按一分钟间隔计算。 以下指标可用于深入了解 VM、磁盘 IO 和吞吐量性能：
- **Os 磁盘队列深度** –等待读取或写入 OS 磁盘的当前未完成 IO 请求数。
- **Os 磁盘读取字节数/秒** –从 OS 磁盘中读取的字节数。
- **Os 磁盘读取操作数/秒** –从 OS 磁盘读取秒的输入操作数。
- **Os 磁盘写入字节数/秒** –从 OS 磁盘写入的字节数。
- **Os 磁盘写入操作数/秒** –从 OS 磁盘写入秒的输出操作数。
- **数据磁盘队列深度** –等待读取或写入数据磁盘)  (的当前未完成 IO 请求数。
- **数据磁盘读取字节数/秒** –从数据磁盘) 中读取的字节数 (。
- **数据磁盘读取操作数/秒** –从数据磁盘)  (读取的输入操作的数量。
- **数据磁盘写入字节数/秒-每** 秒从数据磁盘写入)  (的字节数。
- **数据磁盘写入操作数/秒** –从数据磁盘)  (写入的输出操作数。
- **磁盘读取字节数/秒** –从所有附加到 VM 的磁盘中读取的总字节数。
- **磁盘读取操作数/秒** –从所有附加到 VM 的磁盘中读取的输入操作数。
- **磁盘写入字节数/秒** –附加到 VM 的所有磁盘写入的字节数。
- **磁盘写入操作数/秒** –从附加到 VM 的所有磁盘写入的输出操作数。

## <a name="storage-io-utilization-metrics"></a>存储 IO 利用率指标
有助于诊断磁盘 IO 上限的指标：
- **使用的数据磁盘 IOPS 百分比** -通过预配的数据磁盘 iops 完成的数据磁盘 iops 计算得出的百分比。 如果此数量为100%，则运行的应用程序将从数据磁盘的 IOPS 限制中限制 IO。
- **数据磁盘带宽消耗百分比** -通过预配的数据磁盘吞吐量完成的数据磁盘吞吐量计算得出的百分比。 如果此数量为100%，则运行的应用程序将从数据磁盘的带宽限制中限制 IO。
- **Os 磁盘 IOPS** 已用百分比-通过预配的 Os 磁盘 iops 完成的 Os 磁盘 iops 计算得出的百分比。 如果此数量为100%，则运行应用程序时，会将 IO 限制为操作系统磁盘的 IOPS 限制。
- **Os 磁盘带宽消耗百分比** -通过预配的 os 磁盘吞吐量完成的 os 磁盘吞吐量计算得出的百分比。 如果此数量为100%，则运行的应用程序将是由操作系统磁盘的带宽限制限制的 IO。